var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},DeBug=new MooTools.Class({name:"DeBug",mInitialized:null,mStart:null,mBreakpoints:[],mCounters:{},initialize:function(){this.mInitialized=new Date},start:function(t){this.mStart=new Date,this.mBreakpoints=[],t&&console.log("Start: "+this.mStart.getTime()/1e3)},getElapsed:function(){var t=((new Date).getTime()-this.mStart.getTime())/1e3,e=[t];return this.mBreakpoints.each(function(o){e.push(Math.round(100*(t-o))/100)}),this.mBreakpoints.push(t),e},showElapsed:function(t){var e=(t||"Elapsed:")+" ",o=this.getElapsed();console.log(e+o.join(" "))},count:function(t){t=t||DeBug.COUNTER_DEFAULT,this.mCounters[t]?this.mCounters[t]++:this.mCounters[t]=1},getCount:function(t){return t=t||DeBug.COUNTER_DEFAULT,this.mCounters[t]||0},getAllCounters:function(){return this.mCounters}});DeBug.COUNTER_DEFAULT="_default_",DeBug.perf={},DeBug.perfStart=function(t){DeBug.perf[t]="object"==_typeof(window.performance)?performance.now():0},DeBug.perfGet=function(t,e){console.log("Performance",t,e||"",("object"==_typeof(window.performance)?performance.now():0)-DeBug.perf[t])};
!function(n){"use strict";var u=function(){return _.defaults({TESTENUM:"foo"},n.Enums)}();n.Enums=u}(window);
!function(E){"use strict";var n=function(){return _.defaults({KEYS:{ESC:27,ENTER:13,TAB:9,BACKSPACE:8,DELETE:46}},E.Enums)}();E.Enums=n}(window);
!function(){"use strict";function t(t,e,i){this.mCanvas=t,this.mWrapper=e,this.options=_.defaults(i,this.options)}t.prototype={mCanvas:null,mWrapper:null,mSelection:null,mCurrentHandler:"RB",mSelectionStartOffset:{},mEventsRef:{},mRatio:null,mStartDim:null,mStartHandler:null,options:{create:function(){},change:function(t){},confirm:function(){},close:function(){}},render:function(){this.mWrapper.classList.add("crop-wrapper"),this.mWrapper.classList.add("crop-hidden"),this.mWrapper.appendChild(this.mSelection=this.createSelectionLayer()),this.mRatio=ToolsBoxWidgetImageSettingsCrop.RATIO_NONE,this.mEventsRef.applyCrop=this.applyCrop.bind(this),this.mSelection.addEventListener("dblclick",this.mEventsRef.applyCrop),this.mEventsRef.keyDown=this.keyDown.bind(this),document.addEventListener("keydown",this.mEventsRef.keyDown,!1);var t=this.mWrapper.clientWidth,e=this.mWrapper.clientHeight;this.showSelectionLayer({left:.1*t,top:.1*e,width:.8*t,height:.8*e})},createSelectionLayer:function(){var t=document.createElement("div");return t.className="crop-selection",t.style.zIndex=parseInt(this.mCanvas.style.zIndex,10)+1,["LT","T","RT","R","RB","B","LB","L"].map(function(e){t.appendChild(this.createResizeHandler(e))},this),t},createResizeHandler:function(t){var e=document.createElement("a");return e.classList.add("r-"+t),this.mEventsRef.startResize=this.startResize.bind(this),e.addEventListener("mousedown",this.mEventsRef.startResize),e.addEventListener("mouseover",function(t){null===this.mStartHandler&&e.classList.add("hovered")}.bind(this)),e.addEventListener("mouseout",function(t){null===this.mStartHandler&&e.classList.remove("hovered")}.bind(this)),e},showSelectionLayer:function(t){this.mSelectionStartOffset={left:t.left,top:t.top},this.options.create(),this.mSelection.style.display="block",this.setSelectionDimensions(t),this.mWrapper.classList.add("active-crop"),this.initializeDragAndDrop()},applyCrop:function(t){t.preventDefault(),t.stopPropagation(),this.options.confirm()},keyDown:function(t){[13,27].indexOf(t.keyCode)>=0&&(t.preventDefault(),13===t.keyCode?this.options.confirm():this.options.close())},initializeDragAndDrop:_.debounce(function(){this.mDrag=new Drag(this.mSelection,{stopPropagation:!0,preventDefault:!0,snap:0,limit:{x:[0,this.mWrapper.offsetWidth-this.mSelection.offsetWidth],y:[0,this.mWrapper.offsetHeight-this.mSelection.offsetHeight]},onComplete:this.change.bind(this)})},100),setSelectionDimensions:function(t){t=_.pick(t,["width","height","top","left"]),_.forEach(t,function(t,e){this.mSelection.style[e]=t+"px"}.bind(this)),this.change()},setSelectionWidth:function(t){var e={},i=parseInt(this.mSelection.style.width,10)||0,s=parseInt(this.mSelection.style.left,10)||0,n=parseInt(this.mSelection.style.top,10)||0,o=this.mWrapper.clientWidth,a=o-s-2,r=this.mWrapper.clientHeight,h=r-n-2;a=this.hasRatio()?Math.min(a,this.getXUsingRatio(h)):a,t=t-i-2,i+=t,i=i<=0?1:i,e.width=i>a?a:i,e.left=s,this.hasRatio()&&(this.mStartDim=this.getInitialDimensions(),this.calculateYUsingRatio("RB",e,this.mWrapper.clientHeight,!1)),this.setSelectionDimensions(e),this.initializeDragAndDrop()},setSelectionHeight:function(t){var e={},i=parseInt(this.mSelection.style.height,10)||0,s=parseInt(this.mSelection.style.top,10)||0,n=parseInt(this.mSelection.style.left,10)||0,o=this.mWrapper.clientHeight,a=o-s-2,r=this.mWrapper.clientWidth,h=r-n-2;a=this.hasRatio()?Math.min(a,this.getXUsingRatio(h)):a,t=t-i-2,i+=t,i=i<=0?1:i,e.height=i>a?a:i,e.top=s,this.hasRatio()&&(this.mStartDim=this.getInitialDimensions(),this.calculateXUsingRatio("RB",e,this.mWrapper.clientWidth,!1)),this.setSelectionDimensions(e),this.initializeDragAndDrop()},change:_.throttle(function(){"function"==typeof this.options.change&&this.options.change(this.getSelectionCoordinates())},10),setCurrentHandler:function(t){this.mCurrentHandler=t,this.mSelection.getElementsByClassName("r-"+t)[0].classList.add("active")},clearCurrentHandler:function(){var t=this.mSelection.getElementsByClassName("active")[0];t&&t.classList.remove("active")},updateStartOffset:function(){switch(this.mCurrentHandler){case"R":case"RB":case"B":this.mSelectionStartOffset.left=this.mSelection.offsetLeft,this.mSelectionStartOffset.top=this.mSelection.offsetTop;break;case"LB":case"L":this.mSelectionStartOffset.left=this.mSelection.offsetLeft+this.mSelection.clientWidth,this.mSelectionStartOffset.top=this.mSelection.offsetTop;break;case"LT":case"T":this.mSelectionStartOffset.left=this.mSelection.offsetLeft+this.mSelection.clientWidth,this.mSelectionStartOffset.top=this.mSelection.offsetTop+this.mSelection.clientHeight;break;default:this.mSelectionStartOffset.top=this.mSelection.offsetTop+this.mSelection.clientHeight,this.mSelectionStartOffset.left=this.mSelection.offsetLeft}},startResize:function(t){t&&(t.preventDefault(),t.stopPropagation(),t.target.classList.remove("hovered")),this.mStartDim=this.getInitialDimensions(),this.setCurrentHandler(t?this.getHandlerByClassName(t.target.className):this.mCurrentHandler),this.updateStartOffset(),this.mStartHandler=this.mCurrentHandler,this.mEventsRef.resize=this.resize.bind(this),this.mEventsRef.stopResize=this.stopResize.bind(this),document.addEventListener("mousemove",this.mEventsRef.resize),document.addEventListener("mouseup",this.mEventsRef.stopResize)},getHandlerByClassName:function(t){return t.test(" ")&&t.split(" ").forEach(function(e){e.test("r-")&&(t=e)}),t.split("r-")[1]},stopResize:function(t){t&&(t.preventDefault(),t.stopPropagation()),this.mStartHandler=null,this.mStartDim=null,document.removeEventListener("mousemove",this.mEventsRef.resize),document.removeEventListener("mouseup",this.mEventsRef.stopResize),this.clearCurrentHandler(),this.initializeDragAndDrop()},resize:function(t){var e;switch(this.mCurrentHandler){case"L":case"R":e="horizontal";break;case"T":case"B":e="vertical";break;default:e="both"}var i=this.resizeAccordingToPlane[e].apply(this,[t.pageX,t.pageY,this.mWrapper.getBoundingClientRect()]);this.setSelectionDimensions(i)},getInitialDimensions:function(){return{left:parseInt(this.mSelection.style.left,10)||0,top:parseInt(this.mSelection.style.top,10)||0,width:parseInt(this.mSelection.style.width,10)||0,height:parseInt(this.mSelection.style.height,10)||0}},hasRatio:function(){return this.mRatio!==ToolsBoxWidgetImageSettingsCrop.RATIO_NONE},getXUsingRatio:function(t){switch(this.mRatio){case ToolsBoxWidgetImageSettingsCrop.RATIO_1_1:return t;case ToolsBoxWidgetImageSettingsCrop.RATIO_16_9:return 16*t/9;case ToolsBoxWidgetImageSettingsCrop.RATIO_9_16:return 9*t/16;case ToolsBoxWidgetImageSettingsCrop.RATIO_4_3:return 4*t/3;case ToolsBoxWidgetImageSettingsCrop.RATIO_3_4:return 3*t/4}},getYUsingRatio:function(t){switch(this.mRatio){case ToolsBoxWidgetImageSettingsCrop.RATIO_1_1:return t;case ToolsBoxWidgetImageSettingsCrop.RATIO_9_16:return 16*t/9;case ToolsBoxWidgetImageSettingsCrop.RATIO_16_9:return 9*t/16;case ToolsBoxWidgetImageSettingsCrop.RATIO_3_4:return 4*t/3;case ToolsBoxWidgetImageSettingsCrop.RATIO_4_3:return 3*t/4}},calculateXUsingRatio:function(t,e,i,s){var n=t.test("L"),o=t.test("R"),a=t.test("T"),r=t.test("B"),h=s&&(n||o),l=s&&(a||r),c=n?1:o?0:.5,m=a?1:0,d=i-Math.abs(i*(h?o?1:0:c)-(this.mStartDim.left+this.mStartDim.width*(h?n?1:0:c)))*(.5===c?2:1),p=this.getXUsingRatio(e.height);e.width=p>d?d:p,e.height=this.getYUsingRatio(e.width),e.left=this.mStartDim.left-(e.width-this.mStartDim.width)*c-(h?n?-1:1:0)*e.width,e.top=this.mStartDim.top-(e.height-this.mStartDim.height)*m-(l?a?-1:1:0)*e.height},calculateYUsingRatio:function(t,e,i,s){var n=t.test("L"),o=t.test("R"),a=t.test("T"),r=t.test("B"),h=s&&(n||o),l=s&&(a||r),c=n?1:0,m=a?1:r?0:.5,d=i-Math.abs(i*(l?r?1:0:m)-(this.mStartDim.top+this.mStartDim.height*(l?a?1:0:m)))*(.5===m?2:1),p=this.getYUsingRatio(e.width);e.height=p>d?d:p,e.width=this.getXUsingRatio(e.height),e.top=this.mStartDim.top-(e.height-this.mStartDim.height)*m-(l?a?-1:1:0)*e.height,e.left=this.mStartDim.left-(e.width-this.mStartDim.width)*c-(h?n?-1:1:0)*e.width},resizeAccordingToPlane:{horizontal:function(t,e,i){var s={},n=this.getRelativeMouseX(t,i.left);n=n<0?0:n;var o=Math.min(n,this.mSelectionStartOffset.left),a=i.width-o,r=Math.abs(n-this.mSelectionStartOffset.left),h=n>this.mSelectionStartOffset.left?1:-1,l=h>0&&this.mStartHandler.test("L")||h<0&&this.mStartHandler.test("R");return s.width=r>a?a:r,s.left=o,(h>0&&this.mCurrentHandler.test("L")||h<0&&this.mCurrentHandler.test("R"))&&(this.hasRatio()?this.switchHandler("both"):this.switchHandler("horizontal")),this.hasRatio()&&this.calculateYUsingRatio(this.mStartHandler,s,i.height,l),s},vertical:function(t,e,i){var s={},n=this.getRelativeMouseY(e,i.top);n=n<0?0:n;var o=Math.min(n,this.mSelectionStartOffset.top),a=i.height-o,r=Math.abs(n-this.mSelectionStartOffset.top),h=n>this.mSelectionStartOffset.top?1:-1,l=h>0&&this.mStartHandler.test("T")||h<0&&this.mStartHandler.test("B");return s.height=r>a?a:r,s.top=o,(h>0&&this.mCurrentHandler.test("T")||h<0&&this.mCurrentHandler.test("B"))&&(this.hasRatio()?this.switchHandler("both"):this.switchHandler("vertical")),this.hasRatio()&&this.calculateXUsingRatio(this.mStartHandler,s,i.width,l),s},both:function(t,e,i){return _.extend(this.resizeAccordingToPlane.horizontal.apply(this,arguments),this.resizeAccordingToPlane.vertical.apply(this,arguments))}},switchHandler:function(t){var e=this.switchHandlersMap[t][this.mCurrentHandler];this.mSelection.querySelector(".r-"+this.mCurrentHandler).classList.remove("active"),this.mSelection.querySelector(".r-"+e).classList.add("active"),this.mCurrentHandler=e},switchHandlersMap:{horizontal:{RT:"LT",R:"L",RB:"LB",LT:"RT",L:"R",LB:"RB"},vertical:{LT:"LB",T:"B",RT:"RB",LB:"LT",B:"T",RB:"RT"},both:{L:"R",R:"L",T:"B",B:"T",LT:"RB",RT:"LB",LB:"RT",RB:"LT"}},getRelativeMouseY:function(t,e){return t-e},getRelativeMouseX:function(t,e){return t-e},getSelectionCoordinates:function(){var t=this.mSelection.clientWidth,e=this.mSelection.clientHeight;return{left:this.mSelection.offsetLeft,top:this.mSelection.offsetTop,height:e?e+2:0,width:t?t+2:0}},getCroppedCanvas:function(){var t=this.getSelectionCoordinates(),e=document.createElement("canvas"),i=e.getContext("2d");return e.width=t.width,e.height=t.height,i.drawImage(this.mCanvas,t.left,t.top,t.width,t.height,0,0,t.width,t.height),e},setRatio:function(t){this.mRatio=t,this.mSelection.classList.add("change-ratio"),this.setSelectionWidth(parseInt(this.mSelection.style.width,10)||0),this.mSelection.onTransitionEnd(function(){this.mSelection.classList.remove("change-ratio")}.bind(this))},destroy:function(){this.mWrapper.classList.remove("active-crop"),this.mWrapper.classList.remove("crop-wrapper"),this.mSelection.parentNode.removeChild(this.mSelection),document.removeEventListener("keydown",this.mEventsRef.keyDown,!1)}},window.Crop=t}();
!function(t){"use strict";function n(t){v=t,p()}function e(){return N}function i(t){N=t}function o(t){g=t}function c(){return g}function s(t,n,e,i){var o=(_.isUndefined(i)?v:i)+t;return new Promise(function(t,i){var c=new XMLHttpRequest;c.onreadystatechange=function(){if(c.readyState===k.REQUEST_FINISHED&&c.status===T.OK){var n=c.responseText?JSON.parse(c.responseText):"";t(n)}else c.readyState===k.REQUEST_FINISHED&&i(c)},c.open(n,o,!0),c.withCredentials=!0,c.setRequestHeader("Content-Type","application/json"),c.send(JSON.stringify(e))})}function a(){return s("/ajax/dmsAccountSettings/GetSettings/","GET",{},"").then(function(t){return!(!t||!t.settings)&&t.settings.slack_notifications})}function r(){return s("/ajax/dmsAccountSettings/SetSlackNotificationSettings/","POST",!1,"")}function u(){return s("/ajax/dmsAccountSettings/SetSlackNotificationSettings/","POST",!0,"")}function d(t){return s("/slack/message/channel/","POST",t)}function l(){return s("/slack/state/","GET",{}).then(function(t){return C.idClient=t.idClient,C.scope=t.scope,C.state=t.state,t})}function f(t){return s("/slack/authorize/","POST",t)}function S(){return s("/slack/authorize/","DELETE",{})}function w(t){return s("/slack/"+t+"/list/","GET",{})}function E(t,n){return s("/slack/"+t+"/list/","PUT",n)}function p(){var t=h("error"),n=h("state"),e={code:h("code"),state:n};if(window.opener&&n){var i=window.opener.document.createEvent("Event"),o=document.createElement("div");o.setAttribute("id","spinner-loader"),document.body.classList.add("loading"),document.body.classList.add("connecting"),document.body.insertBefore(o,document.body.firstChild),i.initEvent(m,!0,!0),t?(window.opener.document.dispatchEvent(i),window.close()):f(e).then(function(){return u()}.bind(this)).then(function(){window.opener.document.dispatchEvent(i),window.close()}).catch(function(){window.opener.document.dispatchEvent(i),window.close()})}}function h(t){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var n=new RegExp("[\\?&]"+t+"=([^&#]*)"),e=n.exec(location.search);return null===e?"":decodeURIComponent(e[1].replace(/\+/g," "))}var g,T={OK:200},k={REQUEST_FINISHED:4},m="SLACK_AUTH_EVENT",v="",N=!1,C={},A=function(){return{getState:l,getList:w,setChannel:E,authorize:f,startAuthorization:p,sendMessageToChannel:d,switchOnSlackNotifications:u,switchOffSlackNotifications:r,getSlackSettings:a,setApiHost:n,setNewDashboardUrl:o,getNewDashboardUrl:c,setSlackConnectionPermission:i,canConnectToSlack:e,disconnectSlack:S,SLACK_AUTH_EVENT:m,slackData:C}};t.SlackService=new A}(window);
var UXPS3ImageUpload=new MooTools.Class({Implements:[MooTools.Options],options:{after_upload:MooTools.$empty,onProgress:MooTools.$empty,overwrite:0,add_to_library:1,collection:null},upload:function(o,e){"use strict";this.setOptions(e);var t={file_name:o.name,file_type:o.type,file_size:o.size,directory_id:this.options.root,no_redirect:1,overwrite:this.options.overwrite,add_to_library:this.options.add_to_library,id_collection:this.options.id_collection};o.resolution&&(t.resolution=o.resolution),(new Dejax).send({url:"/ajax/dmsFileManager/PrepareUpload/",data:t,onComplete:function(e){if(!e.status||!e.params)return void alert(e.message||"Could not proceed with upload. \nPlease refresh page and try again.");var t=new FormData;new MooTools.Hash(e.params).each(function(o,e){t.append(e,o)}),t.append("file",o);var s=new MooTools.Browser.Request;s.open("POST",e.upload_url,!0),s.onreadystatechange=function(){if(4===s.readyState){var o=new MooTools.Browser.Request;if(this.options.add_to_library&&(o.open("GET",e.success_action_redirect),o.send()),dpManager.dpWorkBench.imageUploaded(e.id_stored_file),this.options.afterUpload){var t=[e.upload_url,"/",e.params.key].join("");this.options.afterUpload(t)}}}.bind(this),this.options.onProgress&&(s.upload.onprogress=this.options.onProgress),s.send(t)}.bind(this)})}});
var UXPUploadHandler=new MooTools.Class({name:"UXPUploadHandler",Implements:[MooTools.Options],mUploads:[],options:{uploader:"UXPUploadCreateImageProcess",uploader_options:MooTools.$empty,mime_match:"image.*",max_file_size_mb:100,onFileError:MooTools.$empty},initialize:function(e){"use strict";this.setOptions(e)},process:function(e,t){"use strict";var s,o=t.dataTransfer?t.dataTransfer.getData("imageData"):void 0,r=o?JSON.parse(o):void 0;if(!e.length&&r&&r.fullRes&&r.thumbnail){var i=_.extend(this.options.uploader_options,{progress_text_template:"Loading image&nbsp;<strong>{progress}%</strong>"});return void this.mUploads.push(new window[this.options.uploader](r,t,i,s))}var a=e.length;for(s=0;s<a;s++)e[s].type.match(this.options.mime_match)&&e[s].size/1024/1024<this.options.max_file_size_mb?this.mUploads.push(new window[this.options.uploader](e[s],t,this.options.uploader_options,s)):(console.log("cannot upload",e[s]),this.options.onFileError())}}),UXPUploadCreateImageProcess=new MooTools.Class({name:"UXPUploadCreateImageProcess",Implements:[MooTools.Options,UXPS3ImageUpload],mCreatedEl:null,mProgressLayer:null,options:{element_type:"Image",element_props_map:{width:"width",height:"height",source:"src"},special_props:[{name:"ignore_popup_on_drop",value:!0}],afterUploadFn:MooTools.$empty},initialize:function(e,t,s,o){"use strict";var r=!!e.type;return this.setOptions(s),!!this.options.root&&(r?void this.processFile(e,t,s,o):void this.processExternalImage(e,t,s))},processExternalImage:function(e,t){"use strict";var s=window.URL||window.webkitURL,o=new Image;o.src=e.thumbnail,o.width=e.width,o.height=e.height,this.mCreatedEl=this.addElement(o,t.pageX,t.pageY),this.mCreatedEl.removeHoverEvents(),this.mProgressLayer=this.mCreatedEl.mDropLayerInfo,this.mProgressLayer.showProgressLayer(),this.options.progress_text_template&&this.mProgressLayer.setProgressTextTemplate(this.options.progress_text_template),this.mCreatedEl.setSrc(o.src);var r=new XMLHttpRequest;r.open("GET",e.fullRes,!0),r.responseType="blob",r.onprogress=function(e){this.mProgressLayer.setProgress(e.loaded/e.total*100)}.bind(this),r.onload=function(){var t=s.createObjectURL(r.response);this.afterUpload(e.fullRes,t)}.bind(this),this.mProgressLayer.showProgressLayer(),r.send()},processFile:function(e,t,s,o){"use strict";var r=window.URL||window.webkitURL,i=o||0,a=new Image;a.onload=function(){this.mCreatedEl=this.addElement(a,t.pageX+10*i,t.pageY+10*i),this.mCreatedEl.removeHoverEvents(),this.mProgressLayer=this.mCreatedEl.mDropLayerInfo,this.mProgressLayer.showProgressLayer(),this.mCreatedEl.setSrc(a.src),this.mCreatedEl.fireEvent("processing",!0),e.resolution=[a.width,a.height].join("x"),this.upload(e,{id_collection:dpManager.dpProject.mData.id_collection,afterUpload:this.afterUpload.bind(this),onProgress:this.mProgressLayer.setProgressUsingEvent.bind(this.mProgressLayer)})}.bind(this),a.src=r.createObjectURL(e)},addElement:function(e,t,s){"use strict";var o=this.getElementCoords(t,s),r={};return r[this.options.element_props_map.width]=e.width,r[this.options.element_props_map.height]=e.height,this.options.special_props.each(function(e){r[e.name]=e.value}),dpManager.dpWorkBench.getActivePage().createElement(this.options.element_type,r,null,null,null,!0,!0,!1,o.pX,o.pY)},getElementCoords:function(e,t){return this.transformToMppEditorCoords(e,t)},transformToMppEditorCoords:function(e,t){var s=dpManager.dpWorkBench.getWorkBenchEl().getBoundingClientRect();return{pX:e-s.left,pY:t-s.top}},afterUpload:function(e,t){"use strict";this.mProgressLayer.setProgress(100),this.setSource(e,!1,!1),t&&this.setSource(t,!1,!0),this.mProgressLayer.hideProgressLayer.delay(300,this.mProgressLayer),this.mCreatedEl.fireEvent("processing",!1),this.options.afterUploadFn(e,t)},setSource:function(e,t,s){"use strict";t||(t=this.mCreatedEl),s?t.setSrc(e):t.setProperty("src",e,!0,!0,1)}});
var UXPEditorDropHandler=new MooTools.Class({name:"UXPEditorDropHandler",Implements:[MooTools.Options],mZone:null,options:{upload_handler:new UXPUploadHandler,ondragstart:function(){},ondragover:function(){return!1},ondragend:function(){return!1},ondragenter:function(){return!1},ondragleave:function(){return!1},ondrop:this.onDropEvent,onDropCallback:function(){}},mUploadRoot:null,initialize:function(o){this.setOptions(o);var n=this.options.element;"string"==typeof n&&(n=document.getElement(n)),n||console&&console.error("No dropzone found"),this.mZone=n,this.addEvents(this.mZone)},addEvents:function(o){o.ondragstart=this.options.ondragstart,o.ondragover=this.options.ondragover,o.ondragend=this.options.ondragend,o.ondragenter=this.options.ondragenter,o.ondragleave=this.options.ondragleave,o.ondrop=this.dropEvent.bind(this)},dropEvent:function(o){var n=o.dataTransfer.files;return this.options.onDropCallback&&this.options.onDropCallback(n),o.stopPropagation(),o.preventDefault(),this.options.upload_handler.process(n,o),!1}});
var UXPUploadInfoLayer=new MooTools.Class({name:"UXPUploadInfoLayer",mSmallApplied:!1,mApplied:!1,mParent:null,mZIndexFrom:null,mInfoLayer:null,mUploadProgressBar:null,mDropHTML:null,mProgressHTML:"Uploading image <strong>{progress}%</strong>",mPrevProgressHTML:null,mHideCounter:null,mProcessing:!1,initialize:function(s){this.mHideCounter=new MooTools.Hash({}),this.mParent=s,this.mInfoLayer=new MooTools.Element("div",{class:"img-uploading hidden"}),this.mUploadProgressText=new MooTools.Element("p",{class:"upload-progress hidden",html:this.mProgressHTML}),this.mUploadProgressBar=new MooTools.Element("span",{class:"progress-bar hidden",style:{width:"0%"}}),this.mDropHTML=new MooTools.Element("p",{class:"upload-info hidden",html:'<strong class="icon-font-drag">Drop image here</strong>'})},isProcessing:function(){return this.mProcessing},attachInfoLayer:function(){this.mInfoLayer.grab(this.mUploadProgressText),this.mInfoLayer.grab(this.mUploadProgressBar),this.mInfoLayer.grab(this.mDropHTML),this.mParent.addEvent("parent_object_resize",function(s){var e=s.width.toInt(),t=s.height.toInt();this.toggleSmallClass(e,t,this.mInfoLayer)}.bind(this)),this.mParent.grab(this.mInfoLayer,"bottom")},getZIndex:function(){return this.mParent.getElement(".dpElement").getStyle("z-index").toInt()},showUploadZone:function(){this.mHideCounter.drop&&MooTools.$clear(this.mHideCounter.drop),this.toggleSmallClass(this.mParent.getStyle("width").toInt(),this.mParent.getStyle("height").toInt(),this.mInfoLayer),this.mInfoLayer.setStyle("z-index",this.getZIndex()),this.mInfoLayer.removeClass("hidden"),this.mDropHTML.removeClass("hidden")},hideUploadZone:function(){this.mInfoLayer.addClass("hidden");var s=function(){this.mDropHTML.addClass("hidden")};this.mHideCounter.drop=s.delay(330,this)},showProgressLayer:function(){this.mProcessing=!0,this.mInfoLayer.removeClass("gray-style"),this.toggleSmallClass(this.mParent.getStyle("width").toInt(),this.mParent.getStyle("height").toInt(),this.mInfoLayer),this.setProgressText(0),this.mInfoLayer.setStyle("z-index",this.getZIndex()),this.mInfoLayer.removeClass("hidden"),this.mInfoLayer.addClass("uploading"),this.mUploadProgressText.removeClass("hidden"),this.mUploadProgressBar.removeClass("hidden")},hideProgressLayer:function(){this.mProcessing=!1,this.mInfoLayer.addClass("hidden"),this.mUploadProgressText.addClass("hidden"),this.mUploadProgressBar.addClass("hidden"),this.mInfoLayer.removeClass("uploading"),this.setProgressBar.delay(300,this,0)},setProgress:function(s){s=s.toInt(),this.setProgressText(s),this.setProgressBar(s)},setProgressText:function(s){this.mUploadProgressText.set("html",this.mProgressHTML.replace(/{progress}/g,s))},setProgressBar:function(s){this.mUploadProgressBar.setStyle("width",s+"%")},setProgressUsingEvent:function(s){var e=s.loaded/s.total*100;this.setProgress(e)},endProgress:function(){this.setProgressText(0),this.setProgressBar(0)},toggleSmallClass:function(s,e,t){this.checkIfSmall(s,e)?(!this.mSmallApplied&&t.addClass("small"),this.mSmallApplied=!0):(this.mSmallApplied&&t.removeClass("small"),this.mSmallApplied=!1)},checkIfSmall:function(s,e){return s.toInt()<225||e.toInt()<145},addHoverClass:function(){this.mHideCounter.hover&&MooTools.$clear(this.mHideCounter.hover),this.mInfoLayer.addClass("gray-style"),this.showUploadZone()},removeHoverClass:function(){this.hideUploadZone();var s=function(){this.mInfoLayer.removeClass("gray-style")};this.mHideCounter.hover=s.delay(330,this)},setProgressTextTemplate:function(s){this.mPrevProgressHTML=this.mProgressHTML,this.mProgressHTML=s},resetProgressTextTemplate:function(){this.mPrevProgressHTML&&(this.mProgressHTML=this.mPrevProgressHTML)}});
var StickyNotes=new MooTools.Class({name:"StickyNotes",mWidth:0,mHeight:0,mCanvasElement:null,mCTX:null,mTextElement:null,mContainerElement:null,mColorSet:"yellow",mColorSets:{yellow:{base_color:"#FFE605",header_saturation:59},orange:{base_color:"#FF6A00",header_saturation:47},green:{base_color:"#71FF58",header_saturation:55},pink:{base_color:"#ff55aa",header_saturation:47},blue:{base_color:"#46D6F1",header_saturation:55}},initialize:function(t,e){return this.mCanvasElement=new Canvas,this.mContainerElement=new MooTools.Element("div",{class:"StickyNote"}),this.mCanvasElement.injectInside(this.mContainerElement),this.mTextElement=new MooTools.Element("span").injectInside(this.mContainerElement),this.mCanvasElement.setStyles({position:"absolute",left:0,top:0}),this.mCTX=this.mCanvasElement.getContext("2d"),this.setWidth(t),this.setHeight(e),this.refreshView(),this},setWidthHeight:function(t,e){this.mWidth=parseInt(t),this.mWidth<50&&(this.mWidth=50),this.mHeight=parseInt(e),this.mHeight<50&&(this.mHeight=50),this.mCanvasElement.set("width",this.mWidth),this.mCanvasElement.set("height",this.mHeight),this.refreshView()},setWidth:function(t){return this.mWidth=parseInt(t),this.mWidth<50&&(this.mWidth=50),this.mCanvasElement.set("width",this.mWidth),this.refreshView(),this},setHeight:function(t){return this.mHeight=parseInt(t),this.mHeight<50&&(this.mHeight=50),this.mCanvasElement.set("height",this.mHeight),this.refreshView(),this},drawNote:function(){if(this.mHeight&&this.mWidth){this.mCTX.clearRect(0,0,this.mWidth,this.mHeight);for(var t={x:5,y:5},e=0;e<=4;e++)this.roundedRect(this.mCTX,t.x+1+e,t.y+1+e,this.mWidth-2*e-t.x-4,this.mHeight-2*e-t.y-4,4-e+3,[70,70,70],4==e?.1:.03+.04*e);var i=this.mCTX.createLinearGradient(0,0,0,this.mHeight),s=this.mColorSets[this.mColorSet].base_color,h=new Color(s).setSaturation(23);i.addColorStop(0,h.rgbToHex()),i.addColorStop(1,s),this.mCTX.fillStyle=this.mColorSets[this.mColorSet].base_color,this.mCTX.fillRect(8,8,this.mWidth-16,this.mHeight-16),this.mCTX.fillStyle=i,this.mCTX.fillRect(8,8,this.mWidth-16,this.mHeight-16);var o=new Color(this.mColorSets[this.mColorSet].base_color).setSaturation(this.mColorSets[this.mColorSet].header_saturation);return this.mCTX.fillStyle=o.rgbToHex(),this.mCTX.fillRect(8,8,this.mWidth-16,24),this}},refreshView:function(){return this.mContainerElement.setStyles({width:this.mWidth,height:this.mHeight}),this.drawNote(),this},getCanvasElement:function(){return this.mContainerElement},setText:function(t){var e=t.split("\n"),i='<div class="StickyNoteHeader">'+e.shift()+"</div>"+e.join("<br/>");return this.mTextElement.set("html",i),this},setColor:function(t){return this.mColorSet=t.toLowerCase(),this.refreshView(),this},roundedRect:function(t,e,i,s,h,o,n,r){t.fillStyle="rgba("+n.join(",")+","+r+")",t.beginPath(),t.moveTo(e,i+o),t.lineTo(e,i+h-o),t.quadraticCurveTo(e,i+h,e+o,i+h),t.lineTo(e+s-o,i+h),t.quadraticCurveTo(e+s,i+h,e+s,i+h-o),t.lineTo(e+s,i+o),t.quadraticCurveTo(e+s,i,e+s-o,i),t.lineTo(e+o,i),t.quadraticCurveTo(e,i,e,i+o),t.fill()}});
Dejax=new MooTools.Class({name:"Dejax",Implements:[MooTools.Events],mTTL:3e4,mRh:null,mIsActiveConnection:!1,mQueue:new Array,mForceLeave:!1,mLogoutUrl:"/mod/Login/Logout",options:{mode:"free",completePass:new MooTools.Array,data:null,prevent:!1,url:null,eval:!0,evalData:null,debugRequest:!1},initialize:function(){this.resetOptions()},createRequestHandler:function(){this.mRh=new MooTools.Request.JSON({onComplete:this.onCompleteCall.bind(this),onSuccess:this.onSuccessCall.bind(this),onFailure:this.onFailureCall.bind(this),evalScripts:!1,url:this.options.url})},resetOptions:function(){this.options={mode:"free",eval:!0,completePass:new MooTools.Array,data:null,prevent:!1,url:null,evalData:null,debugRequest:!1},this.removeEvents("onComplete"),this.removeEvents("onSuccess"),this.removeEvents("onFailure")},setOptions:function(e){e.onComplete&&this.addEvent("onComplete",e.onComplete),e.onSuccess&&this.addEvent("onSuccess",e.onSuccess),e.onFailure&&this.addEvent("onFailure",e.onFailure);for(i in this.options)this.options[i]=e[i]},newRequest:function(e){switch(e.mode){default:case"free":return(new Dejax).send(e),!0;case"cancel":if(1==this.options.prevent){var t=this.mQueue.length.toInt()-1;return this.mQueue[t]&&"cancel"==this.mQueue[t].mode&&this.mQueue.pop(),this.mQueue.include(e),!1}1==this.mIsActiveConnection&&(MooTools.$clear(this.options.debugDelay),this.mRh.cancel());break;case"queue":if(1==this.mIsActiveConnection)return this.mQueue.extend([e]),!0}if(1==this.options.prevent)return!1;this.send(e)},send:function(e){if(e&&(this.resetOptions(),this.setOptions(e)),!this.options)return!1;if(this.fireEvent("onStart"),this.mIsActiveConnection=!0,this.options.url=this.options.url.replace(/(\?|&)__ajax_request=1/g,""),e.noDmsAjax||(this.options.url.match(/\?/)?this.options.url+="&__ajax_request=1":this.options.url+="?__ajax_request=1"),this.createRequestHandler(),"GET"===e.method)this.mRh.get();else{var t=this.options.data;this.mRh.post(t)}},showAlert:function(){alert("nie wolno!")},onSuccessCall:function(e){this.fireEvent("onSuccess",e)},onFailureCall:function(e){this.fireEvent("onFailure",e)},onCompleteCall:function(e){return MooTools.$clear(this.options.debugDelay),this.mIsActiveConnection=!1,this.options.prevent=!1,e&&e.system_message&&"disabled"==e.system_message&&(this.mForceLeave=!0,window.location.href=this.mLogoutUrl),this.options.completePass||(this.options.completePass=new MooTools.Array),this.options.completePass.extend([e]),this.fireEvent("onComplete",this.options.completePass),1==this.options.eval&&(this.options.evalData?this.options.evalData.each(function(t){this.evalScripts(e[t])}.bind(this)):this.evalScripts(e)),this.fireEvent("onEnd"),this.mQueue.length>0&&this.send(this.mQueue.pop()),e},runDebug:function(e){return 0!=this.mIsActiveConnection&&(this.mRh.cancel(),!0===this.options.debugRequest||(this.newRequest({url:"/ajax/Dejax/DeBug/",eval:!1,debugRequest:!0,data:{data:e}}),void this.newRequest(e)))},evalScripts:function(e){scripts_to_asset=[];for(var t=/<script[^>]* src="([\s\S]*?)"[^>]*?>[\s\S]*?<\/script>/gi;script_to_asset=t.exec(e);)new Asset.javascript(script_to_asset[1]);this.evalInLine.delay(1,this,e)},evalInLine:function(e){scripts=[];for(var t=/<script[^>]*>([\s\S]*?)<\/script>/gi;script=t.exec(e);)scripts.push(script[1]);scripts=scripts.join("\n"),scripts&&(window.execScript?window.execScript(scripts):window.setTimeout(scripts,0))}});var DejaxRequest;window.addEvent("domready",function(){DejaxRequest=new Dejax});
!function(e){function t(e){var t=["B","KB","MB","GB","TB","PB"];for(index=0;e>=1024;)e/=1024,index++;return 0==index?e+" "+t[index]:parseFloat(e).toFixed(2)==parseInt(e)?parseInt(e)+" "+t[index]:parseFloat(e).toFixed(2)+" "+t[index]}var o={details:{element:function(e){var i=new MooTools.Element("tr",{sort_name:e.name,sort_date:e.date,sort_size:e.size,sort_resolution:e.resolution,id_file:e.id_stored_file,title:e.name});return image_cell=new MooTools.Element("td",{class:"list_icon"}),image_cell.injectInside(i),i.adopt(new MooTools.Element("td",{width:200,class:"list_name"}).adopt(new MooTools.Element("span").set("text",e.name))),i.adopt(new MooTools.Element("td",{class:"list_size"}).set("text",t(e.size))),i.adopt(new MooTools.Element("td",{class:"list_date"}).set("text",e.date)),i.adopt(new MooTools.Element("td",{class:"list_resolution"}).set("text",e.resolution||"")),i},header:function(){var e=new MooTools.Element("table"),t=new MooTools.Element("tr").injectInside(new MooTools.Element("thead").injectInside(e));return t.adopt(new MooTools.Element("th",{class:"original_name"==FileManager.mSortBy[0]?"sort_"+FileManager.mSortBy[1]:"",width:"40%",colspan:2,rel:"original_name"}).set("text","Name")),t.adopt(new MooTools.Element("th",{class:"size"==FileManager.mSortBy[0]?"sort_"+FileManager.mSortBy[1]:"",width:"20%",rel:"size"}).set("text","File size")),t.adopt(new MooTools.Element("th",{class:"date"==FileManager.mSortBy[0]?"sort_"+FileManager.mSortBy[1]:"",width:"20%",rel:"date"}).set("text","Added")),t.adopt(new MooTools.Element("th",{class:"resolution"==FileManager.mSortBy[0]?"sort_"+FileManager.mSortBy[1]:"",rel:"resolution"}).set("text","Resolution")),MooTools.Browser.Engine.trident&&t.adopt(new MooTools.Element("th",{width:"10px"}).set("text","")),new MooTools.Element("tbody",{class:"ElementsContainer"}).injectInside(e),e},action:function(e){$("FileManager_Files").getElement("tbody");MooTools.Browser.Engine.trident&&$("FileManager_Files").getElement("table").setStyle("border-collapse","collapse"),this.mLockReload?this.mLockReload=!1:($("FileManager_Files").getElement("th").fireEvent("click",[$("FileManager_Files").getElement("th"),this.mLockReload]),this.mLockReload=!0),e.registerSort()},setInfo:function(e){var t=$("FileManager_Files").getElement("table");if(tFoot=$("FileManager_Files").getElement("tfoot"))tFoot.getElement("td").set("text",e);else{var i=new MooTools.Element("tfoot").injectInside(t);new MooTools.Element("td",{colspan:5}).injectInside(new MooTools.Element("tr").injectInside(i)).set("text",e)}},clearInfo:function(){(infoEl=$("FileManager_Files").getElement("tfoot"))&&infoEl.destroy()},addUsedIcon:function(e){e.getElement(".list_name").innerHTML+='<div class="iconHelper">'+$("FileManager_IconUsed16").innerHTML+"</div>"}},thumb:{element:function(e){var t=new MooTools.Element("li",{id_file:e.id_stored_file,title:e.name}),i=new MooTools.Element("span",{class:"ImageContainer"}).injectInside(t);if(e.thumbnail){i.setStyle("background-image",'url("/cmp/dmsFileManager/loader.gif")');new Asset.image(e.thumbnail,{onload:function(){i.setStyle("background-image",'url("'+e.thumbnail+'")')}})}else{ImgAlpha(DSWindowSkin.mIconBaseP+e.icon_large,32,32).injectInside(new MooTools.Element("span",{class:"icon"}).injectInside(i))}return t.adopt(new MooTools.Element("div",{class:"descriptionContainer"}).adopt(new MooTools.Element("span",{class:"description"}).set("text",e.name.match(/^(.{0,15})/)[1]))),t},header:function(){return new MooTools.Element("ul",{class:"ElementsContainer"})},setInfo:function(e){var t=$("FileManager_Files").getElement("ul");(tFoot=$("FileManager_Files").getElement("li.foot"))?tFoot.set("text",e):new MooTools.Element("li",{class:"foot",skipsearch:1}).injectInside(t).set("text",e)},clearInfo:function(){var e=$("FileManager_Files");if(e){var t=e.getElement("li.foot");t&&t.destroy()}},addUsedIcon:function(e){e.firstChild.innerHTML+=$("FileManager_IconUsed32").innerHTML}}},n=(new MooTools.Class({mMimeTypes:{bm:"image/bmp",bmp:"image/bmp",gif:"image/gif",ico:"image/x-icon",jpe:"image/jpeg",jpeg:"image/jpeg",jpg:"image/jpeg",png:"image/png",pdf:"application/pdf"},mMimeType:null,initialize:function(e){e&&this.setFromFile(e)},setFromFile:function(e){var t=e.split(".").pop(),i=this.getFromExtension(t);this.set(i)},set:function(e){this.mMimeType=e},getFromExtension:function(e){var t=e.toLowerCase();return this.mMimeTypes[t]||null},getFromFile:function(e){return this.setFromFile(e),this.get()},get:function(){return this.mMimeType}}),new MooTools.Class({mLoaded:!1,mLoadingDirectory:!1,mWindowToolbar:null,mDSWindow:null,mDSWindowOptions:null,mDirectories:null,mUploadElement:null,mActiveDirectoryID:null,mActiveFiles:null,mActiveFile:null,mActiveFileIndex:null,mTreeControl:null,mView:null,mOptions:null,mDirectoryFiles:null,mDirectoryFileIndex:0,mDialogWindow:null,mCallbackOptions:null,mLastNavigator:null,mActivePage:1,mSortBy:["original_name","asc"],mActiveFileID:null,mFilterWords:"",onDirectoryLoaded:null,initialize:function(e){this.mOptions=e,this.setWindowOptions({title:"File manager",width:800,height:500,x:"center",y:"center",modal:!0,ignore_resize:!1,ignore_position:!1,close_button:!0,resizable:!0,close_confirm:!1,on_escape_close:!0}),this.mAjax=new Dejax,this.mWindowToolbar={new_file:{active:!0,name:"file",hint:"Upload new file",icon:"famfamfam/16/arrow_up.png",action:function(){FileManager.uploadFile()},type:"file",text_hint:"Upload"},sep3:{separator:!0},remove_file:{active:!1,hint:"Remove file",icon:"crystal/16/actions/delete.png",action:function(){DSWindow.CreateConfirm("Do You really want to delete this file?","Delete file","Yes","Cancel","FileManager.removeActiveFile()","",10,!1,300,90)}.bind(this)},attach_file:{active:!1,hint:"Attach file",icon:"crystal/16/actions/attach.png",action:function(){try{dpManager.Analytics.kissEvent("Filemanager - set image")}catch(e){}MooTools.$clear(this.mTmpDelay),1==FileManager.mOptions.useOptions?FileManager.showAttachDialog():FileManager.callRequest()}},sep1:{separator:!0},new_dir:{active:!0,hint:"Create directory",icon:"famfamfam/16/folder_add.png",action:this.showDirectoryDialog.bind(this)},remove_dir:{active:!1,hint:"Remove directory",icon:"famfamfam/16/folder_delete.png",action:function(){DSWindow.CreateConfirm("Do You really want to delete this folder? <br /><br /> All files in it will be deleted.","Delete Folder","Yes","Cancel","FileManager.removeActiveDirectory()","",10,!1,300,110)}.bind(this)},sep2:{separator:!0},thumb_view:{active:!0,checked:1,hint:"Thumbnail view",icon:"famfamfam/16/application_view_tile.png",action:function(){FileManager.setView("thumb"),FileManager.loadView()},type:"checkbox",group:"default_view"},list_view:{active:!0,hint:"List view",icon:"famfamfam/16/application_view_list.png",action:function(){FileManager.setView("details"),FileManager.loadView()},type:"checkbox",group:"default_view"},sep4:{separator:!0}}},createHTML:o,setView:function(e){this.mView=e},setWindowOptions:function(e){this.mDSWindowOptions=e},getContentElement:function(){return this.mDSWindow.mContentElement},open:function(){try{dpManager.Analytics.kissEvent("Filemanager Opened")}catch(e){}return this.mDSWindow=createDSWindow(this.mDSWindowOptions),DejaxRequest.newRequest({url:"/dms/dmsFileManager/WindowInterface/",data:{id_marked_element:this.getFirstMarkedElement(),options:{sortby:this.mSortBy,filter:this.mFilterWords}},onComplete:function(e){this.getContentElement().set("html",e.html),e.id_directory&&(this.mActiveDirectoryID=e.id_directory),e.page&&(this.mActivePage=e.page),$("FileManager_Close").addEvent("click",function(){this.mDSWindow.Destroy()}.bind(this)),this.mToolbar=new DSToolbar(this.mWindowToolbar,{container:this.getContentElement()}),this.mToolbar.getDOMElement().injectInside(this.getContentElement()),this.registerFilter(),this.registerGlobalShortcuts(),$("FileManager_File_Shadow").makeDraggable(),DejaxRequest.newRequest({url:"/ajax/dmsFileManager/GetDirectories/",eval:!0,onComplete:function(e){this.refreshDirectories(e),MooTools.Browser.Engine.trident4&&this.setJSResizing()}.bind(this)})}.bind(this)}),this.mDSWindow},refreshDirectories:function(e){UXPStack.add("dmsFileManager.refreshDirectories",[e]),this.mTreeControl=new MooTreeControl({div:$("FileManager_Directories",this.getContentElement()),mode:"folders",grid:!0,theme:"/mp/MooTreeControl/mootree.png",nodeOptions:{text:"",open:!0}}),this.mTreeControl.root.text="Main folder",this.mTreeControl.root.update(),this.mTreeControl.root.divs.node.disableSelection(),this.mTreeControl.root.id=e[0].id_tree,e.shift(),this.mDirectories=e,this.mDirectories.each(function(e){this.addDirectory(e.title,e.id_tree,e.id_tree_parent)}.bind(this));var t=null;this.mActiveDirectoryID&&this.mTreeControl.root.id!=this.mActiveDirectoryID?t=this.mTreeControl.get(parseInt(this.mActiveDirectoryID)):(t=this.mTreeControl.root,this.mActiveDirectoryID=this.mTreeControl.root.id),t&&this.mTreeControl.select(t),this.mTreeControl.addEvent("onSelect",this.switchDirectory.bind(this)),this.onDirectoryLoaded=this.scrollToFile.pass([this.getFirstMarkedElement()],this),this.loadDirectory(this.mActiveDirectoryID,this.mActivePage,this.getFirstMarkedElement())},scrollToFile:function(e){this.mScrollToFile=new MooTools.Fx.Scroll($("FileManager_Files")),(elm=$("FileManager_FileID"+e))&&this.mScrollToFile.toElement(elm)},showDirectoryDialog:function(){this.mDialogWindow=createDSWindow({title:"Add new folder",width:300,height:100,x:"center",y:"center",icon:"crystal/16/actions/folder_new.png",modal:!0,ignore_position:!0,close_button:!0,resizable:!1,on_escape_close:!0});DejaxRequest.newRequest({url:"/dms/dmsFileManager/CreateDirectory/",eval:!0,evalData:["html"],onComplete:function(e){this.mDialogWindow.mContentElement.set("html",e.html)}.bind(this)})},showAttachDialog:function(){this.mDialogWindow=createDSWindow({title:"Add file",width:400,height:220,x:"center",y:"center",icon:"crystal/16/actions/folder_new.png",modal:!0,ignore_position:!0,close_button:!0,resizable:!1,on_escape_close:!0});DejaxRequest.newRequest({url:"/dms/dmsFileManager/AttachFile/?"+this.mOptions.whUrlParam,eval:!0,evalData:["html"],onComplete:function(e){this.mAttachHTML=e.html,this.mDialogWindow.mContentElement.set("html",e.html)}.bind(this)})},loadDirectory:function(e,t,i,o){this.mTreeControl.root.id==this.mActiveDirectoryID?this.mToolbar.setButtonsInactive(["remove_file","attach_file","remove_dir"]):this.mToolbar.setButtonsActive(["remove_dir"]),i&&(this.mActiveFileID=i),o&&(this.mFilterWords=""),t&&(this.mActivePage=t),this.requestFiles({id_directory:e,page:t,sortby:this.mSortBy,filter:this.mFilterWords},function(e){this.mDirectoryFiles=e.files,this.setJSNavigator(this.mToolbar.addWidget(e.navigator,500)),this.mLoaded=!0,this.loadView(),i||this.blurDirectory(),"function"==MooTools.$type(this.onDirectoryLoaded)&&this.onDirectoryLoaded()}.bind(this))},requestFiles:function(e,t){this.showIndicator(),DejaxRequest.newRequest({url:"/ajax/dmsFileManager/GetDirectoryFiles/",data:e,mode:"cancel",onComplete:t})},loadFilesHTML:function(){this.mDirectoryFileIndex=0,this.resetStatusBar(),this.clearActiveInfo(),this.mLoadingDirectory=!0,this.mDirectoryFiles.each(function(e){this.loadFileIntoDirectory(e)}.bind(this)),this.mLoadingDirectory=!1,null==this.mActiveFileID&&(this.blurDirectory(),this.mActiveFileID=null),this.refreshQuota()},loadView:function(){this.showIndicator(),0!=this.mLoaded&&($("FileManager_Files").innerHTML="",$("FileManager_Files").disableSelection(),$("FileManager_Files").adopt(this.createHTML[this.mView].header()),this.loadFilesHTML(),"function"==MooTools.$type(this.createHTML[this.mView].action)&&this.createHTML[this.mView].action(this),this.setFilesUsed(this.mMarkedFiles),this.hideIndicator())},loadFileIntoDirectory:function(e){1==this.mLoaded&&this.mDirectoryFiles.include(e),0==this.mLoadingDirectory&&this.refreshQuota();var t=this.createHTML[this.mView].element(e);return t.setProperty("id","FileManager_FileID"+e.id_stored_file),t.setProperty("index",this.mDirectoryFileIndex),this.mDirectoryFileIndex++,t.addEvent("mousedown",this.setFileActive.bindWithEvent(this,t)),t.addEvent("dblclick",this.mWindowToolbar.attach_file.action.bind(this)),$("FileManager_Files").getElement(".ElementsContainer").adopt(t),this.createHTML[this.mView].clearInfo(),e.id_stored_file==this.mActiveFileID&&this.setFileActive(null,t,!0),t},refreshQuota:function(){DejaxRequest.newRequest({url:"/ajax/dmsFileManager/GetUsage/",onComplete:function(e){if(1==e.useQuota){$("FileManager_Quota").setStyle("display","block"),$("FileManager_Directories").setStyle("bottom",155),$("FileManager_DiskUsage").getElement("span").set("text",t(e.usage)),$("FileManager_DiskQuota").getElement("span").set("text",t(e.maxsize)),(chart=$("FileManager_DiskChart").getElement("img"))&&chart.destroy();var i=parseInt(e.usage/e.maxsize*100).toFixed(3),o=parseInt(100-i).toFixed(3);new MooTools.Element("img",{src:"http://chart.apis.google.com/chart?cht=p3&chd=t:"+i+","+o+"&chf=bg,s,E3E3E3&chs=140x80&chl=&chco=84A3E3,EBEDF0"}).injectInside($("FileManager_DiskChart"))}}.bind(this)})},setCallbackOptions:function(e){delete e.additionalOptions,this.mCallbackOptions=e},callRequest:function(){for(i in this.mActiveFiles){var e=this.mActiveFiles[i];if("function"==MooTools.$type(this.mOptions.onAttachFile)){for(i in this.mDirectoryFiles[e.index])this.mCallbackOptions[i]=this.mDirectoryFiles[e.index][i];this.mOptions.onAttachFile(this.mCallbackOptions),this.mMarkedFiles.include(e.idFile),this.setFileUsed(e.idFile)}}1==this.mOptions.closeAfterAttach?this.mDSWindow.Destroy():this.updateStatus("File was added","crystal/16/actions/agt_action_success.png")},updateStatusByFile:function(e){this.updateStatus("Type: "+e.type+" Added: "+e.date+" File size: "+t(e.size),e.icon_small)},updateStatusByFiles:function(e){var t=0;for(i in e)t++;this.updateStatus("Selected files: "+t)},updateStatus:function(e,t){this.resetStatusBar();var i=$("FileManager_Status").getElement(".FileStatus"),o=new MooTools.Element("p");o.set("text",e),o.injectInside(i)},resetStatusBar:function(){$("FileManager_Status").getElement(".FileStatus").empty()},uploadFile:function(){try{dpManager.Analytics.kissEvent("Filemanager File Upload")}catch(e){}this.showIndicator();var e=this.mToolbar.mIcons.new_file.filebox,t=$("_FileManager_UploadForm").empty(),i=function(){e.set("name","file"),t.adopt(e),t.submit(),this.mToolbar.mIcons.new_file.restoreFilebox(e)}.bind(this);(new Dejax).send({url:"/ajax/dmsFileManager/PrepareUpload/",data:{file_name:e.files[0].name,file_type:e.files[0].type,file_size:e.files[0].size,directory_id:this.mActiveDirectoryID,sort_by:this.mSortBy,add_to_library:!0,overwrite:!1},onComplete:function(e){if(!e.status||!e.params)return void alert(e.message||"Could not proceed with upload. \nPlease refresh page and try again.");t.set("action",e.upload_url),new MooTools.Hash(e.params).each(function(e,i){t.adopt(new MooTools.Element("input",{type:"hidden",name:i,value:e}))}),i()}})},removeActiveFile:function(){this.showIndicator();for(i in this.mActiveFiles)this.removeFile(i)},blurDirectory:function(){$("FileManager_Files").getElements(".Selected").each(function(e){e.removeClass("Selected")}),this.mActiveFile=null,this.setCallbackOptions({}),this.mToolbar.setButtonsInactive(["remove_file","attach_file"])},removeFile:function(e){DejaxRequest.newRequest({url:"/ajax/dmsFileManager/DeleteFile/",data:{id_file:e},onComplete:function(e){1==e.success?($("FileManager_FileID"+e.id_file)&&$("FileManager_FileID"+e.id_file).destroy(),this.blurDirectory(),this.mDirectoryFiles.each(function(t){t&&t.id_stored_file==e.id_file&&(this.mDirectoryFiles.erase(t),this.refreshQuota())}.bind(this))):DSWindow.CreateAlert(e.message,"Error occurred","Close"),this.hideIndicator()}.bind(this)})},addDirectory:function(e,t,i){if(this.mTreeControl.root.id!==parseInt(t)){var o;o=this.mTreeControl.root.id==i?this.mTreeControl.root:this.mTreeControl.get(i),o.insert({text:e,id:t}),this.mTreeControl.get(t).divs.node.addEvents({drop:function(e){},over:function(e){e.setStyle("background-color","blue")},leave:function(e){e.setStyle("background-color","transparent")},click:function(e){this.mTreeControl.get(e).toggle(!1,!0)}.bind(this,t)}),this.mTreeControl.get(t).divs.node.disableSelection()}},removeDirectory:function(e){this.mTreeControl.get(e).remove(),this.hideIndicator()},removeActiveDirectory:function(){this.showIndicator();var e=this.mTreeControl.get(this.mActiveDirectoryID).parent;DejaxRequest.newRequest({url:"/ajax/dmsFileManager/DeleteFolder/",data:{id_directory:this.mActiveDirectoryID},onComplete:this.removeDirectory.bind(this,this.mActiveDirectoryID)}),this.mTreeControl.select(e)},switchDirectory:function(e,t){!0===t&&(this.showIndicator(),this.mActiveDirectoryID=e.id,this.loadDirectory(this.mActiveDirectoryID))},setJSResizing:function(){this.mDSWindow.addEvent("OnResize",this.resizeWindowHelper.bind(this)),this.mDSWindow.fireEvent("OnResize")},resizeWindowHelper:function(){var e={x:parseInt(this.mDSWindow.mContentElement.getStyle("width")),y:parseInt(this.mDSWindow.mContentElement.getStyle("height"))};$("FileManager_Directories").setStyle("height",e.y-51),$("FileManager_Files").setStyles({height:e.y-51,width:e.x-parseInt($("FileManager_Directories").getStyle("width"))})},showIndicator:function(){parent.FileManager.mDSWindow.ShowLoadIndicator(!0),this.createHTML[this.mView].clearInfo()},hideIndicator:function(){MooTools.$clear(this.mIndicatorDelay),this.mIndicatorDelay=function(){parent.FileManager.mDSWindow.HideLoadIndicator(),0==this.mDirectoryFiles.length&&this.createHTML[this.mView].setInfo("There are no files in this folder")}.delay(500,this)},setJSNavigator:function(e){this.mLastNavigator&&this.mLastNavigator.destroy(),this.mLastNavigator=e;var t=!1;e.getElements("a").each(function(e){var i=e.getProperty("href"),o=e.get("text"),n=e.getParent();if(i?MooTools.Browser.Engine.trident&&(i=i.match(/(\d+)$/)[1]):i=0,n.hasClass("Pages")){if(0==t&&e.hasClass("Active")){var s=new MooTools.Element("input",{type:"text",styles:{width:"30px"},value:i,class:"DF_textbox"});this.registerQuickJump(s,i),s.injectInside(n),t=!0}}else{var l=new MooTools.Element("a",{class:"DF_button"}),r=new MooTools.Element("input",{type:"button",value:o});e.hasClass("Active")&&r.setStyle("font-weight","bold"),r.injectInside(l),l.injectInside(n),e.getProperty("href")?n.addEvent("click",this.loadDirectory.pass([this.mActiveDirectoryID,i,this.mActiveSortField],this)):(l.addClass("DF_button_disabled"),n.setStyle("opacity",.5),MooTools.Browser.Engine.trident&&l.setStyle("opacity",.5))}e.destroy()}.bind(this))},registerQuickJump:function(e,t){e.addEvent("keydown",function(e){if(!e.key.match(/^(\d|left|right|up|down|backspace|delete)$/))return e.stop(),!1}),e.addEvent("keyup",function(){MooTools.$clear(this.tmpDelay),this.tmpDelay=this.quickJump.delay(1e3,this,[e.get("value")])}.bind(this))},quickJump:function(e){e!=this.mActivePage&&this.loadDirectory(this.mActiveDirectoryID,e,this.mActiveSortField)},changeSort:function(e,t){this.mSortBy=[e,t],this.loadDirectory(this.mActiveDirectoryID,this.mActivePage)},changeFilter:function(e){this.mFilterWords=e,this.loadDirectory(this.mActiveDirectoryID,this.mActivePage)},registerFilter:function(){$("FileManager_FilterInput").set("value",this.mFilterWords),$("FileManager_FilterInput").addEvent("keyup",function(){MooTools.$clear(this.mFilterDelay),this.mFilterDelay=this.changeFilter.delay(1e3,this,[$("FileManager_FilterInput").get("value")])}.bind(this))},registerSort:function(){document.getElements("#FileManager_Files th").each(function(e){e.addEvent("click",function(t){var i,o=e.getProperty("rel");document.getElements("#FileManager_Files th.sort_asc, #FileManager_Files th.sort_desc").each(function(e){e.removeClass("sort_asc"),e.removeClass("sort_desc")}),i=o!=this.mSortBy[0]?"asc":"asc"==this.mSortBy[1]?"desc":"asc",this.changeSort(o,i)}.bind(this,i))}.bind(this))},markFiles:function(e){this.mMarkedFiles=e},getFirstMarkedElement:function(){if("array"==MooTools.$type(this.mMarkedFiles))return this.mMarkedFiles[0]},setFilesUsed:function(e){if("array"!=MooTools.$type(e))return void(this.mMarkedFiles=[]);e.each(function(e){this.setFileUsed(e)}.bind(this))},setFileUsed:function(e){(dest_el=$("FileManager_FileID"+e))&&this.createHTML[this.mView].addUsedIcon(dest_el)},unselectFiles:function(){this.blurDirectory(),this.clearActiveInfo()},clearActiveInfo:function(){delete this.mActiveFiles,this.mActiveFiles=null,this.mActiveFiles={}},hasSelectedOneFile:function(){var e=0;for(i in this.mActiveFiles)if(0<e++)return!1;return!0},setFileActive:function(e,t,o){var n=t.getProperty("id_file"),s=parseInt(t.getProperty("index"));if(!o&&MooTools.$defined(this.mActiveFiles[n]))return MooTools.$clear(this.mTmpDelay),void(this.mTmpDelay=this.setFileActive.delay(300,this,[e,t,!0]));if(e&&(0==e.control&&0==e.shift||null==this.mActiveFiles)&&this.unselectFiles(),e&&1==e.control&&MooTools.$defined(this.mActiveFiles[n]))this.mActiveFiles[n]=null,delete this.mActiveFiles[n],t.removeClass("Selected");else if(e&&1==e.shift){var l=this.mActiveFiles[this.mLastSelectedFile];if(l.index==s)return;if(parseInt(l.index)<s)var r=parseInt(l.index),a=s;else var r=s,a=parseInt(l.index);for(this.unselectFiles(),i=r;i<=a;i++)this.setFileActiveHelper($("FileManager_FileID"+this.mDirectoryFiles[i].id_stored_file),this.mDirectoryFiles[i].id_stored_file,i);this.mToolbar.setButtonsActive(["remove_file","attach_file"])}else this.mLastSelectedFile=n,this.setFileActiveHelper(t,n,s),this.mToolbar.setButtonsActive(["remove_file","attach_file"]);1==this.hasSelectedOneFile()?this.updateStatusByFile(this.mDirectoryFiles[s]):this.updateStatusByFiles(this.mActiveFiles)},setFileActiveHelper:function(e,t,i){this.mActiveFiles[t]={index:i,idFile:t,elDOM:e},e.addClass("Selected")},selectAllFiles:function(){var e=0;this.mDirectoryFiles.each(function(t){this.setFileActiveHelper($("FileManager_FileID"+t.id_stored_file),t.id_stored_file,e++)}.bind(this))},registerGlobalShortcuts:function(){}}));e.dmsFileManager=n}(window);
!function(a){"use strict";a.UXPAnimationsMap={easing:{LINEAR:{value:"easeNone",label:"Linear"},EASE_IN:{value:"easeIn",label:"Ease In"},EASE_OUT:{value:"easeOut",label:"Ease Out"},EASE_IN_OUT:{value:"easeInOut",label:"Ease In Out"}},easingType:{POWER0:{value:"Power0",label:"None",hidden:!0},QUAD:{value:"Power1",label:"Quadratic"},CUBIC:{value:"Power2",label:"Cubic"},QUART:{value:"Power3",label:"Quartic"},QUINT:{value:"Power4",label:"Quintic"},SINE:{value:"Sine",label:"Sine"},EXPO:{value:"Expo",label:"Exponential"},CIRC:{value:"Circ",label:"Circular"},ELASTIC:{value:"Elastic",label:"Elastic"},BOUNCE:{value:"Bounce",label:"Bounce"},BACK:{value:"Back",label:"Back"}}},UXPAnimationsMap.legacyEasing={linear:{easing:UXPAnimationsMap.easing.LINEAR.value,easingType:UXPAnimationsMap.easingType.POWER0.value},"ease-in":{easing:UXPAnimationsMap.easing.EASE_IN.value,easingType:UXPAnimationsMap.easingType.CUBIC.value},"ease-out":{easing:UXPAnimationsMap.easing.EASE_OUT.value,easingType:UXPAnimationsMap.easingType.CUBIC.value},"ease-in-out":{easing:UXPAnimationsMap.easing.EASE_IN_OUT.value,easingType:UXPAnimationsMap.easingType.CUBIC.value},"back-out":{easing:UXPAnimationsMap.easing.EASE_OUT.value,easingType:UXPAnimationsMap.easingType.BACK.value},"elastic-out":{easing:UXPAnimationsMap.easing.EASE_OUT.value,easingType:UXPAnimationsMap.easingType.ELASTIC.value}},a.UXPAnimationsMap=UXPAnimationsMap}(window);
var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(e){"use strict";var t=new MooTools.Class({Implements:[MooTools.Events],mDragMode:!1,mWorkBench:null,mWorkbenchScrollPane:null,mHorizontalRuler:null,mVerticalRuler:null,mActivePage:null,mActiveElement:null,mPageCovers:null,mSnap:null,mDefaultSnap:5,mSmartGuidesActive:!0,mDimensionsEl:!1,mContainerEl:null,mOfflineEl:null,Collaborators:null,mGuidesEnabled:!0,mGuidesSheet:null,mToolbarRefs:new MooTools.Hash,isClickedForScroll:!1,scrollPositions:{original_x:0,original_y:0,actual_x:0,actual_y:0,last_x:0,last_y:0},mScrollEndTimer:null,mPointerEndTimer:null,mCurrentElementToolsBox:null,mPropertyTypesUserDefaults:{width:0,height:0,opacity:1,color:1,overflow:1,"border-color":1,"border-width":1,"border-style":1,"border-right":1,"border-bottom":1,"background-color":1,"background-repeat":1,"background-position-x":1,"background-position-y":1,"font-size":1,"font-weight":1,"font-family":1,"text-align":1,"text-decoration":1,"list-style-type":1,"td-align":1,"th-background":1,"th-align":1,"cell-border-color":1,"th-text-align":1,"th-color":1,"th-font-size":1,"th-font-family":1,"th-background-color":1,"td-text-align":1,"td-font-family":1,"td-font-size":1,"td-color":1,"odd-background":1,"even-background":1},Grid:null,mWidth:null,mHeight:null,mGridWidget:null,mPositionTooltip:null,mSmartGuideSnappingEnabled:4,mSmartGuideSnappingDisabled:0,mOldSmartGuidesStatus:null,mOldSmartGuidesSnappingStatus:null,mCurrentVersion:0,mVersionEditToolbar:null,initialize:function(n){this.setWidth(t.DEFAULT_WIDTH,!1),this.setHeight(t.DEFAULT_HEIGHT,!1),this.createWorkBench(n),this.mWorkBench=document.getElementById("workbench")||document.getElementById("WorkBench"),this.mElementsLayer=document.getElementById("canvas")||document.getElementById("ElementsLayer"),this.mWorkbenchScrollPane=document.getElementById("workbench-scroll-pane"),this.mHorizontalRuler=document.querySelector(".ruler.horizontal"),this.mVerticalRuler=document.querySelector(".ruler.vertical"),this.Collaborators=new e.DPWorkbench_Collaborators(this),this.initializeBodyClasses(),this.mUserDefaultPropValues={},this.loadUserDefaultPropValues(),dpManager.isCollaboration()&&socket.emit("addCollaborator",{socketRoomId:dpManager.dpProject.getHash(),userData:dpManager.DataForCollaboration,accountId:dpManager.DataForCollaboration.account_id}),this.settings(function(){var e=window.lscache,t=e.get("snapping");null===t&&(t=!0),this.setSnap(t?1:0),this.mSmartGuidesActive=!!e.get("smart-guides"),null===e.get("smart-guides")&&(this.mSmartGuidesActive=!0,this.toggleSmartGuides(!0)),null===e.get("smart-guides-snap")&&e.set("smart-guides-snap",!0),null!==(t=e.get("workbench-bg"))&&this.setBackgroundClass(t)}.bind(this)),this.mPageCovers=new e.DPPage_Covers},initializeBodyClasses:function(){var e;(e=lscache.get("screen-mode"))&&document.body.addClass(e)},setWidth:function(e,n){this.mWidth=e>0?parseInt(e):t.DEFAULT_WIDTH,(void 0===n||n)&&this.adjustArea()},setHeight:function(e,n){this.mHeight=e>0?parseInt(e):t.DEFAULT_HEIGHT,(void 0===n||n)&&this.adjustArea()},imageUploaded:function(e){this.fireEvent("imageAddedToCollection",e)},setCurrentVersion:function(e){this.mCurrentVersion=parseInt(e)},getCurrentVersion:function(){return this.mCurrentVersion},isDefaultVersion:function(){return this.getCurrentVersion()===e.DPProject.getDefaultVersion()},addVersion:function(e,t){var n=_.extend({version:dpManager.dpProject.getMaxVersionIndex()+1},e);return dpManager.dpProject.mVersions.push(n),dpManager.dpPageInspector.addVersion(n.version,t)},updateVersion:function(e,t){var n=_.extend(dpManager.dpProject.getVersion(parseInt(e)),t);return this.getCurrentVersion()===parseInt(e)&&(dpManager.dpWorkBench.setWidth(n.width,!1),dpManager.dpWorkBench.setHeight(n.height)),dpManager.dpPageInspector.editVersion(n)},createWorkBench:function(){this.mVersionListEl=new MooTools.Element("div",{id:"version-list"})},getWorkBenchEl:function(){return this.mElementsLayer},getWorkBenchElMain:function(){return this.mWorkBench},getWorkbenchScrollPane:function(){return this.mWorkbenchScrollPane},getWorkBenchPosition:function(){return{x:0,y:0}},loadPage:function(n,o){(_.isUndefined(o)||o)&&this.setActivePage(this.createPage());var r=this.getActivePage(),i=r.mElementsIndex,a={},s={};if(n.page&&"object"===_typeof(n.page)&&Object.keys(n.page).forEach(function(e){void 0!==n.page[e].props["z-index"]&&(a[e]=n.page[e].props["z-index"])}),i.createIndex(n.page),r.loadElements(n.page),this.setComponents(n.components),Object.keys(a).forEach(function(e){var t=r.getElementById(e);if(t){var n=parseInt(t.getProperty("z-index"));n!==parseInt(a[e])&&(s[e]={"z-index":n})}}),Object.keys(s).length>0&&r.saveBulk(s,!1),this.addEvent("onPageLoaded",function(){this.getActivePage().cleanupInteractions.delay(1e3,this.getActivePage())}.bind(this)),dpManager.dpPageInspector&&dpManager.dpPageInspector.isComponent()){new MooTools.Cookie("component_info",{duration:999,path:"/"})}dpManager.dpMainToolbar.refresh(),dpManager.dpProject.mVersions[this.getCurrentVersion()]&&dpManager.dpProject.mVersions[this.getCurrentVersion()].width?this.setWidth(dpManager.dpProject.mVersions[this.getCurrentVersion()].width):this.setWidth(t.DEFAULT_WIDTH),dpManager.dpProject.mVersions[this.getCurrentVersion()]&&dpManager.dpProject.mVersions[this.getCurrentVersion()].height>0?this.setHeight(dpManager.dpProject.mVersions[this.getCurrentVersion()].height):this.setHeight(t.DEFAULT_HEIGHT),dpManager.dpPageInspector.isComponent()&&(this.setWidth(t.DEFAULT_WIDTH,!1),this.setHeight(t.DEFAULT_HEIGHT)),n=new MooTools.Hash,n[dpManager.DataForCollaboration.user_id]={avatar:dpManager.DataForCollaboration.user_avatar,email:dpManager.DataForCollaboration.user_email,id_page:window.hashuri.get("id_page")},dpManager.isCollaboration()&&socket.emit("activatePage",n),this.getActivePage().addEvent("onRender",function(t){if(t=_.defaults({logTime:!0}),this.getActivePage().mLoadingElements=!1,dpManager.dpMainToolbar.refresh(),delete dpManager.uxpElementIndex,dpManager.uxpElementIndex=new e.UXPElementIndex,dpManager.uxpElementIndex.populateIndex(),dpManager.emit("canvas_ready"),t.logTime){var n=e.uxpdebug.getElapsed(),o={time_total:1e3*n[0],time_render:1e3*n[1]},r="Elements count:"+this.mActivePage.getTotalElementsCount()+" ID project:"+dpManager.dpProject.getIdProject();dpManager.Analytics.analyticsTiming("PageLoading","Total load page time",o.time_total,r),dpManager.Analytics.analyticsTiming("PageLoading","Wireframe render",o.time_render,r)}}.bind(this));this.fireEvent("onPageLoaded")},setComponents:function(e){if(!e)return!1;for(var t in e)e.hasOwnProperty(t)&&this.getActivePage().addComponentElementsToWorkbench(t,e[t],!0)},deletePage:function(){var e=this.getActivePage();e&&e.deletePage()},setActivePage:function(e){var t=dpManager.dpPageInspector.getActivePageID(),n=window.hashuri.toUri({id_page:t});_.isUndefined(window.hashuri.get("id_page"))?(window.history&&window.history.replaceState({},document.title,n),window.hashuri.set({id_page:t})):window.hashuri.set("id_page",t),this.mOpenGroup=!1,this.mActivePage=e,(isAnyMSIE||isEdge)&&this.mActivePage.showError("internetexplorer")},getActivePage:function(){return this.mActivePage},createPage:function(){return new e.DPPage},preview:function(e,t){dpManager.Analytics.kissEvent("App - Preview open clicked",{"App - Preview open clicked by":"Top bar button","App - Preview open clicked: Editor version":"Old","App - Preview open clicked: Feature location":"App"}),dpManager.dpProject.openPreview(e,t)},setSnap:function(e){this.mSnap=1===parseInt(e)&&this.mDefaultSnap,this.settings(function(){window.lscache.set("snapping",this.mSnap)}.bind(this));var t=this.getActivePage()&&this.getActivePage().getActiveElement();t&&t.updateSnap()},loadUserDefaultPropValues:function(){var e=MooTools.Cookie.read("userDefaultPropValues");e&&(this.mUserDefaultPropValues=MooTools.JSON.decode(e))},fadeElements2Gray:function(e){var t=dpManager.dpWorkBench.getActivePage().getActiveElements(),n=dpManager.dpHistory.startGroupCounter();t=t.filter(function(e){return e.hasProperty("grayscale")}),t.filter(function(e){return e.isAggregation()}).each(function(e){t=t.concat(e.getElements())}),t.each(function(t,o,r){var i=null;r.length-1===o&&(i=dpManager.dpHistory.getGroupCounter(n)),t.setProperty("grayscale",e?1:0,null,!0,i)})},toggleSmartGuides:function(e){this.mSmartGuidesActive=e,this.settings(function(){window.lscache.set("smart-guides",e)})},settings:function(e){return window.lscache.bucket("workbench-settings",e)},setBackgroundClass:function(e){(document.getElementById("canvas")||document.getElement("#Area")).removeClass("dotted").removeClass("grided").removeClass("none").addClass(e),this.settings(function(){window.lscache.set("workbench-bg",e)})},switchToVersion:function(e,t){var n=dpManager.dpPageInspector.getActivePageID(),o=t||dpManager.dpPageInspector.mVersionIndex[n][parseInt(e)];this.setCurrentVersion(e),dpManager.dpPageInspector.setActivePage(o)},openVersionEdit:function(e,t,n){var o=this.versionModalDefaults(n),r={};r.promise=new Promise(function(e,t){r.resolve=e,r.reject=t});var i=new ResponsiveModal(o),a=new ResponsiveForm(t),s=dpManager.dpProject.getVersion(parseInt(e));if(!s)throw Error("Version not available");return a.setData({submitText:o.submitText,deleteText:"Delete this version",canClose:o.canClose,width:s.width,height:s.height>0?s.height:"",name:s.text.replace(/\(.*\)/,"").trim(),scrollx:s.scrollx,scrolly:s.scrolly}).render(),a.on(ResponsiveForm.ON_SUBMIT,function(t){t.text=t.name,delete t.name,t.width>0&&(t.text+=" ("+t.width+"px)"),this.updateVersion(e,t),r.resolve(t),i.destroy()}.bind(this)),a.on(ResponsiveForm.ON_DELETE,function(){DSWindow.CreateConfirm("Are you sure you want to delete "+s.text+"? <br/><br/>Please note that the "+s.text+" breakpoint <strong>will be removed from all pages in this wireframe</strong> and that you will not be able to undo this action.<br /><br />","Delete "+s.text+"? ","Delete from all pages","No",function(){dpManager.dpPageInspector.toggleVersion(e)}.bind(this)),i.destroy()}),i.render(a).appendTo(document.body).show(30),r.promise},versionModalDefaults:function(e){return _.defaults(e||{},{canClose:!0,submitText:"Save changes"})},showAddVersionModal:function(t,n){var o=new e.ResponsiveModal(n),r=new e.ResponsiveForm(t);r.setCopySources(dpManager.dpProject.getCurrentVersions()),r.render(),r.on(e.ResponsiveForm.ON_SUBMIT,_.once(function(e){var t={text:e.name,width:e.width,height:e.height>0?e.height:"",scrollx:e.scrollx,scrolly:e.scrolly};e.width>0?t.text+=" ("+e.width+"px)":t.text+=" (&infin;)",dpManager.dpWorkBench.addVersion(t,e.copyFrom),o.destroy()})),o.render(r).appendTo(document.body).show(30)},adjustArea:function(){var e=document.getElementById("canvas")||this.mContainerEl.getElementById("Area");e.style.width=this.mWidth+"px",e.style.height=this.mHeight+"px"},getCenterPosition:function(){var e=this.mWorkBench;return{x:Math.round(e.getScroll().x+e.getDimensions().width)/2,y:Math.round(e.getScroll().x+e.getDimensions().height)/3}},render:function(t){return e.utils.RenderTemplate(t,{element:this.getActivePage().getActiveElement()})}});t.VERSION_EDIT_CLASS_NAME="version-settings",t.DEFAULT_WIDTH=5e3,t.DEFAULT_HEIGHT=1e4,e.DPWorkBench=t}(window);
var DPWorkbench_Collaborators=new MooTools.Class({name:"DPWorkbench_Collaborators",mColor:null,mDejax:null,mRef:null,mCollaboratorsActiveElements:null,mLastActiveIdsCRC:null,WorkBench:null,initialize:function(e){if(dpManager.isCollaboration()){var t=lscache.get("collaboration_color");this.WorkBench=e,this.mCollaboratorsActiveElements=new MooTools.Hash,this.mColor=t||this.randomizeColor(),this.mDejax=new Dejax,t||lscache.set("collaboration_color",this.mColor),this.attachEvents()}},attachEvents:function(){var e=this;this.WorkBench.addEvent("pageLoaded",function(){e.WorkBench.getActivePage().addEvent("onActivateElements",e.sendActiveElements.bind(e))})},randomizeColor:function(){for(var e=MooTools.Number.range(0,9).concat(["a","b","c","d","e","f"]),t=[],o=6;o--;)e.shuffle(),t.push(e.shift());return t.join("").hexToRgb()},sendActiveElements:function(){var e=this.WorkBench.getActivePage().getActiveElements().map(function(e){return e.getId().toInt()}).sort(function(e,t){return e-t}),t=e.join("");this.mLastActiveIdsCRC!=t&&(this.mLastActiveIdsCRC=t,pData={id_page:dpManager.dpPageInspector.getActivePageID(),id_project:dpManager.dpProject.getIdProject(),element_ids:e,color:this.mColor,email:dpManager.DataForCollaboration.user_email,id_user:dpManager.DataForCollaboration.user_id},dpManager.isCollaboration()&&socket.emit("activateElements",pData))},cometActivateElements:function(e){var t=this.mCollaboratorsActiveElements.get(e.id_user)||[],o=null;dpManager.dpWorkBench.getActivePage()&&(t.each(function(t){(o=dpManager.dpWorkBench.getActivePage().getElementById(t))&&dpManager.dpWorkBench.getActivePage().getElementById(t).CollaborationInfo.removeCollaborator(e.id_user)}),e.element_ids.each(function(t){var o=dpManager.dpWorkBench.getActivePage().getElementById(t);o&&o.CollaborationInfo.addCollaborator(e.id_user,{name:e.email.split("@")[0],color:e.color})}),this.mCollaboratorsActiveElements.set(e.id_user,e.element_ids))}});
!function(t){"use strict";var e="template-workbench-prompt-input",n=function(t){if(t.templateId){var e=document.getElementById(t.templateId);t.template=e&&e.innerHTML}},i=function t(e){this.options=_.extend({templateId:"template-workbench-prompt-uxpin-30",text:"Prompt",headerText:!1,submitText:"OK",cancelText:"Cancel",value:"",injectHtml:""},e),n(this.options),this.rendered=new Promise(function(t,e){this.renderResolve=t,this.renderReject=e}.bind(this)),this.on(t.ON_CONFIRM,this.destroy.bind(this)),this.on(t.ON_CANCEL,this.destroy.bind(this))};i.prototype=Object.create(AbstractModal.prototype),i.constructor=i,i.ON_CANCEL="onCancel",i.ON_CONFIRM="onConfirm",i.prototype.render=function(){if(AbstractModal.prototype.render.call(this),!this.options.template)throw Error("Prompt template not provided");return this.options.value=htmlspecialchars(this.options.value,"ENT_QUOTES"),this.el.innerHTML=_.template(this.options.template)(_.extend(this.options,{INPUT_ID:e})),this.inputEl=this.el.querySelector("#"+e),this.inputEl?this.renderResolve():this.renderReject("Prompt template must contain text input element of id "+e),this},i.prototype.show=function(t){AbstractModal.prototype.show.call(this,t),t||setTimeout(this.inputEl.focus.bind(this.inputEl),30)},i.prototype.getValue=function(){return this.inputEl.value||!1},i.prototype.cancel=function(t){t&&"function"==typeof t.preventDefault&&t.preventDefault(),this.emit(i.ON_CANCEL,this.getValue())},i.prototype.confirm=function(t){t&&"function"==typeof t.preventDefault&&t.preventDefault(),this.emit(i.ON_CONFIRM,this.getValue())},i.prototype.addEvents=function(){this.rendered.then(function(){AbstractModal.prototype.addEvents.call(this),this.inputEl.addEventListener("keyup",function(t){t.keyCode===Enums.KEYS.ENTER&&this.confirm()}.bind(this))}.bind(this)).catch(function(t){throw Error(t)})},i.prototype.delegatedClick=function(t){[AbstractModal.CLOSE_BUTTON_CLASS,"action-cancel"].some(function(e){return t.target.classList.contains(e)})?(t.preventDefault(),this.cancel()):t.target.classList.contains("action-submit")&&(t.preventDefault(),this.confirm())},t.PromptModal=i}(window);
!function(o){"use strict";var t=function(o){this.el=null,this.form=null,this.options=_.defaults(o||{},{canClose:!0,onOpen:_.noop,onClose:_.noop})};t.prototype=Object.create(o.AbstractModal.prototype),t.constructor=t,t.prototype.render=function(t){o.AbstractModal.prototype.render.call(this);var e=t.getFormElement();return e.classList.add("modal-box-wrapper"),this.el.id="responsive-modal-box",this.el.appendChild(e),this},t.prototype.keyDown=function(o){o.keyCode===Enums.KEYS.ESC&&this.options.canClose&&this.destroy()},o.ResponsiveModal=t}(window);
!function(t){"use strict";function e(t){return Number(t)%1!=0}var i=[{name:"Custom",width:"",height:"",isCustom:!0},{name:"Web",group:!0},{name:"HD 1920",width:1920,height:""},{name:"Wide 1440",width:1440,height:""},{name:"Standard 1024",width:1024,height:""},{name:"iOS",group:!0},{name:"iPhone Xs",width:375,height:812},{name:"iPhone Xs Max",width:414,height:896},{name:"iPhone 8",width:375,height:667},{name:"iPhone 8 Plus",width:414,height:736},{name:"iPhone SE",width:320,height:568},{name:"iPad",width:768,height:1024},{name:'iPad Pro 10.5"',width:834,height:1112},{name:'iPad Pro 11"',width:834,height:1194},{name:'iPad Pro 12.9"',width:1024,height:1366},{name:"Apple Watch 38mm",width:272,height:340},{name:"Apple Watch 40mm",width:324,height:394},{name:"Apple Watch 42mm",width:312,height:390},{name:"Apple Watch 44mm",width:368,height:448},{name:"Apple TV",width:1920,height:1080},{name:"Android",group:!0},{name:"Android",width:360,height:640},{name:"Pixel 2",width:411,height:731},{name:"Pixel 2 XL",width:411,height:823},{name:"Galaxy S9",width:360,height:740},{name:"Nexus 7",width:600,height:960},{name:"Nexus 10",width:800,height:1280}],h=function(){return i.indexOf(_.find(i,{isCustom:!0}))},n=function(t,e){var n,s={width:t,height:e};return t>0&&(s.width=parseInt(t,10)),e>0&&(s.height=parseInt(e,10)),n=i.indexOf(_.find(i,s)),-1===n&&(n=h()),n},s=function t(h){this.template=_.template(document.getElementById(h||"template-workbench-responsive-form").innerHTML),this.form=null,this.data={},this.setPresets(i),this.setData({copySources:[],submitText:"Add breakpoint",deleteText:!1,width:"",height:"",name:"",canClose:!0}),this.on(t.ON_PRESET_CHANGE,function(t){i[t].width?(this.nameInput.value=i[t].name,this.widthInput.value=i[t].width,this.heightInput.value=i[t].height):(this.widthInput.focus(),this.widthInput.select())}.bind(this)),this.on(t.ON_SIZE_CHANGE,function(){var t=Number(this.widthInput.max),i=Number(this.heightInput.max);Number(this.widthInput.value)>t&&(this.widthInput.value=t),Number(this.heightInput.value)>i&&(this.heightInput.value=i),(""===this.widthInput.value||Number.isNaN(Number(this.widthInput.value)))&&(this.widthInput.value=""),(""===this.heightInput.value||Number.isNaN(Number(this.heightInput.value)))&&(this.heightInput.value=""),!Number.isNaN(Number(this.heightInput.value))&&e(this.widthInput.value)&&(this.widthInput.value=Math.round(this.widthInput.value)),!Number.isNaN(Number(this.heightInput.value))&&e(this.heightInput.value)&&(this.heightInput.value=Math.round(this.heightInput.value)),this.presetsSelect.set(n(this.widthInput.value,this.heightInput.value))}.bind(this)),this.on(t.ON_SIZE_BLUR,function(){""===this.widthInput.value&&(this.widthInput.value="auto"),""===this.heightInput.value&&(this.heightInput.value="auto")}.bind(this)),this.on(t.ON_SIZE_FOCUS,function(){"auto"===this.widthInput.value&&(this.widthInput.value=""),"auto"===this.heightInput.value&&(this.heightInput.value="")}.bind(this)),this.on(t.ON_COPY_FROM_ENABLE,function(){this.copySelect.enabled()}.bind(this)),this.on(t.ON_COPY_FROM_DISABLE,function(){this.copySelect.disabled()}.bind(this))};s.prototype=Object.create(EventEmitter.prototype),s.constructor=s,s.ON_SUBMIT="onSubmit",s.ON_DELETE="onDelete",s.ON_PRESET_CHANGE="onPresetChange",s.ON_SIZE_CHANGE="onSizeChange",s.ON_SIZE_BLUR="onSizeBlur",s.ON_COPY_FROM_ENABLE="onCopyFromEnable",s.ON_COPY_FROM_DISABLE="onCopyFromDisable",s.ON_COPY_FROM_CHANGE="onCopyFromChange",s.prototype.set=function(t,e){return this.data[t]=e,this},s.prototype.setPresets=function(t){this.set("presets",t)},s.prototype.setData=function(t){return this.data=_.extend(this.data,t),this},s.prototype.setCopySources=function(t){this.set("copySources",t)},s.prototype.getFormElement=function(){return this.form},s.prototype.getFormData=function(){var t={name:this.nameInput.value,width:this.widthInput.value>0?parseInt(this.widthInput.value,10):"",height:this.heightInput.value>0?parseInt(this.heightInput.value,10):"",scrollx:this.scrollxInput.checked,scrolly:this.scrollyInput.checked};return this.copyCheckbox&&this.copySelect&&(t.copyFrom=this.copyCheckbox.checked?this.copySelect.get():null),t},s.prototype.createPresetsSelect=function(){return new ToolsBoxControlSelect(null,{label:"",elClass:"hulk-select large-size full-width control-wrapper input-like-style",listClass:"hulk-select-list list-canvas-presets white-version",wrapperEl:!1,options:this.data.presets.map(function(t,e){var i=t.name;return t.group?{text:t.name,group:!0}:(t.width>0&&t.height>0?i+=' <span class="additional-info">'+t.width+"x"+t.height+"</span>":t.width>0&&(i+=' <span class="additional-info">'+t.width+"px</span>"),{html:i,text:t.name,value:e.toString()})}),defaultValue:n(this.data.width,this.data.height).toString(),optionsListMinHeight:"full",placeholder:!1,onChange:function(t){this.emit(s.ON_PRESET_CHANGE,t)}.bind(this)})},s.prototype.createCopyElementsFromSelect=function(){return new ToolsBoxControlSelect(null,{label:"",elClass:"hulk-select large-size full-width control-wrapper input-like-style",listClass:"hulk-select-list white-version",wrapperEl:!1,options:this.data.copySources.map(function(t){return{text:t.text.replace(/\([^\d]+\)/,""),value:t.version.toString()}}),defaultValue:this.data.copySources[0].version.toString(),optionsListMinHeight:"full",placeholder:!1,onChange:function(t){this.emit(s.ON_COPY_FROM_CHANGE,t)}.bind(this)})},s.prototype.render=function(){var t;return this.form=document.createElement("form"),this.form.className="custom-breakpoint-form",this.form.innerHTML=this.template(this.data),this.form.addEventListener("submit",function(t){var e,h,n,a=this.getFormData(),o=this.presetsSelect.get();t.preventDefault(),"Create"===this.data.submitText?n="New Project":"Add breakpoint"===this.data.submitText&&(n="Add new breakpoint"),void 0!==n&&(this.copyCheckbox&&this.copySelect&&(e=this.copySelect.get(),h=_.find(this.copySelect.options.options,{value:e}),h=!!this.copyCheckbox.checked&&h.text),dpManager.Analytics.kissEvent("App - Canvas - New Canvas set",{"App - Canvas - New canvas set: Size choosed":i[o].name,"App - Canvas - New canvas set: Height":a.height||"auto","App - Canvas - New canvas set: Width":a.width||"auto","App - Canvas - New canvas set: When":n,"App - Canvas - New canvas set: All elements copied from":h||!1,"App - Canvas - New canvas set: Scrolling Vertical set":a.scrollx||!1,"App - Canvas - New canvas set: Scrolling Horizontal set":a.scrolly||!1})),this.emit(s.ON_SUBMIT,a)}.bind(this)),t=this.form.querySelector(".modal-box-content"),this.nameInput=this.form.querySelector("input[name=name]"),this.widthInput=this.form.querySelector("input[name=width]"),this.heightInput=this.form.querySelector("input[name=height]"),this.scrollxInput=this.form.querySelector("input[name=scrollx]"),this.scrollyInput=this.form.querySelector("input[name=scrolly]"),this.deleteButton=this.form.querySelector(".action-delete"),this.presetsSelect=this.createPresetsSelect(),t.replaceChild(this.presetsSelect.render(),this.form.querySelector("select[name=presets]")),this.scrollxInput.checked=this.data.scrollx,this.scrollyInput.checked=this.data.scrolly,this.widthInput.addEventListener("input",this.emit.bind(this,s.ON_SIZE_CHANGE)),this.heightInput.addEventListener("input",this.emit.bind(this,s.ON_SIZE_CHANGE)),this.widthInput.addEventListener("blur",this.emit.bind(this,s.ON_SIZE_BLUR)),this.heightInput.addEventListener("blur",this.emit.bind(this,s.ON_SIZE_BLUR)),this.widthInput.addEventListener("focus",this.emit.bind(this,s.ON_SIZE_FOCUS)),this.heightInput.addEventListener("focus",this.emit.bind(this,s.ON_SIZE_FOCUS)),Array.isArray(this.data.copySources)&&this.data.copySources.length>0&&(this.copyCheckbox=this.form.querySelector("input[name=copy-elements]"),this.copySelect=this.createCopyElementsFromSelect(),t.replaceChild(this.copySelect.render(),this.form.querySelector("select[name=copy-elements-from]")),this.copyCheckbox.addEventListener("click",function(){this.emit(this.copyCheckbox.checked?s.ON_COPY_FROM_ENABLE:s.ON_COPY_FROM_DISABLE)}.bind(this))),this.data.deleteText&&this.deleteButton&&this.deleteButton.addEventListener("click",function(t){t.preventDefault(),this.emit(s.ON_DELETE)}.bind(this)),this.form},t.ResponsiveForm=s}(window);
var DPShortcuts=new MooTools.Class({name:"DPShortcuts",mDisabledShortcuts:{},mIgnoredShortcuts:{},mIsMultiSelectMode:!1,mTextEditMode:!1,mCustom:null,initialize:function(){this.mCustom=new DPShortcuts_Custom,this.isNotMac="mac"!==MooTools.Browser.Platform.name,this.listeners={keyDown:this.handleListenerDown.bindWithEvent(this),keyUp:this.handleListenerUp.bindWithEvent(this)},this.attachListeners(document.body),window.addEvent("blur",this.handleListenerUp.bindWithEvent(this)),document.addEvent("click",function(t){var e=["input","textarea","select","option","radio","checkbox"].contains(t.target.tagName.toLowerCase());t.target.tagName&&e||document.blur()})},setTextEditMode:function(t){this.mTextEditMode=t},getShortcutByOS:function(t){return-1!==navigator.userAgent.indexOf("Mac OS X")?t.replace("Ctrl+","Cmd+"):t},attachListeners:function(t){t.addEvent("keydown",this.listeners.keyDown),t.addEvent("keyup",this.listeners.keyUp)},getShortcut:function(t){var e={96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",107:"+",109:"-",173:"-"};return"="===t.key&&(t.code=107),(t.control||t.meta?"ctrl+":"")+(t.shift?"shift+":"")+(t.alt?"alt+":"")+(e[t.code]?e[t.code]:t.key)},isEventTriggeredInTextEditor:function(t,e){return!["ctrl+f","esc"].contains(e)&&this.mTextEditMode},handleListenerDown:function(t){if(!dpManager.dpWorkBench.getActivePage())return!1;this.shortcut=this.getShortcut(t);var e=["ctrl+r","ctrl+alt+r"],i="ctrl+r"===this.shortcut;return!(this.isSearchShortcut(t)||e.contains(this.shortcut)||!this.isFormElementActive(t)||this.isTextEdit(t)||this.isSaveShortcut(t))||(!i||!this.isContentEditable(t))&&(!!this.mIgnoredShortcuts[this.shortcut]||(this.setMultiSelectMode(!1),this.mDisabledShortcuts[this.shortcut]?(t.stop(),!1):this.isEventTriggeredInTextEditor(t,this.shortcut)?-1===this.shortcut.indexOf("+")||this.shortcut.indexOf("alt")>-1||this.shortcut.indexOf("shift+l")>-1||(this.mCustom.trigger(this.shortcut)&&t.stop(),!0):("ctrl+shift+p"===this.shortcut&&(dpManager.Analytics.kissEvent("App - Preview open clicked",{"App - Preview open clicked by":"Shortcut","App - Preview open clicked: Feature location":"App"}),dpManager.dpProject.openPreview(!1,!1,!1,!0),t.stop()),"space"!==this.shortcut&&(!this.mCustom.trigger(this.shortcut)||(t.stop(),!0)))))},isSearchShortcut:function(t){return"f"===t.key&&(t.control||t.meta)},isFormElementActive:function(t){return!["html","body","a"].contains(t.target.tagName.toLowerCase())},isTextEdit:function(t){return t.target.hasClass("dpEditable")},isContentEditable:function(t){return"true"===t.target.getAttribute("contenteditable")},isSaveShortcut:function(t){return"s"===t.key&&t.control&&!t.alt},handleListenerUp:function(){this.setMultiSelectMode(!1),this.shortcut&&(this.mCustom.trigger(this.shortcut,"keyup"),this.shortcut=null)},ignoreShortcut:function(t){this.mIgnoredShortcuts[t]=!0},unignoreShortcut:function(t){this.mIgnoredShortcuts[t]=!1},disableShortcut:function(t){this.mDisabledShortcuts[t]=!0},enableShortcut:function(t){this.mDisabledShortcuts[t]=!1},disableShortcuts:function(t){t.each(this.disableShortcut.bind(this))},enableShortcuts:function(t){t.each(this.enableShortcut.bind(this))},moveAction:function(t,e,i){if(dpManager.dpSelector.isManyElementsSelected()){var o=1;dpManager.dpWorkBench.getActivePage().getActiveElements().each(function(t){t["move"+e](i,o),o+=1}),dpManager.dpWorkBench.getActivePage().updateVirtualElement()}else t["move"+e](i)},getMultiSelectMode:function(){return this.mIsMultiSelectMode},setMultiSelectMode:function(t){this.mIsMultiSelectMode=!!t},addShortcut:function(t,e,i,o){e.triggerOnKeyUp=o||!1,this.mCustom.add(t,e,i)},replaceShortcut:function(t,e){this.mCustom.replace(t,e)},restoreShortcut:function(t){this.mCustom.restore(t)},removeShortcut:function(t,e){this.mCustom.remove(t,e)}});
var DPShortcuts_Custom=new MooTools.Class({name:"DPShortcuts_Custom",mShortcuts:null,mStash:{},initialize:function(){this.mShortcuts=new MooTools.Hash},add:function(t,s,e){var h=[];t=t.toLowerCase(),this.mShortcuts.has(t)?h=this.mShortcuts.get(t):this.mShortcuts.set(t,[]),h.contains(s)||(h[e?"unshift":"push"](s),this.mShortcuts.set(t,h))},replace:function(t,s){var e=[s],h=this.mStash[t]&&this.mStash[t].length>0?_.clone(this.mStash[t]):[],r=this.mShortcuts.get(t);h.push(r),this.mStash[t]=h,this.mShortcuts.set(t,e)},restore:function(t){var s=[];this.mStash[t]&&this.mStash[t].length>0&&(s=this.mStash[t].pop()),this.mShortcuts.set(t,s)},remove:function(t,s){if(t=t.toLowerCase(),this.mShortcuts.has(t)){var e=this.mShortcuts.get(t);e.erase(s),this.mShortcuts.set(t,e)}},trigger:function(t,s){var e=this.createTriggerEvent(s);if(t=t.toLowerCase(),!this.mShortcuts.has(t))return!1;var h=this.mShortcuts.get(t);return!!h.length&&(h.each(function(t){e.triggerNext&&(t.triggerOnKeyUp&&"keyup"===s||"keyup"!==s)&&t(e)}),!0)},createTriggerEvent:function(t){function s(){e=!1}var e=!0;return Object.freeze({type:t||"keydown",stop:s,get triggerNext(){return e}})}});
var DPShortcuts_Element=new MooTools.Class({name:"DPShortcuts_Element",mShortcuts:null,mMultiShortcuts:null,attachShortcuts:function(t){var o;t&&this.mShortcuts?o=this.mShortcuts:!t&&this.mShortcuts?o=this.mShortcuts:this.detachShortcuts(),o&&new MooTools.Hash(o).each(function(t,o){dpManager.dpShortcuts.addShortcut(o,t)})},detachShortcuts:function(){this.mShortcuts&&new MooTools.Hash(this.mShortcuts).each(function(t,o){dpManager.dpShortcuts.removeShortcut(o,t)}),this.mMultiShortcuts&&new MooTools.Hash(this.mMultiShortcuts).each(function(t,o){dpManager.dpShortcuts.removeShortcut(o,t)})},getShortcuts:function(){return this.mShortcuts},getMultiShortcuts:function(){return this.mMultiShortcuts}});
var GenericTextShortcuts=new MooTools.Class({name:"GenericTextShortcuts",Implements:[DPShortcuts_Element,MooTools.Events,MooTools.Options],options:{shortcut_props:{"font-family":["font-family"],"font-size":["font-size"],"font-weight":["font-weight"],"font-style":["font-style"],"text-decoration":["text-decoration"]}},createKeyboardShortcuts:function(t){t=MooTools.$extend({getProperty:this.getProperty.bind(this)},t),this.setOptions(t),this.mShortcuts={"ctrl+b":function(){this.options.shortcut_props["font-weight"].each(function(t,o){var i=this.options.getProperty(t).test(/bold/)?"":"bold";this.setProperty(t,i,!0,!0,o)}.bind(this)),this.updateToolbar()}.bind(this),"ctrl+u":function(){this.options.shortcut_props["text-decoration"].each(function(t,o){var i=this.options.getProperty(t).split(" ");i.contains("underline")?i.erase("underline"):i.push("underline"),this.setProperty(t,i.join(" "),!0,!0,o)}.bind(this)),this.updateToolbar()}.bind(this),"ctrl+i":function(){this.options.shortcut_props["font-style"].each(function(t,o){var i=this.options.getProperty(t).test(/italic/)?"":"italic";this.setProperty(t,i,!0,!0,o)}.bind(this)),this.updateToolbar()}.bind(this),"ctrl++":function(){this.options.shortcut_props["font-size"].each(function(t,o){var i=this.options.getProperty(t),s=new MooTools.Hash(this.getPropertyDefinition(t).options).getValues(),e=s.indexOf(i);s[e+1]&&this.setProperty(t,s[e+1],!0,!0,o)}.bind(this)),this.updateToolbar()}.bind(this),"ctrl+-":function(){this.options.shortcut_props["font-size"].each(function(t,o){var i=this.options.getProperty(t),s=new MooTools.Hash(this.getPropertyDefinition(t).options).getValues(),e=s.indexOf(i);s[e-1]&&this.setProperty(t,s[e-1],!0,!0,o)}.bind(this)),this.updateToolbar()}.bind(this)}},updateToolbar:function(){if(this.mToolbar)if(this.mToolsBoxWidgets.length){var t=this.mToolbar.mWidgetsManager.getCurrent();t&&"function"==typeof t.refresh&&t.refresh()}else this.mToolbar.mWidgets.each(function(t){t.refresh()})}});
var RichTextShortcuts=new MooTools.Class({name:"RichTextShortcuts",Implements:[DPShortcuts_Element,MooTools.Events,MooTools.Options],options:{shortcut_props:{"font-family":["font-family"],"font-size":["font-size"],"font-weight":["font-weight"],"font-style":["font-style"],"text-decoration":["text-decoration"]}},createKeyboardShortcuts:function(t){t=MooTools.$extend({getProperty:this.getProperty.bind(this)},t),this.setOptions(t),this.mShortcuts={"ctrl+b":function(){var t=this.setProperty.bind(this,"font-weight","bold",!1,!0);this.textElementCall(t)}.bind(this),"ctrl+u":function(){var t=this.setProperty.bind(this,"text-decoration","underline",!1,!0);this.textElementCall(t)}.bind(this),"ctrl+i":function(){var t=this.setProperty.bind(this,"font-style","italic",!1,!0);this.textElementCall(t)}.bind(this),"ctrl++":function(){var t=this.changeFontSizeBy.bind(this,1);this.textElementCall(t)}.bind(this),"ctrl+-":function(){var t=this.changeFontSizeBy.bind(this,-1);this.textElementCall(t)}.bind(this),esc:function(){_.isFunction(this.makeTextNotEditable)&&this.makeTextNotEditable()}.bind(this)}},textElementCall:function(t){try{if(this.editor)this.editor.composer.doc.execCommand("selectAll",!1,null),t();else{this.dblClick(0,0,!0),setTimeout(t,300)}var e=window.dpManager.dpWorkBench.getActivePage();"Virtual"==e.getActiveElement().mType&&setTimeout(e.updateVirtualElement.bind(e),250)}catch(t){}}});
!function(e){"use strict";var t={MODAL_TEMPLATE_ID:"add-element-modal-template",LIST:".list-container",CHECKBOX:".select-library-checkbox",ADD_BUTTON:".add-button"},i=function(e,i){this.el=null,this.list=null,this.source=e,this.selectedLibraries=[],this.eventRefs={},this.template=_.template(document.getElementById(t.MODAL_TEMPLATE_ID).innerHTML),i&&(this.elements=i)};i.prototype=Object.create(e.AbstractModal.prototype),i.constructor=i,i.prototype.render=function(){return this.el=document.createElement("section"),this.el.id="libraries-modal-box",this.el.classList.add("modal-box"),this.el.innerHTML=this.template({}),this.list=this.el.querySelector(t.LIST),this.list.appendChild(this.generateLibrariesList()),this.addButton=this.el.querySelector(t.ADD_BUTTON),this.generateLibrariesList(),this.updateCounter(),this.addEvents(),this},i.prototype.generateLibrariesList=function(){var e,t,i=dpManager.User.libraries.filter(function(e){return 1===parseInt(e.is_editable)||!0===e.is_editable}),s=document.createElement("ul");s.classList.add("libraries-list");for(var r=0,l=i.length;r<l;r++)t=i[r].id_tree,e=document.createElement("li"),e.innerHTML='<input data-id="'+i[r].id_library+'" id="library-id-'+t+'" type="checkbox" name="'+t+'" class="select-library-checkbox" value="'+i[r].id_library+'"/><label for="library-id-'+t+'">'+i[r].title+"</label>",s.appendChild(e);return s},i.prototype.updateCounter=function(){var e=this.selectedLibraries.length;if(e>0){var t=1===e?"library selected":"libraries selected";this.el.querySelector(".library-count").innerHTML=e+" "+t,this.el.classList.remove("no-library-selected"),this.addButton.disabled=!1}else this.el.querySelector(".library-count").innerHTML="no libraries selected",this.el.classList.add("no-library-selected"),this.addButton.disabled=!0},i.prototype.setAll=function(e){var i=this.list.querySelectorAll(t.CHECKBOX),s=[];MooTools.Array.prototype.forEach.call(i,function(t){t.checked=e,s.push(t.value)}),this.selectedLibraries=e?s:[],this.updateCounter()},i.prototype.toggleSelection=function(e){var t=this.selectedLibraries.indexOf(e);t>=0?this.selectedLibraries.splice(t,1):this.selectedLibraries.push(e),this.updateCounter()},i.prototype.addElement=function(){var e={element:this.elements||dpManager.UserElements.prepareElement(),name:"Custom element#"+(dpManager.User.elements.length+1),libraries:this.selectedLibraries};dpManager.UserElements.addElementToLibraries(e,this.source),this.destroy()},i.prototype.delegatedClick=function(e){e.target.classList.contains("action-add")?(this.addElement(),e.preventDefault()):e.target.classList.contains("action-close")?(e.preventDefault(),this.destroy()):e.target===this.el?this.destroy():e.target.classList.contains("select-library-checkbox")?this.toggleSelection(e.target.getAttribute("data-id")):e.target.classList.contains("select-all")?(e.preventDefault(),this.setAll(!0)):e.target.classList.contains("select-none")&&(this.setAll(!1),e.preventDefault())},e.AddElementModal=i}(window);
!function(e){"use strict";var t=Object.freeze({MODAL_TEMPLATE_ID:"libraries-modal-template",MPP_MODAL_TEMPLATE_ID:"libraries-modal-template-uxpin-30",MODAL_WRAPPER:".modal-box-wrapper",LIBRARIES_CONTAINER:".scroll-container",ELEMENTS_CONTAINER:".elements-container",CONTENT_WRAPPER:".content-wrapper",SAVE_BUTTON:".save-button",CANCEL_BUTTON:".cancel-button",CHECKBOX:".visibility-checkbox",UNDO_MESSAGE:".undo-message"}),i=function(){return t.MPP_MODAL_TEMPLATE_ID},s=function(e){this.el=null,this.options=_.defaults(e||{},{onOpen:_.noop,onClose:_.noop}),this.Elements=new LibrariesModalElements(this),this.Libraries=new LibrariesModalLibraries(this),this.listsContainer=null,this.elementsContainer=null,this.selectedLibraryNode=null,this.activeLibrary=null,this.editNameMode={on:!1,id:null},this.saveButton=null,this.undoMessage=null,this.visibleLibraries=dpManager.User.visible_libraries?_.clone(dpManager.User.visible_libraries):[],this.eventRefs={},this.template=_.template(document.getElementById(i()).innerHTML),this.refreshElementsList(),this.settings=null,this.undoTimeout=null};s.prototype=Object.create(e.AbstractModal.prototype),s.constructor=s,s.prototype.render=function(){return this.el=document.createElement("section"),this.el.id="libraries-modal-box",this.el.classList.add("modal-box"),this.el.innerHTML=this.template({}),this.listsContainer=this.el.querySelector(t.LIBRARIES_CONTAINER),this.elementsContainer=this.el.querySelector(t.ELEMENTS_CONTAINER),this.saveButton=this.el.querySelector(t.SAVE_BUTTON),this.generateLibrariesList(),this.updateCounter(),this.addEvents(),_.isFunction(this.options.onOpen)&&this.options.onOpen(),this},s.prototype.generateLibrariesList=function(){var e;this.listsContainer.innerHTML="",this.generatedList=this.Libraries.generateLibrariesList(dpManager.elementsDataManager.mElementsData.categories),e=document.createElement("header"),e.classList.add("header-custom-library"),this.listsContainer.appendChild(e),this.listsContainer.appendChild(this.Libraries.generateCategoryLabel("UXPin libraries")),this.listsContainer.appendChild(this.generatedList)},s.prototype.refreshElementsList=function(){this.elementsList=this.Elements.getElementsList()},s.prototype.generateElementsList=function(e){var t=this.Elements.getElementsByLibraryId(e),i=this.Libraries.isLibraryEditable(e),s=this.Libraries.isLibraryCustom(e);return this.Elements.generateElementsList(t,i,s)},s.prototype.setCustomLibraryClass=function(e){var i=this.el.querySelector(t.CONTENT_WRAPPER);this.Libraries.isLibraryCustom(e)?(i.classList.add("custom-library"),uxpft.disabledInPlan(FEATURE_CUSTOM_LIBRARIES)&&i.classList.add("upgrade-bar-visible")):(i.classList.remove("custom-library"),i.classList.remove("upgrade-bar-visible"))},s.prototype.updateElementsList=function(e){var t,i,s,n;if(this.activeLibrary=e||this.activeLibrary,this.activeLibrary){if(this.setCustomLibraryClass(this.activeLibrary),this.elementsContainer.innerHTML="",this.elementsContainer.scrollTop=0,this.Libraries.isLibraryEditable(this.activeLibrary)&&this.Libraries.isOwner(this.activeLibrary)&&uxpft.enabled(FEATURE_EDITABLE_CUSTOM_LIBRARIES)&&(i=this.generateActionLink({text:"Library settings",actionClasses:["action-edit-library","icon-general-settings","edit-library-link","big-blue-link"],attributes:{"data-library-id":e}}),this.elementsContainer.appendChild(i)),t=this.generateElementsList(this.activeLibrary),!uxpft.disabledInPlan(FEATURE_CUSTOM_LIBRARIES)||t.length&&1!==t.length||!this.Libraries.isLibraryCustom(e)||this.elementsContainer.appendChild(dpManager.UserElements.getPromoCountDown()),!t.length)return void this.elementsContainer.appendChild(t);for(s=0,n=t.length;s<=n;s+=1)t[s]&&this.elementsContainer.appendChild(t[s])}},s.prototype.generateActionLink=function(e){var t,i=_.defaults(e||{},{actionClasses:[],styleClasses:[],href:"#",text:"",attributes:{}}),s=document.createElement("a");i.href&&(s.href=i.href),i.actionClasses.forEach(function(e){s.classList.add(e)}),i.styleClasses.forEach(function(e){s.classList.add(e)}),i.text&&(s.innerHTML=i.text);for(t in i.attributes)i.attributes.hasOwnProperty(t)&&s.setAttribute(t,i.attributes[t]);return s},s.prototype.showUndoMessage=function(e,t,i){var s,n,a,r;this.hideUndoMessage(),s=document.createElement("aside"),s.classList.add("undo-message"),n=document.createElement("p"),a="element"===e?"Element":"Library",n.innerHTML=a+" &quot;<strong>"+t+"</strong>&quot; has been deleted",r=this.generateActionLink({actionClasses:["action-undo-delete"],styleClasses:["big-blue-link"],text:"Undo action",attributes:{"data-item-id":i,"data-item":e}}),s.appendChild(n),s.appendChild(r),this.elementsContainer.appendChild(s),this.elementsContainer.classList.add("undo-message-visible"),this.undoTimeout=setTimeout(function(){dpManager.Analytics.kissEvent("app-libraries-delete "+e),this.hideUndoMessage()}.bind(this),5e3)},s.prototype.hideUndoMessage=function(){this.undoMessage=this.elementsContainer.querySelector(t.UNDO_MESSAGE),this.undoMessage&&(this.elementsContainer.classList.remove("undo-message-visible"),setTimeout(function(){this.undoMessage.parentElement.removeChild(this.undoMessage),clearTimeout(this.undoTimeout)}.bind(this),300))},s.prototype.updateLibrarySelection=function(e,t){this.selectedLibraryNode&&this.selectedLibraryNode.classList.remove("selected"),e||t||!this.activeLibrary?t&&(this.selectedLibraryNode="A"===t.tagName?t.parentNode:t):this.selectedLibraryNode=this.listsContainer.querySelector('[data-id="'+this.activeLibrary+'"'),this.selectedLibraryNode&&this.selectedLibraryNode.classList.add("selected")},s.prototype.updateVisibilityList=function(e){var t=this.visibleLibraries.indexOf(e)>=0,i=this.visibleLibraries.indexOf(parseInt(e,10))>=0;t||i?!t&&i?this.visibleLibraries.splice(this.visibleLibraries.indexOf(parseInt(e,10)),1):!i&&t&&this.visibleLibraries.splice(this.visibleLibraries.indexOf(e),1):(this.visibleLibraries.push(e),this.delayLabel(e)),this.updateCounter()},s.prototype.delayLabel=function(e){var t=this.listsContainer.querySelector("#library-label-"+e);t.classList.add("with-delay"),setTimeout(function(){t.classList.remove("with-delay")},1e3)},s.prototype.getCountFromCheckboxes=function(){return this.listsContainer.querySelectorAll(t.CHECKBOX+":checked").length},s.prototype.setVisibilityForAll=function(e){var i=this.listsContainer.querySelectorAll(t.CHECKBOX),s=[];MooTools.Array.prototype.forEach.call(i,function(t){t.checked=e,s.push(t.value)}),this.visibleLibraries=e?s:[],this.updateCounter()},s.prototype.updateCounter=function(){var e,t=this.getCountFromCheckboxes();t>0?(e=1===t?"library selected":"libraries selected",this.el.querySelector(".library-count").innerHTML=t+" "+e,this.el.classList.remove("no-library-selected"),this.saveButton.disabled=!1):(this.el.querySelector(".library-count").innerHTML="no libraries selected",this.el.classList.add("no-library-selected"),this.saveButton.disabled=!0)},s.prototype.saveSettings=function(){(new e.Dejax).newRequest({url:"/ajax/dmsAdminUsers/SetVisibleLibraries/",mode:"cancel",data:{visible_libraries:this.visibleLibraries},onComplete:function(){this.destroy(),dpManager.UserElements.setVisibleLibraries(this.visibleLibraries),dpManager.Analytics.kissEvent("App - Manage libraries - Libraries chosen",{number:this.visibleLibraries.length})}.bind(this)})},s.prototype.deleteElement=function(e){dpManager.UserElements.deleteElement(e,"modal"),this.Elements.removeElement(e)},s.prototype.exitNameEditMode=function(e){this.editNameMode.on=!1,this.editNameMode.id=null,e&&e.blur()},s.prototype.updateElementName=function(e,t,i){if(this.editNameMode.on=!1,this.editNameMode.id=null,!t)return i.value=e.name,void this.exitNameEditMode(i);e.name!==t&&(dpManager.UserElements.renameElement(e.id_element,t),this.Elements.updateElement(e.id_element,t),this.exitNameEditMode(i))},s.prototype.removeEvents=function(){this.el.removeEventListener("click",this.eventRefs.delegatedClick),this.el.removeEventListener("focus",this.eventRefs.delegatedFocus,!0),this.el.removeEventListener("blur",this.eventRefs.delegatedBlur,!0),this.listsContainer.removeEventListener("change",this.eventRefs.delegatedChange),document.removeEventListener("keydown",this.eventRefs.keyDown)},s.prototype.addEvents=function(){this.eventRefs.keyDown=this.keyDown.bind(this),this.eventRefs.delegatedClick=this.delegatedClick.bind(this),this.eventRefs.delegatedFocus=this.delegatedFocus.bind(this),this.eventRefs.delegatedBlur=this.delegatedBlur.bind(this),this.eventRefs.delegatedChange=this.delegatedChange.bind(this),this.el.addEventListener("click",this.eventRefs.delegatedClick),this.el.addEventListener("focus",this.eventRefs.delegatedFocus,!0),this.el.addEventListener("blur",this.eventRefs.delegatedBlur,!0),this.listsContainer.addEventListener("change",this.eventRefs.delegatedChange),document.addEventListener("keydown",this.eventRefs.keyDown),this.el.querySelector(".action-upgrade")&&dpManager.attachUpgradeEvent(this.el.querySelector(".action-upgrade"))},s.prototype.delegatedClick=function(e){e.target.classList.contains("action-save")?this.saveSettings():e.target.classList.contains("action-delete")?(e.preventDefault(),this.deleteElement(e.target.dataset.id)):e.target.classList.contains("action-undo-delete")?(this.hideUndoMessage(),dpManager.UserElements.undoDelete(e.target.dataset.item,e.target.dataset.itemId)):e.target.classList.contains("action-close")?(e.preventDefault(),this.destroy()):e.target.classList.contains("library-link")?(e.preventDefault(),this.updateElementsList(e.target.dataset.id),this.updateLibrarySelection(e.target.dataset.title,e.target)):e.target.classList.contains("select-all")?(e.preventDefault(),this.setVisibilityForAll(!0)):e.target.classList.contains("select-none")?(e.preventDefault(),this.setVisibilityForAll(!1)):e.target.classList.contains("action-upgrade")&&this.destroy()},s.prototype.delegatedChange=function(e){this.updateVisibilityList(e.target.value)},s.prototype.delegatedFocus=function(e){e.target.classList.contains("edit-name-input")&&(this.editNameMode.on=!0,this.editNameMode.id=e.target.dataset.id,e.target.value=e.target.value)},s.prototype.delegatedBlur=function(e){var t;e.target.classList.contains("edit-name-input")&&(t=this.Elements.getCustomElementById(e.target.dataset.id),this.updateElementName(t,e.target.value,e.target))},s.prototype.keyDown=function(e){e.keyCode===Enums.KEYS.ESC&&e.target.classList.contains("edit-name-input")?(e.target.value=this.Elements.getCustomElementById(e.target.dataset.id).name,this.exitNameEditMode(e.target),e.preventDefault()):e.keyCode===Enums.KEYS.ESC?(this.destroy(),e.preventDefault()):e.keyCode===Enums.KEYS.TAB?e.preventDefault():e.keyCode===Enums.KEYS.ENTER&&this.editNameMode.on&&e.target.classList.contains("edit-name-input")&&this.updateElementName(this.Elements.getCustomElementById(e.target.dataset.id),e.target.value,e.target)},s.prototype.destroy=function(){this.removeEvents(),e.AbstractModal.prototype.destroy.call(this)},e.LibrariesModal=s}(window);
!function(e){"use strict";var t=function(e){this.parent=e};t.prototype=Object.create(EventEmitter.prototype),t.constructor=t,t.prototype.getElementsList=function(){return dpManager.User.elements.concat(dpManager.elementsDataManager.mElementsData.list)},t.prototype.getElementsByLibraryId=function(e){return this.parent.elementsList.filter(function(t){return t.id_tree===e})},t.prototype.getCustomElementById=function(e){return _.find(this.parent.elementsList,function(t){return t.id_element===e})},t.prototype.generateNoElementsInfo=function(){var e=document.createElement("div"),t=[],n=uxpft.disabledInPlan(FEATURE_CUSTOM_LIBRARIES)&&uxpft.disabledInPlan(FEATURE_CUSTOM_LIBRARIES_PROMO),r=n?"template-libraries-modal-no-elements-info-extended":"template-libraries-modal-no-elements-info-simple",a=utils.RenderTemplate(r);e.insertAdjacentHTML("beforeend",a);for(var i=0,l=e.children.length;i<=l;i++)e.children[i]&&t.push(e.children[i]);return t},t.prototype.appendNoElementsInfo=function(e){for(var t=this.generateNoElementsInfo(),n=0,r=t.length;n<=r;n++)t[n]&&e.appendChild(t[n])},t.prototype.generateElementsList=function(e,t,n){if(!e||0===e.length){var r=this.generateNoElementsInfo();return uxpft.disabledInPlan(FEATURE_CUSTOM_LIBRARIES)&&uxpft.disabledInPlan(FEATURE_CUSTOM_LIBRARIES_PROMO)&&dpManager.attachUpgradeEvent(r[1].querySelector(".action-upgrade"),dpManager.UserElements.sendKissUpgradeEvent),r}var a=document.createElement("ul");a.classList.add("elements-list");var i;return e.forEach(function(e){e.status&&"0"!==e.status&&(i=this.generateElement(e,t,n),a.insertAdjacentHTML("beforeend",i))}.bind(this)),a},t.prototype.generateElement=function(e,t,n){if("1"==e.status){var r={id:e.id_element,icon:e.icon,iconClass:window["DPElementsList_Element_"+e.type]&&e.icon&&e.icon.test(/.svg/)?"icon":"",isElementEditable:n&&t,label:e.label};return utils.RenderTemplate("template-libraries-modal-element",r)}},t.prototype.updateElement=function(e,t){var n=this.parent.elementsContainer.querySelector("#container-element-no-"+e);e&&t&&n&&(n.querySelector("label").textContent=t)},t.prototype.removeElement=function(e){var t=this.parent.elementsContainer.querySelector("#container-element-no-"+e);e&&t&&(t.parentNode.removeChild(t),this.parent.elementsContainer.querySelector("ul").children.length||(this.parent.elementsContainer.removeChild(this.parent.elementsContainer.querySelector("ul")),this.appendNoElementsInfo(this.parent.elementsContainer),uxpft.disabledInPlan(FEATURE_CUSTOM_LIBRARIES)&&uxpft.disabledInPlan(FEATURE_CUSTOM_LIBRARIES_PROMO)&&dpManager.attachUpgradeEvent(this.parent.elementsContainer.querySelector(".action-upgrade"),dpManager.UserElements.sendKissUpgradeEvent)))},e.LibrariesModalElements=t}(window);
!function(e){"use strict";var t=function(e){this.parent=e};t.prototype=Object.create(EventEmitter.prototype),t.constructor=t,t.prototype.generateCategoryLabel=function(e){var t=document.createElement("h3");return t.classList.add("category-label"),t.classList.add("g-heading-3"),t.innerHTML=e||"Default",t},t.prototype.generateLibsGroupLabel=function(e){var t=document.createElement("h4");return t.classList.add("lib-group-label"),t.innerHTML=e||"Default",t},t.prototype.generateProInfo=function(){var e=document.createElement("p");return e.classList.add("info-block"),e.innerHTML='<small class="pro-label">Pro</small> More libraries available in Pro Plan. <a class="action-upgrade" href="#action-upgrade" data-source="basic plan elements library">Upgrade now!</a>',e},t.prototype.generateLibrariesList=function(e){var t=document.createElement("ul");return e.forEach(function(e){t.appendChild(this.generateLibrary(e))}.bind(this)),t},t.prototype.generateLibrary=function(e){var t,r,i=e.id_tree;return t=document.createElement("li"),t.classList.add("library-link"),t.classList.add("g-link"),t.classList.add("library-id-"+e.id_library),t.setAttribute("data-title",e.title),t.setAttribute("data-id",i),r=this.libraryInList(e.id_tree,this.parent.visibleLibraries)?"checked":"",t.innerHTML='<input id="library-id-'+i+'" type="checkbox" name="'+i+'" class="visibility-checkbox" value="'+i+'" '+r+'/><label id="library-label-'+i+'" for="library-id-'+i+'" class="visibility-switch">Select</label><a href="#'+i+'" class="g-link library-link" data-title="'+e.title+'" data-id="'+e.id_tree+'"></a>',t.querySelector("a").textContent=e.title,t},t.prototype.isLibraryCustom=function(e){return"c"===e[0]},t.prototype.isLibraryEditable=function(e){var t=_.find(dpManager.User.libraries,function(t){return t.id_tree===e});return!(!t||!t.is_editable)&&1===parseInt(t.is_editable)},t.prototype.isOwner=function(e){var t=_.find(dpManager.User.libraries,function(t){return t.id_tree===e});return t&&(1===parseInt(t.is_owner)||!0===t.is_owner)},t.prototype.libraryInList=function(e,t){return t.some(function(t){return t===e||t===parseInt(e)})},e.LibrariesModalLibraries=t}(window);
var DPToolbar=new MooTools.Class({name:"DPToolbar",mIcons:{},mToolbarElContainer:null,mToolbarEl:null,initialize:function(t,e){if(!t||!e.container)return!1;this.mIcons=t,this.mToolbarElContainer=new MooTools.Element("div",{class:"Toolbar"}),this.mToolbarEl=new MooTools.Element("div").injectInside(this.mToolbarElContainer),e.height&&this.mToolbarElContainer.setStyle("height",e.height),this.createButtons(),e.container.adopt(this.getDOMElement())},addButton:function(t,e){var n=this.mIcons[e].type||"button";this.mIcons[e].elementLink=new MooTools.Element("a",{name:"Toolbar_"+e,title:t.hint}).injectInside(this.mToolbarEl),this.mIcons[e].elementImage=new MooTools.Element("img",{src:DSWindowSkin.mIconBaseP+t.icon,alt:t.hint}).injectInside(this.mIcons[e].elementLink),this.mIcons[e].elementImage.disableSelection(),t.text_hint&&(this.mIcons[e].elementTextHint=new MooTools.Element("span").set("html",t.text_hint).injectInside(this.mIcons[e].elementLink),this.mIcons[e].elementTextHint.disableSelection()),this.mIcons[e].elementLink.addEvent("mouseup",this.execute.pass(e,this)),"checkbox"==n&&1==this.mIcons[e].checked&&this.mIcons[e].elementLink.addClass("ButtonChecked")},executeActions:function(){for(i in this.mIcons)"checkbox"==this.mIcons[i].type&&(this.mIcons[i].checked=!this.mIcons[i].checked,this.mIcons[i].action(this.mIcons[i]),this.mIcons[i].checked=!this.mIcons[i].checked)},addSeparator:function(){new MooTools.Element("span",{class:"separator"}).injectInside(this.mToolbarEl)},createButtons:function(){for(i in this.mIcons)MooTools.$defined(this.mIcons[i].separator)&&1==this.mIcons[i].separator?this.addSeparator():(this.addButton(this.mIcons[i],i),this.setButtonDefault(i))},execute:function(t){1==this.mIcons[t].active&&this.mIcons[t].action(this.mIcons[t]),"checkbox"==this.mIcons[t].type&&(0==this.mIcons[t].checked?(this.mIcons[t].checked=1,this.mIcons[t].elementLink.addClass("ButtonChecked")):(this.mIcons[t].checked=0,this.mIcons[t].elementLink.removeClass("ButtonChecked")))},getDOMElement:function(){return this.mToolbarElContainer},setButtonActive:function(t){this.mIcons[t].active=!0,this.mIcons[t].elementLink.setStyles({opacity:"1"}),this.mIcons[t].elementLink.addClass("ButtonActive");var e=this.mIcons[t].elementLink.getElement(".DisableButton");e&&e.destroy(),this.mIcons[t].shortcut&&dpManager.dpShortcuts.enableShortcuts(this.mIcons[t].shortcut)},setButtonsActive:function(t){t.each(this.setButtonActive.bind(this))},setButtonDefault:function(t){1==this.mIcons[t].active?this.setButtonActive(t):this.setButtonInactive(t)},setButtonProperty:function(t,e,n){return!!this.mIcons[t]&&(this.mIcons[t][e]=n,"text_hint"==e?this.mIcons[t].elementTextHint.set("html",n):"hint"==e?(this.mIcons[t].elementLink.setProperty("title",n),this.mIcons[t].elementImage.setProperty("alt",this.mIcons[t].hint)):"icon"==e&&this.mIcons[t].elementImage.setProperties({src:DSWindowSkin.mIconBaseP+n,alt:this.mIcons[t].hint}),!0)},setButtonInactive:function(t){this.mIcons[t].active=!1,this.mIcons[t].elementLink.setStyles({opacity:"0.2"}),this.mIcons[t].elementLink.removeClass("ButtonActive"),this.mIcons[t].elementLink.adopt(new MooTools.Element("div",{class:"DisableButton"})),this.mIcons[t].shortcut&&dpManager.dpShortcuts.disableShortcuts(this.mIcons[t].shortcut)},setButtonsInactive:function(t){t.each(this.setButtonInactive.bind(this))},getIcon:function(t){return this.mIcons[t]}});
var DPTabs=new MooTools.Class({name:"DPTabs",Implements:[MooTools.Events,MooTools.Options],mContainerEl:null,mTitlesEl:null,mTabs:{},mTabsCount:0,mCachedElements:[],mTabsContents:null,mActiveTab:null,initialize:function(t,i){this.setOptions(i),this.mContainerEl=t,this.initLayout(),this.loadTabs(),this.finalizeLayout(),this.showDefaultTab()},initLayout:function(){this.mTitlesEl=new MooTools.Element("ul"),this.mTitlesEl.setProperty("class","DPTabs"),this.mTabsContents=new MooTools.Element("div"),this.mTabsContents.setProperty("class","DPTabsContents")},finalizeLayout:function(){this.mTitlesEl.injectInside(this.mContainerEl),this.mTabsContents.injectInside(this.mContainerEl)},loadTabs:function(){this.mContainerEl.getChildren().each(this.initTab.bind(this))},generateID:function(){return Math.round(999999999999999*Math.random())},initTab:function(t){var i=this.generateID();this.mTabs[i]={source:t.getProperty("title"),title:t.getProperty("title"),element:t,id:i},t.setProperty("title",""),this.mTabsCount++,this.mCachedElements.include(t),t.setStyle("display","none"),t.injectInside(this.mTabsContents),this.createSwitch(i)},createSwitch:function(t){this.mTabs[t].tabElement=new MooTools.Element("li").set("html","<a>"+this.mTabs[t].title+"</a>"),this.mTabs[t].tabElement.injectInside(this.mTitlesEl),this.mTabs[t].tabElement.addEvent("click",this.switchTab.pass([t],this))},switchTab:function(t){t!=this.mActiveTab&&(this.hideTab(this.mActiveTab),this.mActiveTab=t,this.mTabs[this.mActiveTab].element.setStyle("display","block"),this.mTabs[this.mActiveTab].tabElement.addClass("active"),this.fireEvent("onSwitch"))},hideTab:function(t){this.mTabs[t]&&(this.mTabs[t].element.setStyle("display","none"),this.mTabs[t].tabElement.removeClass("active"))},showDefaultTab:function(){if(this.options.default){var t=$(this.options.default);if(t&&this.mCachedElements.contains(t))for(i in this.mTabs)if(this.mTabs[i].element==t)return void this.switchTab(i);var e=parseInt(this.options.default);if(e&&e<=this.mTabsCount){var s=0;for(i in this.mTabs)if(++s==e)return void this.switchTab(i)}}for(i in this.mTabs){this.switchTab(i);break}},setSize:function(t,i){this.mContainerEl.setStyles({width:t,height:i});var e=parseInt(this.mTitlesEl.getStyle("padding-left"))+parseInt(this.mTitlesEl.getStyle("padding-right"));this.extendAllTabs(this.mTitlesEl.getSize().x-e)},extendAllTabs:function(t){var e=0;for(i in this.mTabs)e+=this.mTabs[i].tabWidth=this.mTabs[i].tabElement.getSize().x;for(i in this.mTabs)this.resizeTab(this.mTabs[i].tabElement,Math.round(this.mTabs[i].tabWidth/e*t))},resizeTab:function(t,i){t.setStyle("width",i-parseInt(t.getStyle("padding-left")))},getCurrentContentTitle:function(){return this.mTabs[this.mActiveTab].source},getTabBySource:function(t){var i=null;return new MooTools.Hash(this.mTabs).each(function(e,s){e.source==t&&(i=e)}),i}});
!function(t){"use strict";var e=new MooTools.Class({cache:{centerOffset:null,previousAngle:null,angle:null,bounds:null},shiftIsPressed:!1,mActiveEl:null,eventsRef:{},initialize:function(){this.eventsRef.startListenToShiftPress=this.startListenToShiftPress.bind(this),this.eventsRef.stopListenToShiftPress=this.stopListenToShiftPress.bind(this),window.addEventListener("keydown",this.eventsRef.startListenToShiftPress),window.addEventListener("keyup",this.eventsRef.stopListenToShiftPress)},destroy:function(){window.removeEventListener("keydown",this.eventsRef.startListenToShiftPress),window.removeEventListener("keyup",this.eventsRef.stopListenToShiftPress)},updateCache:function(t){this.cache=MooTools.$extend(this.cache,t),this.mActiveEl.rotator=MooTools.$extend(this.mActiveEl.rotator,t)},startListenToShiftPress:function(t){16===t.keyCode&&(this.shiftIsPressed=!0)},stopListenToShiftPress:function(t){16===t.keyCode&&(this.shiftIsPressed=!1)},calculateCenterOffset:function(){var t=dpManager.dpWorkBench.mWorkBench.getPosition();return t.x+=dpManager.dpWorkBench.getWorkBenchEl().offsetLeft,t.x-=dpManager.dpWorkBench.getWorkbenchScrollPane().scrollLeft,t.y+=dpManager.dpWorkBench.getWorkBenchEl().offsetTop,t.y-=dpManager.dpWorkBench.getWorkbenchScrollPane().scrollTop,{x:t.x+this.mActiveEl.getProperty("left")+this.mActiveEl.getProperty("width")/2,y:t.y+this.mActiveEl.getProperty("top")+this.mActiveEl.getProperty("height")/2}},calculateCenterOffsetWithoutWorkbench:function(){return{x:this.mActiveEl.getProperty("left").toInt()+this.mActiveEl.getProperty("width").toInt()/2,y:this.mActiveEl.getProperty("top").toInt()+this.mActiveEl.getProperty("height").toInt()/2}},convertPositionRelativeToCenterOffset:function(t,e,n){return n=n||this.cache.centerOffset||this.calculateCenterOffset(),{x:n.x-t,y:n.y-e}},getRotatedByAnglePointCoordinatesRelative:function(t,e,n){var o=n*Math.PI/180,i=Math.sin(o),s=Math.cos(o),r=this.calculateCenterOffsetWithoutWorkbench();return{x:parseInt(s*(t-r.x)-i*(e-r.y)+r.x,10),y:parseInt(i*(t-r.x)+s*(e-r.y)+r.y,10)}},getRotatedByAnglePointCoordinates:function(t,e,n){var o=n*Math.PI/180,i=Math.sin(o),s=Math.cos(o);return{x:parseInt(t*s-e*i,10),y:parseInt(t*i+e*s,10)}},getRelativeToWorkbenchBoundingClientRect:function(t){if(!t)return!1;var e=t.getBoundingClientRect(),n=dpManager.dpWorkBench.getWorkBenchEl().getPosition();return{width:e.width.toInt(),height:e.height.toInt(),top:e.top.toInt()-n.y,left:e.left.toInt()-n.x}},calculateRelativeToWorkbenchRotatedBounds:function(t,e,n,o,i){t=t.toInt(),e=e.toInt(),n=n.toInt(),o=o.toInt(),i=i.toInt();var s={x:t+n/2,y:e+o/2},r=this.convertPositionRelativeToCenterOffset(t,e,s),h=this.convertPositionRelativeToCenterOffset(t+n,e,s),a=this.convertPositionRelativeToCenterOffset(t+n,e+o,s),c=this.convertPositionRelativeToCenterOffset(t,e+o,s);r=this.getRotatedByAnglePointCoordinates(r.x,r.y,i),h=this.getRotatedByAnglePointCoordinates(h.x,h.y,i),a=this.getRotatedByAnglePointCoordinates(a.x,a.y,i),c=this.getRotatedByAnglePointCoordinates(c.x,c.y,i),r=this.convertPositionRelativeToCenterOffset(r.x,r.y,s),h=this.convertPositionRelativeToCenterOffset(h.x,h.y,s),a=this.convertPositionRelativeToCenterOffset(a.x,a.y,s),c=this.convertPositionRelativeToCenterOffset(c.x,c.y,s);var l={left:Math.min(r.x,h.x,a.x,c.x),bottom:Math.max(r.y,h.y,a.y,c.y),top:Math.min(r.y,h.y,a.y,c.y),right:Math.max(r.x,h.x,a.x,c.x)};return l.width=l.right-l.left,l.height=l.bottom-l.top,l},recalculatePositionByAngle:function(t,e){var n=this.convertPositionRelativeToCenterOffset(t,e),o=this.getRotatedByAnglePointCoordinates(n.x,n.y,this.cache.angle);return this.convertPositionRelativeToCenterOffset(o.x,o.y)},mathCornerClass:function(t){return t.className.match(/r-(LT|T|RT|RB|R|B|LB|L)/i)[0]}});t.ElementOnAxisKit=e}(window);
var UXPElementAligner=new MooTools.Class({name:"UXPElementAligner",mElements:[],mDirection:null,mOrientation:null,initialize:function(t){this.mElements=t},setDirection:function(t){this.mDirection=t},setOrientation:function(t){this.mOrientation=t},align:function(){var t,e=this.getPeak(),i=this.getPropertyName();this.mElements.each(function(r,o){var n=e,s=r.getProperty(i),a=!!r.isRotated()&&r.rotator.cache.bounds;if("top"===this.mDirection?n+=a?(a.height-r.getProperty("height"))/2:0:"bottom"===this.mDirection?(n-=r.getProperty("height"),n-=a?(a.height-r.getProperty("height"))/2:0):"left"===this.mDirection?n+=a?(a.width-r.getProperty("width"))/2:0:"right"===this.mDirection?(n-=r.getProperty("width"),n-=a?(a.width-r.getProperty("width"))/2:0):"center"===this.mDirection&&(n-=parseInt(r.getProperty("horizontal"==this.mOrientation?"width":"height")/2)),o+1===this.mElements.length&&(t=o),r.setProperty(i,n,!1,!1),r.isAggregation()){var h={};h[i]=n-s,r.resizeElements(h,!0)}r.addProperty2HistoryDelayed(i,s,n,t,!0)}.bind(this)),dpManager.dpSelector.isManyElementsSelected()&&dpManager.dpWorkBench.getActivePage().updateVirtualElement()},distribute:function(){var t,e,i,r,o,n,s=new MooTools.Hash,a=0,h=0;"horizontal"==this.mOrientation?(s.set("left",this.getPeak("left")),s.set("right",this.getPeak("right")),s.set("min",s.get("left")),s.set("max",s.get("right")),e="width",i="left"):(s.set("top",this.getPeak("top")),s.set("bottom",this.getPeak("bottom")),s.set("min",s.get("top")),s.set("max",s.get("bottom")),e="height",i="top"),r=s.max-s.min,this.mElements.map(function(t){a+=t.rotator&&t.rotator.cache.angle?t.rotator.cache.bounds[e]:parseInt(t.getProperty(e),10)}.bind(this)),(t=(r-a)/(this.mElements.length-1))<0&&(t=5);var m;this.mElements.sort(function(t,e){o=t.isRotated()?t.rotator.cache.bounds[i]:t.getProperty(i),n=e.isRotated()?e.rotator.cache.bounds[i]:e.getProperty(i);var r=o-n;return 0===r&&(m="horizontal"==this.mOrientation?"top":"left",o=t.isRotated()?t.rotator.cache.bounds[m]:t.getProperty(m),n=e.isRotated()?e.rotator.cache.bounds[m]:e.getProperty(m),r=o-n),r});for(var g=1,l=this.mElements.length;g<l;g++){if(1===g){var c=parseInt(this.mElements[g-1].getProperty(i),10);this.mElements[g-1].addProperty2HistoryDelayed(i,c,c,0,!0,!0),h++}var p=parseInt(this.mElements[g].getProperty(i),10),d=0,P=0;if(d=this.mElements[g-1].isRotated()?this.mElements[g-1].rotator.cache.bounds[i]+this.mElements[g-1].rotator.cache.bounds[e]:parseInt(this.mElements[g-1].getProperty(i),10)+parseInt(this.mElements[g-1].getProperty(e),10),P=d+t,P+=this.mElements[g].isRotated()?(this.mElements[g].rotator.cache.bounds[e]-this.mElements[g].getProperty(e))/2:0,this.mElements[g].setProperty(i,P,!1,!1),this.mElements[g].addProperty2HistoryDelayed(i,p,P,g+1==this.mElements.length&&h,!0),this.mElements[g].isAggregation()){var y={};y[i]=P-p,this.mElements[g].resizeElements(y,!0)}h++}dpManager.dpSelector.isManyElementsSelected()&&dpManager.dpWorkBench.getActivePage().updateVirtualElement()},getPeak:function(t){var e=t||this.mDirection;if("center"==e)return this.getCenter();var i=this.getPropertyName(),r=null;return this.mElements.each(function(t){var o,n;t.rotator&&t.rotator.cache.angle?(n=t.rotator.getRelativeToWorkbenchBoundingClientRect(t.mEl),o=n[i],"bottom"===e?o+=n.height:"right"===e&&(o+=n.width)):(o=parseInt(t.getProperty(i)),"bottom"==e?o+=parseInt(t.getProperty("height")):"right"==e&&(o+=parseInt(t.getProperty("width")))),(null===r||["top","left"].contains(e)&&o<r||["bottom","right"].contains(e)&&o>r)&&(r=o)}.bind(this)),r},getCenter:function(t){var e,i,r=t||this.mOrientation;return"horizontal"==r?(e=this.getPeak("left"),i=this.getPeak("right")):(e=this.getPeak("top"),i=this.getPeak("bottom")),parseInt(e+(i-e)/2)},getPropertyName:function(){return["top","bottom"].contains(this.mDirection)?"top":["left","right"].contains(this.mDirection)?"left":"horizontal"==this.mOrientation?"left":"top"}});
!function(i){"use strict";i.ElementMixins={}}(window);
!function(i){"use strict";var a=new MooTools.Class({name:"LoadingLayer",mLoadingLayer:null,showLoadingLayer:function(){this.mLoadingLayer||(this.mLoadingLayer=this.renderLoadingLayer()),this.mEl.classList.add("loading"),this.mLoadingLayer.style.zIndex=this.mInEl.style.zIndex,this.mLoadingLayer.classList.add("visible")},hideLoadingLayer:function(){this.mLoadingLayer.classList.remove("visible"),this.mEl.classList.remove("loading")},renderLoadingLayer:function(){var i=document.createElement("div");return i.classList.add("loading-layer"),this.mEl.appendChild(i),this.mLoadingLayer=i,i}});i.LoadingLayer=a}(window.ElementMixins);
!function(e){"use strict";var t=new MooTools.Class({name:"DPProject",Implements:[MooTools.Events],mIdProject:null,mData:null,mDejax:null,mVersions:[{version:0,text:"Default ()"},{version:1,text:"iPhone (320px)",width:320},{version:2,text:"iPhone Landscape (480px)",width:480},{version:3,text:"Tablets (600px)",width:600},{version:4,text:"iPads (768px)",width:768},{version:5,text:"Standard websites (992px)",width:992},{version:6,text:"iPad Landscape (1024px)",width:1024},{version:7,text:"Wide websites (1224px)",width:1224}],mMaxStockVersion:7,mMainVersion:0,mActiveVersionIds:[],initialize:function(t,n){this.mIdProject=t,this.mData=n,this.mMainVersion=this.mData.main_version,this.mData.versions&&this.addVersions(this.mData.versions),this.mData.settings&&!Array.isArray(this.mData.settings)||(this.mData.settings={}),this.mDejax=new e.Dejax},editVersion:function(e){dpManager.dpProject.mVersions[e.version]=e.variation_data,this.fireEvent("editVersions")},shouldCheckIntegrity:function(){return dpManager.DATA.project_data.last_import.type&&"sketch"===dpManager.DATA.project_data.last_import.type},addVersions:function(e){var t=this;Object.keys(e).forEach(function(n){var i=e[n];i.data&&(i.data.width=parseInt(i.data.width,10)||"",i.data.height>0&&(i.data.height=parseInt(i.data.height,10)||""),t.mVersions[i.data.version]=i.data),t.addVersion(i.version,!1)}),this.fireEvent("editVersions")},addVersion:function(e,t){if(void 0!==e&&null!==e)return e=e.toInt(),!!this.mVersions[e]&&(this.mActiveVersionIds.push(e.toInt()),this.mActiveVersionIds=this.mActiveVersionIds.unique().sort(),!0);(void 0===t||t)&&this.fireEvent("editVersions")},getCurrentVersions:function(){var e=[];return this.mVersions.forEach(function(t){dpManager.dpProject.hasVersion(t.version)&&e.push(t)}),e},getMaxVersionIndex:function(){return _.max(_.map(_.compact(this.mVersions),function(e){return e.version}))},getLastIterationNumber:function(){return _.max(_.map(dpManager.dpProject.mData.previous_iterations_urls,function(e){return e.iteration_number}))},getVersion:function(e){for(var t=0,n=this.mVersions.length;t<n;t++)if(this.mVersions[t]&&parseInt(this.mVersions[t].version)===e)return this.mVersions[t];return null},hasVersion:function(e){return-1!==this.mActiveVersionIds.indexOf(parseInt(e))},removeVersion:function(e){if(e=e.toInt(),-1!==this.mActiveVersionIds.indexOf(e)){if(this.mActiveVersionIds.splice(this.mActiveVersionIds.indexOf(e.toInt()),1),parseInt(dpManager.dpWorkBench.getCurrentVersion())===parseInt(e)){dpManager.dpWorkBench.setCurrentVersion(this.mActiveVersionIds[0]);var t=dpManager.dpPageInspector.getActivePageID(),n=dpManager.dpPageInspector.getPageIdWithActiveResponsiveVersion(t),i=dpManager.dpWorkBench.isDefaultVersion()?n:dpManager.dpPageInspector.mVersionIndex[n][dpManager.dpWorkBench.getCurrentVersion()];dpManager.dpPageInspector.setActivePage(i)}return this.fireEvent("editVersions"),!0}return!1},getIdProject:function(){return this.mIdProject},getIdCollection:function(){return this.mData.id_collection},getHash:function(){return this.mData.hash},getPreviewURL:function(t,n,i,r,a,s,o){var d="",c=t||(e.uxpDocEditor?e.uxpDocEditor.getDocumentId():dpManager.dpPageInspector.getActivePageID());if("undefined"!=typeof uxp&&_.get(uxp,"data.experimental")){var p=uxp.data.ngrokSessionId?"?ngrok_session="+uxp.data.ngrokSessionId:"?port="+uxp.data.experimentalHost.split(":").pop();return[dpManager.PREVIEW_URL,"/experiment/",dpManager.dpProject.getHash(),"#/e/pages/"+c,p].join("")}!0===r&&(d+="c"),!0===n&&(d+="d"),!0===i&&(d+="m"),!0===o&&(d+="i"),dpManager.dpPageInspector&&dpManager.dpPageInspector.isComponent()&&(c=dpManager.dpPageInspector.getPages()[0].id_page);var u=dpManager.PREVIEW_URL+"/"+dpManager.dpProject.getHash();switch(u+=a?"#/documents/"+c:"#/pages/"+c,s){case"liveShare":u+="/live-presentation-configuration";break;case"usabilityTesting":u+="/usability-test/1"}return d.length>0&&(u+="?mode="+d),u},openPreview:function(t,n,i,r,a,s){if(!e.uxpDocEditor&&!dpManager.dpWorkBench.getActivePage())return!1;var o=window.getSize().x-20,d=window.getSize().y-20;!dpManager.dpWorkBench.isDefaultVersion()&&n&&(o=dpManager.dpProject.mVersions[dpManager.dpWorkBench.getCurrentVersion()].width),r?window.open(this.getPreviewURL(!1,t,n,i,a,s),"_blank"):e.PopupWindow(o,d,"center","center",this.getPreviewURL(!1,t,n,i),null,!0,"scrollbars,hotkeys,location,menubar,resizable,titlebar,toolbar")},shareProject:function(){var n;t.types.wireframe===this.mData.type?(n=dpManager.dpPageInspector.getActivePageID(),dpManager.dpPageInspector.isComponent()&&(n=dpManager.dpPageInspector.getPages()[0].id_page)):n=e.uxpDocEditor.getDocumentId(),this.mShareProjectWindow=dpManager.createDSWindow({title:"Share your project",width:800,height:600,x:"center",y:"center",modal:!0,ignore_resize:!0,ignore_position:!0,close_button:!0,resizable:!1,close_confirm:!1,url:"/dms/dmsDPProject/ShareProject/?id_project="+this.getIdProject()+"&id_page="+n,on_escape_close:!0})},closeShareProjectWindow:function(){return this.mShareProjectWindow&&this.mShareProjectWindow.Destroy()},exportToZip:function(){if(t.types.document===this.mData.type)return void dpManager.Export.start({name:this.mData.name,type:"ToZip",menu:0,project_hash:this.getHash()});this.mShareProjectWindow=dpManager.createDSWindow({title:"Export to HTML",width:495,height:370,x:"center",y:"center",modal:!0,ignore_resize:!0,ignore_position:!0,close_button:!0,resizable:!1,close_confirm:!1,url:"/dms/Export/ChooseLayout/?hash="+this.getHash(),on_escape_close:!0})},exportAs:function(e){void 0===e&&(e=!1),this.mShareProjectWindow=dpManager.createDSWindow({title:"Export",width:310,height:230,x:"center",y:"center",modal:!0,ignore_resize:!0,ignore_position:!0,close_button:!0,resizable:!1,close_confirm:!1,url:"/dms/Export/ChooseExport/?hash="+this.getHash(),on_escape_close:!0})},getSettings:function(e){return this.mData.settings.hasOwnProperty(e)?this.mData.settings[e]:null},getName:function(){return this.mData.name},getType:function(){return this.mData.type},getPassword:function(){return this.mData.preview_password},isNewProject:function(){return this.mData.isNewProject},isOriginalProject:function(){return!this.mData.id_original_project&&!this.mData.iteration_name},getOriginalProjectId:function(){return this.mData.id_original_project},getIterationName:function(){return""===this.mData.iteration_name&&this.mData.iteration_number?"Iteration #"+this.mData.iteration_number:this.mData.iteration_name||""},changeName:function(e,t){var n=function(n){n&&dpManager.setPageTitle(e),"function"==typeof t&&t(n)}.bind(this);this.mDejax.newRequest({url:"/ajax/dmsDPProject/ChangeName/",mode:"cancel",data:{id_project:this.getIdProject(),name:e},onComplete:n}),this.mData.name=e},saveSettings:function(e,t,n){this.mData.settings[e]=t,this.mDejax.newRequest({url:"/ajax/dmsDPProject/SaveSettings/",mode:"cancel",data:{id_project:this.mIdProject,settings:this.mData.settings},onComplete:"function"==typeof n?n:function(){}})},savePassword:function(e){dpManager.dpProject.mData.preview_password=e,t.saveProjectPassword(this.mIdProject,e)},setMainVersion:function(t){t=parseInt(t),-1!==this.mActiveVersionIds.indexOf(t.toInt())&&(this.mMainVersion=t,(new e.Dejax).newRequest({url:"/ajax/dmsDPProject/changeMainVersion/",mode:"cancel",data:{id_project:this.mIdProject,version:t}}))},updateGuideSettings:function(e,t){this.mData.settings.guides||(this.mData.settings.guides={}),this.mData.settings.guides[e]=t},updatePreviousIterationsUrls:function(e){this.mData.previous_iterations_urls||(this.mData.previous_iterations_urls={}),this.mData.previous_iterations_urls=e}}).extend({types:{document:"D",wireframe:"W"},saveProjectPassword:function(t,n){(new e.Dejax).newRequest({url:"/ajax/dmsDPProject/SavePassword/",mode:"cancel",data:{id_project:t,password:n}})},getMaxStockVersion:function(){return 7},getDefaultVersion:function(){return 0},isDefaultVersion:function(e){return parseInt(e)===t.getDefaultVersion()},isCustomVersion:function(e){return e>t.getMaxStockVersion()}});e.DPProject=t}(window);
var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},DPProject_VersionCommit=new MooTools.Class({name:"DPProject_VersionCommit",Implements:[MooTools.Options,MooTools.Events],mNotificationEl:null,mDejax:null,options:{onCommit:MooTools.$empty,onDispose:MooTools.$empty,onSuccess:MooTools.$empty,container:null,id_project:null,position:null,delay:5e3,show_undo:!0,comments:"copy-all"},initialize:function(o){this.setOptions(o),this.mDejax=new Dejax},resetNotification:function(){this.mNotificationEl||(this.mNotificationEl=new MooTools.Element("section",{class:"processing-info notification spinner"})),this.mNotificationEl.empty();var o=[["span","Creating iteration: "],["h4",this.options.container.getAttribute("data-name")]];this.mNotificationEl.appendChild($.microjungle(o)),this.options.container.classList.add("processing"),this.options.container.classList.add("visible")},getEl:function(){return this.mNotificationEl},commit:function(){this.fireEvent("commit"),this.resetNotification(),this.mNotificationEl.inject(this.options.container),this.options.position&&this.mNotificationEl.position(this.options.position),this.mNotificationEl.fade("in"),DPProject_VersionCommit.commitCall(this.options,this.onCommitComplete.bind(this))},onCommitComplete:function(o){var t,i=function(){this.mNotificationEl.set("morph",{onComplete:function(){this.mNotificationEl.dispose()}.bind(this)}).morph({opacity:0}),this.fireEvent("dispose")}.bind(this);this.mNotificationEl.innerHTML="",o.error?this.mNotificationEl.microjungle([["div",{class:"content error"},"You have no permission to create project version."]]):(this.mNotificationEl.microjungle([["div",{class:"content"},[["h4","You created a new iteration for this project."],this.options.show_undo?["a",{href:"#",class:"undo"},"Undo"]:[]]]]),this.fireEvent("success",o),this.options.show_undo&&this.mNotificationEl.getElement("a").addEvent("click",function(){return MooTools.$clear(t),this.mDejax.newRequest({url:"/ajax/dmsDPProject/RevertVersion/",mode:"cancel",data:{id_project:o.new_id_project},onComplete:this.onCommitUndoComplete.bind(this)}),i(),!1}.bind(this))),t=i.delay(this.options.delay)},onCommitUndoComplete:function(){this.fireEvent("undo"),dpManager.dpProject&&(dpManager.dpProject.mData.previous_iterations_urls=dpManager.dpProject.mData.previous_iterations_urls.slice(1))}});DPProject_VersionCommit.getIterations=function(o,t){"use strict";(new Dejax).newRequest({url:"/ajax/dmsDPProject/GetIterations/",mode:"cancel",data:{idDocument:o.idDocument,page:o.page||0},onComplete:t})},DPProject_VersionCommit.renameIteration=function(o,t,i){"use strict";(new Dejax).newRequest({url:"/ajax/dmsDPProject/RenameIteration/",mode:"cancel",data:{idDocument:o,name:t},onComplete:i})},DPProject_VersionCommit.removeIteration=function(o,t){"use strict";(new Dejax).newRequest({url:"/ajax/dmsDPProject/DeleteProject/",mode:"cancel",data:{id_project:o},onComplete:t})},DPProject_VersionCommit.commitCall=function(o,t){"use strict";var i=function(o){if("object"===(void 0===o?"undefined":_typeof(o))&&!o.error){var i={url:"/"+o.new_hash+"#/pages/"+o.new_first_id_page,name:o.name,idProject:o.new_id_project,date:(new Date).format("db")};dpManager.dpProject&&dpManager.dpProject.mData.previous_iterations_urls.unshift(i)}t.call(this,o,i)};(new Dejax).newRequest({url:"/ajax/dmsDPProject/CommitVersion/",mode:"cancel",data:{name:o.name,id_project:o.id_project,comments:o.comments},onComplete:i})};
!function(e){"use strict";var t=new MooTools.Class({name:"DPComponentsList_Component",Implements:[MooTools.Options,MooTools.Events],mEl:null,mItemEl:null,mDraggingReference:null,mShotDejax:null,mShotRetries:{},mWithOptions:!1,mLoadedCover:null,mCategory:null,initialize:function(t,n){this.setOptions(_.extend({mtime:+new Date},t)),this.mShotDejax=new e.Dejax,this.mWithOptions=n,this.setCategory(),this.render()},setCategory:function(){this.mCategory=this.options.id_category||"0",this.options.shared&&(this.mCategory="shared")},getCategory:function(){return this.mCategory},render:function(){this.mEl=document.createElement("li"),this.mEl.className="category-"+this.getCategory()+" conn-active smart-element",this.mItemEl=document.createElement("a"),this.mItemEl.id="component-"+this.options.id_page;var t=document.createElement("em"),n=document.createElement("span");if(n.innerHTML=e.htmlspecialchars(this.options.name,"ENT_QUOTES"),this.mWithOptions){var o=[{class:"edit",title:"Edit"},{class:"rename",title:"Rename"},{class:"delete",title:"Delete"}];(this.options.id_category>0||this.options.shared)&&o.splice(2,0,{class:"copy",title:"Copy to Project Elements"}),o.forEach(function(e){var n=document.createElement("i");n.className=e.class,n.title=e.title,n.innerHTML=e.title,t.appendChild(n)})}return this.mItemEl.appendChild(t),this.mItemEl.appendChild(n),this.mEl.appendChild(this.mItemEl),this.attachDragingComponent(),this.addOptionsEvents(this.mItemEl),this},isCategoryVisible:function(e){return""===e||this.getCategory()===e},toggleVisibilityByCategory:function(e){var t=this.isCategoryVisible(e);return t&&!this.mLoadedCover&&this.processCoverImageSetting(),this.mEl.style.display=t?"":"none",t},addOptionsEvents:function(e){this.mWithOptions&&(e.getElement("i.edit").addEvent("click",this.setActiveComponent.bind(this)),e.getElement("i.rename").addEvent("click",this.changeComponent.bind(this)),e.getElement("i.delete").addEvent("click",this.deleteComponent.bind(this)),(this.options.id_category>0||this.options.shared)&&e.getElement("i.copy").addEvent("click",this.copyComponentToProject.pass([!0],this)))},getDomElement:function(){return this.mEl},processCoverImageSetting:function(){this.options.shot&&this.loadCoverImage().then(function(e){this.mLoadedCover=e,this.setCoverImage(e)}.bind(this)).catch(function(){this.mLoadedCover=null,this.options.shot=!1}.bind(this))},loadCoverImage:function(){var e=this.mLoadedCover,t=this.options.mtime||+new Date,n=this.options.shot+"?"+t;return new Promise(function(t,o){var i;e&&e===n?t(n):(i=new Image,i.addEventListener("load",function(){t(n)}),i.addEventListener("error",function(){o()}),i.src=n)})},setCoverImage:function(e){this.mItemEl.style["background-image"]="url(%s)".sprintf(e)},attachDragingComponent:function(){"function"==typeof this.mDraggingReference&&this.dettachDragingComponent(),this.mDraggingReference=function(e){"I"!==e.target.tagName&&this.createDragElement(e)}.bind(this),this.mEl.addEvent("mousedown",this.mDraggingReference),this.mEl.style.cursor="move",this.mEl.style.cursor="-moz-grab",this.mEl.title=""},dettachDragingComponent:function(){this.mEl.removeEvent("mousedown",this.mDraggingReference),this.mEl.style.cursor="default"},createDragElement:function(e){var t=dpManager.dpComponentsList.getActiveComponentPageID();if(!1!==t&&dpManager.dpComponentsList.getComponent(t))return!1;var n="drag_shadow_component_"+this.options.id_page,o=null;if(o=$(n))o.setStyle("opacity",1);else{o=new MooTools.Element("div",{id:n,class:"ondrag"}).setStyles({"background-repeat":"no-repeat","background-position":"center",padding:0,margin:0,width:70,height:70,"z-index":64e3}),o.injectInside(document.body);var i;o.makeDraggable({precalculate:!0,droppables:[dpManager.dpWorkBench.getWorkBenchEl()],onStart:function(e){e.addClass("DragBoxDragged")},onComplete:function(e){e.set("tween",{duration:180}),e.tween("opacity",0)},onDrop:function(e,t){t&&this.loadComponent(e.getLeft(),e.getTop())}.bind(this),onCancel:function(e){e.setStyle("opacity",0),i?(clearTimeout(i),i=!1,this.setActiveComponent()):i=setTimeout(function(){e.setStyle("opacity",0);var t=dpManager.dpWorkBench.getCenterPosition();this.loadComponent(t.x,t.y),clearTimeout(i),i=!1}.bind(this),250)}.bind(this)})}o.setStyles({top:e.page.y-35,left:e.page.x-35,background:"transparent",width:"200px",height:"133px",border:"1px dashed grey","border-width":"1px 0 0 1px"}),o.fireEvent("mousedown",e)},loadComponent:function(e,t){var n=dpManager.dpWorkBench.getActivePage(),o=dpManager.dpComponentsList.getActiveComponentPageID();if(n&&!1!==o&&dpManager.dpComponentsList.getComponent(o))return!1;var i=n.addComponentElement(this.options.id_page,!0,e,t);return this.toogleUsingComponents(!0),i},setActiveComponent:function(){this.fireEvent("onSetActiveComponent",[this.options.id_page])},changeComponent:function(){var e='<input id="smart_share_all" type="checkbox" ';this.options.shared&&(e+=' checked="checked" '),e+='><label class="smart_share_label" for="smart_share_all">',e+="Share this element with all the other projects</label>",dpManager.dpPageInspector.showPrompt({text:"Enter Smart element name",headerText:"Edit name",submitText:"Save",value:this.options.name,checked:"components",injectHtml:e},function(e){var t=e,n=!1;if(document.getElement("#smart_share_all")&&document.getElement("#smart_share_all").checked&&(n=!0),null===t||""===t||!1===t)return!1;dpManager.dpPageInspector.updateComponentData(t,this.options.id_page,n),n?dpManager.dpSidebar.getWidget("components").viewComponentsCategory("shared"):dpManager.dpSidebar.getWidget("components").viewComponentsCategory("0"),this.fireEvent("onChangeComponentName",{id_page:this.options.id_page,name:t,shared:n})}.bind(this))},deleteComponent:function(){this.fireEvent("onDeletePage",[this.options.id_page,this.options.shared])},copyComponentToProject:function(t,n){var o=window.utils.getDeferred();n=n||this.options.id_page,_.isUndefined(t)&&(t=!1);var i="You've copied your UXPorn UI element to Project Smart Elements Library. <br/><br/>";i+="It means that all changes made to this element will be visible only in this project.";var s="Copying UXPorn Smart Element to Project Smart Elements Library ...<br/><br/><br/><br/>";return this.options.shared&&(i="You've copied your shared element to Project Smart Elements Library. <br/><br/>",i+="It means that all changes made to this element will be visible only in this project.",s="Copying Shared Element to Project Smart Elements Library ...<br/><br/><br/><br/>"),this.mCopiedActionRef=function(e){var t=e||this.mResRef;dpManager.dpPageInspector.addPage(t,!0),""!==dpManager.dpSidebar.getWidget("components").getViewedCategory()&&dpManager.dpSidebar.getWidget("components").viewComponentsCategory("0")}.bind(this),t&&(e.DSWindow.Alert(s,"Use element locally","OK, I get it",5,"crystal/32/actions/agt_update_critical.png",this.mCopiedActionRef),this.mCopyPromptClose=$("DSWCloseButton"),this.mCopyPromptClose.hide(),this.mCopyPromptContent=$("DSWConfirmWinContent").getElement(".DSWindowConfirmText")),dpManager.dejax.newRequest({url:"/ajax/dmsDPPage/CopyComponent/",eval:!1,data:{id_page:n,id_project:dpManager.dpProject.getIdProject()},onComplete:function(e){e&&!e.error||o.reject(e),t?(this.mResRef=e,this.mCopyPromptContent.set("html",i),this.mCopyPromptClose.show()):this.mCopiedActionRef(e),o.resolve(e)}.bind(this)}),o.promise},toogleUsingComponents:function(e){return e?this.mEl.addClass("Using"):this.mEl.removeClass("Using")},showOfflineWarning:function(){e.DSWindow.Alert("You are currently working offline.<br/><br/>Creating, editing and placing Smart Elements is not possible.","Offline","Close")}});e.DPComponentsList_Component=t}(window);
var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(e){"use strict";var t=new MooTools.Class({name:"DPComponentsList",Implements:[MooTools.Events],mActiveComponentPageID:!1,mCollaborators:[],mComponentsEditors:{},mPages:[],mEl:null,mComponents:{},mInfoEl:null,mWidget:null,mComponentsCovers:null,initialize:function(){this.mComponentsCovers=new e.DPComponentsCovers(this),dpManager.dpPageInspector.addEvent("onSelectPage",this.setActiveComponent.pass([!1],this))},get:function(e){return this.mComponents[e]},getAll:function(){return this.mComponents},getByCategoryId:function(e){var t=[];return _.each(this.getAll(),function(n){n.mCategory===e&&t.push(n)}),t},exists:function(e){return this.mComponents[e]&&"object"===_typeof(this.mComponents[e])},render:function(e){this.mWidget=dpManager.dpSidebar.getWidget("components"),this.mEl=new MooTools.Element("ul",{class:"Elements"}).inject(e),this.mWidget.mToolbarEl.getElement(".add-new").addEvent("click",function(e){var t=e.target.get("data-rel");if(e.stop(),"component"===t)this.addNewComponent(),dpManager.Analytics.analyticsEvent("app","components","create");else if("uxpattern"===t){dpManager.uxpPatterns.showLibrary();try{dpManager.Analytics.analyticsEvent("app","open uxpattern library","sidebar")}catch(e){}}}.bind(this))},createInfoEl:function(){if(this.mInfoEl)return!1;var e="Create Smart element and <strong>use it throughout the project and edit in one place.</strong>";e+=' Time saver!<br/>Click <em>"Add new"</em>, ',e+="or just select group of elements on your wireframe, right click on it and hit ",e+='<em>"Create Smart element"</em>.',this.mInfoEl=new MooTools.Element("p",{class:"smart-elements-info",html:e}).inject(this.mEl)},createPatternsInfoEl:function(){var t='<p class="icon-font-empty">'+(e.uxpft.enabled(e.FEATURE_UXPATTERNS)?"Your UX patterns library is empty!":"We're redesigning UX patterns library. We'll be back soon.")+"</p>";this.mPatternInfoEl=new MooTools.Element("div",{class:"pattern-elements-info align-center",html:t}).inject(this.mEl)},removeInfoEl:function(){this.mInfoEl&&(this.mInfoEl.destroy(),this.mInfoEl=null)},removePatternsInfoEl:function(){this.mPatternInfoEl&&(this.mPatternInfoEl.destroy(),this.mPatternInfoEl=null)},toogleUsingComponents:function(e,t){var n=this.mComponents[t];if(!n)return!1;n.toogleUsingComponents(e)},showOfflineWarning:function(){e.DSWindow.Alert("You are currently working offline.<br/><br/>Creating, editing and placing Smart Elements is not possible.","Offline","Close")},setActiveComponent:function(e){this.mActiveComponentPageID>0&&parseInt(this.mActiveComponentPageID)!==parseInt(e)&&this.fireEvent("onExitComponentEdit",[this.mActiveComponentPageID]),this.mActiveComponentPageID=e,e?(dpManager.dpPageInspector.setActivePage(e),new MooTools.Hash(this.mComponents).each(function(e){e.mEl.setProperty("title","").setStyle("cursor","pointer").removeEvents("mousedown")}),dpManager.dpPageInspector.mDPTreeView.deselectNode(),document.getElement(".btn.component-name")&&document.getElement(".btn.component-name").getElement("span span").set("text",this.mComponents[e]?this.mComponents[e].options.name:"")):new MooTools.Hash(this.mComponents).each(function(e){e.attachDragingComponent()}.bind(this))},getComponent:function(e){return!!this.mComponents[e]&&(this.mComponents[e]||!1)},getComponentOptions:function(e){var t=this.getComponent(e);return t&&t.options||!1},hasComponent:function(e){return this.mComponents[e]&&"object"===_typeof(this.mComponents[e])},addNewComponent:function(e,t,n,o){var a='<input id="smart_share_all" class="state-helper" type="checkbox">';a+='<label class="fake-choose-label fake-checkbox" for="smart_share_all">',a+="Share this element with all the other projects</label>";var r={text:"Enter Smart element name",headerText:"Add Smart Element",submitText:"Add",checked:"components",injectHtml:a};dpManager.dpPageInspector.showPrompt(r,function(e){var a=e,r=!1;if(document.getElement("#smart_share_all")&&document.getElement("#smart_share_all").checked&&(r=!0),"function"==typeof n)return void n({name:a,shared:r});!1===e&&this.removeEvents("onAddNewComponent"),null!==a&&""!==a&&!1!==a&&(dpManager.dpPageInspector.updateComponentData(a,_.noop,r,t,function(e){dpManager.emit("smart_element_created",e),dpManager.Analytics.kissEvent("App - Smart element - Created",{"App - Smart element - Created: Added to library":e.shared?"Account elements":"Project elements","App - Smart element - Created by":o||"Context menu"})}),r&&dpManager.dpSidebar.getWidget("components").viewComponentsCategory("shared"))}.bind(this))},createComponentFromSelection:function(e){var t=dpManager.dpWorkBench.getActivePage().getActiveElements();this.addNewComponent(_.noop,!0,_.noop,e),dpManager.Analytics.analyticsEvent("app","components","create from selection"),this.addEvent("onAddNewComponent",function(e){this.insertElements(e.id_page,t,function(){this.replaceSelectionWithComponent(e.id_page)}.bind(this)),this.removeEvents("onAddNewComponent")}.bind(this))},insertElements:function(t,n,o){var a={id_page:t,id_project:dpManager.dpProject.getIdProject(),changed_elements:{},deleted_elements:{}};n.forEach(function(t){var n=t;t instanceof e.DPElementGeneric&&(n=t.toHash());var o=n.id;e.DPElementGeneric.isAggregation(n.type)&&(n.stored_elements.forEach(function(e){a.changed_elements[e.id]=e}),delete n.stored_elements,delete n.deltas,delete n.id),a.changed_elements[o]=n}),new MooTools.Request({onComplete:"function"==typeof o?o:_.noop,evalScripts:!1,url:"/ajax/dmsDPPage/Save/",link:"chain",noCache:!0}).post({json:MooTools.JSON.encode(a)})},replaceSelectionWithComponent:function(e){var t=dpManager.dpWorkBench.getActivePage(),n=t.getActiveElements(),o=dpManager.dpWorkBench.getWorkBenchPosition(),a=1e5,r=1e5;n.each(function(e){a=Math.min(a,e.getProperty("left")),r=Math.min(r,e.getProperty("top"))}),t.deleteSelectedElements(),t.addComponentElement(e,!0,a+o.x,r+o.y)},getActiveComponentPageID:function(){return this.mActiveComponentPageID},getCategoryLongName:function(e){switch(e){case"":return"All";case"0":return"Project elements";case"shared":return"Account elements";default:return"UX Pattern Library"}},deleteComponent:function(t){var n,o=this.mComponents[t]||!1,a=this.mWidget.mCategoriesSelect.mValue||"";if(!1===o)return!1;if(n=dpManager.dpPageInspector.isUsedByOtherUser(t)){var r=n.match(/,/)?"are":"is";return void e.DSWindow.Alert(n+" "+r+" editing this component now, so you can't delete it","Cannot delete this component","OK",5,"crystal/32/actions/agt_update_critical.png")}var s="Deleting Smart Element may affect other pages.<br/><br/>Are you sure?";o.options.shared&&(s="Deleting Shared Smart Element may affect other projects.<br/><br/> Do you still want to proceed?"),DSWindow.CreateConfirm(s,"Confirm","Yes","No",this.processDeleteComponent.bind(this,t,a))},processDeleteComponent:function(e,t){var n=this.getCategoryLongName(t);return dpManager.Analytics.kissEvent("App - Smart element - Removed",{"App - Smart element - Removed: From library":n}),this.deletePageFromServer(e).then(function(e){return this.fireEvent("onDeletePage"),e}.bind(this))},deletePageFromServer:function(e){var t=window.utils.getDeferred();return dpManager.dejax.newRequest({url:"/ajax/dmsDPPage/DeletePage/",eval:!1,data:{id_page:e,id_project:dpManager.dpProject.getIdProject()},onComplete:function(n){n&&!n.error||t.reject(n),this.cometOnDeletePage({id_page:e}),dpManager.isCollaboration()&&socket.emit("deleteComponent",{id_page:e}),t.resolve(n)}.bind(this)}),t.promise},deleteComponentFromList:function(e){var t=_.clone(this.mComponents[e]);$(this.mComponents[e].mEl).destroy(),delete this.mComponents[e];var n=dpManager.dpWorkBench.getActivePage();if(n){var o=n.getComponents(e),a=[];o&&o.each(function(e){a.push(e.mId)}),a.each(function(e){n.deleteElement(e,!1,!1,!0,!0)}),dpManager.dpWorkBench.theSearch.removeIndexDocument("component",e),this.fireEvent("onDeleteFromList",[t.options])}},cometOnActivateComponent:function(e){},setCollaborator:function(e){var t=!0;new MooTools.Hash(this.mComponentsEditors).each(function(n,o){parseInt(o)!==parseInt(e.id_page)&&!1===n.contains(e.email)&&(n.push(e.email),t=!1);var a=n.indexOf(e.email);parseInt(o)!==parseInt(e.id_page)&&a>-1&&n.splice(a,1)}),t&&(this.mComponentsEditors[e.id_page]=[e.email])},cometOnDeletePage:function(e){this.mComponents[e.id_page]&&this.deleteComponentFromList(e.id_page)},cometOnUpdatePage:function(e){var t=this.mComponents[e.id_page];if(e.shared?this.mComponents[e.id_page].options.shared=1:this.mComponents[e.id_page].options.shared=0,t){if(!t.mEl.hasClass("category-shared")&&e.shared){t.mEl.setProperty("class",t.mEl.getProperty("class").replace(/(category-\d+)/,"category-shared")),t.mEl.hide();var n=new MooTools.Element("i",{class:"copy",title:"Copy to Project Elements",text:"Copy to Project Elements"});n.addEvent("click",this.mComponents[e.id_page].copyComponentToProject()),n.inject(t.mEl.getElement("em i.rename"),"after")}else t.mEl.hasClass("category-shared")&&!e.shared&&(t.mEl.setProperty("class",t.mEl.getProperty("class").replace(/(category-shared)/,"category-0")),t.mEl.getElement("em i.copy").dispose());if(t.name=e.name,t.mEl.getElement("a span").set("text",e.name),parseInt(dpManager.dpPageInspector.getActivePageID())===parseInt(e.id_page)){var o=document.getElement(".btn.component-name");o&&o.getElement("span span").set("text",e.name)}}},showComponentInComponentErrorMessage:function(){e.DSWindow.Alert("Smart element can't contain another smart element.","Cannot create smart element")},showComponentInCustomElementErrorMessage:function(){e.DSWindow.Alert("Custom element can't contain smart elements.","Cannot create custom element")},showClippedGroupInComponentErrorMessage:function(){e.DSWindow.Alert("Crop content doesnt allow to create smart element.","Cannot create smart element")},showComponentInGroupErrorMessage:function(){e.DSWindow.Alert("Create smart isn't available while edit group.","Cannot create smart element")},showComponentInMultistateGroupErrorMessage:function(){e.DSWindow.Alert("Multistate element can't contain smart elements.","Cannot create smart element")}});e.DPComponentsList=t}(window);
!function(t){"use strict";var e=function(t,e){this.list=t,this.listeners={},this.counter=0,this.componentCounters={},this.nothingToGenerateCounter=0,this.activeTimeout=!1,this.options=_.extend({attempts_limit:10,covers_per_request_limit:50,timeout:1e4},e||{}),this.list.addEvent("onInsertComponent",function(t){this.generateSingle(t.id_page,!0)}.bind(this))};e.prototype.getNotGenerated=function(t){var e=[];return Object.keys(this.list.mComponents).forEach(function(o){var n=this.list.get(o);!n.options.shot&&(void 0===t||e.length<t)&&e.push({id_page:o,id_account:n.options.id_account,is_component:"1",project_hash:dpManager.dpProject.getHash(),shared:n.options.shared?1:0,prevent_generate:this.componentCounters[o]>0})}.bind(this)),e},e.prototype.generateInvalid=function(){this.isActiveTimeout()||this.generate()},e.prototype.generate=function(){var t=this.getNotGenerated(this.options.covers_per_request_limit);t.length>0?(DPPage_Covers.bulkRequest(t).then(this.onRequestSent.bind(this)).catch(function(t){console.error(t)}),this.nothingToGenerateCounter=0):0===this.nothingToGenerateCounter&&(this.nothingToGenerateCounter++,this.setTimeout(this.generate.bind(this)))},e.prototype.invalidateSingle=function(t){var e=this.list.get(t);return e.setOptions({shot:!1}),this.componentCounters[t]=0,e},e.prototype.generateSingle=function(t,e){var o=this.invalidateSingle(t),n={id_page:t,id_account:o.options.id_account,is_component:"1",project_hash:dpManager.dpProject.getHash(),shared:o.options.shared?1:0,force_generate:e?1:0};DPPage_Covers.request(n).then(this.onRequestSent.bind(this)).catch(function(t){console.error(t)}),this.nothingToGenerateCounter=0},e.prototype.onRequestSent=function(t){MooTools.Array.isArray(t)||(t=[t]),this.onReturnData(t),this.setTimeout(this.generate.bind(this))},e.prototype.onReturnData=function(t){if(!MooTools.Array.isArray(t))return void console.error("Covers data is not an array");t.forEach(function(t){if(t&&t.id_page){var e=parseInt(t.id_page,10);t.shot&&(this.list.get(e).setOptions(t).processCoverImageSetting(),dpManager.emit("smart_element_updated",t)),void 0===this.componentCounters[e]&&(this.componentCounters[e]=0),this.componentCounters[e]++}}.bind(this))},e.prototype.setTimeout=function(t,e){this.activeTimeout>0&&(clearTimeout(this.activeTimeout),this.activeTimeout=null),this.activeTimeout=setTimeout(t,e||this.options.timeout)},e.prototype.isActiveTimeout=function(){return this.activeTimeout>0},e.prototype.onGenerateCover=function(t,e){t=parseInt(t,10),MooTools.Array.isArray(this.listeners[t])||(this.listeners[t]=[]),this.listeners[t].push(e)},t.DPComponentsCovers=e}(window);
var DPPage_Guide_ElementSnap=new MooTools.Class({name:"DPPage_Guide_ElementSnap",mEl:null,initialize:function(e){this.mEl=e},snap:function(){this.generateList().each(function(e){e&&this.mEl.mEl.setStyles(e.styles)}.bind(this))},generateList:function(){var e,t;return dpManager.dpWorkBench.getActivePage().getGuides().each(function(i){var o;i.isVisible()&&(o=this.calculatePosition(i))&&(DPPage_Guide.TYPE_HORIZONTAL===i.getType()?(!e||e&&e.distance>o.distance)&&(e=o):(!t||t&&t.distance>o.distance)&&(t=o))}.bind(this)),[e,t]},calculatePosition:function(e){var t,i=null,o={};return o[DPPage_Guide.TYPE_HORIZONTAL]={property:"top",check:[{edge:"upperRight",position:"bottomRight",offset:{y:-1}},{edge:"bottomRight",position:"upperRight",offset:{y:0}}]},o[DPPage_Guide.TYPE_VERTICAL]={property:"left",check:[{edge:"upperRight",position:"upperLeft",offset:{x:0}},{edge:"upperLeft",position:"upperRight",offset:{x:-1}}]},t=o[e.getType()],t.check.breakEach(function(o){var n,s,r=0,p=this.mEl.mEl.position(MooTools.$extend({relativeTo:e.getLine(),returnPos:!0},o));return this.mEl.isRotated()?(s=this.mEl.rotator.cache.bounds[t.property],"left"===t.property?(r=this.mEl.rotator.cache.bounds.width-this.mEl.getProperty("width"),"upperLeft"===o.edge?r=r/2+1:(s+=r,r=-r/2)):(r=this.mEl.rotator.cache.bounds.height-this.mEl.getProperty("height"),"upperRight"===o.edge?r/=2:(s+=r,r=-r/2))):s=this.mEl.mEl.getStyle(t.property).toIntZero(),!((n=(s-p[t.property]).abs())<=DPPage_Guide_ElementSnap.PRECISION)||(i={distance:n,styles:{}},i.styles[t.property]=p[t.property]+r,!1)}.bind(this)),i}});DPPage_Guide_ElementSnap.PRECISION=10;
var DPPage_Guide_ElementResize=new MooTools.Class({name:"DPPage_Guide_ElementResize",mEl:null,initialize:function(t){this.mEl=t},snap:function(t){var e=["right","bottom","left","top"],i=dpManager.dpWorkBench.getActivePage().getGuides(),n="snap%sBorder".sprintf(function(t){return t.substr(0,1).toUpperCase()+t.substr(1)}(t));e.contains(t)&&i&&(i=i.filter(function(e){return!!e.isVisible&&((!["top","bottom"].contains(t)||DPPage_Guide.TYPE_VERTICAL!=e.getType())&&(!["left","right"].contains(t)||DPPage_Guide.TYPE_HORIZONTAL!=e.getType()))}),this[n](i))},snapRightBorder:function(t){var e,i,n=this.mEl.getStyle("left").toIntZero()+this.mEl.getStyle("width").toIntZero();t.each(function(t){var i=(t.getPosition().left-n-1).abs();i>DPPage_Guide_ElementSnap.PRECISION||(!e||e&&e.distance>i)&&(e={distance:i,guide:t})}),e&&(i=e.guide.getPosition().left-n-1,this.mEl.setStyle("width",this.mEl.getStyle("width").toIntZero()+i))},snapLeftBorder:function(t){var e,i,n=this.mEl.getStyle("left").toIntZero();t.each(function(t){var i=(t.getPosition().left-n-1).abs();i>DPPage_Guide_ElementSnap.PRECISION||(!e||e&&e.distance>i)&&(e={distance:i,guide:t})}),e&&(i=e.guide.getPosition().left-n-1,this.mEl.setStyle("left",n+i),this.mEl.setStyle("width",this.mEl.getStyle("width").toIntZero()-i))},snapTopBorder:function(t){var e,i,n=this.mEl.getStyle("top").toIntZero();t.each(function(t){var i=(t.getPosition().top-n-1).abs();i>DPPage_Guide_ElementSnap.PRECISION||(!e||e&&e.distance>i)&&(e={distance:i,guide:t})}),e&&(i=e.guide.getPosition().top-n-1,this.mEl.setStyle("top",n+i),this.mEl.setStyle("height",this.mEl.getStyle("height").toIntZero()-i))},snapBottomBorder:function(t){var e,i,n=this.mEl.getStyle("top").toIntZero()+this.mEl.getStyle("height").toIntZero();t.each(function(t){var i=(t.getPosition().top-n-1).abs();i>DPPage_Guide_ElementSnap.PRECISION||(!e||e&&e.distance>i)&&(e={distance:i,guide:t})}),e&&(i=e.guide.getPosition().top-n-1,this.mEl.setStyle("height",this.mEl.getStyle("height").toIntZero()+i))}});
var DPPage_Guide=new MooTools.Class({name:"DPPage_Guide",Implements:[MooTools.Events],mType:null,mRuler:null,mGuide:null,mDrags:[],mResizeCallback:null,mCreated:!1,mDimensionsEl:null,mDimensionsTimer:null,initialize:function(e,t){this.mType=e,this.mRuler=t||this.selectRuler()},selectRuler:function(){return DPPage_Guide.TYPE_HORIZONTAL==this.getType()?dpManager.dpWorkBench.getHorizontalRuler():dpManager.dpWorkBench.getVerticalRuler()},attach:function(e){var t=this.getPositionFromEvent(e);this.createGuide(t,e),dpManager.dpWorkBench.getActivePage().addGuide(this)},createGuide:function(e,t,i){var s=e,n="guide %s".sprintf(this.mType);i=void 0===i||i,this.mGuide=new MooTools.Element("div",{class:n}).microjungle([["div",{class:"line"}]]),setTimeout(function(){this.mGuide.inject(dpManager.dpWorkBench.getWorkBenchEl())}.bind(this)),s.x=s.left&&!s.x?s.left:s.x,s.y=s.top&&!s.y?s.top:s.y,this.mppSetStyles(s),t?i&&this.makeDraggable(this.mGuide):setTimeout(function(){this.mppSetStyles(s),i&&this.makeDraggable(this.mGuide)}.bind(this)),t&&this.mGuide.fireEvent("mousedown",t),this.mResizeCallback=this.refresh.bind(this),window.addEvent("resize",this.mResizeCallback),dpManager.addListener("guides_update",this.mResizeCallback)},mppSetStyles:function(e){var t=document.getElementById("free-canvas");if(t){var i=t.offsetHeight,s=t.offsetWidth;if(!e){var e={};e.x=this.mGuide.style.left,e.y=this.mGuide.style.top}this.mType===DPPage_Guide.TYPE_HORIZONTAL?(this.mGuide.style.left=-(s/2-dpManager.dpWorkBench.getWorkBenchEl().offsetWidth/2)+"px",this.mGuide.style.width=s+"px",this.mGuide.style.top=e.y+"px",this.getLine().style.width=s+"px"):(this.mGuide.style.top=-(i/2-dpManager.dpWorkBench.getWorkBenchEl().offsetHeight/2)+"px",this.mGuide.style.height=i+"px",this.mGuide.style.left=e.x+"px",this.getLine().style.height=i+"px")}},makeDraggable:function(e){var t=dpManager.dpWorkBench.getWorkBenchElMain(),i=this.getLimits(),s=e.makeDraggable({droppables:this.mRuler.getParent(),snap:0,limit:{x:[i.x,t.getScrollWidth()],y:[i.y,t.getScrollHeight()]},modifiers:{x:this.mType===DPPage_Guide.TYPE_HORIZONTAL?null:"left",y:this.mType===DPPage_Guide.TYPE_VERTICAL?null:"top"},onDrag:function(e,t){document.body.setStyle("cursor",e.getStyle("cursor")),this.showDimensionsEl(t)}.bind(this),onDrop:function(e){if(document.body.setStyle("cursor",""),DPPage_Guide.TYPE_HORIZONTAL===this.mType){if(e.getPosition().y<=this.mRuler.getPosition().y+this.mRuler.getHeight())return void this.remove()}else if(e.getPosition().x<=this.mRuler.getPosition().x+this.mRuler.getWidth())return void this.remove();this.mCreated||dpManager.Analytics.analyticsEvent("app","guides","added"),this.mCreated=!0,this.fireEvent("update")}.bind(this),onCancel:function(){document.body.setStyle("cursor",""),this.mCreated||this.remove.bind(this)}.bind(this)});this.mDrags.push(s)},getPositionFromEvent:function(e){var t=e.client;return t.x+=dpManager.dpWorkBench.getWorkbenchScrollPane().scrollLeft-dpManager.dpWorkBench.getWorkBenchElMain().offsetLeft-dpManager.dpWorkBench.getWorkBenchEl().offsetLeft,t.y+=dpManager.dpWorkBench.getWorkbenchScrollPane().scrollTop-dpManager.dpWorkBench.getWorkBenchElMain().offsetTop-dpManager.dpWorkBench.getWorkBenchEl().offsetTop,t},getPosition:function(){var e,t,i=this.getLine().getPosition(dpManager.dpWorkBench.getWorkBenchElMain());return t=document.getElementById("canvas"),e={x:i.x-t.offsetLeft,y:i.y-t.offsetTop},DPPage_Guide.TYPE_HORIZONTAL===this.getType()?{top:e.y,left:0}:{left:e.x,top:0}},remove:function(){this.destroy(),dpManager.dpWorkBench.getActivePage().removeGuide(this),dpManager.Analytics.analyticsEvent("app","guides","removed")},destroy:function(){window.removeEvent("resize",this.mResizeCallback),this.mGuide.destroy(),this.mDimensionsEl&&this.mDimensionsEl.destroy(),this.mDimensionsEl=null,this.mResizeCallback=null,this.mDrags=null},refresh:function(){var e=dpManager.dpWorkBench.getWorkBenchElMain(),t=this.getLimits();this.mDrags&&(this.mDrags.each(function(i){i.setOptions({limit:{x:[t.x,e.getScrollWidth()],y:[t.y,e.getScrollHeight()]}})}),this.mppSetStyles())},getType:function(){return this.mType},getLine:function(){return this.mGuide.getElement(".line")},isVisible:function(){var e=dpManager.dpWorkBench.getWorkBenchElMain(),t=this.getLine().getPosition(e);return!(DPPage_Guide.TYPE_HORIZONTAL===this.getType()&&t.y<e.getScrollTop())&&!(DPPage_Guide.TYPE_VERTICAL===this.getType()&&t.x<e.getScrollLeft())},showDimensionsEl:function(e){MooTools.$clear(this.mDimensionsTimer);var t=this.getPosition();this.mDimensionsEl?this.mDimensionsEl.fade("show"):this.mDimensionsEl=new MooTools.Element("div",{class:"ruler-size",tween:{duration:130}}).inject(document.body),this.getType()==DPPage_Guide.TYPE_HORIZONTAL?(this.mDimensionsEl.set("text",t.top>=0?t.top:0),this.mDimensionsEl.setStyles({left:e.client.x-this.mDimensionsEl.getWidth()/2,top:e.client.y+20})):(this.mDimensionsEl.set("text",t.left>=0?t.left:0),this.mDimensionsEl.setStyles({left:e.client.x-this.mDimensionsEl.getWidth()-20,top:e.client.y-this.mDimensionsEl.getHeight()/2})),this.mDimensionsTimer=this.mDimensionsEl.fade.delay(500,this.mDimensionsEl,["out"])},getLimits:function(){return{x:-dpManager.dpWorkBench.getWorkBenchEl().offsetLeft,y:-dpManager.dpWorkBench.getWorkBenchEl().offsetTop}}});DPPage_Guide.TYPE_HORIZONTAL="horizontal",DPPage_Guide.TYPE_VERTICAL="vertical";
var DPPage_ComponentsList=new MooTools.Class({name:"DPPage_ComponentsList",mList:null,initialize:function(){this.mList=new MooTools.Hash},add:function(t,e){var n=this.get(t);n.contains(e)||n.push(e),this.mList.set(t,n)},remove:function(t,e){var n,i;if(!e)return void this.mList.erase(t);n=this.get(t),i=this.get(t,e),n.erase(i),this.mList.set(t,n)},getLast:function(t){var e=this.mList.get(t);return e?e.getLast():null},getInstance:function(t,e){var n=this.mList.get(t),i=n.filter(function(t){return t.getId()==e});return i.length>0?i[0]:null},getAll:function(){return this.mList.getValues().flatten()},has:function(t){return!!this.mList.has(t)&&this.mList.get(t).length>0},get:function(t,e){var n=this.mList.get(t)||[];return e?n.filter(function(t){return t.getId()==e}).pop():n},findComponentsElements:function(t,e){var n=[],i=e||"getId";return this.getAll().forEach(function(e){var s=e.getElements().filter(function(e){return"function"==typeof e[i]&&e[i]()==t});n.extend(s)}),n},removeComponentsElement:function(t,e){this.get(t).each(function(t){t.removeElement(e)})}});
var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(e){"use strict";var t=new MooTools.Class({name:"DPPage_ElementsIndex",Implements:[MooTools.Events],mBaseZindex:10001,mIndex:[],fireChange:function(e,t){var n={add_to_history:!0,group_undo:null};t&&"number"==typeof t&&(t={group_undo:t}),t&&"object"==(void 0===t?"undefined":_typeof(t))&&(n=_.extend(n,t)),this.fireEvent("change",[e,n.add_to_history,n.group_undo])},getIndex:function(e){return e?_.clone(this.mIndex):this.mIndex},getLength:function(){return this.mIndex.length},getMax:function(){return this.mBaseZindex+this.getLength()},createIndex:function(e){this.mIndex=e?Object.keys(e).map(t.parseInt):[],this.mIndex=this.mIndex.filter(function(t){return!DPElementGeneric.isAggregation(e[t].type)||void 0!==e[t].props["z-index"]}),this.mIndex.sort(function(t,n){return e[t].props["z-index"]||(e[t].props["z-index"]=1e4),e[n].props["z-index"]||(e[n].props["z-index"]=1e4),e[t].props["z-index"]-e[n].props["z-index"]})},recreateIndex:function(){var e={};dpManager.dpWorkBench.getActivePage().getElements().each(function(t){e[t.getId()]=t.toHash()}),this.createIndex(e)},findNearestInIndex:function(e,n,i){for(var o=this.getPosition(e),r=n>0?1:-1,s=!!MooTools.Array.isArray(i)&&i.map(t.parseInt),d=o+r,a=this.mIndex.length;d<a&&d>=0;d+=r)if(!1===s||s.indexOf(this.mIndex[d])>-1)return this.mIndex[d];return 0},findHighestInIndex:function(e){var t,n=0;return e.forEach(function(e){var i=this.getPosition(e);i>-1&&i>n&&(n=i,t=e)}.bind(this)),t},findLowestInIndex:function(e){var t,n=this.getMax();return e.forEach(function(e){var i=this.getPosition(e);i>-1&&i<n&&(n=i,t=e)}.bind(this)),t},findElementOfZindex:function(e){var t=e-this.mBaseZindex;return t>=0&&this.mIndex[t]},getPosition:function(e){return this.mIndex.indexOf(t.parseInt(e))},add:function(e,n){var i=t.parseInt(e),o=void 0===n||n,r={};return this.mIndex.push(i),r[i]=this.generateZindex(i),o&&this.fireChange(r),r[i]},addRelativeTo:function(e,t,n,i){var o=this.getPosition(t),r=n>0?1:0;this.mIndex.splice(o+r,0,parseInt(e,10));var s=this.generateZindex();return(void 0===i||i)&&this.fireChange(s),s},remove:function(e,t){(MooTools.Array.isArray(e)?e:[e]).forEach(function(e){var t=this.getPosition(e);t>-1&&this.mIndex.splice(t,1)}.bind(this)),this.fireChange(this.generateZindex(),t)},removeChangeDryRun:function(e){var n=MooTools.Array.isArray(e)?e:[t.parseInt(e)],i=this.mIndex.slice(this.getLength()-n.length);return!1===n.some(function(e){return-1===i.indexOf(t.parseInt(e))})},moveElements:function(e,t,n,i){var o=n>0?1:0;this.standardizeList(e,-1*n).forEach(function(e){var n=this.getPosition(e);n!==this.getPosition(t)&&(this.mIndex.splice(n,1),this.mIndex.splice(this.getPosition(t)+o,0,e))}.bind(this));var r=this.generateZindex();return(void 0===i||i)&&this.fireChange(r),MooTools.Array.isArray(e)?r:this.generateZindex(e)},moveToTop:function(e){var t=this.standardizeList(e,1),n=this.mIndex.length;t.forEach(function(e){var t=this.getPosition(e);t+1!==n&&(this.mIndex.splice(t,1),this.mIndex.push(e))}.bind(this)),this.fireChange(this.generateZindex())},moveToBottom:function(e){this.standardizeList(e,-1).forEach(function(e){var t=this.getPosition(e);0!==t&&(this.mIndex.splice(t,1),this.mIndex.unshift(e))}.bind(this)),this.fireChange(this.generateZindex())},generateZindex:function(e,n,i){if(e>0){var o=this.mIndex.indexOf(t.parseInt(e));return-1==o&&n?this.add(e,!1):this.mBaseZindex+o}var r,s=this.mBaseZindex,d={};return r=i?function(e,t){var n=dpManager.dpWorkBench.getActivePage().getElementById(e),i=s+t;n.getProperty("z-index")!=i&&(d[e+""]=i)}:function(e,t){d[e+""]=s+t},this.mIndex.forEach(r),d},isOnTop:function(e){return t.parseInt(e)===this.mIndex[this.getLength()-1]},isOnBottom:function(e){return t.parseInt(e)===this.mIndex[0]},standardizeList:function(e,n){var i=!MooTools.Array.isArray(e)&&e>0?[e]:e;return this.sortElementsByPosition(i.map(t.parseInt).filter(function(e,t,n){return this.getPosition(e)>-1&&n.indexOf(e)===t}.bind(this)),n)},sortElementsByPosition:function(e,t){if(!MooTools.Array.isArray(e))throw"Provided argument is not an Array.";var n=function(e,n){var i=t>0?e:n,o=t>0?n:e;return this.getPosition(i)-this.getPosition(o)}.bind(this);return e.sort(n)}});t.parseInt=function(e){return parseInt(e,10)},t.sortByPositionAsc=function(e,t){"object"==(void 0===e?"undefined":_typeof(e))&&"object"==(void 0===t?"undefined":_typeof(t))&&(e=e.getId(),t=t.getId());var n=dpManager.dpWorkBench.getActivePage().mElementsIndex;return n.getPosition(e)-n.getPosition(t)},t.sortByPositionDesc=function(e,t){"object"==(void 0===e?"undefined":_typeof(e))&&"object"==(void 0===t?"undefined":_typeof(t))&&(e=e.getId(),t=t.getId());var n=dpManager.dpWorkBench.getActivePage().mElementsIndex;return n.getPosition(t)-n.getPosition(e)},e.DPPage_ElementsIndex=t}(window);
!function(n){"use strict";var o=new MooTools.Class({name:"DPPage_ElementsPolygonsSet",mPolygons:[],mParsedPolygon:[],addElement:function(n){this.addPolygon(new DPPage_ElementsPolygon(n))},addPolygon:function(n){this.mPolygons.push(n)},intersectsWith:function(n){return n instanceof DPPage_ElementsPolygon&&this.mPolygons.some(function(o){return o.intersects(n)})}});n.DPPage_ElementsPolygonsSet=o}(window);
!function(t){"use strict";var e=new MooTools.Class({name:"DPPage_ElementsPolygon",mVertices:[],mEdges:[],initialize:function(t){t&&this.createFromElement(t)},setVertices:function(t){this.mVertices=t},getVertices:function(){return this.mVertices},getSetEdges:function(){if(this.mEdges.length!=this.mVertices.length){this.mEdges=[];for(var t=0,e=this.mVertices.length,n=e-1;t<e;n=t++)this.mEdges.push([this.mVertices[n],this.mVertices[t]])}return this.mEdges},createFromElement:function(t){var n=[],s=parseInt(t.getProperty("top"),10),i=parseInt(t.getProperty("left"),10),r=parseInt(t.getProperty("width"),10),o=parseInt(t.getProperty("height"),10),u=parseInt(t.getProperty("angle"),10)||0;n.push([i,s]),n.push([i+r,s]),n.push([i+r,s+o]),n.push([i,s+o]),0!==u&&(n=n.map(function(t){return e.rotateElementPoint(t,u,r,o,i,s)}.bind(this))),this.setVertices(n)},intersects:function(t){return[function(){return t.getVertices().some(function(t){return this.pointInPolygon(t[0],t[1])}.bind(this))}.bind(this),function(){return this.getVertices().some(function(e){return t.pointInPolygon(e[0],e[1])}.bind(this))}.bind(this),function(){return t.getSetEdges().some(function(t){return this.getSetEdges().some(function(e){return this.linesIntersect(e[0],e[1],t[0],t[1])}.bind(this))}.bind(this))}.bind(this)].some(function(t){return t.call(this)}.bind(this))},pointInPolygon:function(t,e){for(var n=this.getVertices().map(function(t){return t[0]}),s=this.getVertices().map(function(t){return t[1]}),i=this.getVertices().length,r=i-1,o=!1,u=0;u<i;r=u++)s[u]>e!=s[r]>e&&t<(n[r]-n[u])*(e-s[u])/(s[r]-s[u])+n[u]&&(o=!o);return o},linesIntersect:function(t,e,n,s){var i=this.substractPoints(e,t),r=this.substractPoints(s,n),o=this.crossProduct(this.substractPoints(n,t),i),u=this.crossProduct(i,r);if(0===o&&0===u)return n[0]-t[0]<0!=n[0]-e[0]<0!=s[0]-t[0]<0!=s[0]-e[0]<0||n[1]-t[1]<0!=n[1]-e[1]<0!=s[1]-t[1]<0!=s[1]-e[1]<0;if(0===u)return!1;var c=o/u,h=this.crossProduct(this.substractPoints(n,t),r)/u;return h>=0&&h<=1&&c>=0&&c<=1},substractPoints:function(t,e){return[t[0]-e[0],t[1]-e[1]]},crossProduct:function(t,e){return t[0]*e[1]-t[1]*e[0]}});e.rotatePoint=function(t,e){var n=e*Math.PI/180,s=Math.cos(n),i=Math.sin(n);return[t[0]*s-t[1]*i,t[0]*i+t[1]*s]},e.rotateElementPoint=function(t,n,s,i,r,o){var u=[r+s/2,o+i/2],c=[t[0]-u[0],u[1]-t[1]],h=e.rotatePoint(c,n);return[h[0]+u[0],u[1]-h[1]]},t.DPPage_ElementsPolygon=e}(window);
var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_CanvasPosition=function(){function e(e,t,n){return e<t?t:e>n?n:e}function t(t,n){var o=document.getElementById("canvas"),i=o.offsetWidth-n.mPropsValues.width,s=o.offsetHeight-n.mPropsValues.height;return{x:e(t.x,0,i),y:e(t.y,0,s)}}function n(e){var n=document.getElementById("canvas"),o=document.getElementById("workbench");o.offsetWidth,o.offsetHeight,e.mPropsValues.width,e.mPropsValues.height,o.scrollLeft,n.offsetLeft,o.scrollTop,n.offsetTop;return t({x:Math.round(0),y:Math.round(0)},e)}return{mppCanvasCoordinatesForClickedElement:n}}(),DPPage=new MooTools.Class({name:"DPPage",Implements:[MooTools.Events,MooTools.Chain],mElementsIndex:null,mElements:new MooTools.Hash,mDeletedElements:new MooTools.Hash,mLatelyDeletedElements:new MooTools.Hash,mComponents:null,mComponentsUsed:null,mZIndexes:[],mActiveElements:[],mSaveIndex:0,mIndex:0,mCollectedData:new MooTools.Hash,mStartZIndex:1e4,mGuides:[],mGroupedElements:{},mLoadingElements:!1,mDPVirtualEl:null,mGroupInEditMode:!1,mElementPickerMode:!1,mSaveLocallyOnFail:!0,_fallbackChangesStore:{},initialize:function(){this.mZIndexes=[],this.mIndex=0,this.mWorkbenchEl=dpManager.dpWorkBench.getWorkBenchEl(),this.mWorkbenchElMain=dpManager.dpWorkBench.getWorkBenchElMain(),this.mElementsIndex=new DPPage_ElementsIndex,this.mElements=new MooTools.Hash,this.mDeletedElements=new MooTools.Hash,this.mComponents=new DPPage_ComponentsList,this.mComponentsUsed=new MooTools.Hash,this.mCollectedData=new MooTools.Hash,this.mStrangeEvent=this.applyResize.bindWithEvent(this),document.addEvent("mouseup",this.mStrangeEvent),this.mElementsIndex.addEvent("change",this.orderChange.bind(this))},applyResize:function(e){this.getActiveElement()&&(this.getActiveElement().detachResize(),this.getActiveElement().handleLocking())},orderChange:function(e,t,n){var o=void 0===t||t,i={},s=this.getActiveElements().filter(function(e){return e.mEl});Object.keys(e).forEach(function(t){var n=this.getElementById(t);n&&n.getProperty("z-index")!=e[t]&&(i[t]={"z-index":e[t]})}.bind(this)),0!==Object.keys(i).length&&(this.saveBulk(i,o,s,n),Object.keys(i).each(function(e){this.getElementById(e).setProperty("z-index",i[e]["z-index"],null,!1)}.bind(this)))},loadElements:function(e,t,n){if(!e)return!1;var o=function(e,n){t>0&&"Component"==e.type||(DPElementGeneric.isAggregation(e.type)&&"1"!=e.props.ungroup&&MooTools.Array.isArray(e.props.stored_elements)&&e.props.stored_elements.forEach(function(t){this.mGroupedElements[t]=e.id}.bind(this)),this.createElement(e.type,e.props,n,!0,t))}.bind(this),i=void 0===n||n;this.mLoadingElements=!0;var s=new MooTools.Hash(e);s.each(function(e,t){DPElementGeneric.isAggregation(e.type)&&o(e,t)}.bind(this)),s.each(function(e,t){DPElementGeneric.isAggregation(e.type)||o(e,t)}),t&&this.countComponentRelativePosition(t),i&&this.fireEvent("onLoad")},isLoading:function(){return this.mLoadingElements},countComponentRelativePosition:function(e){var t=this.mComponents.get(e);if(!t.length)return void console.error("No components element: "+e);t.each(function(e){var t,n=1e5,o=1e5,i=0,s=0;return t=e.getElements(),!!t.length&&(t.each(function(e){var t={width:e.getProperty("width"),height:e.getProperty("height"),left:e.getProperty("left"),top:e.getProperty("top")};e.isRotated()&&(t=e.rotator.calculateRelativeToWorkbenchRotatedBounds(t.left,t.top,t.width,t.height,e.getProperty("angle")));var a=+t.width+t.left,r=+t.height+t.top;n=Math.min(t.left,n),o=Math.min(t.top,o),i=Math.max(a,i),s=Math.max(r,s)},this),t.each(function(e){var t=e.getProperty("left")-n,i=e.getProperty("top")-o;e.mEl.setStyles({top:i+"px",left:t+"px"})}),e.setProperty("width",+i-n),e.setProperty("height",+s-o),!0)})},mVirtualElementType:"Virtual",isVirtualElementType:function(e){return this.mVirtualElementType===e},createElement:function(e,t,n,o,i,s,a,r,l,d,c,m){function h(){return e&&r&&!M.getProperty("left")&&!M.getProperty("top")}function p(){return e&&l&&d}if(UXPStack.add("DPPage.createElement",[e,t,n,o,i,s,a,r,l,d,c,m]),t&&0!==new MooTools.Hash(t).getLength()||(this.isVirtualElementType(e.mType)||"Image"==e||UXPStack.error("Creating element without props",[e,t]),t={}),dpManager.eventsStatus&&!dpManager.eventsStatus.elements_count&&this.getElements().getLength()>=9&&(_kmq.push(["record","App - Elements - Added 10 elements to Canvas"]),window.dataLayer&&dataLayer.push({event:"appuse_added_10_elements"}),dpManager.dejax.newRequest({url:"/ajax/dmsAccountEvents/ElementCountReached/"}),dpManager.eventsStatus.elements_count=!0),DPElementGeneric.isAggregation(e)&&1==t.ungroup)return!1;var u=e,g=!1;if(a?g=!0:e=!1,"Component"==u&&t.id_component&&!t.stored_elements){var f=this.mComponents.getLast(t.id_component);f&&(t.stored_elements=f.toHash().props.stored_elements)}var v=this.mWorkbenchElMain;v&&l&&d&&(t.pX=Math.round(l),t.pY=Math.round(d));var E=n||this.generateUniqueId();if(s&&!i)if(DPElementGeneric.isAggregation(u)&&t.stored_elements){var y=t.stored_elements.slice();t.states&&_.forEach(t.states,function(e){y.combine(e.elements.slice())}),t.stored_elements.forEach(function(e){var t=this.getElementById(e);t&&DPElementGeneric.isAggregation(t.getType())&&y.push.apply(y,t.getProperty("stored_elements"))}.bind(this)),t["z-index"]=this.mElementsIndex.addRelativeTo(E,this.mElementsIndex.findHighestInIndex(y),1,!1)[E],this.mElementsIndex.moveElements(y,E,-1)}else if(t["z-index-force"]>0){var P=this.mElementsIndex.findElementOfZindex(t["z-index-force"]);delete t["z-index-force"],t["z-index"]=P?this.mElementsIndex.addRelativeTo(E,P,-1,!0)[E]:this.mElementsIndex.add(E,!1)}else t["z-index"]=this.mElementsIndex.add(E,!1);else t["z-index"]&&!i&&(t["z-index"]=this.mElementsIndex.generateZindex(E));var M=new window["DPElement"+u](E,t,o,i,!1,g,c);if("MultistatePredefined"===u||"UserElement"===u)return!1;DPElementGeneric.isAggregation(u)&&M.addEvent("onRender",function(){this.fireEvent("groupRendered")}.bind(this)),this.mDeletedElements.erase(E);M.getDropOffset();if(function(){var e;(h()||p())&&(e=h()?_CanvasPosition.mppCanvasCoordinatesForClickedElement(M):{x:l,y:d},M.setProperty("left",e.x),M.setProperty("top",e.y))}(),(h()||p())&&(s=!0),M.mIndexEnabled=!0,this.mLoadingElements||dpManager.uxpElementIndex.insert(M),i>0){var I=this.mComponents.get(i);if(!I.length)return console.error("No component element: "+i),!1;M.setIdComponent(i);I.each(function(e){var t=M.clone();e.hasElement(t.getId())||(t.mEl.injectInside(e.mInEl),e.addElement(t),t.getProperty("fixed")&&e.setProperty("fixed",!0),DPElementGeneric.isAggregation(t.getType())&&function(){if(t.getProperty("stored_elements").each(function(e){var n=dpManager.dpWorkBench.getActivePage().getElementById(e,{from_components:!0,as_array:!0});n.length>0&&t.mGroupedElements.push(n[0])}),t.fireEvent("elementsAttached",{opacity:e.getProperty("opacity")}),DPElementGeneric.isMultistate(t.getType())){for(var n=t.getProperty("states"),o=n.length-1;o>=0;o--)if(n.hasOwnProperty(o)&&"default"!=n[o].type)for(var i in n[o].elements)n[o].elements.hasOwnProperty(i)&&e.hasElement(n[o].elements[i])&&t.hideStateElementOnEditor(e.getElement(n[o].elements[i]));t.hideNonDefaultStates()}}.delay(250))})}else M.mEl.injectInside(this.mWorkbenchEl),this.isVirtualElementType(M.mType)||this.mElements.set(E,M),"Component"==u&&this.mComponents.add(t.id_component,M),M.fireEvent("ready"),M.afterInsert&&M.afterInsert(g,c,t);return!0===s&&new MooTools.Hash(M.getProperties()).each(function(e,t){this.save(E,t,e)}.bind(this)),!0===o&&!g||!0===m||this.addCreateElement2History({element:M,id:E,group_index:dpManager.dpClipboard.isLastProcessing()?dpManager.dpClipboard.getLength()-1:0}),dpManager.emit("element_added",M),M},addCreateElement2History:function(e){var t=e.element.toHash(),n=e.id?e.id:this.generateUniqueId();dpManager.dpHistory.add({undo:function(e){var t,n=dpManager.dpWorkBench.getActivePage().getGroupInEditMode();n&&(t=dpManager.dpWorkBench.getActivePage().getElementById(n),t.closeGroupEdit(),DPElementTransformator.deselectElements(null,!0)),this.deleteElement(this.getElementById(e),!0,!1,!0,null,null,!0),this.mElementsIndex.remove(e,1)}.pass(n,this),redo:function(e,t){var n=copyObject(e.props);e.stored_elements&&(n.stored_elements=this.recreateGroupElements(e)),this.createElement(e.type,n,t,!1,!1,!0,!1,!1,0,0,!0)}.pass([t,n],this),group_undo:e.group_index})},getComponents:function(e){return this.mComponents.get(e)},getElementById:function(e,t){var n,o=t&&!0===t.as_array?[]:null;return t=t||{},!0===t.from_components?(n=this.mComponents.findComponentsElements(e),n.length?n:o):(n=this.mElements.get(e),n?!0===t.as_array?[n]:n:o)},getElements:function(){return this.mElements},getTotalElementsCount:function(){var e=_.size(this.getElements());return _.each(this.mComponents.mList,function(t){t.forEach(function(t){e+=_.size(t.mElements)})}.bind(this)),e},isElementInGroup:function(e){return this.mGroupedElements[e]||null},countElementsWithName:function(e,t){var n="object"==(void 0===e?"undefined":_typeof(e))?e:new RegExp(e),o=0,i=0;return this.getElements().each(function(e){if(n.test(e.getProperty("name"))){if(t){var s=/.*\sCopy\s\((\d+)\)$/i.exec(e.getProperty("name"));s&&s[1]>o&&(o=s[1])}i++}}),parseInt(t&&o>i?o:i)},getElementCopyName:function(e){var t=e,n=" Copy";/.+Copy/.test(e)&&(t=/(.*?)\sCopy/i.exec(e)[1]);var o=this.countElementsWithName(t,!0);return o>0&&(n+=" ("+(o+1)+")"),t+n},recreateVirtualElement:function(){dpManager.dpWorkBench.mBatchVirtualElement||(this.destroyVirtualElement(),this.createVirtualElement())},updateVirtualElement:function(e){var t=dpManager.dpWorkBench.getActivePage().getActiveElements(),n=dpManager.dpSelector.getElementsBoundingBox(t),o={width:n.width,height:n.height,top:n.top,left:n.left};for(var i in o)o.hasOwnProperty(i)&&this.mDPVirtualEl.setProperty(i,o[i]);this.mDPVirtualEl.mSelectedElements=t,this.mDPVirtualEl.createProps(),this.mDPVirtualEl.setActiveElement(!1,!0,e),this.mDPVirtualEl.mInEl.style.zIndex=-1e4},destroyVirtualElement:function(){this.mDPVirtualEl&&(this.mDPVirtualEl.removePropagationEvents(),this.mDPVirtualEl.mActive=!1,this.deleteElement(this.mDPVirtualEl,!1,!0),this.mDPVirtualEl=null)},createVirtualElement:function(){var e=dpManager.dpWorkBench.getActivePage().getActiveElements(),t=dpManager.dpSelector.getElementsBoundingBox(e),n={width:t.width,height:t.height,top:t.top,left:t.left};null===this.mDPVirtualEl&&(this.mDPVirtualEl=dpManager.dpWorkBench.getActivePage().createElement(this.mVirtualElementType,n,!1,!0,!1,!1,!1,!1,0,0,!1,!0)),this.updateVirtualElement()},setActiveElement:function(e,t){if(!e||e.mType!==this.mVirtualElementType){var n=dpManager.dpWorkBench.getActivePage().getGroupInEditMode();if(n)if(null!=e||t){if(e){var o=dpManager.dpWorkBench.getActivePage().getElementById(n);o&&(e.mId==o.mId||o.mPropsValues.stored_elements.some(function(t){return t==e.mId})||o.closeGroupEdit())}}else{var o=dpManager.dpWorkBench.getActivePage().getElementById(n);o&&o.closeGroupEdit()}MooTools.$defined(t)||dpManager.dpWorkBench.mBatchVirtualElement||(t=!0),this.deactivateElements(),this.mActiveElements=[e],null===e&&(this.mActiveElements=[]),this.activateElements(),t&&this.fireEvent("onActivateElements")}},setActiveElements:function(e,t){this.deactivateElements(),this.mActiveElements=e,(dpManager.dpSelector.isActivated()||t)&&this.mActiveElements.each(function(e){t?e.setActiveElement():e.setActiveElement(!0)}),dpManager.dpSelector.isManyElementsSelected()?this.recreateVirtualElement():this.destroyVirtualElement(),this.activateElements(),this.fireEvent("onActivateElements")},deactivateElements:function(){if(!this.mActiveElements.length)return void(this.mDPVirtualEl&&this.destroyVirtualElement());dpManager.dpWorkBench.mBatchVirtualElement||this.mActiveElements.each(function(e){dpManager.uxpElementIndex.insert(e),e.detachShortcuts&&e.detachShortcuts(),e.onDeactivate&&e.onDeactivate()}),dpManager.emit("element_deselected",this.mActiveElements)},activateElements:function(){var e=this.mActiveElements.length>1;if(!this.mActiveElements.length)return void dpManager.emit("element_selected",[]);dpManager.dpWorkBench.mBatchVirtualElement||this.mActiveElements.each(function(t){dpManager.uxpElementIndex.remove(t),t.attachShortcuts&&t.attachShortcuts(e),t.onActivate&&t.onActivate(e)}),dpManager.emit("element_selected",this.mActiveElements)},getActiveElement:function(){return this.mActiveElements.length>1&&null!==this.mDPVirtualEl?this.mDPVirtualEl:this.mActiveElements[0]},recreateGroupElements:function(e,t,n,o){UXPStack.add("DPPage.recreateGroupElements)",[e,t,n]),o=o||!1;var i,s=[],a=e.stored_elements,r={};return a.sort(function(e,t){return e.props["z-index"]-t.props["z-index"]}),a.forEach(function(t){var a=copyObject(t.props);n&&(a.top+=n.top.toIntZero(),a.left+=n.left.toIntZero()),a.locked=0,a.top+=e.deltas.top,a.left+=e.deltas.left,i=dpManager.dpWorkBench.getActivePage().createElement(t.type,a,!1,!0,!1,!0,!1,!1,0,0,!0),r[t.id]=i.getId(),"Component"==t.type&&dpManager.dejax.newRequest({url:"/ajax/dmsDPPage/SetComponent/",eval:!0,data:{timestamp:dpManager.getTimestamp(),id_component:t.props.id_component,id_page:dpManager.dpPageInspector.getActivePageID(),id_project:dpManager.dpProject.getIdProject()}}),o?s[t.id]=i:s.push(i.getId())}),_.forEach(r,function(e){i=dpManager.dpWorkBench.getActivePage().getElementById(e),_.forEach(r,function(e,t){this.switchInteractions(t,e,i)}.bind(this))}.bind(this)),s},getActiveElements:function(){return this.mActiveElements},selectAllElements:function(){DPElementTransformator.deselectElements(null,!0);var e=[];this.mElements.each(function(t){t.getProperty("locked")||t.isInGroup()||t.isHidden()||e.push(t)}),e.length>1&&(dpManager.dpClipboard.mMultiPaste=!0,dpManager.dpShortcuts.setMultiSelectMode(!0)),dpManager.dpWorkBench.getActivePage().setActiveElements(e),e.each(function(e){e.setActiveElement(!1,!0)})},deleteElement:function(e,t,n,o,i,s,a){if("object"!==(void 0===e?"undefined":_typeof(e))&&(e=this.getElementById(e)),e){var r=e.getId(),l=e.getIdComponent();if(r){dpManager.isCollaboration()&&e.CollaborationInfo&&e.CollaborationInfo.removeCollaborators(),!0!==n&&(s+=this.switchInteractions(r));var d=e.toHash();"Component"==d.type&&(this.deleteComponentElements(d.props.id_component,r),this.mComponents.remove(d.props.id_component,r),l=d.props.id_component,this.mComponents.get(d.props.id_component).length||dpManager.dpComponentsList.toogleUsingComponents(!1,d.props.id_component));var c=null;if(e.isInGroup()&&(c=dpManager.dpWorkBench.getActivePage().getElementById(e.mIdGroup))){var m=c.mId;c.updateGroupZone()}if(!0===t&&!0!==i){o=!0;var h=s||null;dpManager.dpHistory.add({undo:function(e,t,n){if(e.props["z-index-force"]=e.props["z-index"],this.createElement(e.type,e.props,t,!1,!1,!0,!1,!1,0,0,!0),n){var o=dpManager.dpWorkBench.getActivePage().getElementById(n);o&&o.attachElement(t),o.attachElements()}}.pass([d,r,m],this),redo:function(e){this.deleteElement(this.getElementById(e),!0,!1,!0,null,null,a)}.pass([r],this),group_undo:h})}return n||(this.mDeletedElements.set(r,!0),this.mComponentsUsed.set(l,this.mComponents.has(l))),!0!==o||n||this.save(),!0===i&&this.mComponents.removeComponentsElement(l,r),this.mElements.erase(r),c&&c.updateGroupZone(),e.deleteElement(n,a)}}},deleteSelectedElements:function(e,t,n){var o=this.getActiveElements().filter(function(e){return"1"==e.getProperty("locked")}.bind(this)),i=this.getActiveElements();if(!0!==e&&o.length>0){var s={title:"%s confirmation",text:"%s. Do you still want to %s it?"},a=t?"Cut":"Delete",r=o.length>1,l=i.length>1?"Selection contains "+o.length+" locked element"+(r?"s":""):"Element is locked";return s.title=s.title.sprintf(a),s.text=s.text.sprintf(l,a.toLowerCase()),void DSWindow.CreateConfirm(s.text,s.title,"Yes","No",this.deleteSelectedElements.pass([!0],this))}this.deleteProvidedElements(this.getActiveElements(),n),this.mActiveElements=[],this.destroyVirtualElement()},deleteProvidedElements:function(e,t,n,o){void 0==o&&(o=!0);var i,s=dpManager.dpHistory.startGroupCounter(),a=t||0;if(e.sort(DPPage_ElementsIndex.sortByPositionDesc).forEach(function(e,t,n){this.deleteElement(e,o)}.bind(this)),i=dpManager.dpHistory.getGroupCounter(s),i+=a,n)return i;--i>-1&&dpManager.dpHistory.setGroupUndo(i)},deleteElements:function(){dpManager.dpWorkBench.getActivePage().setActiveElement(null),this.mElements.each(function(e){this.deleteElement(e,!1,!0)}.bind(this)),this.mElements.empty(),this.mActiveElement=null},deletePage:function(){if(this.deleteElements(),this.removeEvents(),this.mWorkbenchEl){MooTools.Array.prototype.forEach.call(this.mWorkbenchEl.querySelectorAll(".dpContainer"),function(e){this.mWorkbenchEl.removeChild(e),e=null}.bind(this));var e=this.mWorkbenchEl.querySelector(".tools-box");e&&this.mWorkBenchEl.removeChild(e)}this.mWorkbenchEl=null,this.mWorkbenchElMain=null,document.removeEvent("mouseup",this.mStrangeEvent),this.mStrangeEvent=null,this.clearGuides()},save:function(e,t,n,o,i){i=i||!1,MooTools.$clear(this.mClearSaveTimer),this.mClearSaveTimer=this.clearSaveTimerIndex.delay(1500,this),this.getElementById(e)&&this.saveSingleProperty(e,t,n,o),this.mSaveIndex<4||this.mSaveIndex>15?(this.mSaveIndex++,this.mSaveIndex>15&&(this.mSaveIndex=4),i?this.forceSave():this.saveCollectedTimer(120)):(this.mSaveIndex++,i?this.forceSave():this.saveCollectedTimer(400))},saveSingleProperty:function(e,t,n,o){this.mCollectedData.has(e)||this.mCollectedData.set(e,new MooTools.Hash({props:new MooTools.Hash,timestamps:new MooTools.Hash,type:this.getElementById(e).getType()})),this.mCollectedData.get(e).get("props").set(t,n),void 0===this.mCollectedData.get(e).get("timestamps")[t]&&this.mCollectedData.get(e).get("timestamps").set(t,o||null)},saveBulk:function(e,t,n,o){var i=void 0===t||t,s={},a=dpManager.getTimestamp();Object.keys(e).forEach(function(t){var n=this.getElementById(t);void 0===s[t]&&(s[t]={}),Object.keys(e[t]).forEach(function(o){s[t][o]=n.getProperty(o),this.saveSingleProperty(t,o,e[t][o],a)}.bind(this))}.bind(this)),this.saveCollectedTimer(900),i&&this.saveBulkHistory(e,s,n,o)},saveBulkHistory:function(e,t,n,o){dpManager.dpHistory.add({undo:function(t,n){var o=!1,i=dpManager.dpWorkBench.getActivePage();Object.keys(t).forEach(function(n){var s=dpManager.dpWorkBench.getActivePage().getElementById(n);s&&Object.keys(t[n]).forEach(function(a){s.setProperty(a,t[n][a],null,null,null,e[n][a]),s.mTimestamps[a]=dpManager.getTimestamp(),i.save(n,a,t[n][a],i.getElementById(n).mTimestamps[a]),"z-index"==a&&(o=!0)})}),n.forEach(function(e){e.setActiveElement()}),o&&dpManager.dpWorkBench.getActivePage().mElementsIndex.recreateIndex()}.pass([t,n]),redo:function(e){var o=!1,i=dpManager.dpWorkBench.getActivePage();Object.keys(e).forEach(function(n){var s=dpManager.dpWorkBench.getActivePage().getElementById(n);s&&Object.keys(e[n]).forEach(function(a){s.setProperty(a,e[n][a],null,null,null,t[n][a]),s.mTimestamps[a]=dpManager.getTimestamp(),i.save(n,a,e[n][a],i.getElementById(n).mTimestamps[a]),"z-index"==a&&(o=!0)})}),n.forEach(function(e){e.setActiveElement()}),o&&dpManager.dpWorkBench.getActivePage().mElementsIndex.recreateIndex()}.pass([e,n]),group_undo:o>0?o:0})},clearSaveTimerIndex:function(){MooTools.$clear(this.mClearSaveTimer),this.mSaveIndex=0},saveCollectedTimer:function(e){MooTools.$clear(this.mSaveTimer),this.mSaveTimer=this.saveCollected.delay(e,this)},forceSave:function(){MooTools.$clear(this.mSaveTimer),this.saveCollected()},saveCollected:function(){var e=this.mCollectedData.getClean(),t=this.mDeletedElements.getClean(),n=this.mComponentsUsed.getClean(),o=dpManager.dpPageInspector.getActivePageID();if(this.mCollectedData.empty(),this.mComponentsUsed.empty(),0!=new MooTools.Hash(e).getLength()||0!=new MooTools.Hash(t).getLength()){var i={id_page:o,id_project:dpManager.dpProject.getIdProject(),changed_elements:e,deleted_elements:t,components_used:n};this.storeLocally(i)}},saveStored:function(e){var t=this.getStoredLocally(e,!0);if(t){if(t.last_iteration_number=dpManager.dpProject.getLastIterationNumber(),t.last_import_type=dpManager.DATA.project_data.last_import.type,!t.id_page){var n=copyObject(t);n.actual_id_page=dpManager.dpPageInspector.getActivePageID(),n.actual_uri=window.location.href,new MooTools.Request({url:"/ajax/dmsDPPage/SaveDebug/"}).post({json:MooTools.JSON.encode(n)})}this.mSaveLocallyOnFail=!0,dpManager.emit("savingRequest"),this.chainSaveRequest(this.postSave.bind(this,t))}},postSave:function(e){this.saveRunning=!0;var t=this.saved.bind(this),n=this.failed.bind(this),o=function(e){this.saveRunning=e}.bind(this);return new MooTools.Request({onCancel:function(t){try{dpManager.Analytics.analyticsEvent("app","Local Storage restored in OnCancel")}catch(e){}n(e),o(!1)},onComplete:function(i){if(o(!1),200===this.xhr.status&&this.xhr.getAllResponseHeaders().length>0&&i)try{var s=JSON.parse(i);t(s),dpManager.isCollaboration()&&socket.emit("changeProperties",i)}catch(t){n(e)}else n(e)},evalScripts:!1,url:"/ajax/dmsDPPage/Save/",link:"chain",noCache:!0}).post({json:MooTools.JSON.encode(e)})},chainSaveRequest:function(e){this.chain(e),this.saveRunning||this.callChain()},cancelChainedSaveRequest:function(){var e=this.callChain();e&&e.cancel()},saved:function(e){if(e="string"==typeof e?MooTools.JSON.decode(e):e,MooTools.$clear(this.mSaveNotifyDelay),dpManager.removeNotification(),e.error){switch(e.error){case"nalert3":this.mSaveLocallyOnFail=!0;break;default:this.mSaveLocallyOnFail=!1}throw e.error&&e.error===dpManager.dpPageInspector.ERROR.SKETCH_PAGE_OUTDATED?(dpManager.dpProject.updatePreviousIterationsUrls(e.previous_iterations_urls),dpManager.emit("requested_page_is_not_available")):(dpManager.emit("page_save_error",{error:e.error}),this.showError(e.error)),new Error(e.error)}if(this.mSaveLocallyOnFail=!0,e&&e.system_message&&"disabled"==e.system_message)return void(window.location.href="/mod/Login/Logout");0===this.$chain.length&&dpManager.emit("savingReceived",e),this.callChain(),this.fireEvent("onSaved",e.id_page)},failed:function(e){this.mSaveLocallyOnFail&&this.storeLocally(e),this.cancelChainedSaveRequest()},storeLocally:function(e,t){var n=(t||dpManager.dpPageInspector.getActivePageID(),this.getStoredLocally(!1)||{});n.changed_elements=void 0!==n.changed_elements?new MooTools.Hash(n.changed_elements):new MooTools.Hash,n.deleted_elements=void 0!==n.deleted_elements?new MooTools.Hash(n.deleted_elements):new MooTools.Hash,new MooTools.Hash(e.changed_elements).each(function(e,t){n.changed_elements.has(t)?"string"==typeof n.changed_elements.get(t)&&n.changed_elements.set(t,MooTools.JSON.decode(n.changed_elements.get(t))):(n.changed_elements.set(t,new MooTools.Hash({props:new MooTools.Hash,timestamps:new MooTools.Hash,type:e.type,v:e.v})),n.deleted_elements.has(t)&&n.deleted_elements.erase(t)),new MooTools.Hash(e.props).each(function(e,o){n.changed_elements.get(t).props[o]=e}),new MooTools.Hash(e.timestamps).each(function(e,o){void 0===n.changed_elements.get(t).timestamps[o]&&(n.changed_elements.get(t).timestamps[o]=e)})}),n.deleted_elements.extend(e.deleted_elements),n.components_used=void 0!==n.components_used?new MooTools.Hash(n.components_used):new MooTools.Hash,n.components_used.extend(e.components_used),n.component_version=void 0!==n.component_version?new MooTools.Hash(n.component_version):new MooTools.Hash,n.component_version.extend(e.component_version);var o={id_project:e.id_project,id_page:e.id_page,changed_elements:n.changed_elements.getClean(),deleted_elements:n.deleted_elements.getClean(),components_used:n.components_used.getClean(),component_version:n.component_version.getClean()};this._storeChangesLocally(o)},_storeChangesLocally:function(e){lscache.bucket(e.id_page,function(){lscache.set("changes",e)||(this._fallbackChangesStore[e.id_page]=e)}.bind(this))},_getStoredLocallyChanges:function(e){return this._fallbackChangesStore[e]?this._fallbackChangesStore[e]:lscache.bucket(e,function(){return lscache.get("changes")})},getStoredLocally:function(e,t){var n=e||dpManager.dpPageInspector.getActivePageID(),o=this._getStoredLocallyChanges(n);if(t&&this.clearStoredLocally(n),o&&o.changed_elements){var i=new MooTools.Hash(o.changed_elements);o.changed_elements={},i.each(function(e,t){o.changed_elements[t]="string"==typeof e?MooTools.JSON.decode(e):e})}return o},clearStoredLocally:function(e){var t=e||dpManager.dpPageInspector.getActivePageID();this._fallbackChangesStore[t]&&delete this._fallbackChangesStore[t],lscache.bucket(t,function(){return lscache.remove("changes")})},mergeChanges:function(e){var t=dpManager.dpPageInspector.getActivePageID(),n=this.getStoredLocally(t);if(!n)return!0;var o=new MooTools.Hash(n.changed_elements),i=new MooTools.Hash(n.changed_elements);return e.each(function(e){e.changed_elements&&new MooTools.Hash(e.changed_elements).each(function(e,t){if(DPElementGeneric.isAggregation(e.type)){var i=e.props.stored_elements||[],s=function(e,t){return!1===i.contains(parseInt(t))&&!1===i.contains(""+t)}.bind(this);o=o.filter(s),this._storeChangesLocally(MooTools.$extend(n,{changed_elements:o.getClean()}))}}.bind(this))}.bind(this)),o.toQueryString()==i.toQueryString()},showError:function(e){if("suspended"==e)return void dpManager.showAccountExpired(!1);var t={text:"You have no permission to access this project.",title:"No permissions",button:"Back",size:10},n={permissions:{text:"You have no permission to access this project.",title:"No permissions",button:"OK",size:10,callback:function(){window.location="/"}},editormpp:{text:"You've chosen to leave UXPin Beta. To switch to UXPin, the page has to be reloaded.",title:"Leaving UXPin Beta",button:"OK",size:10,callback:function(){var e=window.location.origin;e+="/dms/Desktop/Default/"+dpManager.dpProject.getIdProject(),window.location.href=e}},internetexplorer:{text:"We are trying hard to make UXPin work with Internet Explorer, but we're not there yet.<br/>Meanwhile please use Chrome, Safari or Firefox.<br/>Have a nice day! &#9786",title:"We're doing our best",button:"OK",size:10},nalert3:{text:"Your wireframe changes couldn't be saved.<br/><br/>Please refresh your browser and try again. Contact us if problem persists.",title:"Save error",button:"OK",size:10},nopageid:{text:"Invalid save request.<br/><br/>Please refresh your browser and try again. Contact us if problem persists.",title:"Invalid request",button:"OK",size:10},conflict:{text:"Your local changes conflicted or desynchronised with the server.<br/> Please refresh your browser to avoid further conflicts. <br/><br/>Your not-conflicted changes are already saved.",title:"Conflict",button:"OK",size:10},logout:{text:"You've been logged out because you've logged in from another browser or you haven't been using UXPin for a while.",title:"Login error",button:"OK",size:10,callback:function(){window.location="/"}},migrating:{text:"We need a moment to upgrade your project. It shouldn't take more than a couple of seconds but in some rare cases it could take up to minute.",title:"Give us a second",button:"Reload",size:10,callback:function(){window.location.reload()}},noresponse:{text:"This action could not be completed, please check your internet connection",title:"Connection error",size:10,callback:function(){window.location.reload()}}};if(n[e]){if(!1===n[e].displayError)return;_.extend(t,n[e])}DSWindow.IsAlertDisplayed(t.title)||(DSWindow.Alert(t.text,t.title,t.button,t.size,null,t.callback||function(){}),window.Rollbar&&window.Rollbar.warning("Page alert displayed",{title:t.title,text:t.text}))},setZIndex:function(e){this.mZIndexes.push(e.toInt()),this.mZIndexes=[this.mZIndexes.min().toIntZero(),this.mZIndexes.max().toIntZero()]},getMaxZIndex:function(){this.mElementsIndex.getMax()},getMinZIndex:function(){return this.mElementsIndex.mBaseZindex},fixNegativeZIndex:function(){this.mElementsIndex.recreateIndex(),this.mElementsIndex.fireChange(this.mElementsIndex.generateZindex())},addComponentElement:function(e,t,n,o){return this.createElement("Component",{id_component:e},!1,!0,null,!0,!0,null,n||0,o||0)},loadComponent:function(e,t){var n=this.mComponents.getLast(e);return!n||(n.componentLoading.delay(1,n),dpManager.dejax.newRequest({url:"/ajax/dmsDPPage/SetComponent/",eval:!0,data:{timestamp:dpManager.getTimestamp(),id_component:e,id_page:dpManager.dpPageInspector.getActivePageID(),id_project:dpManager.dpProject.getIdProject()},onComplete:function(t){this.addComponentElementsToWorkbench(e,t),this.mLoadingElements=!1}.bind(this)}),!0)},deleteComponentElements:function(e,t){var n=this.mComponents.get(e,t),o=!!n&&n.getElements();return!(!o||o.length<1)&&(o.each(function(e){this.deleteElement(e,!1,!0,!1,!1)}.bind(this)),n.resetElements(),!0)},addComponentElementsToWorkbench:function(e,t,n){dpManager.dpComponentsList.toogleUsingComponents(!0,e),this.loadElements(t,e,n),dpManager.removeNotification("addComponentElement")},setSaved:function(){dpManager.dpPageInspector.dpToolbar.setButtonInactive("save")},getElementByTypeProperty:function(e,t){var n=[];return this.mElements.each(function(o){if(o.mType==e){var i=!0;for(var s in t)if(void 0==o.mPropsValues[s]||o.mPropsValues[s]!=t[s]){i=!1;break}1==i&&n.push(o)}}),n},generateUniqueId:function(e,t){var n,o,i=e||1,s=t&&t>99&&t<Date.now()?t:9999999;do{n=Date.now().toString(),n=n.substr(n.length-s.toString().length),o=parseInt(n*Math.random(),10)}while(o<i||o>s||null!==this.getElementById(o));return o.toString()},cometOnChangeElements:function(e){var t=!1,n=!1;if(1==e.is_component&&this.mComponents.has(e.id_page))t=!0,n=e.id_page;else if(!e.changed_elements||!e.deleted_elements||dpManager.dpPageInspector.getActivePageID()!=e.id_page)return;if(new MooTools.Hash(e.changed_elements).each(function(e,o){var i=this.getElementById(o,{from_components:t,as_array:!0});if(!i.length&&!this.mDeletedElements.get(o)){var s=this.createElement(e.type,e.props,o,!0,n,!1,!1,!1,0,0,!0);return void dpManager.uxpElementIndex.insert(s)}new MooTools.Hash(e.props).each(function(t,n){i.each(function(o){var i=!0;o.mActive&&!dpManager.dpSelector.isManyElementsSelected()&&(i=!1),o.mTimestamps[n]>e.timestamps[n]||(o.setProperty(n,t,i,!1,!0,null,!0),o.mTimestamps[n]=e.timestamps[n])})})},this),dpManager.mGroupUpdate){var o=this.getElementById(dpManager.mGroupUpdate);o&&o.updateGroup(!0),dpManager.mGroupUpdate=!1}new MooTools.Hash(e.deleted_elements).each(function(e,n){var o=this.getElementById(n,{from_components:t,as_array:!0});o.length&&o.each(function(e){this.deleteElement(e,!1,!0,!1,t)},this)},this),t&&this.countComponentRelativePosition(n),dpManager.dpSelector.isManyElementsSelected()?this.updateVirtualElement():this.destroyVirtualElement()},cometOnReconnectChanges:function(e){var t=e.onChangeElements||[];if(0===t.length)return void this.restoreCommunication();try{if(!1===this.mergeChanges(t))return this.handleConflict();t.each(function(e){this.cometOnChangeElements(e)}.bind(this)),this.restoreCommunication()}catch(e){DSWindow.Alert(e.message,"Warning","OK",10,"crystal/32/actions/agt_update_critical.png",function(){this.handleConflict()}.bind(this))}},restoreCommunication:function(){this.saveStored(),"undefined"!=typeof socket&&dpManager.isCollaboration()&&(socket.emit("howManyCollaborators",dpManager.dpProject.getHash()),socket.on("howManyCollaborators",function(e){if(e>1)return this.displayOfflineAlert(),!1}.bind(this)))},displayOfflineAlert:function(){var e="Collaboration mode";DSWindow.IsAlertDisplayed(e)||DSWindow.Alert("You went offline, so you were disconnected from collaboration mode. Please, refresh this page (all changes have been saved).",e,"Close")},handleConflict:function(){dpManager.setCollaboration(!1),this.saveStored(),this.showError("conflict"),dpManager.Analytics.analyticsEvent("conflict-offline")},saveGuides:function(e){lscache.bucket(e||dpManager.dpPageInspector.getActivePageID(),function(){lscache.set("guides",this.serializeGuides())}.bind(this))
},restoreGuides:function(){var e=lscache.bucket(dpManager.dpPageInspector.getActivePageID(),function(){return lscache.get("guides")});if(e){if("string"==typeof e)try{e=JSON.parse(e)}catch(e){}e&&e.each(function(e){var t=new DPPage_Guide(e.type);t.createGuide(e.position),this.addGuide(t)}.bind(this))}},addGuide:function(e){this.mGuides.push(e),e.addEvent("update",this.saveGuides.bind(this))},removeGuide:function(e){this.mGuides.erase(e),this.saveGuides()},clearGuides:function(){this.mGuides.each(function(e){e.destroy()}),this.mGuides=[]},getGuides:function(){return this.mGuides},serializeGuides:function(){var e=[];return this.mGuides.each(function(t){var n={type:t.getType(),position:t.getPosition()};e.push(n)}),e},settings:function(e){return lscache.bucket("pages-settings",e)},getSetting:function(e){return this.settings(function(){return window.lscache.get(e)})},removeInteractionsOnState:function(e,t){return(new ElementInteractions_Switcher).removeInteractionsOnState(e,t)},switchInteractions:function(e,t,n,o){return(new ElementInteractions_Switcher).switchInteractions(e,t,n,o)},cleanupInteractions:function(){var e=this.getElements(),t=0;return e.each(function(n){var o=n.getProperty("actions").map(function(e){return e}),i=[],s=!1;o.each(function(t,n){t.elements&&t.elements[0]&&void 0===e[t.elements[0]]?s=!0:i.push(t)}),s&&(n.setProperty("actions",i,!0,!0,null,null,null,!0),t++,0==i.length&&n.setInteractiveIcons&&n.setInteractiveIcons())}),t},setGroupInEditMode:function(e){this.mGroupInEditMode=e},getGroupInEditMode:function(){return this.mGroupInEditMode},setElementPickerMode:function(e){this.mElementPickerMode=e},isElementPickerMode:function(){return this.mElementPickerMode}});DPPage.isComponentInElements=function(e){function t(e){function t(e){return"Component"===e.type}return t(e)||DPElementGeneric.isAggregation(e.type)&&e.stored_elements.some(t)}function n(e){function t(e){return e.isComponent()}return t(e)||e.isAggregation()&&e.getElements().some(t)}return e&&!MooTools.Array.isArray(e)&&(e=[e]),e[0]instanceof DPElementGeneric?e.some(n):e.some(t)},DPPage.isComponentInActiveElements=function(){return DPPage.isComponentInElements(dpManager.dpWorkBench.getActivePage().getActiveElements())};
!function(e){"use strict";var t=function t(){this.timers={},e.addEventListener("beforeunload",function(){var e=Object.keys(this.timers).map(function(e){return{id_page:e,force_generate:!0}});e.length>0&&t.bulkRequest(e)}.bind(this))};t.prototype.debounceTimer=function(e,t,r){this.stopTimer(e).setTimer(e,t,r)},t.prototype.setTimer=function(e,t,r){return this.timers[e]=setTimeout(this.generate.bind(this,e,t),r||3e4),this},t.prototype.stopTimer=function(e){return void 0!==this.timers[e]&&(clearTimeout(this.timers[e]),delete this.timers[e]),this},t.prototype.generate=function(e,r){t.request({id_page:e,force_generate:!0}).then(function(t){this.stopTimer(e),"function"==typeof r&&r(t)}.bind(this)).catch(function(e){console.error(e)})},t.request=function(e){return new Promise(function(t,r){if(!e.id_page)return void r("No id_page provided");(new Dejax).newRequest({url:"/ajax/dmsDPPage/GetShot/",mode:"queue",data:e,onComplete:t,onError:r})})},t.bulkRequest=function(e){return new Promise(function(t,r){if(!MooTools.Array.isArray(e)||0==e.length)return void r("Empty or incorrect data provided");(new Dejax).newRequest({url:"/ajax/dmsDPPage/GetBulkShot/",mode:"queue",data:e,onComplete:t,onError:r})})},e.DPPage_Covers=t}(window);
var DPPage_ElementsHelper=function(){var n=function(){},e=function(n){return _.some(n,function(n){return!0===n.disableStates})};return{canLock:n.pass([0]),canUnlock:n.pass([1]),canGroup:function(){},canConvertToMultistate:function(){var n=dpManager.dpWorkBench.getActivePage().getActiveElements();return!uxpft.disabledInPlan(FEATURE_INTERACTIONS_STATES)&&(!e(n)&&!(1!==n.length||!n[0].isGroup()))},canUngroup:function(){return dpManager.dpWorkBench.getActivePage().getActiveElement().isGroup()},canRemoveFromGroup:function(){return!0}}}();
!function(){"use strict";var e=new MooTools.Class({name:"DPPage_ElementPicker",Implements:[MooTools.Events,MooTools.Options],options:{scroll_back:!1,initiator:null,validator:null,validatorParams:[],onSelect:MooTools.$empty},mActiveEl:null,mActiveToolbar:null,mBaseOffset:null,mCurrentOffset:null,initialize:function(e){this.setOptions(e),this.enterWorkbenchPickerMode(),this.options.scroll_back&&this.setOffsetListener()},getElements:function(){var e=dpManager.dpWorkBench.getActivePage().getElements();if("function"!=typeof this.options.validator)return e;var t,n,i=[],o=[];for(var s in e)e.hasOwnProperty(s)&&(n=[e[s].mId].concat(this.options.validatorParams),t=this.options.validator.apply(this,n),t.status?i.push(e[s]):o.push(e[s]));return{availableElements:i,unavailableElements:o}},enterWorkbenchPickerMode:function(){this.mActiveEl=dpManager.dpWorkBench.getActivePage().getActiveElement(),dpManager.dpSelector.removeEvents(),this.mOnPickRef=this.onElementPick.bind(this),this.mOnWorkbenchClickRef=this.onWorkbenchClick.bind(this),this.mOnEscKeyRef=this.onEscKey.bind(this),this.mOnCloseComponentEditRef=this.onCloseComponentEdit.bind(this),this.mActiveEl&&this.mActiveEl.mToolbar&&(this.mActiveToolbar=this.mActiveEl.mToolbar,this.mActiveToolbar.mPreventDestroy=!0,this.mActiveToolbar.quickHide());var e=this.getElements();e.availableElements.length>0&&e.availableElements.each(function(e){e.addEvent("pick",this.mOnPickRef),e.setPickerMode(!0)}.bind(this)),e.unavailableElements.length>0&&e.unavailableElements.each(function(e){e.mEl.classList.add("unpickable")}.bind(this)),dpManager.dpWorkBench.getWorkBenchElMain().addEvent("click",this.mOnWorkbenchClickRef),dpManager.dpShortcuts.addShortcut("esc",this.mOnEscKeyRef);var t=document.querySelector(".btn.component-name small");t&&t.addEventListener("click",this.mOnCloseComponentEditRef),document.body.classList.contains("tracking")||document.body.classList.add("tracking"),this.addEvent("select",this.exitWorkbenchPickerMode.bind(this)),dpManager.dpWorkBench.getActivePage().setElementPickerMode(!0)},exitWorkbenchPickerMode:function(){dpManager.dpSelector.restoreEvents(),this.mActiveToolbar&&this.mActiveToolbar.quickShow(),this.mActiveEl.setActiveElement();var e=this.getElements();e.availableElements.length>0&&e.availableElements.each(function(e){e.removeEvent("pick",this.mOnPickRef),e.removeHighlight(),e.setPickerMode(!1)}.bind(this)),e.unavailableElements.length>0&&e.unavailableElements.each(function(e){e.mEl.classList.remove("unpickable")}.bind(this)),dpManager.dpWorkBench.getWorkBenchElMain().removeEvent("click",this.mOnWorkbenchClickRef),dpManager.dpShortcuts.removeShortcut("esc",this.mOnEscKeyRef),document.body.classList.contains("tracking")&&document.body.classList.remove("tracking"),dpManager.dpWorkBench.getActivePage().setElementPickerMode(!1),this.fireEvent("exit")},onElementPick:function(e){this.fireEvent("select",[e])},onWorkbenchClick:function(e){e.stopPropagation(),"ElementsLayer"==e.target.get("id")&&this.exitWorkbenchPickerMode()},onEscKey:function(){this.exitWorkbenchPickerMode()},onCloseComponentEdit:function(){this.exitWorkbenchPickerMode(),dpManager.dpWorkBench.mCurrentElementToolsBox.destroy({noAnimation:!0,force:!0})},setOffsetListener:function(){var e=dpManager.dpWorkBench.getWorkBenchElMain(),t=e.getScroll();this.addEvent("exit",function(){var n=e.getScroll();if(n.x!==t.x||n.y!==t.y){new MooTools.Fx.Scroll(e,{duration:"short"}).start(t.x,t.y)}})}});window.DPPage_ElementPicker=e,window.DPPage_ElementPicker.pickerClass="pickermode"}();
!function(e){"use strict";var t=new MooTools.Class({name:"DPPageInspector",Implements:[MooTools.Events],mActivePageID:0,mCoverPageId:0,mActivePageBaseID:0,mPrevActivePageID:0,mCollaborators:[],mPages:[],mVersionIndex:{},mUndoTimeoutMs:1e4,ERROR:{NO_PAGE:"no_page",SKETCH_PAGE_OUTDATED:"sketch_page_outdated"},initialize:function(e){this.render(e),this.addEvent("onSelectPage",this.setActivePage.bind(this)),window.addListener("hashchange",function(){var e=parseInt(this.getActivePageID()),t=parseInt(window.hashuri.get("id_page"));if(t&&e!==t){var n=dpManager.dpPageInspector.mVersionIndex,a=n[t]&&n[t][0];a&&this.getTree().getNode(a)?this.getTree().selectNode(a):dpManager.dpComponentsList.setActiveComponent(t)}}.bind(this))},render:function(e){this.mEl=new MooTools.Element("div",{id:"DPPageInspector"}),e&&this.mEl.inject(e),this.mDPTreeView=new DPTreeView({container:this.mEl,tree_top:0,tree_left:-10,draggable:!0,onNodeDrop:function(){this.saveOrder(this.mDPTreeView.getSortedNodes())}.bind(this),tree_bottom:"auto",tree_position:"relative"}),this.mDPTreeView.hideTree(),this.mDPTreeView.mTreeControl.div.getElement(".mooTree_node:first-child").hide()},setActivePage:function(t){return new Promise(function(n,a){if(t){var r=dpManager.dpWorkBench.getCurrentVersion();if(r=r?r.toInt():0,!dpManager.dpProject.hasVersion(r)){var o={id_project:dpManager.dpProject.getIdProject(),active_page:dpManager.dpPageInspector.mActivePageID,version:r,main:null};dpManager.dejax.newRequest({data:o,url:"/ajax/dmsDPPage/addVersion/",onComplete:function(e){dpManager.isCollaboration()&&socket.emit("addVersion",e);var t=document.querySelector('div[data-version="'+e.version+'"]');t&&t.click()}.bind(this)})}e.lscache.bucket(dpManager.dpProject.mIdProject,function(){return e.lscache.get("layers_panel_is_opened")});e.uxpdebug.start(),dpManager.dpWorkBench.isDefaultVersion()||this.mVersionIndex[t]&&this.mVersionIndex[t][dpManager.dpWorkBench.getCurrentVersion()]&&(t=this.mVersionIndex[t][dpManager.dpWorkBench.getCurrentVersion()]),this.closeAndSaveAllElements(),this.isComponent(this.mActivePageID)||(this.mPrevActivePageID=this.mActivePageID),this.mActivePageID=t;var i="/ajax/dmsDPPage/SetActivePage/",s=JSON.stringify({id_page:t,id_project:parseInt(dpManager.dpProject.getIdProject(),10)}),d=window.ajaxCache.getAndRemoveFromCache(i+":"+s);d||(d=window.utils.request(i,"POST",s)),d.then(function(e){var r;if(dpManager.elementsDataManager.fetchElementsFilesStructureOnlyOnce(),e&&e.target&&e.target.response)try{r=JSON.parse(e.target.response)}catch(e){r=null}this.switchActivePage(r).then(function(){this.isComponent(t)&&dpManager.emit("smart_element_opened",t),r.error&&r.error===this.ERROR.NO_PAGE&&dpManager.emit("requested_page_is_not_available"),n()}.bind(this),a)}.bind(this)),dpManager.dpWorkBench.deletePage()}}.bind(this))},closeAndSaveAllElements:function(){var e=dpManager.dpWorkBench.getActivePage();e&&_.each(e.mElements,function(e){var t=e.mEditable,n=e.editor;if(t||n){t&&e.mEditable.exit();var a=e.mCustomTextProperty;a||(a="caption");var r="";n?(a="input-value",r=e.editor.getValue()):r=e.mPropsDefinitions[a].value,e.forceSaveProperty(a,r)}})},getActivePageID:function(){return this.mActivePageID},getPrevActivePageID:function(){return this.mPrevActivePageID},getPageById:function(e,t){for(var n in this.mPages)if(this.mPages.hasOwnProperty(n)&&parseInt(this.mPages[n].id_page)===parseInt(e))return t?this.mPages[n][t]:this.mPages[n];return!1},switchActivePage:function(t){return new Promise(function(n){e.uxpdebug.getElapsed();var a=dpManager.dpWorkBench.createPage();if(dpManager.dpWorkBench.setActivePage(a),null!==a.getStoredLocally(this.mActivePageID,!1)){var r=function(){this.setActivePage(this.mActivePageID),a.removeEvent("onSaved",r)}.bind(this);return a.addEvent("onSaved",r),void a.saveStored()}a.addEvent("onSaved",function(e){var t=this.getActivePageID();t!==e&&this.isComponent(e)&&dpManager.dpWorkBench.mPageCovers.debounceTimer(e,function(t){var n=dpManager.dpComponentsList.get(e);n&&(n.setOptions({shot:!1}),dpManager.dpComponentsList.mComponentsCovers.onRequestSent(t))}),this.isCoverPage(t)&&dpManager.dpWorkBench.mPageCovers.debounceTimer(t)}.bind(this)),dpManager.emit("page_switched",t),dpManager.emit("breakpoint_switched"),n()}.bind(this))},saveOrder:function(e){return new Promise(function(t,n){var a={pages:e,id_project:dpManager.dpProject.getIdProject()};dpManager.dejax.newRequest({url:"/ajax/dmsDPProject/SavePagesOrder/",mode:"free",data:a,onComplete:function(e){if(e&&e.error)return dpManager.dpWorkBench.getActivePage().showError(e.error),n(e),!1;dpManager.isCollaboration()&&socket.emit("savePagesOrder",a,e),this.resetCoverPageId(),t(e)}.bind(this)})}.bind(this))},addNewPage:function(e,t,n,a){window._kmq.push(["record","App - Page - Add page clicked"]);var r={text:"Enter new page name",headerText:"Add page",submitText:"Add",checked:e};a&&(r.templateId=a),"function"!=typeof n&&(n=function(){}),this.showPrompt(r,function(e,a){var r=e;null!==r&&""!==r&&(this.updatePage(a,r,t).then(n),this.fireEvent("onAddNewPage"))}.bind(this))},addPage:function(e,t,n){if(!e||e.error)return dpManager.dpWorkBench.getActivePage().showError(e?e.error:"noresponse"),!1;if(!e||!e.id_page)return!1;t&&!n||(this.mVersionIndex[e.id_page]={},e.versions?(new MooTools.Hash(e.versions).each(function(t,n){this.addToVersionIndex(t,e.id_page,n),this.addToVersionIndex(e.id_page,e.id_page,0),this.addToVersionIndex(e.id_page,t,0)}.bind(this)),this.updateVersionsIndex(e.id_page)):"pages"===e.type&&this.addToVersionIndex(e.id_page,e.id_page,0));var a={text:e.name,icon:"/mp/MooTreeControl/mootree.png#11",id:e.id_page,versions:e.versions,allow_drop:e.allow_drop,allow_drop_sort:e.allow_drop_sort,draggable:e.draggable,workbenchDroppable:e.workbenchDroppable,onClick:_.noop,onSelect:this.fireEvent.pass(["onSelectPage",e.id_page],this),injectAfter:e.injectAfter,injectBefore:e.injectAfter?null:"add new page"},r=this.mDPTreeView.addNode(a,e.parent>0?e.parent:null),o=this.showHover.pass([r],this),i=this.hideHover.bind(this);r.divs.node.addEvent("mouseenter",o),r.divs.node.addEvent("mouseleave",i),r.divs.node.addEvent("dblclick",this.changePage.pass([r],this)),r.divs.text.setStyle("padding-right",10),r.divs.node.disableSelection(),t||r.divs.node.fireEvent("click");var s={name:r.text,id_page:r.id,parent:r.parent.id,is_active:0};return this.mPages.push(s),this.fireEvent("addPage",s),r},changePage:function(e,t){var n=e;if(!1===n)return!1;var a=!n.nodes[0]&&this.mDPTreeView.getSubRoot(n).id,r={text:"Enter page name",headerText:"Edit name",submitText:"Save",value:n.text,checked:a};t&&(r.templateId=t),this.showPrompt(r,function(t,a){var r=t;if(null===r||""===r)return!1;if(this.updatePage(a,r,n.id),this.mDPTreeView.changeNodeText(e,r),parseInt(dpManager.dpPageInspector.getActivePageID())===parseInt(e.id)){var o=document.getElement(".btn.page-inspector").getElement("span");o&&o.set({text:r,title:r})}window._kmq.push(["record","App - Page - Page renamed"]),this.fireEvent("onChangePageName")}.bind(this))},changePageTree:function(e,t,n){return this.mDPTreeView.changeNodeText(n,t),!1},showUndoPageDeletionBox:function(e,t){var n,a=$("WorkBench"),r=new MooTools.Element("div",{class:"notification"}).setStyle("width",7*t.length+240+"px"),o=function(){document.getElement("div.notification").set("morph",{onComplete:function(){document.getElement("div.notification").dispose()}.bind(this)}).morph({opacity:0})}.bind(this);r.empty(),r.microjungle([["div",{class:"overlay"}],["div",{class:"loader"}]]).setStyle("opacity",0),r.inject(a,"top"),r.position({relativeTo:a,position:"upperRight",edge:"upperRight",offset:{y:9+a.getScrollTop(),x:-27+a.getScrollLeft()}}),r.fade("in"),r.microjungle([["div",{class:"content undoDelete",style:"width: "+(7*t.length+240)+"px"},[["h4","Page <b>"+window.htmlspecialchars(t,"ENT_QUOTES")+"</b> has been removed"],["a",{href:"#",class:"undo"},"Undo"]]]]),document.getElement("div.loader").hide(),r.getElement("div.content").setStyle("background-image","url()"),r.getElement("a.undo").addEvent("click",function(){return document.getElement("a.undo").hide(),document.getElement("div.loader").show(),clearTimeout(n),dpManager.dejax.newRequest({url:"/ajax/dmsDPPage/UndoPageDeletion/",eval:!0,mode:"cancel",data:{id_project:dpManager.dpProject.getIdProject(),id_page:e},onComplete:function(e){dpManager.dpPageInspector.closeUndoPageDeletionBox(),e.each(function(e){dpManager.dpPageInspector.addPage(e,!0),dpManager.isCollaboration()&&socket.emit("addNewPage",e)})}.bind(this)}),!1}),n=setTimeout(o,this.mUndoTimeoutMs)},closeUndoPageDeletionBox:function(){document.getElement("div.notification").dispose()},setPages:function(t){if(t.error)return dpManager.hideWaiter(),e.DSWindow.Alert("You have no permission to access this project.","No permissions","Back",10,"crystal/32/actions/agt_update_critical.png",function(){window.location="/dms/Dashboard/Default"}),!1;0===t.pages.length&&dpManager.dpPageInspector.addNewPage("pages"),uxp.data.project_data.pages=t.pages,dpManager.setTimestampDiff(t.timestamp),this.mDPTreeView.getRootNode().options.allow_drop=!1,this.mDPTreeView.getRootNode().options.draggable=!1,this.mDPTreeView.getRootNode().text=t.project_name,this.mDPTreeView.getRootNode().updateText(),this.mDPTreeView.getRootNode().divs.node.removeEvents("click"),this.mDPTreeView.getRootNode().divs.node.disableSelection(),dpManager.setPageTitle(t.project_name),this.mProjectHash=t.project_hash,this.mDPTreeView.mTreeControl.div.getElements(".mooTree_node:first-child").hide();var n,a,r,o=parseInt(window.hashuri.get("id_page"),10),i={},s=[];t.pages.each(function(e){if(o&&parseInt(e.id_page)===o&&(e.version_of?(n=parseInt(e.version_of),dpManager.dpWorkBench.setCurrentVersion(e.version_type)):n=parseInt(e.id_page)),null!==e.version_type){var t=null===e.version_of?e.id_page:e.version_of;i[t]||(i[t]={}),i[t][e.version_type]=e.id_page,i[e.id_page]||(i[e.id_page]={}),i[e.id_page][0]=t||e.id_page,s.push(t)}}.bind(this)),i=this.getReverseMapForVersions(i),this.mVersionIndex=i,t.pages.each(function(e){o?e.is_active=Number([parseInt(e.id_page),parseInt(e.version_of)].indexOf(n)>-1):a&&(e.is_active=Number(e.version_of===a)),i[e.id_page]&&(e.versions=i[e.id_page]),e.version_of||(e.is_active&&(a=e.id_page),this.addSavedToTree(e),r=e.main_version)}.bind(this)),this.resetCoverPageId(),o?dpManager.dpPageInspector.setActivePage(o):dpManager.dpPageInspector.setActivePage(this.getCoverPageId()),this.mDPTreeView.showTree(),this.mDPTreeView.getRootNode().insert({allow_drop_sort:!1,allow_drop:!0,draggable:!1,text:"Add page",id:"add new page",icon:"/mp/MooTreeControl/mootree.png?v2#32",hide_tree_icon:!0,class_name:"add-new-page",selectable:!1,last_node:!0,onClick:this.addNewPage.pass(["pages"],this)}).divs.node.disableSelection(),dpManager.dpMainToolbar.pageWidget.refresh()},resetCoverPageId:function(){var e=parseInt(dpManager.dpProject.mMainVersion||0,10),t=parseInt(this.mDPTreeView.mTreeControl.root.nodes[0].id,10);this.mCoverPageId=this.mVersionIndex[t]&&this.mVersionIndex[t][e]},getCoverPageId:function(){return this.mCoverPageId},isCoverPage:function(e){return parseInt(e)===parseInt(this.mCoverPageId)},getReverseMapForVersions:function(e){var t,n;for(var a in e)if(e.hasOwnProperty(a)&&e[a][0]){t=e[a][0];for(var r in e[t])e[t].hasOwnProperty(r)&&(n=e[t][r],parseInt(n,10)!==parseInt(a,10)&&(e[a][r]=n))}return e},changeName:function(e){e&&dpManager.dejax.newRequest({url:"/ajax/dmsDPProject/ChangeName/",eval:!0,onComplete:function(t){t&&this.setProjectName(e)}.bind(this),data:{id_project:dpManager.dpProject.getIdProject(),name:e}})},addSavedToTree:function(e){var t={name:e.name,id_page:e.id_page,parent:e.parent,versions:e.versions},n=this.addPage(t,!0);return e.is_active&&(n.divs.node.fireEvent("click"),n.toggleParent()),n},updateComponentData:function(e,t,n,a,r){var o={};o.promise=new Promise(function(e,t){o.resolve=e,o.rejected=t});var i={type:"components",name:e,id_page:t,shared:n,id_project:dpManager.dpProject.getIdProject()};return dpManager.dejax.newRequest({url:"/ajax/dmsDPPage/UpdatePage/",eval:!1,data:i,onComplete:function(n){if(!n||n.error)return void o.rejected(n);var i=this.addPage(n,a);"function"==typeof r&&r(i),this.mPages.each(function(n){parseInt(n.id_page)===parseInt(t)&&(n.name=e)}),o.resolve(n)}.bind(this)}),o.promise},updatePage:function(e,t,n,a,r){var o,i,s=new Promise(function(e,t){o=e,i=t}),d={type:e,name:t,id_page:n,id_project:dpManager.dpProject.getIdProject()};return void 0!==a&&(d.sort_order=a),dpManager.dejax.newRequest({url:"/ajax/dmsDPPage/UpdatePage/",eval:!1,data:d,onComplete:function(e){var n=this.addPage(e,r);e?o(!0===e?t:e):i(),dpManager.isCollaboration()&&(e&&d.id_page?socket.emit("updatePage",d):e&&n&&socket.emit("addNewPage",e))}.bind(this)}),this.mPages.each(function(e){parseInt(e.id_page)===parseInt(n)&&(e.name=t)}),s},confirmPageDeletion:function(e){DSWindow.CreateConfirm("Are you sure you want to delete the page?<br /><br />If there are any nested pages, they will be deleted as well.<br /><br />","Delete page","Yes","Cancel",function(){this.processPageDeletion(e)}.bind(this))},processPageDeletion:function(e){var t=this.deletePageFromServer(e);return this.mPages=this.mPages.filter(function(t){return parseInt(t.id_page)!==parseInt(e)}),this.fireEvent("onDeletePage"),t},deletePageFromServer:function(e){var t={};return t.promise=new Promise(function(e,n){t.resolve=e,t.reject=n}),dpManager.dejax.newRequest({url:"/ajax/dmsDPPage/DeletePage/",eval:!1,data:{id_page:e,id_project:dpManager.dpProject.getIdProject()},onComplete:function(n){var a=_.extend({},n,{id_page:e});n&&!n.error||t.reject(n);dpManager.dpPageInspector.mDPTreeView.getNode(e);this.resetCoverPageId(),dpManager.isCollaboration()&&socket.emit("deletePage",a),window._kmq.push(["record","App - Page - Page removed"]),t.resolve(a)}.bind(this)}),t.promise},deletePageFromTree:function(e){var t,n=dpManager.dpPageInspector.mDPTreeView.getNode(e);n&&(t=n.getNext()||n.getPrevious()||n.getBack()||n.getForward(),t.options.selectable||(t=n.getPrevious()||n.getBack()),t=!(!t||!t.options.selectable)&&t,this.mDPTreeView.deleteNode(n)),t&&n.selected?parseInt(e)===parseInt(this.mActivePageID)&&t.divs.node.fireEvent("click"):this.isComponent()?dpManager.dpPageInspector.mDPTreeView.getAllNodes().pages.nodes[0].divs.node.fireEvent("click"):this.updatePage("pages","Homepage",null,0),dpManager.dpWorkBench.mToolbarRefs.each(function(e){e.adjustToSitemap&&e.adjustToSitemap()})},isComponent:function(e){return e=e||this.getActivePageID(),!!dpManager.dpComponentsList&&!1!==dpManager.dpComponentsList.getComponent(e)},isComponentCurrentlyOpen:function(){return this.isComponent(this.getActivePageID())},duplicatePage:function(e,t){var n,a,r=new Promise(function(e,t){n=e,a=t});return dpManager.dejax.newRequest({url:"/ajax/dmsDPPage/Duplicate/",eval:!1,data:{id_page:e,id_project:dpManager.dpProject.getIdProject(),name:t||!1},onComplete:function(e){e&&!e.error||a(e),e&&!e.error&&e.id_page&&dpManager.dpWorkBench.getActivePage().saveGuides(e.id_page),dpManager.isCollaboration()&&socket.emit("addNewPage",e),window._kmq.push(["record","App - Page - Page duplicated"]),this.addPage(e),n(e)}.bind(this)}),r},showPrompt:function(t,n){var a=new e.PromptModal(t),r="components"===t.checked?"components":"pages";a.on(e.PromptModal.ON_CONFIRM,function(e){n(e,r)}),a.render().appendTo(document.body).show(30)},getTreeData:function(e){return this.mDPTreeView.mTreeControl.getFlatTree(e)},onVersionAdd:function(e){var t=e.version;dpManager.dpProject.addVersions([e]),new MooTools.Hash(e.map).each(function(e,n){this.addToVersionIndex(e,n,t),this.addToVersionIndex(n,e,0),this.updateVersionsIndex(n)}.bind(this))},onVersionEdit:function(e){dpManager.dpProject.editVersion(e)},onVersionDelete:function(e){var t=e.version;dpManager.dpProject.removeVersion(t)&&(new MooTools.Hash(e.map).each(function(e,n){0!==parseInt(t)&&(delete this.mVersionIndex[n][t],delete this.mVersionIndex[e])}.bind(this)),dpManager.dpProject.mMainVersion=e.main_version,this.resetCoverPageId())},updateVersionsIndex:function(e){_.each(this.mVersionIndex,function(t){if(t[DPProject.getDefaultVersion()]&&parseInt(t[DPProject.getDefaultVersion()])===parseInt(e))return _.extend(t,this.mVersionIndex[e])}.bind(this))},isUsedByOtherUser:function(e){if(e instanceof Array||(e=[e]),e.each(function(t,n){e[n]=t.toInt()}),!(this.mCollaborators.length>0))return!1;var t=[];return this.mCollaborators.each(function(n){n.page_id&&e.contains(n.page_id.toInt())&&t.push(n.email)}),0!==t.length&&(1===t.length?t[0]:t.length>1?t.join(", "):void 0)},getProjectHash:function(){return this.mProjectHash},setCollaborators:function(e){this.mCollaborators=[],new MooTools.Hash(e).each(function(e,t){this.mCollaborators.push({user_id:t,email:e.email,avatar:e.avatar,page_id:e.id_page})}.bind(this)),dpManager.dpCollaborationBar.getCollaborators().length!==this.mCollaborators.length&&dpManager.dpCollaborationBar.setCollaborators(this.mCollaborators).refresh()},getCollaborators:function(){return this.mCollaborators},showHover:function(t){this.hideHover(),this.mHoverRef=new e.DPPageInspector_Hover({position:{relativeTo:t.divs.text,edge:"centerLeft",position:"centerRight"}},t),this.mHoverRef.mEl.getStyle("left").toInt()>270&&this.mHoverRef.mEl.setStyle("left",270)},hideHover:function(e){if(this.mHoverRef)return e&&e.relatedTarget===this.mHoverRef.getDomElement()?void e.stop():void this.mHoverRef.destroy()},getDomElement:function(){return this.mEl},getPages:function(){return this.mPages},getTree:function(){return this.mDPTreeView},sidebarWasHidden:function(){dpManager.dpSidebar.isAnyToolbarVisible()?this.mEl.setStyle("max-height",document.getSize().y/3.5):this.mEl.setStyle("max-height",500)},sidebarShown:function(){this.mEl.setStyle("max-height",document.getSize().y/3.5)},addVersion:function(e,t){var n={};n.promise=new Promise(function(e,t){n.resolve=e,n.reject=t}),dpManager.Analytics&&dpManager.dpProject.mVersions[e]&&dpManager.Analytics.kissEvent("App - Canvas adding breakpoint - Added breakpoint",{"App - Canvas adding breakpoint - Added breakpoint: Breakpoint Name":dpManager.dpProject.mVersions[e].text}),dpManager.Analytics&&dpManager.dpProject.mVersions[e]&&dpManager.Analytics.analyticsEvent("app","responsive add",dpManager.dpProject.mVersions[e].text);var a={id_project:dpManager.dpProject.getIdProject(),active_page:dpManager.dpPageInspector.mActivePageID,version:e,main:t};return e>dpManager.dpProject.mMaxStockVersion&&(a.variation_data=MooTools.JSON.stringify(dpManager.dpProject.mVersions[e])),dpManager.dejax.newRequest({data:a,url:"/ajax/dmsDPPage/addVersion/",onComplete:function(e){if(e.error)return n.reject(e),dpManager.dpWorkBench.getActivePage().showError(e.error),!1;this.onVersionAdd(e),dpManager.isCollaboration()&&socket.emit("addVersion",e);var t=document.querySelector('div[data-version="'+e.version+'"]');t&&t.click(),dpManager.emit("breakpoint_added",e),n.resolve(e)}.bind(this)}),n.promise},editVersion:function(e){var t={};t.promise=new Promise(function(e,n){t.resolve=e,t.reject=n});var n={id_project:dpManager.dpProject.getIdProject(),version:e,main:dpManager.dpProject.mMainVersion};return dpManager.emit("breakpoint_changed",e),dpManager.dejax.newRequest({data:n,url:"/ajax/dmsDPPage/EditVersion/",onComplete:function(e){e.error&&t.reject(e),this.onVersionEdit(e),dpManager.isCollaboration()&&socket.emit("editVersion",e),t.resolve(e)}.bind(this)}),t.promise},deleteVersion:function(t){var n={};n.promise=new Promise(function(e,t){n.resolve=e,n.reject=t});var a=dpManager.dpProject.mMainVersion;if(parseInt(a)===parseInt(t)){var r=_.clone(dpManager.dpProject.mActiveVersionIds);r.splice(r.indexOf(t.toInt()),1),a=r[0]}var o={id_project:dpManager.dpProject.getIdProject(),version:t,id_page:this.getActivePageID(),active_version:a};return dpManager.isCollaboration()?dpManager.dejax.newRequest({data:o,url:"/ajax/dmsDPPage/getAllVersions/",onComplete:function(t){var a=[];new MooTools.Hash(t.map).each(function(e){a.push(e)}),this.isUsedByOtherUser(a)?(e.DSWindow.Alert("Looks like other user is editing this version.","Cannot delete breakpoint","OK",15,"crystal/32/actions/agt_update_critical.png"),n.rejection()):this.deleteVersionFromServer(o).then(n.resolve,n.reject)}.bind(this)}):this.deleteVersionFromServer(o).then(n.resolve,n.reject),n.promise},deleteVersionFromServer:function(t){var n={};return n.promise=new Promise(function(e,t){n.resolve=e,n.reject=t}),dpManager.dejax.newRequest({data:t,url:"/ajax/dmsDPPage/deleteVersion/",onComplete:function(t){if(t.error)"last_version"===t.error&&(e.DSWindow.Alert("You must leave at least one version.","Cannot delete breakpoint","OK",15,"crystal/32/actions/agt_update_critical.png"),n.reject(t));else{this.onVersionDelete(t),dpManager.isCollaboration()&&socket.emit("deleteVersion",t);dpManager.dpProject.mVersions.filter(function(e){return e.version===t.version})[0].text;dpManager.emit("breakpoint_removed",t),n.resolve(t)}}.bind(this)}),n.promise},toggleVersion:function(e,t){return dpManager.dpProject.hasVersion(e)?(this.deleteVersion(e),-1):(this.addVersion(e,t),1)},addToVersionIndex:function(e,t,n){this.mVersionIndex[t]||(this.mVersionIndex[t]={}),this.mVersionIndex[t][n]=e.toInt()},getPageIdWithActiveResponsiveVersion:function(e){var t=new MooTools.Hash(this.mVersionIndex);if(t[e].hasOwnProperty(0))return this.mVersionIndex[e][0];for(var n in t[e])if(t[e].hasOwnProperty(n))return t[e][n]}});e.DPPageInspector=t}(window);
var DPPageInspector_Hover=new MooTools.Class({name:"DPPageInspector_Hover",Implements:[MooTools.Options],options:{position:{},id_page:null},mNode:null,initialize:function(e,o){this.mNode=o,this.setOptions(e),this.render(),this.show()},render:function(){this.mEl=new MooTools.Element("div",{id:"DPPageInspector_Hover"}).addEvent("mouseleave",this.destroy.bind(this)).microjungle([["span.arrow"]]).inject(document.body),new MooTools.Element("span",{class:"Rename",events:{click:dpManager.dpPageInspector.changePage.pass([this.mNode],dpManager.dpPageInspector)}}).microjungle([["em","Rename"]]).inject(this.mEl),new MooTools.Element("span",{class:"Props",events:{click:this.iconProps.bind(this)}}).microjungle([["em","Duplicate"]]).inject(this.mEl),dpManager.dpPageInspector.mPages.length>1&&new MooTools.Element("span",{class:"Trash",events:{click:this.iconTrash.bind(this)}}).microjungle([["em","Delete"]]).inject(this.mEl)},show:function(){this.mEl.position(this.options.position).show()},destroy:function(){this.mEl.destroy()},getDomElement:function(){return this.mEl},iconProps:function(){dpManager.dpPageInspector.duplicatePage(this.mNode.id),this.destroy()},iconTrash:function(){dpManager.dpPageInspector.deletePage(this.mNode.id),this.destroy()}});
var DPTreeView=new MooTools.Class({name:"DPTreeView",Implements:[MooTools.Events],mDSWindow:null,mTreeControl:null,mPagesNotes:new MooTools.Hash,mNoteEl:{},initialize:function(e){this.mContainer=e.container||!1,this.mDSWindow=e.dsWindow,this.createTree(e)},addNode:function(e,t,o){var n=this.getNode(t);t&&n||(n=this.mTreeControl.root);var i=n.insert(e,o);if(e.injectAfter){var r=this.getNode(e.injectAfter);r&&(i.injectAfter(r),n.nodes.pop(),n.update(!0))}if(e.injectBefore){var r=this.getNode(e.injectBefore);r&&(i.injectBefore(r),n.nodes.pop(),n.update(!0))}return i},changeSelectedNodeText:function(e){var t;return!!(t=this.getSelectedNode())&&this.changeNodeText(t,e)},changeNodeText:function(e,t){e.text=t,e.updateText()},getNode:function(e){return this.mTreeControl.get(e)},getAllNodes:function(){return this.mTreeControl.index},getSortedNodes:function(){return this.mTreeControl.getSortedNodes()},selectNode:function(e){var t=this.mTreeControl.get(e);if(!t)return!1;this.mTreeControl.select(t)},deselectNode:function(){this.mTreeControl.selected&&this.mTreeControl.select(!1,!0)},getSelectedNode:function(){return!!this.mTreeControl.selected&&this.mTreeControl.selected},getRootNode:function(){return this.mTreeControl.root},getSubRoot:function(e){return e.parent.id>0?this.getSubRoot(e.parent):e.parent},removeAll:function(){var e=this.getRootNode().nodes.length;for(i=0;i<e;i++)this.getRootNode().nodes[0]._remove()},deleteSelectedNode:function(){return!(!this.mTreeControl.selected||this.mTreeControl.selected.getLevel()<2)&&this.mTreeControl.selected.remove()},deleteNode:function(e){return!(!e||e.getLevel()<1)&&e.remove()},createTree:function(e){UXPStack.add("DPTreeView.createTree",[e]);var t;t="auto"===e.tree_bottom?e.tree_bottom:e.tree_bottom&&e.tree_bottom.toIntZero()>0?e.tree_bottom.toIntZero():0;var o=new MooTools.Element("div",{class:"TreeView",styles:{bottom:t,position:e.tree_position||"absolute",width:e.tree_width||"100%",height:e.tree_height||"100%",overflow:e.tree_overflow||"visible",top:e.tree_top&&0!=e.tree_top.toIntZero()?e.tree_top.toIntZero():0,left:e.tree_left&&0!=e.tree_left.toIntZero()?e.tree_left.toIntZero():0,right:e.tree_right&&0!=e.tree_right.toIntZero()?e.tree_right.toIntZero():0}}).injectInside(this.mContainer||this.mDSWindow.mContentElement);this.mTreeControl=new MooTreeControl({div:o,mode:"files",grid:!0,draggable:e.draggable,theme:"/mp/MooTreeControl/mootree.png",onAddComponent:e.onAddComponent,onReplace:e.onNodeDrop,nodeOptions:MooTools.$defined(e.root)?e.root:{text:"",open:!0}})},hideTree:function(){this.mTreeControl.div.setStyle("visibility","hidden")},showTree:function(){this.mTreeControl.div.setStyle("visibility","visible")},isTreeVisible:function(){return"visible"==this.mTreeControl.div.getStyle("visibility")},remove:function(){this.mTreeControl.remove(),this.mTreeControl=null},addNotes:function(e){new MooTools.Hash(e).each(function(e,t){var o=e.id_page;dpManager.dpPageInspector.mVersionIndex[e.id_page]&&dpManager.dpPageInspector.mVersionIndex[e.id_page][0]&&(o=dpManager.dpPageInspector.mVersionIndex[e.id_page][0]),this.addNote(o,e.email),this.mPagesNotes.set(o,!0)}.bind(this))},addNote:function(e,t){if(!e)return!1;this.setNodeIcon(e,t)},removeNotes:function(e,t){this.mPagesNotes.each(function(e,t){this.setNodeIcon(t)}.bind(this)),this.mPagesNotes.empty()},getNotes:function(e){return!!this.mPagesNotes.get(e)&&this.getNode(e).divs.icon.retrieve("tip:title")},setNodeIcon:function(e,t){var o=this.getNode(e);if(!o)return!0;var n,i=o.divs.icon;if(t){if(this.mNoteEl[i])return this.mNoteEl[i].setText(this.mNoteEl[i].getText()+", "+t),!0;this.mNoteEl[i]=new DPToolTip({relative:{element:i,position:"leftBottom",edge:"leftTop"},arrow:{position:"topLeft",edge:"topRight"},klass:"info-tip-bottom"}),this.mNoteEl[i].setText("also editing: "+t),n="components"==o.parent.id?19:18}else this.mNoteEl[i]&&this.mNoteEl[i].destroy(),this.mNoteEl[i]=null,n="components"==o.parent.id?17:11;o.getImg("/mp/MooTreeControl/mootree.png#"+n,i)}});
function _defineProperty(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var MooTreeIcon=["I","L","Lminus","Lplus","Rminus","Rplus","T","Tminus","Tplus","_closed","_doc","_open","minus","plus"],MooTreeControl=new MooTools.Class({name:"MooTreeControl",Implements:[MooTools.Options,MooTools.Events],options:{onExpand:MooTools.$empty,onSelect:MooTools.$empty,onClick:MooTools.$empty,onReplace:MooTools.$empty,onAddComponent:MooTools.$empty,onNodeDrop:MooTools.$empty,theme:"mootree.png",draggable:!1},initialize:function(t){UXPStack.add("MooTreeControl.initialize",[t]),this.setOptions(t);var t=this.options;this.div=$(this.options.div);var e=MooTools.$extend(t.nodeOptions,{div:this.div});this.root=new MooTreeNode(e,this),this.root.addInTree(),this.index={},this.enabled=!0,!0===t.draggable&&this.DDinit(),this.theme=t.theme,this.loader=t.loader||{icon:"mootree_loader.gif",text:"Loading...",color:"#a0a0a0"},this.selected=null,this.mode=t.mode,this.grid=t.grid,this.root.update(!0)},select:function(t,e){!0!==e&&(this.fireEvent("onClick",[t]),t.fireEvent("onClick")),this.selected!==t&&(this.selected&&(this.selected.select(!1),!0!==e&&this.fireEvent("onSelect",[this.selected,!1])),this.selected=t,!1!==t&&t.select(!0,e),!0!==e&&this.fireEvent("onSelect",[t,!0]))},expand:function(){this.root.toggle(!0,!0)},collapse:function(){this.root.toggle(!0,!1)},get:function(t){return this.index[t]||null},adopt:function(t,e){void 0===e&&(e=this.root),this.disable(),this._adopt(t,e),e.update(!0),$(t).destroy(),this.enable()},_adopt:function(t,e){$(t).getChildren().each(function(t){if("li"!=t.get("tag"))return!1;var i={text:""},s="",o=[];t.getChildren().each(function(t){switch(t.get("tag")){case"a":$A(t.childNodes).each(function(t){switch(t.nodeName){case"#text":i.text+=t.nodeValue;break;case"#comment":s+=t.nodeValue}}),i.data=t.getProperties("href","target","title","name");break;case"ul":o.push(t)}}),i.data.url=i.data.href,""!=s&&s.split(";").each(function(t){var e=t.split(":");2==e.length&&(i[e[0].trim()]=e[1].trim())});var n=e.insert(i);o.length&&o.each(function(t){this._adopt(t,n)}.bind(this))}.bind(this))},disable:function(){this.enabled=!1},enable:function(){this.enabled=!0,this.root.update(!0,!0)},keyNavigation:function(){this.div.addEvent("keydown",function(t){var t=new MooTools.Event(t);if(!this.scrolled){if(this.selected){var e=this.selected;switch(t.key){case"down":this.goForward(e);break;case"up":this.goBack(e);break;case"left":this.goLeft(e);break;case"right":this.goRight(e)}}else this.select(this.root);this.chkOverflow()}t.stop()}.bind(this))},goForward:function(t){var e=t.getForward();e&&this.select(e)},goBack:function(t){var e=t.getBack();e&&this.select(e)},goLeft:function(t){if(t.isRoot()){if(!t.open)return!1;t.toggle(!1)}else{if(!t.nodes.length||!t.open)return this.select(t.parent);t.toggle(!1)}},goRight:function(t){return!!t.nodes.length&&(t.open?this.select(t.getFirst()):t.toggle(!1))},setSortedNodes:function(t){t||(t=this.root,this.sort_order={}),t.nodes.each(function(t){this.sort_order[t.id+" "]=t.parent.id,this.setSortedNodes(t)},this)},getSortedNodes:function(){return this.setSortedNodes(),this.sort_order},setFlatTree:function(t){t.nodes.each(function(t){this.flat_tree.push(t),this.setFlatTree(t)},this)},getFlatTree:function(t){var e=null;return this.flat_tree=[],e=t&&this.get(t)?this.get(t):this.root,this.setFlatTree(e),this.flat_tree},replace:function(t,e,i){t.replaceTo(e,i)&&this.fireEvent("onReplace",[t,e,i])},chkOverflow:function(){return},initGarbageCollector:function(){this.GarbageCollector=[],window.addListener("beforeunload",function(){window.addListener("unload",function(){this.GarbageCollector.each(function(t){t.treeNode=null})}.bind(this))}.bind(this))},DDinit:function(){this.mouse={down:!1,drag:!1},this.DDnotAllowed=[],this.DDinjectEvents(),dpManager||(this.DDEvents(),this.DDfixUp())},DDEvents:function(){this.div.addEvents({mousedown:this.DDdownEvent.bindWithEvent(this),mouseup:this.DDupEvent.bind(this)}),document.addEvent("mousemove",this.DDmoveEvent.bindWithEvent(this))},DDdownEvent:function(t){var t=new MooTools.Event(t),e=this.DDfindNode(t.target);e&&!1!==e.treeNode.options.draggable&&(this.DDworkbenchDroppable=e.treeNode.options.workbenchDroppable||!1,this.mouse.down=!0,t.stop())},DDupEvent:function(){this.mouse.down&&this.mouse.drag&&(this.DDghost&&this.DDghost.destroy&&this.DDghost.destroy(),this.DDclean(),this.DDexternalUp?this.DDexternalUp=!1:this.DDreplace(),!0===this.DDAddComponent&&!0===this.DDworkbenchDroppable?this.fireEvent("onAddComponent",[this.DDnode,this.mouse.x,this.mouse.y]):"notAllowed"!=this.DDinject[0]&&this.fireEvent("onNodeDrop")),this.DDworkbenchDroppable=!1,this.DDAddComponent=!1,this.mouse.down=!1,this.mouse.drag=!1},DDmoveEvent:function(t){if(this.mouse.x=t.page.x,this.mouse.y=t.page.y,!this.mouse.down)return!0;var t=new MooTools.Event(t);this.mouse.drag||this.DDaddGhost(t);var e=this.DDfindNode(t.target);if(!e)return!0;e.treeNode.open=!0,this.scrolled||this.chkOverflow(),this.DDgetDropPlace(t)},DDfixUp:function(){document.addEvent("mouseup",function(){this.mouse.down&&this.mouse.drag&&(this.DDexternalUp=!0,this.div.fireEvent("mouseup"))}.bind(this))},DDinjectEvents:function(){["After","Before","Inside","NotAllowed"].each(function(t){this.addEvent("onDDinject"+t,this.DDinjectEvent.bind(this))}.bind(this))},DDinjectEvent:function(t,e){if(!0===this.DDworkbenchDroppable&&(t="notAllowed"),![t,e].eq(this.DDinject))switch(this.DDclean(),this.DDinject=[t,e],t){case"before":case"after":var i="after"==t?"bottom":"top";this.DDinjector=new MooTools.Element("div",{styles:{position:"absolute",left:0,width:18,height:0,"border-top":"solid 2px #888",overflow:"hidden",cursor:"default","z-index":100}}).setStyle(i,0).injectInside(this.DDinject[1]);break;case"inside":var s=e.getLast();this.DDinside=s;var o=e.treeNode;o.options.last_node||s.setStyle("background-color","#DDD"),o.open||this.DDopenTimer||(e.setStyle("cursor","progress"),s.setStyle("cursor","progress"),this.DDopenTimer=function(t){t.toggle(!1,!0),this.DDopenTimer=!1,this.DDinside.setStyle("cursor","default"),this.DDinside.getParent().setStyle("cursor","default")}.delay(600,this,[o]));break;case"notAllowed":this.DDnotAllowed.push(e),this.DDnotAllowed.push(e.getLast()),e.oldCursor||(e.oldCursor=e.getStyle("cursor")),e.setStyle("cursor","default"),e.getLast().oldCursor||(e.getLast().oldCursor=e.getLast().getStyle("cursor")),e.getLast().setStyle("cursor","default")}},DDclean:function(){if(this.DDinside&&(this.DDinside.setStyles({border:"none","background-color":"transparent",cursor:"default"}),this.DDinside=!1),this.DDnotAllowed.length>0&&(this.DDnotAllowed.each(function(t){t.setStyle("cursor",t.oldCursor)}),this.DDnotAllowed=[]),this.DDinjector){try{this.DDinjector.destroy()}catch(t){}this.DDinjector=!1}this.DDopenTimer&&(MooTools.$clear(this.DDopenTimer),this.DDopenTimer=!1)},DDfindNode:function(t){if("body"==t.get("tag"))return!1;do{if("body"==t.get("tag"))return!1;if(!0===this.DDworkbenchDroppable&&"WorkBench"==t.getProperty("id"))return this.DDAddComponent=!0,!1;if(t.treeNode)return t}while(t=t.getParent())},DDaddGhost:function(t){if(!this.selected)return!1;var e=this.DDfindNode(t.target);if(e){this.DDnode=e.treeNode;var i=e.clone(!0).injectInside($(document.body)).setStyles({position:"absolute",left:t.page.x+20,top:t.page.y+20,opacity:.85,"background-color":"#FFF",width:e.getFirst().offsetWidth+e.getLast().offsetWidth,height:e.offsetHeight,"z-index":1e4});i.makeDraggable({onComplete:function(){var t=this.element;if(t)try{t.destroy()}catch(t){}}}).start(t),this.DDghost=i}this.mouse.drag=!0},DDgetDropPlace:function(t){if(this.selected){var e=this.DDfindNode(t.target);if(e){this.DDtargetNode=e.treeNode;var i=e.offsetHeight,s=e.getPosition([this.div]).y,o=s+i;t.page.y-s<.25*i&&!this.DDtargetNode.isRoot()&&!1!==this.DDtargetNode.options.allow_drop_sort&&!this.DDnode.contain(this.DDtargetNode)?this.fireEvent("onDDinjectBefore",["before",e]):o-t.page.y<.25*i&&!this.DDtargetNode.isRoot()&&!1!==this.DDtargetNode.options.allow_drop_sort&&!this.DDnode.contain(this.DDtargetNode)?this.fireEvent("onDDinjectAfter",["after",e]):"file"==this.DDtargetNode.options.DDtype||this.DDtargetNode.isRoot()&&(t.page.y-s<.25*i||o-t.page.y<.25*i)||this.DDnode.contain(this.DDtargetNode)?this.fireEvent("onDDinjectNotAllowed",["notAllowed",e]):!1===this.DDtargetNode.options.allow_drop?this.fireEvent("onDDinjectNotAllowed",["notAllowed",e]):this.fireEvent("onDDinjectInside",["inside",e])}else this.DDclean(),this.DDinject=null}},DDreplace:function(){if(this.DDtargetNode&&this.DDnode&&this.DDinject){if("notAllowed"==this.DDinject[0])return;this.DDtargetNode.options.last_node&&(this.DDtargetNode=this.DDtargetNode.getPrevious(),this.DDinject[1]=this.DDtargetNode.divs.node),this.replace(this.DDnode,this.DDtargetNode,this.DDinject[0]),this.DDtargetNode=!1,this.DDnode=!1}},remove:function(){this.selected=null,this.root.nodes.empty(),this.options.div.destroy(),this.options.div=null;for(var t in this.root.divs)this.root.divs[t].destroy();this.root.divs=null,this.div.destroy(),this.div=null,this.options=null}}),MooTreeNode=new MooTools.Class({name:"MooTreeNode",Implements:[MooTools.Options,MooTools.Events],options:{onExpand:MooTools.$empty,onSelect:MooTools.$empty,onClick:MooTools.$empty,hide_tree_icon:!1,class_name:null,selectable:!0,last_node:!1},initialize:function(t,e){var i;UXPStack.add("MooTreeNode.initialize",[t,e]),this.setOptions(t);var t=this.options;this.text=t.text,this.id=t.id||null,this.nodes=new MooTools.Array,this.parent=null,this.control=e,this.selected=!1,this.color=t.color||null,this.data=t.data||{},this.open=!!t.open,this.icon=t.icon,this.openicon=t.openicon||this.icon,this.id&&(this.control.index[this.id]=this),this.divs={main:new MooTools.Element("div").addClass("mooTree_node").setStyle("position","relative"),indent:new MooTools.Element("div").setStyle("position","absolute"),gadget:new MooTools.Element("div"),node:new MooTools.Element("div"),icon:new MooTools.Element("div"),text:new MooTools.Element("div").addClass("mooTree_text"),sub:new MooTools.Element("div")},this.options.class_name&&this.divs.main.addClass(this.options.class_name),this.divs.main.adopt([this.divs.indent,this.divs.gadget,this.divs.node.setStyles((i={position:"relative",width:"auto !important"},_defineProperty(i,"width","1px"),_defineProperty(i,"min-width","1px"),i)).adopt([this.divs.icon,this.divs.text])]),this.divs.node.treeNode=this,dpManager||(this.divs.gadget.addEvent("click",this.toggle.bind(this)),this.divs.node.addEvent("click",function(){this.options.selectable?this.control.select(this):this.fireEvent("click")}.bind(this)))},addInTree:function(){if(!this.options.div)return UXPStack.error("this.options.div is empty in MooTreeNode"),!1;$(this.options.div).adopt([this.divs.main,this.divs.sub]),this.$added=!0},insert:function(t,e){t.div=this.divs.sub;var i=new MooTreeNode(t,this.control);i.addInTree(),i.parent=this;var s=this.nodes;return s.push(i),!1!==e&&(i.update(),1==s.length?this.update():s.length>1&&s[s.length-2].update(!0)),i},isLast:function(){return null==this.parent||this.parent.nodes.getLast()==this},isFirst:function(){return null==this.parent||this.parent.nodes[0]==this},isRoot:function(){return null==this.parent},childOrder:function(){return this.isRoot()?0:this.parent.nodes.indexOf(this)},getNext:function(){return this.isLast()?null:this.parent.nodes[this.childOrder()+1]},getPrevious:function(){return this.isFirst()?null:this.parent.nodes[this.childOrder()-1]},getFirst:function(){return 0==this.nodes.length?null:this.nodes[0]},getLast:function(){return 0==this.nodes.length?null:this.nodes.getLast()},getLevel:function(){var t=this,e=0;do{if(t.isRoot())return this.currentLevel=e,e;e++}while(t=t.parent)},getForward:function(){var t=this;return t.isRoot()?!(!t.open||0==t.nodes.length)&&t.getFirst():t.getFirst()&&t.open?t.getFirst():function(t){return t.getNext()?t.getNext():t.isRoot()?null:arguments.callee(t.parent)}(t)},getBack:function(){var t=this;if(t.isRoot())return!1;if(t.getPrevious()){for(t=t.getPrevious();t.open&&t.getLast();)t=t.getLast();return t}return t.parent},copy:function(t){var e=new MooTreeNode(this.options,this.control);return t?(this.nodes.each(function(t){var i=t.copy(!0);i.parent=e,i.options.div=i.parent.divs.sub,e.nodes.push(i)}.bind(this)),e):e},injectInside:function(t){this.parent=t,this.options.div=t.divs.sub,this.addInTree();var e=t.nodes;return e.push(this),this.update(!0),1==e.length?t.update():e.length>1&&e[e.length-2].update(!0),this},injectBefore:function(t){if(this.parent=t.parent,this.parent){this.options.div=t.parent.divs.sub,this.divs.sub.injectBefore(t.divs.main),this.divs.main.injectBefore(this.divs.sub),this.$added=!0;var e=t.parent.nodes;e.injectBefore(t,this),this.update(!0);var i=e.indexOf(this);return i>0&&e[i-1].update(!0),i<e.length-1&&e[i+1].update(!0),this}},injectAfter:function(t){if(this.parent=t.parent,this.parent){this.options.div=t.parent.divs.sub,this.divs.main.injectAfter(t.divs.sub),this.divs.sub.injectAfter(this.divs.main),this.$added=!0;var e=t.parent.nodes;e.injectAfter(t,this),this.update(!0);var i=e.indexOf(this);return i>0&&e[i-1].update(!0),i<e.length-1&&e[i+1].update(!0),this}},injectTop:function(t){},replaceTo:function(t,e,i){if(!["after","before","inside"].contains(e))return!1;var s=this.parent,o=this.getPrevious();this.getNext();switch(e){case"after":if(t.getNext()&&t.getNext()==this)return!1;this.divs.main.injectAfter(t.divs.sub),this.divs.sub.injectAfter(this.divs.main),this.parent.nodes.erase(this),this.parent=t.parent,this.parent.nodes.injectAfter(t,this);break;case"before":if(t.getPrevious()&&t.getPrevious()==this)return!1;this.divs.sub.injectBefore(t.divs.main),this.divs.main.injectBefore(this.divs.sub),this.parent.nodes.erase(this),this.parent=t.parent,this.parent.nodes.injectBefore(t,this);break;case"inside":if(t.getLast()&&t.getLast()==this)return!1;this.divs.main.injectInside(t.divs.sub),this.divs.sub.injectAfter(this.divs.main),this.parent.nodes.erase(this),this.parent=t,this.parent.nodes.push(this)}o&&o.update(!0),s&&!s.getFirst()&&s.update(),this.update(!0);var n=this.getPrevious();n&&n.update(!0);var r=this.getNext();return r&&r.update(),this.parent.update(),i?this:(this.control.select(this),this)},contain:function(t){if(this==t)return!0;for(var e=this.nodes,i=0,s=e.length;i<s;i++)if(e[i].contain(t))return!0;return!1},remove:function(){var t=this.parent;this._remove(),t.update(!0)},_remove:function(){for(var t=this.nodes;t.length;)t[t.length-1]._remove();if(delete this.control.index[this.id],this.divs.main.destroy(),this.divs.sub.destroy(),this.parent){this.parent.nodes.erase(this)}},clear:function(){for(this.control.disable();this.nodes.length;)this.nodes[this.nodes.length-1].empty();this.control.enable()},update:function(t){if(this.control.enabled){var e=this.getLevel();this.updateIndent(e),this.updateGadget(e),this.updateShowHide(),this.updateNode(e),this.updateIcon(e),this.updateText(),t&&this.nodes.each(function(t){t.$added||t.addInTree(),t.update(t.open)})}},updateIndent:function(t){if(void 0==t)var t=this.getLevel();this.divs.indent.empty();for(var e=this,i=[];e=e.parent;)i.push(this.getImg(e.isLast()||!this.control.grid?"":"I"));for(var s=0;s<t;s++)i[s].setStyles({position:"absolute",width:18,height:18,top:0,left:18*(t-s-1)}),this.divs.indent.adopt(i[s])},updateGadget:function(t){if(void 0==t)var t=this.getLevel();this.divs.gadget.setStyles({position:"absolute",top:0,width:18,height:18,left:18*t}),this.divs.gadget.empty(),this.getImg((this.control.grid?this.control.root==this?this.nodes.length?"R":"":this.isLast()?"L":"T":"")+(this.nodes.length?this.open?"minus":"plus":""),this.divs.gadget)},updateNode:function(t){if(void 0==t)var t=this.getLevel();this.divs.node.style.left.toInt()!==18*(t+1)&&this.divs.node.setStyles({height:18,left:18*(t+1)})},updateIcon:function(t){var e=this.divs.icon.style.backgroundPosition;if(e&&"none"!=e&&(e=e.match(/(\d+)/g),324==e[0]||306==e[0]))return!0;"absolute"!==this.divs.icon.style.position?this.divs.icon.setStyles({position:"absolute",top:0,width:18,height:18,left:0}):this.divs.icon.empty(),this.getImg(this.nodes.length?this.open?this.openicon||this.icon||"_open":this.icon||"_closed":this.icon||("folders"==this.control.mode?"_closed":"_doc"),this.divs.icon)},updateText:function(){"absolute"!==this.divs.text.style.position?(this.divs.text.setStyles({position:"absolute",height:18,left:18,padding:0,margin:0}),this.divs.textsub=new MooTools.Element("div").setStyles({position:"relative","white-space":"nowrap",bottom:-3,height:"100%",color:this.color}).appendText(this.text),this.divs.text.adopt(this.divs.textsub)):this.divs.textsub.set("text",this.text)},updateShowHide:function(){this.divs.sub.style.display=this.open?"block":"none"},getImg:function(t,e){if(e=(e||new MooTools.Element("div")).addClass("mooTree_img"),""==t)return e;var i=this.control.theme,s=MooTreeIcon.indexOf(t);if(-1==s){var o=t.split("#");i=o[0],s=2==o.length?parseInt(o[1])-1:0}return e.style.backgroundPosition==="-"+18*s+"px 0px"?e:(this.options.hide_tree_icon||(e.style.backgroundImage="url("+i+")"),e.style.backgroundPosition="-"+18*s+"px 0px",e)},toggle:function(t,e){this.open=void 0===e?!this.open:e,this.$subUpdated?(this.updateGadget(),this.updateShowHide()):(this.update(!0),this.$subUpdated=!0),this.fireEvent("onExpand",this.open),this.control.fireEvent("onExpand",[this,this.open]),t&&this.nodes.each(function(t){t.toggle(!0,this.open)},this)},toggleParent:function(){this.toggle(!1,!0),this.parent&&this.parent.toggleParent()},select:function(t,e){this.selected=t,this.selected?this.divs.main.addClass("mooTree_selected"):this.divs.main.removeClass("mooTree_selected"),!0===t&&!0!==e&&this.fireEvent("onSelect",[t])},load:function(t,e,i){this.nodes.length||(this.toggle(!1,!0),this.clear(),this.insert(this.control.loader),function(){new XHR({method:"GET",onSuccess:this._loaded.bind(this),onFailure:this._load_err.bind(this)}).send(t,e||"")}.delay(20,this))},_loaded:function(t,e){this.control.disable(),this.clear(),this._import(e.documentElement),this.control.enable()},_import:function(t){for(var e=t.childNodes,i=0;i<e.length;i++)if("node"==e[i].tagName){for(var s={data:{}},o=e[i].attributes,n=0;n<o.length;n++)switch(o[n].name){case"text":case"id":case"icon":case"openicon":case"color":case"open":s[o[n].name]=o[n].value;break;default:s.data[o[n].name]=o[n].value}var r=this.insert(s);r.data.load&&(r.open=!1,r.insert(this.control.loader),r.onExpand=function(t){this.load(this.data.load),this.onExpand=new MooTools.Function}),e[i].childNodes.length&&r._import(e[i])}},_load_err:function(t){window.alert("Error loading: "+this.text)}});MooTools.Array.implement({injectBefore:function(t,e){if(!this.contains(t))return!1;var i=this.slice(0,this.indexOf(t));i.push(e),this.slice(this.indexOf(t),this.length).each(function(t){i.push(t)}),this.splice(0,this.length),i.each(function(t){this.push(t)}.bind(this))},injectAfter:function(t,e){if(!this.contains(t))return!1;var i=this.slice(0,this.indexOf(t)+1);i.push(e),this.slice(this.indexOf(t)+1,this.length).each(function(t){i.push(t)}),this.splice(0,this.length),i.each(function(t){this.push(t)}.bind(this))},eq:function(t){if(!t)return!1;var e=this.length,i=t.length;if(!i||e!=i)return!1;for(var s=e-1;s>=0;s--)if(this[s]!=t[s])return!1;return!0}});
var DPAccountSettings=new MooTools.Class({name:"DPAccountSettings",mDefAvatarURL:window.location.protocol+"//"+window.location.host+"/p/default_avatar.png",initialize:function(){this.mUserAvatar=document.getElement("#account-edit-gravatar").get("src"),this.registerEvents(),this.initGravatar()},registerEvents:function(){editform_use_gravatar.addEvent("onChecked",this.enableGravatar.bind(this)),editform_use_gravatar.addEvent("onUnchecked",this.disableGravatar.bind(this)),editform_email.getDomElement().addEvent("mousedown",this.userTyping.bind(this)),editform_email.getDomElement().addEvent("keydown",this.userTyping.bind(this)),document.getElement("#account-edit-cancelbtn").addEvent("click",this.close.bind(this)),editform_editform.addEvent("valid",this.close.bind(this)),editform_editform.addEvent("invalid",this.hideLoader.bind(this)),document.getElement("#editform_upload_avatar").addEvent("change",function(){editform_upload_avatar.getValue()&&(editform_use_gravatar.setValue("0"),this.disableGravatar(),document.getElement("#account-edit-gravatar").set("src",this.mDefAvatarURL))}.bind(this)),document.getElement("#editform_button_submit").addEvent("click",function(){this.showLoader(),editform_editform.submit()}.bind(this)),document.getElement("#account-edit-gravatar").addEvent("load",this.hideLoader.bind(this)),document.getElement("#account-edit-change-password").addEvent("click",function(t){t.stop(),parent.dpManager.showChangePassword()}),document.getElement("#account_close").addEvent("click",function(t){t.stop(),parent.dpManager.showAccountClose()})},initGravatar:function(){editform_use_gravatar.getValue()>0&&this.enableGravatar()},enableGravatar:function(){var t=MD5(editform_email.getValue().toLowerCase()),e="?s=30&d="+encodeURI(this.mDefAvatarURL),a=document.getElement("#account-edit-gravatar").get("src");a!=this.mDefAvatarURL&&(this.mUserAvatar=a),document.getElement("#account-edit-gravatar").set("src","https://secure.gravatar.com/avatar/"+t+e),document.getElement("#editform_upload_avatar").set("value",""),this.showLoader()},disableGravatar:function(){document.getElement("#account-edit-gravatar").set("src",this.mUserAvatar)},showLoader:function(){parent.dpManager.mAccountSettingsWindow.ShowLoadIndicator(!0)},hideLoader:function(){parent.dpManager.mAccountSettingsWindow.HideLoadIndicator()},close:function(t){t&&t.stop(),parent.location.reload(!1),parent.dpManager.closeAccountSettings()},userTyping:function(){MooTools.$clear(this.mTimer1),this.mTimer1=this.initGravatar.delay(600,this)}});
!function(t){"use strict";var e=new MooTools.Class({name:"DPMainToolbar_InputMinMax",Implements:[MooTools.Events,MooTools.Options],mEl:null,mMin:null,mMax:null,mUpdateLock:!1,mTimer:null,mLastValue:null,options:{timerDelay:200,allowEmpty:!1},initialize:function(t,e,i,n){void 0!==t&&void 0!==i&&(this.mEl=t,this.mLastValue=this.getInputValue(),this.mMin=e||0,this.mMax=i,this.mEl.addEvent("blur",this.validateAndFireEvent.bind(this,!0)),this.mEl.addEvent("keydown",this.eChange.bind(this)),this.mEl.addEvent("mousewheel",this.mouseWheelChange.bind(this)),"number"===this.mEl.getProperty("type")&&this.mEl.addEvent("change",this.validateAndFireEvent.bind(this,!0)),this.setOptions(n))},isLocked:function(){return this.mUpdateLock},mouseWheelChange:function(t){this.isEnabled()&&(t.preventDefault(),t.wheel>0&&(this.mEl.value=this.mEl.value.toInt()+1),t.wheel<0&&(this.mEl.value=this.mEl.value.toInt()-1),this.validateAndFireEvent(!0))},eChange:function(t){var e=dpManager.dpShortcuts.getShortcut(t),i=["down","pagedown","up","pageup","shift+up","shift+down"],n=["ctrl+a","ctrl+c","ctrl+v","backspace","shift+home","shift+end","shift+left","shift+right","home","left","right","end","tab","shift+tab","-"];if(t.code!==Enums.KEYS.ENTER&&t.code!==Enums.KEYS.TAB||this.validateAndFireEvent(!0),t.code===Enums.KEYS.ENTER&&this.fireEvent("submit",[this.mLastValue]),t.code===Enums.KEYS.DELETE)return this.mEl.value="",void this.validateAndFireEvent(!0);if((t.code<48||t.code>57)&&(t.code<96||t.code>105)&&173!==t.code&&!n.concat(i).contains(e))return void t.preventDefault();if(t.code!==Enums.KEYS.BACKSPACE){if(this.mLastValue=this.mEl.value||"",this.mUpdateLock=!0,i.contains(e)){var s={up:1,down:-1,pageup:10,pagedown:-10,"shift+up":10,"shift+down":-10};return this.mEl.value=this.mEl.value.toIntZero()+s[e],this.validateAndFireEvent(!0),void t.preventDefault()}clearTimeout(this.mTimer),!1!==this.options.timerDelay&&(this.mTimer=this.validateAndFireEvent.delay(this.options.timerDelay,this,!1))}},setMinMax:function(t,e){this.mMin=t,this.mMax=e},getInputValue:function(){var t=this.mEl.value;return this.options.allowEmpty&&""===t||(t=this.mEl.value.toIntZero()||0),t},validateAndFireEvent:function(t){var e=this.getInputValue();null!==this.mMax&&this.mEl.value>this.mMax&&(e=this.mMax),this.mEl.value<this.mMin&&(""!==e||!this.options.allowEmpty)&&(e=this.mMin),t&&this.isEnabled()&&(this.mEl.value=e),t&&this.mLastValue!==e&&this.isEnabled()&&(this.fireEvent("onChange",[e]),this.mLastValue=e),this.mUpdateLock=!1},isEnabled:function(){return!this.mEl.get("disabled")}});t.DPMainToolbar_InputMinMax=e}(window);
!function(t){"use strict";var s=new MooTools.Class({name:"ToolsBoxControlCore",Implements:[MooTools.Options,MooTools.Events],options:{wrapperEl:"div",wrapperClass:"control-wrapper",elClass:null,label:null,defaultValue:null,disabled:!1,property:null},mActiveEl:null,mWrapperEl:null,initialize:function(t,s){return this.mActiveEl=t,this.setOptions(s),this.options.disabled&&(this.options.tooltip="Property is not available for this element"),this},getWrapperEl:function(){return this.mWrapperEl},renderWrapperEl:function(){if(this.options.wrapperEl?(this.mWrapperEl=document.createElement(this.options.wrapperEl),this.options.wrapperClass&&(this.mWrapperEl.className=this.options.wrapperClass)):this.mWrapperEl=document.createDocumentFragment(),this.options.label){var t=document.createElement("label");t.innerHTML=this.options.label,t.setAttribute("for",this.options.id),this.options.labelClass&&(t.className=this.options.labelClass),this.mWrapperEl.appendChild(t)}return this.mWrapperEl},render:function(){return this.options.disabled&&this.disabled(),this.mWrapperEl},getActiveEl:function(){return this.mActiveEl},getValue:function(t){return this.getActiveEl().getProperty(t)},disabled:function(){this.options.disabled=!0,this.mWrapperEl&&this.mWrapperEl.classList&&this.mWrapperEl.classList.add(this.disabledClass),this.mInputEl&&this.mInputEl.setAttribute("disabled","disabled")},enabled:function(){this.options.disabled=!1,this.mWrapperEl&&this.mWrapperEl.classList&&this.mWrapperEl.classList.remove(this.disabledClass),this.mInputEl&&this.mInputEl.removeAttribute("disabled")}});t.ToolsBoxControlCore=s}(window);
!function(o){"use strict";var t=new MooTools.Class({name:"ToolsBoxFormControlCore",Extends:ToolsBoxControlCore,options:{id:null,unit:null,tooltip:null},disabledClass:"inactive",initialize:function(){return this.parent.apply(this,arguments),this.options.id=this.options.id||"id-"+ +new Date+Math.round(1e3*Math.random()),this},renderAdditional:function(){if(this.options.tooltip){var o=document.createElement("small");o.className="tooltip small-style",o.innerHTML=this.options.tooltip,this.options.wrapperForAdditionalEl?(this.options.wrapperForAdditionalEl.dataset.showNode="tooltip",this.options.wrapperForAdditionalEl.appendChild(o)):(this.mWrapperEl.dataset&&(this.mWrapperEl.dataset.showNode="tooltip"),this.mWrapperEl.appendChild(o))}if(this.options.hint){var t=document.createElement("small");t.className="hint",t.innerHTML=this.options.hint,this.options.wrapperForAdditionalEl?this.options.wrapperForAdditionalEl.appendChild(t):this.mWrapperEl.appendChild(t)}}});o.ToolsBoxFormControlCore=t}(window);
!function(t){"use strict";var i={START:200,STOP:1200,RESET:2200},e=function(){var t=function(t){for(var i=t.offsetTop;t=t.offsetParent||t.parentElement;)i+=t.offsetTop;return i};return function(i,e){return i.contains(e)?t(e)-t(i):0}}(),s=function(t,i,e){var s=document.createElement("span");s.className=e.join(" "),s.textContent=i,t.appendChild(s)},n=new MooTools.Class({name:"ToolsBoxControlSelect",Extends:ToolsBoxFormControlCore,options:{defaultValue:"",placeholder:"Start typing",noResultsMessage:"Oops, we couldn't find anything.",customValue:!1,canBeEmpty:!1,fitContainer:!1,fitToElement:null,fitWidth:!1,highlightFirstOption:!1,search:!1,bottomMargin:null,beforeOpenCallback:null,openCallback:null,beforeCloseCallback:null,closeCallback:null,searchCallback:null,elClass:"hulk-select",listClass:"hulk-select-list",footerClass:"hulk-select-footer",footerContent:null,categoriesContent:null,unit:null,options:[{value:0,text:"Option-0"},{value:1,text:"Option-1"}],showPreview:!1,renderOption:function(t,i,e){var n,o=document.createElement("li");if(o.dataset.uid=i,t.newOption?o.classList.add("new-option"):t.group?o.classList.add("options-group"):t.info_block&&(o.classList.add("info-block"),"string"==typeof t.info_block&&o.classList.add(t.info_block)),t.disabled&&o.classList.add("inactive"),t.element?o.appendChild(t.element):t.html?o.innerHTML=t.html:t.text&&(t.group?s(o,t.text,["lines-on-side"]):t.iconClass?s(o,t.text,["only-icon-font",t.iconClass]):s(o,t.text,["hulk-label"])),t.addAction&&(e[o.dataset.uid]=function(i){i.stopPropagation(),n.classList.add("disabled"),t.addAction(i)},n=document.createElement("a"),n.classList.add("additional-action-icon","add-font","icon-general-add-circle","only-icon-font","aside-text"),n.innerHTML="Add font",n.href="#add-font",n.setAttribute("title",t.addActionTitle),n.addEventListener("click",e[o.dataset.uid]),t.addActionDisabled&&n.classList.add("disabled"),o.classList.add("with-additional-icon"),o.appendChild(n)),t.asideText){o.classList.add("with-aside-text");var a=document.createElement("small");a.classList.add("aside-text"),a.textContent=t.asideText,o.appendChild(a)}if(t.optionUnavailable){var a=document.createElement("span");a.className="error-indicator ds-icon--font__exclamation-mark",a.title=t.optionUnavailable,o.classList.add("with-error"),o.appendChild(a)}return t.className&&o.classList.add(t.className),o.setAttribute("data-value",t.value),o.setAttribute("data-index",i),o},onChange:function(){}},openTimeout:null,saveTimeout:null,mValue:null,mInputEl:null,mSelectContainer:null,mOptionsList:null,mOptionsListContainer:null,mFooter:null,mEventsRef:{},mSearching:!1,initialize:function(){this.parent.apply(this,arguments),this.mValue=this.options.defaultValue},set:function(t){this.mValue=t,this.refresh()},get:function(){return this.mValue},getValueBasedOnType:function(){return this.mInputEl.value},setValueBasedOnType:function(t){this.mInputEl.value=t},updateOptions:function(t){var i;this.options.options=t.map(function(t){return Object.assign({},t)}),this.mSearching?this.search({target:{value:this.getValueBasedOnType()}}):(this.refresh(),i=this.getSelectedOption()),this.isOpen()&&window.requestAnimationFrame(function(){this.updateSearchListContainerHeight()}.bind(this)),i&&(this.markOptionAsSelected(i),this.highlight(i),this.adjustLayerScroll(this.getOptionIndex(i))),this.isOpen()&&this.options.search&&!this.mSearching&&window.requestAnimationFrame(function(){this.mInputEl.select()}.bind(this))},render:function(){if(this.options.wrapperEl?(this.mWrapperEl=document.createElement(this.options.wrapperEl),this.options.wrapperClass&&(this.mWrapperEl.className=this.options.wrapperClass)):this.mWrapperEl=document.createDocumentFragment(),this.mSelectContainer=document.createElement("div"),this.mSelectContainer.className=this.options.elClass,this.options.label){var t=document.createElement("label");t.innerHTML=this.options.label,t.setAttribute("for",this.options.id),this.options.labelClass&&(t.className=this.options.labelClass),this.mWrapperEl.appendChild(t)}if(this.mInputEl=document.createElement("input"),this.mInputEl.id=this.options.id,this.options.btnLabel?(this.mInputEl.type="button",this.mInputEl.classList.add("hulk-select-placeholder")):(this.mInputEl.type="text",this.mInputEl.setAttribute("autocomplete","off"),this.mInputEl.setAttribute("autocorrect","off"),this.mInputEl.setAttribute("spellcheck",!1),this.options.search||this.options.customValue?this.mSelectContainer.classList.add("with-search"):this.mInputEl.setAttribute("readonly","readonly"),this.options.placeholder&&this.mInputEl.setAttribute("placeholder",this.options.placeholder)),this.options.inputClass&&(this.mInputEl.className=this.options.inputClass),this.options.unit){var i=document.createElement("div"),e=document.createElement("span");i.className="unit-inside",e.className="unit",e.innerHTML=this.options.unit,i.appendChild(this.mInputEl),i.appendChild(e),this.mSelectContainer.appendChild(i)}else this.mSelectContainer.appendChild(this.mInputEl);if(this.mOptionsListContainer=document.createElement("div"),this.mOptionsListContainer.className=this.options.listClass,this.mOptionsList=document.createElement("ul"),this.mOptionsList.className="scroll-container",this.mOptionsListContainer.appendChild(this.mOptionsList),this.options.categoriesContent&&(this.options.categoriesContent.className="categories-container",this.mOptionsListContainer.insertBefore(this.options.categoriesContent,this.mOptionsList)),this.options.infoContainer&&(this.options.infoContainer.className="info-container",this.mOptionsListContainer.insertBefore(this.options.infoContainer,this.mOptionsList)),this.options.footerContent&&(this.mFooter=document.createElement("footer"),this.mFooter.className=this.options.footerClass,this.mFooter.appendChild(this.options.footerContent),this.mOptionsListContainer.appendChild(this.mFooter)),this.options.showPreview){var n=document.createElement("div"),o=document.createElement("div"),a=document.createElement("section"),l=document.createElement("section");n.className="preview-container",o.className="inside-helper",a.className="preview first",l.className="preview second",n.appendChild(o),o.appendChild(a),o.appendChild(l),this.previewEl=document.createElement("aside"),this.previewEl.className="hulk-preview",this.previewEl.appendChild(n),this.mOptionsListContainer.appendChild(this.previewEl)}if(this.attachEvents(),this.refresh(),this.mWrapperEl.appendChild(this.mSelectContainer),this.renderAdditional(),_.some(this.options.options,"iconClass")){var r=_.find(this.options.options,{value:this.options.defaultValue}),h=r.iconClass||"without-icon",p=["only-icon-font",h,"visual-select-wrapper"];s(this.mWrapperEl,this.options.defaultValue,p)}return this.parent()},renderOptionsList:function(t,i){var e=document.createDocumentFragment();t=_.sortBy(t,["showFirst"]),t.forEach(function(t,s){if(!t.hidden){t.selected=i&&t.value===i;var n=this.options.renderOption(t,s,this.mEventsRef.additionalActions);n.classList.contains("options-group")||n.classList.contains("info-block")||(n.addEventListener("mouseenter",this.mEventsRef.mouseOverOptionElement),n.addEventListener("mouseup",this.mEventsRef.optionElementClicked),n.addEventListener("mousedown",this.mEventsRef.optionElementMouseDown)),e.appendChild(n)}}.bind(this)),this.mOptionsList.innerHTML="",this.mOptionsList.appendChild(e),t.length||this.options.customValue?(this.mOptionsListContainer.removeAttribute("data-message"),this.mOptionsListContainer.classList.remove("no-results")):(this.mOptionsListContainer.setAttribute("data-message",this.options.noResultsMessage),this.mOptionsListContainer.classList.add("no-results"))},updateOptionsListContainer:function(){var t=this.getAvailableSpace();return this.getCurrentOptionsHeight()<t.bottom?void this.showListOnBottom(t.bottom):t.top>t.bottom?void this.showListOnTop(t.top):void this.showListOnBottom(t.bottom)},updateSearchListContainerHeight:function(){var t=this.mSelectContainer.getBoundingClientRect(),i=this.isListOnTop(),e=this.calculateSearchListHeight(i);this.setOptionsListContainerSize(t.width,e),i&&this.setOptionsListContainerPosition(t.left,t.top-e)},calculateSearchListHeight:function(t){var i=this.getAvailableSpace(),e=this.getCurrentOptionsHeight();return t?i.top>e?e:i.top:i.bottom>e?e:i.bottom},getCurrentOptionsHeight:function(){var t=this.mOptionsList.children,i=t.length,e=i?t[0].offsetHeight:0,s=window.getComputedStyle(this.mOptionsList,null),n=parseInt(s.getPropertyValue("padding-top"),10)+parseInt(s.getPropertyValue("padding-bottom"),10),o=this.mFooter?this.mFooter.clientHeight:0,a=this.options.infoContainer?this.options.infoContainer.clientHeight:0;return e*i+n+(this.options.categoriesContent?this.options.categoriesContent.clientHeight:0)+o+a},getAvailableSpace:function(){var t=this.mInputEl.getPosition(),i=this.mInputEl.clientHeight;return{top:t.y-10,bottom:window.innerHeight-(t.y+i+10)}},showListOnBottom:function(t){var i=this.mSelectContainer.getBoundingClientRect(),e=this.calculateOptionsListContainerHeight(t);this.removeOptionsOnTopClass(),this.setOptionsListContainerSize(i.width,e),this.setOptionsListContainerPosition(i.left,i.top+i.height)},showListOnTop:function(t){var i=this.mSelectContainer.getBoundingClientRect(),e=this.calculateOptionsListContainerHeight(t);this.addOptionsOnTopClass(),this.setOptionsListContainerSize(i.width,e),this.setOptionsListContainerPosition(i.left,i.top-e)},isListOnTop:function(){return this.mOptionsListContainer.classList.contains("options-on-top")},calculateOptionsListContainerHeight:function(t){var i=this.mOptionsList.scrollHeight,e=this.mFooter?this.mFooter.clientHeight:0,s=this.options.infoContainer?this.options.infoContainer.clientHeight:0,n=this.options.categoriesContent?this.options.categoriesContent.clientHeight:0,o=i+e+n+s;return o<t?o:t},addOptionsOnTopClass:function(){this.mSelectContainer.classList.add("options-on-top"),this.mOptionsListContainer.classList.add("options-on-top")},removeOptionsOnTopClass:function(){this.mSelectContainer.classList.remove("options-on-top"),this.mOptionsListContainer.classList.remove("options-on-top")},setOptionsListContainerSize:function(t,i){var t=this.options.fitWidth?"auto":t+"px";this.mOptionsListContainer.style.width=t,this.mOptionsListContainer.style.height=i+"px"},setOptionsListContainerPosition:function(t,i){this.mOptionsListContainer.style.left=t+"px",this.mOptionsListContainer.style.top=i+"px"},attachEventsOnOpen:function(){window.addEventListener("click",this.mEventsRef.clickOnWindow),window.addEventListener("mousedown",this.mEventsRef.mouseDownOnWindow),window.addEventListener("resize",this.mEventsRef.resizeOnWindow)},attachEvents:function(){this.mEventsRef.toggle=this.toggle.bind(this),this.mEventsRef.focusIn=this.focusIn.bind(this),this.mEventsRef.keyDown=this.keyDown.bind(this),this.mEventsRef.manualListScroll=this.manualListScroll.bind(this),this.mInputEl.addEventListener("click",this.mEventsRef.toggle),this.mInputEl.addEventListener("focus",this.mEventsRef.focusIn),this.mInputEl.addEventListener("keydown",this.mEventsRef.keyDown),this.mOptionsList.addEventListener("mousewheel",this.mEventsRef.manualListScroll),this.options.search=!!this.options.customValue||this.options.search,this.options.search&&(this.mEventsRef.search=this.search.bind(this),this.mEventsRef.blur=this.blur.bind(this),this.mInputEl.addEventListener("input",this.mEventsRef.search),this.mInputEl.addEventListener("blur",this.mEventsRef.blur)),this.options.customValue&&(this.mEventsRef.saveCustomValue=this.saveCustomValue.bind(this),this.mInputEl.addEventListener("input",this.mEventsRef.saveCustomValue)),this.mEventsRef.clickOnWindow=this.clickOnWindow.bind(this),this.mEventsRef.mouseDownOnWindow=this.mouseDownOnWindow.bind(this),this.mEventsRef.resizeOnWindow=this.close.bind(this),this.mEventsRef.mouseOverOptionElement=this.mouseOverOptionElement.bind(this),this.mEventsRef.optionElementClicked=this.optionElementClicked.bind(this),this.mEventsRef.optionElementMouseDown=this.optionElementMouseDown.bind(this),this.mEventsRef.additionalActions={}},saveCustomValue:function(){clearTimeout(this.saveTimeout),this.saveTimeout=setTimeout(function(){var t=_.find(this.options.options,{value:this.mInputEl.mValue});this.mValue=t?t.value:this.getValueBasedOnType(),this.fireEvent("change",[this.mValue])}.bind(this),100)},focusIn:function(){this.isOpen()||(this.openTimeout=setTimeout(this.open.bind(this),200))},clickOnWindow:function(t){var i=t.target;this.mOptionsList!==i&&this.mInputEl!==i&&(this.refresh(),this.close(t,!0))},toggle:function(){this.isOpen()?this.close():this.open()},beforeOpenCallback:function(){"function"==typeof this.options.beforeOpenCallback&&this.options.beforeOpenCallback()},openCallback:function(){if("function"==typeof this.options.openCallback){var t={height:parseInt(this.mOptionsListContainer.style.height,10),offset:this.mOptionsListContainer.offsetParent.offsetTop-this.mOptionsListContainer.offsetParent.offsetHeight};this.options.openCallback(t)}},beforeCloseCallback:function(){"function"==typeof this.options.beforeCloseCallback&&this.options.beforeCloseCallback()},closeCallback:function(t,i){"function"==typeof this.options.closeCallback&&this.options.closeCallback(t,i)},open:function(){if(!this.isOpen()){this.beforeOpenCallback(),this.insertOptionsListContainer(),this.fireEvent("open");var t=this.mInputEl.parentNode;this.options.unit&&(t=t.parentNode);var i=this.findParentWrapper(t);this.refresh(),i&&i.classList.add("active"),t.classList.add("active"),this.updateOptionsListContainer();var e=this.getSelectedOption();e&&(this.markOptionAsSelected(e),this.highlight(e),this.adjustLayerScroll(this.getOptionIndex(e))),this.options.highlightFirstOption&&this.highlightFirstOption(),this.options.search&&this.mInputEl.select(),this.openCallback(),this.attachEventsOnOpen()}},mouseDownOnWindow:function(t){this.isExternalEvent(t.target)&&(this.refresh(),this.close(t,!0))},isExternalEvent:function(t){return this.mInputEl!==t&&!this.hasParent(t,this.mOptionsListContainer)},shouldBlockScroll:function(t){return!this.hasParent(t,this.mOptionsList)},hasParent:function(t,i){for(var e=!1,s=t.parentNode;!e&&null!==s;)s===i?e=!0:s=s.parentNode;return e},close:function(t,i){this.beforeCloseCallback();var e=this.mInputEl.parentNode;if(e&&(this.openTimeout&&(clearTimeout(this.openTimeout),this.openTimeout=null),this.isOpen())){this.mSearching=!1,this.removeOptionsListContainer(),this.options.unit&&(e=e.parentNode);var s=this.findParentWrapper(e);s&&s.classList.remove("active"),e.classList.remove("active"),this.fireEvent("close"),this.mOptionsListContainer.style.removeProperty("height"),this.mSelectContainer.classList.remove("no-animation"),this.removeEventsOnOpen(),this.closeCallback(t,i),this.setPreviewClassName(),this.setHighlightFirstOption(!1)}},insertOptionsListContainer:function(){scrollService.disableScroll(this.shouldBlockScroll.bind(this)),this.isOpen()?document.body.insertBefore(this.mOptionsListContainer,document.getElementById("layout")):document.body.appendChild(this.mOptionsListContainer)},removeOptionsListContainer:function(){this.isOpen()&&(document.body.removeChild(this.mOptionsListContainer),scrollService.enableScroll())},findParentWrapper:function(t){var i=t;if(!t.classList.contains("control-wrapper"))for(;!i.classList.contains("control-wrapper");)if(!(i=i.parentNode)||!i.parentNode)return null;return i},isOpen:function(){var t=this.mInputEl.parentNode;return!!t&&(this.options.unit&&(t=t.parentNode),t&&t.classList.contains("active"))},setOptionsListOffset:function(t){var i,e,s,n,o,a;return _.defaults(t||{},{noAnimation:!1}).noAnimation&&this.mSelectContainer.classList.add("no-animation"),this.mSelectContainer.classList.remove("options-on-top"),this.mOptionsListContainer.style.removeProperty("height"),i=document.getElementById("trial-info")?145:120,e=this.mOptionsList.scrollHeight,s=this.mInputEl.getPosition(),n=Math.abs(s.y+this.mInputEl.clientHeight-window.innerHeight+10),o=s.y-=i,this.options.fitContainer||this.options.fitToElement?void this.setRelativeHeight():n>=e?void(this.mOptionsListContainer.style.height=e+"px"):(n>=o?a=n>e?e:n:(a=o>e?e:o,this.mSelectContainer.classList.add("options-on-top")),void(this.mOptionsListContainer.style.height=a+"px"))},setRelativeHeight:function(){var t=this.options.wrapperEl?this.mWrapperEl.parentNode:this.mSelectContainer.parentNode,i=this.options.fitToElement||t.parentNode,s=e(i,t),n=i.clientHeight-t.clientHeight-parseInt(i.getStyle("paddingTop"),10)-parseInt(i.getStyle("paddingBottom"),10)-s;if(this.options.bottomMargin&&(n-=this.options.bottomMargin),this.mOptionsList.scrollHeight<n)return void(this.mOptionsListContainer.style.height=this.mOptionsList.scrollHeight+"px");this.mOptionsListContainer.style.height=n+"px"},setHighlightFirstOption:function(t){this.options.highlightFirstOption=t},keyDown:function(t){if([9,13,27,38,40].indexOf(t.keyCode)>=0)switch(t.keyCode){case 40:this.move(1),t.preventDefault();break;case 38:this.move(-1),t.preventDefault();break;case 27:this.isOpen()&&t.stopPropagation(),t.preventDefault(),this.refresh(),this.close();break;case 13:t.preventDefault(),this.confirmChoice();break;case 9:this.isOpen()?t.preventDefault():this.confirmChoice()}},move:function(t){this.open();var i,e=this.mOptionsList.childNodes,s=this.getHighlightedOptionIndex(),n=s;do{n+=t,i=this.options.options[n]}while(n>=0&&n<e.length&&(i.disabled||i.group));n<0||n>e.length-1||(this.highlight(e[n]),this.adjustLayerScroll(n,t))},setOptionsListScrollTop:_.throttle(function(t){this.mOptionsList.scrollTop=t},16),manualListScroll:function(t){var i=this.getMouseEventDeltaScroll(t);i&&this.setOptionsListScrollTop(this.mOptionsList.scrollTop+30*(i<0?1:-1)),t.preventDefault()},getMouseEventDeltaScroll:function(t){return"number"==typeof t.deltaY?-t.deltaY:t.wheelDelta||-t.detail},adjustLayerScroll:function(t,i){if(!(t<0)){var e=this.mOptionsList.childNodes[0].clientHeight,s=this.mOptionsList.scrollHeight,n=Math.floor(s/e),o=Math.floor(this.mOptionsList.scrollTop/e);if(i)1===i&&t>=o+n?this.mOptionsList.scrollTop=(t-n+1)*e:t<o+1&&(this.mOptionsList.scrollTop=t*e);else{var a=Math.floor(n/2);t>n&&(this.mOptionsList.scrollTop=(t-a)*e)}}},mouseOverOptionElement:function(t){t.target.classList.contains("options-group")||this.highlight(t.target)},runAnimation:function(){this.previewEl.classList.remove("reset"),this.previewEl.classList.add("run")},stopAnimation:function(){this.previewEl.classList.remove("run")},resetAnimation:function(){this.previewEl.className="hulk-preview",this.previewEl.classList.add("reset")},setPreviewClassName:function(t){if(this.previewEl){var e=t||"none";clearTimeout(this.runAnimationTimeout),clearTimeout(this.stopAnimationTimeout),clearTimeout(this.resetAnimationTimeout),this.previewEl.className="hulk-preview",this.previewEl.classList.add("reset"),this.previewEl.classList.add(e),this.runAnimationTimeout=setTimeout(this.runAnimation.bind(this),i.START),this.stopAnimationTimeout=setTimeout(this.stopAnimation.bind(this),i.STOP),this.resetAnimationTimeout=setTimeout(this.resetAnimation.bind(this),i.RESET)}},optionElementClicked:function(t){var i=t.target;if(!(i.classList.contains("options-group")||i.classList.contains("info-block")||i.classList.contains("additional-action-icon"))){i.classList.contains("icon-font-warning")&&(i=i.parentElement);var e=i.querySelectorAll(".aside-text");for(_.forEach(e,function(t){t.remove()});!i.getAttribute("data-value")&&""!==i.getAttribute("data-value");)i=i.parentElement;this.close(),this.selectOption(i.getAttribute("data-value"),i.textContent,i)}},optionElementMouseDown:function(t){t.stopPropagation(),t.preventDefault()},selectOption:function(t,i,e){this.mValue=t,this.setValueBasedOnType(i),this.markOptionAsSelected(e),this.fireEvent("change",[t]),this.setPreviewClassName(t)},confirmChoice:function(){clearTimeout(this.saveTimeout);var t=this.getHighlightedOption(),i=null,e="";t?(i=t.getProperty("data-value"),e=t.textContent):this.options.customValue&&(i=this.getValueBasedOnType().trim(),e=i),i&&i!==this.mValue||this.options.canBeEmpty&&""===i?this.selectOption(i,e,t):this.refresh(),this.close()},refresh:function(){var t=this.getOptionText(this.mValue);!t&&this.options.customValue&&(t=this.mValue),this.setValueBasedOnType(t),this.renderOptionsList(this.options.options,t)},findInOptions:function(t){var i=_.find(this.options.options,{value:t});return i=i||_.find(this.options.options,{value:parseInt(t,10)}),i=i||_.find(this.options.options,{value:t+""})},getOptionText:function(t){var i=this.findInOptions(t);return i?i.text:null},getSelectedOption:function(){var t=isNaN(this.mValue)?this.mValue:parseInt(this.mValue,10),i=_.find(this.options.options,{value:t}),e=null;if(i){var s=this.mOptionsList.querySelectorAll('[data-value="'+i.value+'"]');e=s[s.length-1]}return e},getFirstOption:function(){return this.mOptionsList.firstChild},getOptionIndex:function(t){return parseInt(t.getAttribute("data-index"),10)},getHighlightedOption:function(){return this.mOptionsList.querySelector(".highlighted")},getHighlightedOptionIndex:function(){var t=this.getHighlightedOption();return t?parseInt(t.getAttribute("data-index"),10):-1},highlight:function(t){if(this.clearHighlight(),t.classList.add("highlighted"),this.fireEvent("hilight",[t]),this.previewEl){var i=t.getAttribute("data-value")||"";this.setPreviewClassName(i)}},highlightFirstOption:function(){var t=this.getFirstOption();t&&this.highlight(t)},clearHighlight:function(){var t=this.getHighlightedOption();t&&(t.classList.remove("highlighted"),this.fireEvent("clearHilight",[t]))},markOptionAsSelected:function(t){this.clearSelectedOption(),t.classList.add("selected")},clearSelectedOption:function(){var t=this.mOptionsList.querySelector(".selected");t&&t.classList.remove("selected")},blur:function(){this.mSearching=!1},search:function(t){var i=t.target.value.trim(),e=this.options.options,s=[],n={};this.mSearching=!0,e.forEach(function(t){if(t.text){var e=t.text+"",o=t.text+"_"+t.type;!n[o]&&e.match(new RegExp(_.escapeRegExp(i),"i"))&&(t.selected=!1,n[o]=!0,s.push(t))}}),this.options.customValue&&i&&!this.findInOptions(i)&&s.unshift({value:i,text:i,newOption:!0}),this.clearHighlight(),s[0]&&(s[0].selected=!0),this.open(),this.renderOptionsList(s),this.updateSearchListContainerHeight(),this.options.searchCallback&&this.options.searchCallback.call(),this.options.highlightFirstOption&&this.highlightFirstOption()},removeEventsOnOpen:function(){window.removeEventListener("click",this.mEventsRef.clickOnWindow),window.removeEventListener("mousedown",this.mEventsRef.mouseDownOnWindow),window.removeEventListener("resize",this.mEventsRef.resizeOnWindow)},removeEvents:function(){this.mInputEl.removeEventListener("click",this.mEventsRef.toggle),this.mInputEl.removeEventListener("focus",this.mEventsRef.focusIn),this.mInputEl.removeEventListener("keydown",this.mEventsRef.keyDown),this.mOptionsList.removeEventListener("mousewheel",this.mEventsRef.manualListScroll),this.options.search&&this.mInputEl.removeEventListener("input",this.mEventsRef.search),this.options.customValue&&this.mInputEl.removeEventListener("input",this.mEventsRef.saveCustomValue),this.removeEventsOnOpen(),_.forEach(this.mOptionsList.childNodes,function(t){var i=t.dataset.uid,e=t.querySelector("a.additional-action-icon");t.removeEventListener("mouseenter",this.mEventsRef.mouseOverOptionElement),t.removeEventListener("mouseup",this.mEventsRef.optionElementClicked),t.removeEventListener("mousedown",this.mEventsRef.optionElementMouseDown),this.mEventsRef.additionalActions[i]&&(e&&e.removeEventListener("click",this.mEventsRef.additionalActions[i]),this.mEventsRef.additionalActions[i]=null)}.bind(this))},destroy:function(){this.removeEvents(),this.mWrapperEl&&this.mWrapperEl.parentNode&&this.mWrapperEl.parentNode.removeChild(this.mWrapperEl),this.isOpen()&&this.removeOptionsListContainer()},enabled:function(){this.mInputEl.removeAttribute("readonly"),this.parent()},disabled:function(){this.mInputEl.setAttribute("readonly","readonly"),this.mSelectContainer.classList.add("disabled"),this.parent()}});t.ToolsBoxControlSelect=n}(window);
!function(n){"use strict";var o=function(){function n(n){return function(o){n(o.target)&&o.preventDefault()}}function o(o){window.onwheel=n(o),window.ontouchmove=n(o)}function e(){window.onwheel=null,window.ontouchmove=null}return{disableScroll:o,enableScroll:e}}();n.scrollService=o}(window);
var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(t){"use strict";var i=new MooTools.Class({name:"ToolsBoxPosition",Implements:[MooTools.Options],mPositionedEl:null,mRelativeEl:null,mWrapperEl:null,mElementOnAxisKit:null,mRelativeElOffset:{left:null,top:null,width:null,height:null},options:{prioritySide:"right",offset:{elementMargin:0,layerWidth:0,triggerWidth:0,layerTop:0,boundsMargin:0}},positionedElementWidth:null,initialize:function(t,i,e,o){this.mPositionedEl=t,this.mRelativeEl=i,this.mWrapperEl=e,this.setOptions(o),this.mElementOnAxisKit=new ElementOnAxisKit},setPosition:function(){this.mRelativeElOffset=this.mElementOnAxisKit.getRelativeToWorkbenchBoundingClientRect(this.mRelativeEl),this.clear(),this.horizontalBoxPosition[this.getAvailableHorizontalPosition(this.options.prioritySide)].call(this),this.verticalBoxPosition[this.getAvailableVerticalPosition()].call(this)},horizontalBoxPosition:{right:function(){this.mPositionedEl.style.left=this.mRelativeElOffset.width+this.mRelativeElOffset.left+this.options.offset.elementMargin+"px"},left:function(){this.mPositionedEl.style.left=this.mRelativeElOffset.left-this.getPositionedElementWidth()+"px",this.mPositionedEl.classList.add("tool-layer-on-left")},partialRight:function(){this.horizontalBoxPosition.right.call(this),this.mPositionedEl.classList.add("tool-layer-on-left"),this.mPositionedEl.classList.add("extra-offset")},innerRight:function(){var t=this.mRelativeElOffset.left+this.mRelativeElOffset.width-this.getPositionedElementWidth(),i=this.mWrapperEl.scrollLeft+this.mWrapperEl.clientWidth-this.getPositionedElementWidth();this.mPositionedEl.style.left=Math.min(t,i)+"px",this.mPositionedEl.classList.add("tool-layer-on-left")}},verticalBoxPosition:{top:function(){var t=this.mRelativeElOffset.top;this.mPositionedEl.style.top=t+"px",this.verticalBoxPosition.boundsAdjust.call(this,t)},middle:function(){var t=parseInt((this.mPositionedEl.clientHeight-this.mRelativeElOffset.height)/2,10),i=this.mRelativeElOffset.top-t;this.mPositionedEl.style.top=i+"px",this.verticalBoxPosition.boundsAdjust.call(this,i)},boundsAdjust:function(t){var i=this.mWrapperEl.scrollTop+this.options.offset.boundsMargin,e=this.mWrapperEl.scrollTop+this.mWrapperEl.clientHeight,o=e-this.mPositionedEl.clientHeight-this.options.offset.boundsMargin;t=t<i?i:t,t=t>o?o:t,"number"==typeof this.options.offset.boundMarginTop&&this.options.offset.boundMarginTop&&(t+=this.options.offset.boundMarginTop),this.mPositionedEl.style.top=t+"px"}},getAvailableHorizontalPosition:function(t){var i=this.getAvailableRightSpace(),e=this.getPositionedElementWidth(),o=e+this.options.offset.layerWidth;if("right"===t){if(this.checkHorizontalRight(i,o))return"right";if(this.checkHorizontalLeft(o))return"left"}else{if(this.checkHorizontalLeft(o))return"left";if(this.checkHorizontalRight(i,o))return"right"}return i>e?"partialRight":"innerRight"},checkHorizontalRight:function(t,i){return t>i},checkHorizontalLeft:function(t){if(this.getAvailableLeftSpace()>t)return"left"},getAvailableVerticalPosition:function(){var t=this.mPositionedEl.clientHeight;return this.mRelativeElOffset.height<t?"middle":"top"},getAvailableRightSpace:function(){return this.mWrapperEl.clientWidth+this.mWrapperEl.scrollLeft-0-(this.mRelativeElOffset.width+this.mRelativeElOffset.left)},getAvailableLeftSpace:function(){return this.mRelativeElOffset.left+this.mWrapperEl.scrollLeft},getPositionedElementWidth:function(){return this.mPositionedEl.clientWidth+this.options.offset.elementMargin},adjustLayerPositionToBounds:function(t,i){var e={animate:!1,forceHeight:!1,forceMinHeight:!1};i&&"object"==(void 0===i?"undefined":_typeof(i))&&(e=MooTools.$extend(e,i));var o=parseInt(t.style.top),s=!1!==e.forceHeight?e.forceHeight:t.clientHeight;!1!==e.forceMinHeight&&e.forceMinHeight>s&&(s=e.forceMinHeight),t.style.removeProperty("top");var l=t.getPosition(this.mWrapperEl).y,n=this.options.offset.layerTop,r=this.mWrapperEl.clientHeight+this.mWrapperEl.scrollTop,h=l+this.options.offset.boundsMargin+s-r;n=h>0?n-h:n;var a=this.mWrapperEl.scrollTop,f=l-a-this.options.offset.boundsMargin;n=f<0?n-f:n,e.animate?InteractionsAnimations.positionTop(t,n,300,"ease-out",o):t.style.top=n+"px"},clear:function(){this.mPositionedEl.classList.remove("tool-layer-on-left"),this.mPositionedEl.classList.remove("extra-offset"),this.mPositionedEl.style.removeProperty("right"),this.mPositionedEl.style.removeProperty("top")}});t.ToolsBoxPosition=i}(window);
var DPEditable=new MooTools.Class({name:"DPEditable",Implements:[MooTools.Events,MooTools.Options],mEl:null,mTextEl:null,mActiveEl:null,mStyles:["color","font-size","font-weight","font-style","font-family","text-decoration","text-align"],mIgnoreShortcuts:["ctrl+alt+c","ctrl+alt+e"],options:{br2nl:!0,nbsp2sp:!1,onEdit:MooTools.$empty,onExit:MooTools.$empty,direct_el:!1,make_selection:!0,styles_map:{},encode_on_exit:!0},initialize:function(t,e){this.mEl=t,this.mActiveEl=dpManager.dpWorkBench.getActivePage().getActiveElement(),this.setOptions(e)},enableEdit:function(){this.makeEditable(),this.attachEvents(),this.mIgnoreShortcuts.each(dpManager.dpShortcuts.ignoreShortcut.bind(dpManager.dpShortcuts))},attachEvents:function(){this.mEditedKeydownRef=function(t){if(this.fireEvent("edit",[t]),"esc"==t.key)return void this.exit(!0);("right"==t.key&&this.mTextEl.getCaretPosition()==this.mTextEl.value.length||"left"==t.key&&0==this.mTextEl.getCaretPosition())&&t.stop(),"ctrl+a"==dpManager.dpShortcuts.getShortcut(t)&&this.mTextEl.selectRange(0,this.mTextEl.value.length),this.options.direct_el||this.adjustHeight()}.bind(this),this.mEl.addEvent("keydown",this.mEditedKeydownRef)},makeEditable:function(){var t=he.decode(this.mEl.innerHTML),e=(this.mEl.getHeight(),this.mEl.getStyle("line-height"));this.options.br2nl&&(t=t.replace(/<br\s?\/?>/gi,"\n")),this.options.nbsp2sp&&(t=t.replace(/\&nbsp\;/gi," ")),this.options.direct_el?this.mTextEl=this.mEl:(this.mTextEl=new MooTools.Element("textarea",{text:t,class:"dpEditable",styles:{cursor:"text",width:"100%",height:e.toIntZero()+2,"line-height":e,margin:0,background:"transparent",border:"none","vertical-align":"middle",resize:"none",overflow:"hidden"}}),this.mEl.innerHTML="",this.mTextEl.inject(this.mEl),this.adjustHeight.delay(100,this),this.setStyles()),this.mTextEl.enableSelection("text"),this.focus()},getValue:function(){return this.mTextEl.value},adjustHeight:function(){var t=this.mTextEl.getHeight(),e=this.mTextEl.scrollHeight;e>t&&this.mTextEl.setStyle("height",e+"px")},focus:function(){(function(){this.mTextEl.focus(),this.options.make_selection?this.mTextEl.selectRange(0,this.mTextEl.value.length):this.mTextEl.setCaretPosition("end")}).bind(this).delay(100,this)},setStyles:function(){this.mStyles.each(function(t){this.mTextEl.setStyle(t,this.mActiveEl.getProperty(this.options.styles_map[t]||t))}.bind(this))},exit:function(t){t=!MooTools.$defined(t)||t,this.mEl.removeEvent("keydown",this.mEditedKeydownRef),this.mTextEl.disableSelection(),this.mTextEl.blur();var e=this.getValue();this.options.encode_on_exit&&(e=he.encode(e)),this.mEl.innerHTML=e,this.mIgnoreShortcuts.each(dpManager.dpShortcuts.unignoreShortcut.bind(dpManager.dpShortcuts)),t&&this.fireEvent("exit",[e])},destroy:function(){this.mEl=null,this.mTextEl=null}});
!function(e){function r(e,r,a,n){var t=0,E=0,T=!1;void 0!==r&&null!==r||(r=2),e=e.toString(),!1!==n&&(e=e.replace(/&/g,"&amp;")),e=e.replace(/</g,"&lt;").replace(/>/g,"&gt;");var c={ENT_NOQUOTES:0,ENT_HTML_QUOTE_SINGLE:1,ENT_HTML_QUOTE_DOUBLE:2,ENT_COMPAT:2,ENT_QUOTES:3,ENT_IGNORE:4};if(0===r&&(T=!0),"number"!=typeof r){for(r=[].concat(r),E=0;E<r.length;E++)0===c[r[E]]?T=!0:c[r[E]]&&(t|=c[r[E]]);r=t}return r&c.ENT_HTML_QUOTE_SINGLE&&(e=e.replace(/'/g,"&#039;")),T||(e=e.replace(/"/g,"&quot;")),e}function a(e,r){var a=0,n=0,t=!1;void 0===r&&(r=2),e=e.toString().replace(/&lt;/g,"<").replace(/&gt;/g,">");var E={ENT_NOQUOTES:0,ENT_HTML_QUOTE_SINGLE:1,ENT_HTML_QUOTE_DOUBLE:2,ENT_COMPAT:2,ENT_QUOTES:3,ENT_IGNORE:4};if(0===r&&(t=!0),"number"!=typeof r){for(r=[].concat(r),n=0;n<r.length;n++)0===E[r[n]]?t=!0:E[r[n]]&&(a|=E[r[n]]);r=a}return r&E.ENT_HTML_QUOTE_SINGLE&&(e=e.replace(/&#0*39;/g,"'")),t||(e=e.replace(/&quot;/g,'"')),e=e.replace(/&amp;/g,"&")}function n(e,r){return(e+"").replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,"$1"+(r||void 0===r?"<br />":"<br>")+"$2")}function t(e,r){r=(((r||"")+"").toLowerCase().match(/<[a-z][a-z0-9]*>/g)||[]).join("");var a=/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi,n=/<!--[\s\S]*?-->|<\?(?:php)?[\s\S]*?\?>/gi;return e.replace(n,"").replace(a,function(e,a){return r.indexOf("<"+a.toLowerCase()+">")>-1?e:""})}e.htmlspecialchars=r,e.htmlspecialchars_decode=a,e.nl2br=n,e.strip_tags=t}(window);
var LipsumGenerator=new MooTools.Class({name:"LipsumGenerator",mDictionary:["Lorem ipsum dolor sit amet","Aenean","Aliquam","Class","Cras","Cum","Curabitur","Curae","Donec","Duis","Etiam","Fusce","In","Integer","Lorem","Maecenas","Mauris","Morbi","Nam","Nulla","Nullam","Nunc","Pellentesque","Phasellus","Praesent","Proin","Quisque","Sed","Suspendisse","Ut","Vestibulum","Vivamus","a","ac","accumsan","ad","adipiscing","aliquam","aliquet","amet","ante","aptent","arcu","at","auctor","augue","bibendum","blandit","commodo","condimentum","congue","consectetuer","consequat","conubia","convallis","cubilia","cursus","dapibus","diam","dictum","dictumst","dignissim","dis","dolor","dui","egestas","eget","eleifend","elementum","elit","enim","erat","eros","est","et","eu","euismod","facilisi","facilisis","fames","faucibus","felis","fermentum","feugiat","fringilla","gravida","habitant","habitasse","hac","hendrerit","hymenaeos","iaculis","id","imperdiet","in","inceptos","interdum","ipsum","justo","lacinia","lacus","laoreet","lectus","leo","libero","ligula","litora","lobortis","lorem","luctus","magna","magnis","malesuada","massa","mattis","mauris","metus","mi","molestie","mollis","montes","morbi","mus","nascetur","natoque","nec","neque","netus","nibh","nisl","non","nonummy","nostra","nulla","nunc","odio","orci","ornare","parturient","pede","pellentesque","penatibus","per","pharetra","placerat","platea","porta","porttitor","posuere","pretium","primis","pulvinar","purus","quam","quis","rhoncus","ridiculus","risus","rutrum","sagittis","sapien","scelerisque","sed","sem","semper","senectus","sit","sociis","sociosqu","sodales","sollicitudin","suscipit","taciti","tellus","tempor","tempus","tincidunt","torquent","tortor","tristique","turpis","ullamcorper","ultrices","ultricies","urna","ut","varius","vehicula","vel","velit","venenatis","vestibulum","vitae","viverra","volutpat","vulputate","wisi"],generate:function(i,e,t){i=i||30,e=e||!1;for(var a,s="",u=t?1:0,r=0;r<i;r++)a=this.mDictionary[MooTools.$random(1,this.mDictionary.length-1)],1==u&&(a=a.capitalize()),0==r&&1==e&&(a=this.mDictionary[0]),u=0,t&&(Math.random()<.1&&r<this.mDictionary.length-1?a+=",":Math.random()<.15&&r<this.mDictionary.length-1?(a+=".",u=1):Math.random()<.08&&r<this.mDictionary.length-1&&(a+="!",u=1)),s+=a+" ";return s=s.trim(),t&&(s+="."),s}});
var hashuri=function(){var t,o={},n=MooTools.Array.prototype.map,r=MooTools.Array.prototype.forEach;r||(r=function(t){for(var o=0;o<this.length;o++)t(this[o],o)}),n||(n=function(t){var o=[];return r.call(this,function(n){o.push(t(n))}),o});var e=function(){var r;document.location.hash!=t&&(t=document.location.hash,r=t.replace(/^#\??/,""),o={},r&&n.call(r.split("&"),function(t){var n=t.split("=");o[n[0]]=n[1]?decodeURI(n[1]):null}))},a=function(t){var o,n=[];for(o in t)t.hasOwnProperty(o)&&n.push(o+"="+encodeURI(t[o]));return"#?"+n.join("&")},c=function(){document.location=a(o)};return e(),(window.attachEvent||window.addEventListener)("hashchange",e),{toUri:a,get:function(t){return o[t]},set:function(t,n){"[object Object]"==Object.prototype.toString.call(t)?o=t:void 0===n?delete o[t]:o[t]=n,c()}}}();
var DPSidebar_Widget=new MooTools.Class({name:"DPSidebar_Widget",Implements:[MooTools.Events,MooTools.Options],mSection:null,mSidebar:null,mEl:null,initialize:function(i,n){this.mSection=i,this.setOptions(n)},getSection:function(){return this.mSection},setSidebar:function(i){this.mSidebar=i},render:function(i){}});
var DPSidebar_Widget_FloatingToolbar=new MooTools.Class({name:"DPSidebar_Widget_FloatingToolbar",Implements:DPSidebar_Widget,mToolbarEl:null,mToolbarWidth:240,mToolbarName:null,mToggleShortcut:null,mOn:null,mCSidebarH:!1,renderToolbar:function(e){this.mToolbarEl=new MooTools.Element("div",{class:"sidebar-toolbar",styles:{width:this.mToolbarWidth}}).hide().inject(e),document.getElement("#trial-info")&&this.mToolbarEl.setStyle("top",75),void 0!==this.mToolbarName&&this.mToolbarEl.addClass(this.mToolbarName)},show:function(e){this.mOn=!0;var i=this.areOtherToolbarsActive(),t={animate:!0,resize_workbench:!i};MooTools.$extend(t,e||{}),this.mEl.addClass("active"),this.mToolbarEl.show(),this.fireEvent("show",[this,t]),t.resize_workbench&&(t.animate&&this.fireEvent("showAnimStart"),this.mSidebar.Resizer.resize({width:-this.mToolbarWidth,animate:t.animate,force:t.force||!1})),dpManager&&dpManager.dpPageInspector&&(dpManager.dpPageInspector.sidebarShown(),this.adjustToSitemap())},afterInit:function(){this.mToggleShortcut&&dpManager&&dpManager.dpShortcuts.addShortcut(this.mToggleShortcut,this.toggle.bind(this))},areOtherToolbarsActive:function(){return this.mSidebar.getItems().getValues().some(function(e){return e!==this&&!!(e instanceof DPSidebar_Widget_FloatingToolbar&&e.isToolbarVisible())}.bind(this))},hide:function(e){this.mOn=!1;var i={animate:!0,resize_workbench:!0};MooTools.$extend(i,e||{}),this.mEl.removeClass("active"),this.fireEvent("hide",[this,i]),i.resize_workbench?(i.animate&&this.fireEvent("hideAnimStart"),this.mSidebar.Resizer.addEvent("complete",function(){this.mToolbarEl.hide()}.bind(this)).resize({width:this.mToolbarWidth,animate:i.animate})):this.mToolbarEl.hide(),dpManager&&dpManager.dpPageInspector.sidebarWasHidden()},toggle:function(e){this.mSidebar.Resizer.isLocked()||(this.isToolbarVisible()?this.hide(e):this.show(e))},getToolbarEl:function(){return this.mToolbarEl},isToolbarVisible:function(){return this.mToolbarEl.isVisible()}});
!function(e){"use strict";var t=new MooTools.Class({name:"DPSidebar_Widget_Elements",Extends:DPSidebar_Widget_FloatingToolbar,mCategoryLabelEl:null,mSettingsButton:null,mCurrentCategory:null,mToolbarName:"elements",mSearch:null,mListEl:null,mDejax:null,mResizeRef:null,mSearchResultFilter:null,mLibrariesModal:null,mToggleShortcut:"ctrl+alt+e",mTooltipEl:'Elements <small><span class="cmd alt"> + e</span></small>',mPopup:null,mVisibleLibraries:null,options:{categories:[],list:null},initialize:function(e){this.mSection=e,this.mDejax=new Dejax,this.mResizeRef=this.resizeWrapper.bind(this),this.mSearchResultFilter=new UXPTheSearchElementsFilter,this.initVisibleLibraries(),this.addEvents({show:function(){this.resizeWrapper(),window.addEvent("resize",this.mResizeRef)}.bind(this),hide:function(){window.removeEvent("resize",this.mResizeRef)}.bind(this)}),this.addElementEvents(),dpManager.dpWorkBench.mToolbarRefs[this.mToolbarName]=this},initVisibleLibraries:function(){if(!dpManager.User.visible_libraries){var e;e=dpManager.User.libraries&&dpManager.User.libraries.length>0&&!dpManager.UserElements.isDesignLibrariesActive()?dpManager.User.libraries.concat(elementsData.categories):dpManager.elementsDataManager.mElementsData.categories;var t=e.map(function(e){return e.id_tree});dpManager.User.visible_libraries=t,(new Dejax).newRequest({url:"/ajax/dmsAdminUsers/SetVisibleLibraries/",mode:"cancel",data:{visible_libraries:t},onComplete:function(){dpManager.UserElements.broadcast("visibility-changed")}})}},render:function(e){this.mEl=new MooTools.Element("a",{href:"#","data-tooltip":"Elements library","data-show-node":"tooltip",text:"Elements",class:"icon-font-elements",events:{click:function(){var e=!1===dpManager.uxpPatterns.isActive();return this.toggle({animate:e}),!1}.bind(this)}}).inject(e),this.mEl.microjungle([["span",{class:"tooltip left-arrow"},this.mTooltipEl]]),this.renderToolbar(),this.loadCategory(),dpManager.UserElements.getAllShots(dpManager.User.elements,function(){dpManager.dpWorkBench.theSearch.updateTheSearchElements()}.bind(this)),this.attachEvents()},refreshCurrentLibrary:function(e){this.refreshLibraries(this.mCurrentCategory.id_category),e&&e.length>0&&this.animateElementAdded()},animateElementAdded:function(){this.mCategoriesSelect.mWrapperEl.classList.add("animate-added-element"),setTimeout(function(){this.mCategoriesSelect.mWrapperEl.classList.remove("animate-added-element")}.bind(this),1600)},renameElementInDOM:function(e,t){var i=this.mListEl.querySelector("#container-element-no-"+e);e&&t&&i&&(i.querySelector("span").innerHTML=t,i.querySelector("input").value=t)},deleteElementFromDOM:function(e,t){var i=this.mListEl.querySelector("#container-element-no-"+e.id_element);e.id_element&&i&&(i.parentNode.removeChild(i),this.mListEl.children.length||this.mListEl.appendChild(this.generateNoElementsInfo()),"sidebar"===t&&this.showUndoElementRemoveBox(e))},generateLibrariesList:function(){return this.mVisibleLibraries=t.generateRawLibList(this.options.categories),t.getLibraryHulkSelect(this.mVisibleLibraries)},refreshLibraries:function(e){var t=document.querySelector(".sidebar-toolbar.elements .smart-category");this.mCategoriesSelect=this.generateLibrariesList(),t.parentNode.replaceChild(this.mCategoriesSelect.render(),t),dpManager.UserElements.isLibraryVisible(e)?this.selectCategory(e):this.selectCategory(this.mCurrentCategory.value||(this.mVisibleLibraries[0]?this.mVisibleLibraries[0].value:"")),this.appendSettingsButton(),this.attachEvents()},renderToolbar:function(){this.parent(),this.mCategoryLabelEl=document.createElement("div"),this.mCategoryLabelEl.className="category-title",this.mCategoriesSelect=this.generateLibrariesList(),this.mCategoryLabelEl.appendChild(this.mCategoriesSelect.render()),this.mToolbarEl.appendChild(this.mCategoryLabelEl),this.mListEl=new MooTools.Element("ul",{class:"Elements"}),this.mToolbarEl.microjungle([["div",{class:"sidebar-wrapper scroll-container"},[["div",{class:"elements-list clearfix"},[this.mListEl]]]]]),this.appendSettingsButton()},appendSettingsButton:function(){this.mSettingsButton=document.createElement("a"),this.mSettingsButton.classList.add("libraries-link","icon-font-cog"),this.mSettingsButton.innerHTML="<span>manage libraries</span>",this.mCategoryLabelEl.querySelector(".smart-category").insertBefore(this.mSettingsButton,this.mCategoryLabelEl.querySelector(".smart-category .hulk-select"))},showUndoElementRemoveBox:function(e){var t,i=$("WorkBench"),r=new MooTools.Element("div",{class:"notification"}).setStyle("width",7*e.name.length+260+"px"),s=function(){document.getElement("div.notification").set("morph",{onComplete:function(){document.getElement("div.notification").dispose()}.bind(this)}).morph({opacity:0})}.bind(this);r.empty(),r.microjungle([["div",{class:"overlay"}],["div",{class:"loader"}]]).setStyle("opacity",0),r.inject(i,"top"),r.position({relativeTo:i,position:"upperRight",edge:"upperRight",offset:{y:9+i.getScrollTop(),x:-27+i.getScrollLeft()}}),r.fade("in"),r.microjungle([["div",{class:"content undoDelete",style:"width: "+7*e.name.length+"260px"},[["h4","Element <b>"+htmlspecialchars(e.name,"ENT_QUOTES")+"</b> has been removed"],["a",{href:"#",class:"undo"},"Undo"]]]]),document.getElement("div.loader").hide(),r.getElement("div.content").setStyle("background-image","url()"),r.getElement("a.undo").addEvent("click",function(){document.getElement("a.undo").hide(),document.getElement("div.loader").show(),MooTools.$clear(t),dpManager.UserElements.undoDelete("element",e.id_element),this.closeUndoElementRemoveBox()}.bind(this)),t=s.delay(5e3)},closeUndoElementRemoveBox:function(){document.getElement("div.notification").dispose()},resizeWrapper:function(){var e=this.mToolbarEl.getHeight(),t=this.mToolbarEl.getElements(".category-title, .search").map(function(e){return e.getHeight()}).sum();this.mToolbarEl.getElement(".sidebar-wrapper").setStyle("height",e-t)},addElementEvents:function(){dpManager.UserElements.on("refreshElements",this.refreshCurrentLibrary,this),dpManager.UserElements.on("visibility-changed",this.refreshCurrentLibrary,this),dpManager.UserElements.on("libraryAdded",this.refreshCurrentLibrary,this),dpManager.UserElements.on("libraryRemoved",this.refreshCurrentLibrary,this),dpManager.UserElements.on("libraryUpdated",this.refreshCurrentLibrary,this),dpManager.UserElements.on("externallyUpdated",this.refreshCurrentLibrary,this),dpManager.UserElements.on("elementAdded",this.refreshCurrentLibrary,this),dpManager.UserElements.on("elementRemoved",this.deleteElementFromDOM,this),dpManager.UserElements.on("elementRenamed",this.renameElementInDOM,this)},attachEvents:function(){this.mSettingsButton.addEventListener("click",t.openLibrariesSettings),this.mCategoriesSelect.addEvent("change",function(e){this.selectCategory(e);try{var t=MooTools.JSON.parse(lscache.get("browsedlibs"));t&&MooTools.Array.isArray(t)||(t=[]),t.indexOf(e)<0&&(t.push(e),lscache.set("browsedlibs",t)),"string"==typeof e&&e.indexOf("c")}catch(e){console.error("event not sent",e)}}.bind(this))},getCacheKey:function(e){return"id_recent_library:"+e},selectCategory:function(e){this.changeCategory({id_category:e}),lscache.set(this.getCacheKey(dpManager.dpProject.getIdProject()),e),_kmq.push(["record","App - Libraries - Changed selected libraries",{"App - Libraries - Changed selected libraries: Selected library":this.mCategoriesSelect.getOptionText(e)}])},categoryExists:function(e){var t,i;if(!e)return!1;for(i in dpManager.User.libraries)if(dpManager.User.libraries.hasOwnProperty(i)&&(t=dpManager.User.libraries[i],"c"+t.id_library===e))return!0;for(i in this.options.categories)if(this.options.categories.hasOwnProperty(i)&&(t=this.options.categories[i],parseInt(t.id_tree,10)===parseInt(e,10)))return!0;return!1},loadCategory:function(){var e=this.options.categories[0].id_tree,t=this.options.categories[0].title;this.changeCategory({id_category:e,name:t})},getCategoryElements:function(e){return t.getCategoryElements(e,this.options.list)},changeCategory:function(e){this.mCategoriesSelect.set(e.id_category),this.mCurrentCategory=e,this.mSearch&&this.mSearch.clear();var t={data:this.getCategoryElements(e.id_category)};return this.loadElements(t),this},generateNoElementsInfo:function(){var e,t=document.createElement("p");t.classList.add("empty-info-custom");var i=uxpft.disabledInPlan(FEATURE_CUSTOM_LIBRARIES)&&uxpft.disabledInPlan(FEATURE_CUSTOM_LIBRARIES_PROMO),r=i?"template-sidebar-no-elements-info-extended":"template-sidebar-no-elements-info-simple";return e=utils.RenderTemplate(r),t.innerHTML=e,t},loadElements:function(e,t){if(this.mListEl.innerHTML="",!uxpft.enabled(FEATURE_CUSTOM_LIBRARIES)&&this.isCustomLibraryId(this.mCurrentCategory.id_category)&&this.mListEl.appendChild(dpManager.UserElements.getPromoCountDown()),(!e.data||0===e.data.length)&&this.isCustomLibraryId(this.mCurrentCategory.id_category))return void this.mListEl.appendChild(this.generateNoElementsInfo());var i=document.createDocumentFragment();e.data.each(function(e){if(1==e.status&&dpManager.UserElements.isLibraryVisible(e.id_tree)){var t=this.createElementByType(e);t=this.addWorkingClass(e.icon,t),t.id="container-element-no-"+e.id_element,i.appendChild(t)}}.bind(this)),this.mListEl.appendChild(i)},isCustomLibraryId:function(e){return"string"==typeof e&&0===e.indexOf("c")},addWorkingClass:function(e,t){return!e&&this.isCustomLibraryId(this.mCurrentCategory.id_category)&&t.classList.add("working"),t},createElementByType:function(e){},search:function(e){if(!e)return void this.changeCategory(this.mCurrentCategory);var t=new RegExp(RegExp.quote(e),"i"),i={data:[]},r=dpManager.User.elements.concat(this.options.list);for(var s in r)if(r.hasOwnProperty(s)){var n=r[s];void 0!==n.label&&n.label.test(t)&&i.data.push(n)}0!==i.data.length&&(i.data=this.mSearchResultFilter.execute(i.data)),e&&dpManager.Analytics.analyticsEvent("editor","search",e),dpManager.Analytics.kissEvent("App - Search - Searched for",{"App - Search - Searched for: Phrase":e,"App - Search - Searched for: # of results":i.data.length||"None","App - Search - Searched for: Libraries":"Elements"}),this.loadElements(i,{isFromSearch:!0})},hide:function(e){this.mPopup&&this.mPopup.destroy(),this.parent(e)},adjustToSitemap:function(e){var t=document.getElementById("proptoolpageinsp");if(void 0===e&&t&&(e=t.getSize().y),e=e||0,!1===this.mLastSidebarH||this.mLastSidebarH!==e)this.mLastSidebarH=e;else if(this.mLastSidebarH===e)return;var i=document.getElement("#trial-info")?75:50,r=i+e;if(this.mToolbarEl.setStyle("top",r),this.mToolbarEl.getElement(".sidebar-wrapper")){var s=this.mToolbarEl.getElements(".category-title, .search").map(function(e){return e.getHeight()}).sum();this.mToolbarEl.getElement(".sidebar-wrapper").setStyle("height",document.getElement("#sidebar").getSize().y-s-i-e)}}});t.openLibrariesSettings=function(e){var t=new LibrariesModal(e);document.body.appendChild(t.render().el),dpManager.Analytics.kissEvent("App - Manage libraries - Opened"),setTimeout(t.show.bind(t,1))},t.getCategoryElements=function(e,t){var i=[];if(e&&"c"===e[0]){var r=e.slice(1);for(var s in dpManager.User.elements)if(dpManager.User.elements.hasOwnProperty(s)){var n=dpManager.User.elements[s];parseInt(r)===parseInt(n.id_library)&&i.push(n)}}else for(var s in t)if(t.hasOwnProperty(s)){var n=t[s];parseInt(e)===parseInt(n.id_tree)&&1===parseInt(n.status)&&i.push(n)}return i},t.getLibraryHulkSelect=function(e,t){t=t||{};var i={label:"Libraries: ",elClass:"hulk-select size-231",listClass:"hulk-select-list size-231",wrapperClass:"smart-category libraries-wrapper control-wrapper",optionsListMinHeight:"full",placeholder:!1};return _.defaults(t,i),t.options=e,new ToolsBoxControlSelect(null,t)},t.generateRawLibList=function(e,t){var i=[];return t||(t=[]),dpManager.User.libraries&&!dpManager.UserElements.isDesignLibrariesActive()&&dpManager.User.libraries.forEach(function(e){(dpManager.UserElements.isLibraryVisible(e.id_tree)||t.includes(parseInt(e.id_tree,10)))&&i.push({value:e.id_tree,text:e.name})}),e.each(function(e){(dpManager.UserElements.isLibraryVisible(e.id_tree)||t.includes(parseInt(e.id_tree,10)))&&i.push({value:e.id_tree,text:e.title})}),i},e.DPSidebar_Widget_Elements=t}(window);
var UXPElementHistory=new MooTools.Class({name:"UXPElementHistory",mStorage:null,mMaxElements:20,initialize:function(t){this.mStorage=t,this.mStorage.setSize(this.mMaxElements)},add:function(t){this.mStorage.count()>=this.mMaxElements&&this.mStorage.removeOldest(),this.mStorage.add(t)},remove:function(t){this.mStorage.remove(t)},getLast:function(t){return void 0===t&&(t=1),this.mStorage.getLast(t)},getAll:function(){return this.mStorage.getAll()},clear:function(){this.mStorage.clear()},count:function(){return this.mStorage.count()}});
var UXPLscacheHistoryStorage=new MooTools.Class({name:"UXPLscacheHistoryStorage",mBucketName:null,mCache:null,mSize:null,initialize:function(e){this.mBucketName="last_used"+e.toString(),null===lscache.bucket(this.mBucketName,function(){return lscache.get("elements")})&&lscache.bucket(this.mBucketName,function(){return lscache.set("elements",MooTools.JSON.encode([]))})},setSize:function(e){this.mSize=e},add:function(e){lscache.bucket(this.mBucketName,function(){var t=lscache.get("elements")||[];t.contains(e)&&t.erase(e),t.length>=this.mSize&&t.pop(),t.unshift(e),lscache.set("elements",MooTools.JSON.encode(t))})},remove:function(e){lscache.bucket(this.mBucketName,function(){var t=lscache.get("elements")||[];t.erase(e),lscache.set("elements",MooTools.JSON.encode(t))})},getLast:function(e){return lscache.bucket(this.mBucketName,function(){return(lscache.get("elements")||[]).slice(0,e)})},getAll:function(){return this.getLast(this.mSize)},clear:function(){lscache.bucket(this.mBucketName,function(){lscache.set("elements",MooTools.JSON.encode([]))})},count:function(){return lscache.bucket(this.mBucketName,function(){return(lscache.get("elements")||[]).length})},removeOldest:function(){lscache.bucket(this.mBucketName,function(){var e=lscache.get("elements")||[];e.pop(),lscache.set("elements",MooTools.JSON.encode(e))})}});
!function(e){"use strict";var i=new MooTools.Class({name:"UXPTheSearchElementsFilter",execute:function(e){var i,n=[],t={},s=null,r=null,o=!1;return _.each(e,function(p,l){i=e[l],r=void 0!==i.label?this.sanitizeString(i.label):this.sanitizeString(i.name),o=!1,_.isEmpty(t[r])||_.every(t[r],function(e,n){return s=t[r][n],i.icon!==s.icon||i.type!==s.type||!(_.isEqual(i.props,s.props)||_.isEmpty(i.props)||_.isEmpty(s.props))||(o=!0,!1)}),o||(n.push(i),_.isEmpty(t[r])&&(t[r]=[]),t[r].push(i))}.bind(this)),n},sanitizeString:function(e){return e.replace(/\s+/g,"-")}});e.UXPTheSearchElementsFilter=i}(window);
var ColorPickerControlInputMinMax=new MooTools.Class({Extends:DPMainToolbar_InputMinMax,initialize:function(i,t,e,l){this.parent(i,t,e,l)},mouseWheelChange:function(i){this.isEnabled()&&(i.preventDefault(),this.options.suffix&&(this.mEl.value=this.mEl.value.replace(this.options.suffix,"")),i.wheel>0&&(this.mEl.value=this.mEl.value.toInt()+1),i.wheel<0&&(this.mEl.value=this.mEl.value.toInt()-1),this.validateAndFireEvent(!0),this.options.suffix&&(this.mEl.value=this.mEl.value+this.options.suffix))}});
var ColorPickerWidgetCore=new MooTools.Class({Implements:[MooTools.Events,MooTools.Options],mWidgetsManager:null,options:{name:null,parentElement:null},systemColorPickerInactiveClass:"inactive",initialize:function(e,t){this.mWidgetsManager=e,this.setOptions(t)},getTemplate:function(e){return document.getElementById(e).clone().innerHTML},render:function(){},afterRender:function(){},addEvents:function(){},removeEvents:function(){},getWidget:function(e){return this.mWidgetsManager.getWidget(e)},getColorPickerWindow:function(){return this.mWidgetsManager.getColorPickerWindow()},getWidgetsManager:function(){return this.mWidgetsManager},isGradientEditorVisible:function(){var e=this.mEl.getElementById("gradient-view");return!!e&&e.checked},isHex:function(e){return e&&/^#([0-9a-f]{6})$/i.test(e)},isShortHex:function(e){return e&&/^#([0-9a-f]{3})$/i.test(e)},onColorChange:function(e){this.updateView(e),this.isGradientEditorVisible()||this.fireEvent("change",[this.options.property,e])},manualColorChange:function(e){var t=this.mEl.querySelector("input.action-color-hex");t.value=this.rgbToHex(e),this.mEl.querySelector("input.action-color-opacity").value=100,this.getWidget("middle-picker-gradient")&&this.getWidget("middle-picker-gradient").hideGradientView(),t.fireEvent("manualSet",{code:""})},manualColorRemove:function(e){var t=this.mEl.querySelector("input.action-color-hex");t.value="#FFFFFF",t.fireEvent("manualSet",{code:""}),this.mEl.querySelector("input.action-color-opacity").value=0,this.mEl.querySelector("div.color-opacity .trigger").style.left=0,t.value="#FFFFFF",this.mEl.querySelector(".color-preview").style.backgroundColor=e,this.getWidget("middle-picker-gradient")&&this.getWidget("middle-picker-gradient").hideGradientView(),this.fireEvent("change",[this.options.property,e])},manualGradientChange:function(e){this.getWidget("middle-picker-gradient").drawGradient(e)},expandHex:function(e){return e=e.substr(1),"#"+_.reduce(e,function(e,t){return e+t+t},"")},rgbToHex:function(e){if("#"===e.substr(0,1))return this.isShortHex(e)&&(e=this.expandHex(e)),e;var t=/(.*?)rgb\((\d+),\s*(\d+),\s*(\d+)\)/i.exec(e);if(!t)return!1;var i=parseInt(t[2],10).toString(16),r=parseInt(t[3],10).toString(16),n=parseInt(t[4],10).toString(16);return"#"+((1==i.length?"0"+i:i)+(1==r.length?"0"+r:r)+(1==n.length?"0"+n:n))},parseColor:function(e){var t=/rgba?\((\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,)(\s*\d+[\.\d+]*)*\)/g.exec(e);if(!_.isNull(t)&&!_.isEmpty(t[5])&&t[5]>=0&&t[5]<=1){var i=parseInt(t[1],10).toString(16),r=parseInt(t[2],10).toString(16),n=parseInt(t[3],10).toString(16);return{rgba:e,hex:"#"+((1==i.length?"0"+i:i)+(1==r.length?"0"+r:r)+(1==n.length?"0"+n:n)),opacity:t[5]}}var o=/rgb?\((\d+)\s*,\s*(\d+)\s*,(\s*\d+[\.\d+]*)*\)/g.exec(e);if(!_.isNull(o)&&!_.isEmpty(o[3])){var i=parseInt(o[1],10).toString(16),r=parseInt(o[2],10).toString(16),n=parseInt(o[3],10).toString(16);return{rgb:e,hex:"#"+((1==i.length?"0"+i:i)+(1==r.length?"0"+r:r)+(1==n.length?"0"+n:n))}}return{hex:e}},initSystemColorPicker:function(e){var t=this.mEl.querySelector(".system-color-picker"),i=document.querySelector(".action-system-color-picker");this.isSystemColorPickerAvailable()&&!0!==window.is_firefox||t.classList.add(this.systemColorPickerInactiveClass),i&&(i.value=e||"")},isSystemColorPickerAvailable:function(){var e=document.createElement("input");return e.setAttribute("type","color"),"text"!==e.type},updateView:function(e){var t=this.mEl.querySelector(".color-preview");if(!t)return!1;t.style.backgroundColor=e.rgba||e.hex||null;var i=this.mEl.querySelector("input.action-color-hex");i.value=e.hex||null,e.hex&&"transparent"===e.hex&&(e.hex=i.value="#FFFFFF"),this.initSystemColorPicker(i.value),this.mEl.querySelector("div.color-opacity").style.backgroundImage="linear-gradient(to right, rgba(206, 57, 132, 0) 0%,"+(e.hex||e)+" 100%)",this.getWidget("middle-picker-rainbow").generateShades(e);var r=this.mEl.querySelector(".color-indicator.active span");if(this.isGradientEditorVisible()&&r&&(r.style.backgroundColor=e.rgba||e.hex||null),this.isGradientEditorVisible()&&this.getWidget("middle-picker-gradient"))this.getWidget("middle-picker-gradient").refreshGradientBar(this.getWidgetsManager().isRendered());else if(this.getWidget("middle-picker-gradient")){var n=this.mEl.querySelectorAll(".color-indicator"),o=this.mEl.querySelector("div.gradient-bar");n&&2==n.length&&"0px"==n[0].style.left&&o.getSize().x+"px"==n[1].style.left&&MooTools.Array.prototype.forEach.call(n,function(t,i){t.querySelector("span").style.backgroundColor=e.rgba||e.hex||null}.bind(this))}}});
var ColorPickerDesignLibrary=new MooTools.Class({Extends:ColorPickerWidgetCore,options:{parentElement:"slides-content-overflow"},getItems:function(t,e){return _.reduce(t.items,function(t,r){var i=e[r];return i&&t.push(i),_.sortBy(t,"sortOrder")},[])},getColors:function(t){var e=t.getState(),r=_.find(e.libraries.collection,function(t){return t.id===e.libraries.currentLibraryId}),i=e.libraryCategories.categories,n=e.libraryItems.items;return r?this.getReducedColors(r,i,n):[]},renderColorsAsync:function(t){var e,r,i,n,o=t.dispatch;return o(window.actionGetActiveLibraryData()).then(function(t){if(e=t.library,r=t.categories,i=t.items,!e)return[];n=this.getReducedColors(e,r,i),this.renderColors(n)}.bind(this))},isBright:function(t){if(!t||!this.isHex(t)&&!this.isShortHex(t))return!1;var e=this.isShortHex(t)?this.expandHex(t):t,r=e.hexToRgb().match(/\d+/g);return.2126*r[0]+.7152*r[1]+.0722*r[2]>165},getReducedColors:function(t,e,r){return _.reduce(t.colorCategories,function(t,i){var n=e[i];return n&&t.push(_.extend({},e[i],{items:_.map(this.getItems(n,r),function(t){var e,r=t.content;switch(t.type){case"color":e=t.content;break;case"sketch-color":try{r=JSON.parse(t.content),e=r.content}catch(r){e=t.content.content}}return _.extend({},t,{content:r,isBlocked:!this.options.with_gradient_editor&&("gradient"===t.type||"sketch-gradient"===t.type),isBright:this.isBright(e)})}.bind(this))})),_.sortBy(t,"sortOrder")}.bind(this),[])},renderColors:function(t){var e=this.mEl.querySelector(".color-design-library-content");if(e){var r=this.getTemplate("template-design-library-colors"),i=_.template(r);e.innerHTML=i({colors:t})}},render:function(){var t,e,r=window.uxpinStore,i=r.getState(),n=i.libraries.currentLibraryId;return n?(t=this.getTemplate("template-color-picker-design-library"),(e=_.template(t))({colors:this.getColors(r)})):(t=this.getTemplate("template-color-picker-design-library-container"),e=_.template(t),this.renderColorsAsync(r),e())},addEvents:function(){var t=this.mEl.querySelector(".color-design-library-content");t&&t.addEvent("click",function(t){var e=t.target;t.preventDefault();var r,i,n=window.uxpinStore,o=_.isEmpty(e.dataset)?e.parentNode.dataset:e.dataset,s=parseInt(o.i,10),a=parseInt(o.j,10),c=this.getColors(n);isNaN(s)||isNaN(a)||(r=c[s].items[a],i="sketch-gradient"===r.type||"sketch-color"===r.type?r.content.content:r.content,r.isBlocked||("gradient"===r.type||"sketch-gradient"===r.type?this.manualGradientChange(i):this.manualColorChange(i)))}.bind(this))}});
var ColorPickerWidgetFavourites=new MooTools.Class({Extends:ColorPickerWidgetCore,mColors:null,options:{parentElement:"slides-content-overflow"},render:function(){var e=this.getTemplate("template-color-picker-favourites");return _.template(e)({favourites:ColorPickerWidgetFavourites.getUserColors(),withGradientEditor:this.options.with_gradient_editor})},addEvents:function(){this.mEl.querySelector(".color-favourites-content").addEvent("click",function(e){e&&e.stop&&e.stop();var o=e.target.classList.contains("single-color");if(e.target.classList.contains("delete-color")){e.target.parentNode.parentNode.dispose();var t=ColorPickerWidgetFavourites.getUserFavouriteColors();this.fireEvent("onSetFavouriteColors",{colors:t}),ColorPickerWidgetFavourites.updateUserColors(t,!1)}else o&&e.target.style.backgroundImage.test(/gradient/)?this.manualGradientChange(e.target.style.backgroundImage):o&&this.manualColorChange(e.target.style.backgroundColor)}.bind(this));var e=this.mEl.querySelector("div.color-favourites-content div.colors-list");e.addEvent("scroll",function(o){var t=e.getScroll(),r=this.mEl.querySelector("div.color-favourites-content h5");t&&t.y?r.classList.add("on-scroll"):r.classList.remove("on-scroll")}.bind(this))}});ColorPickerWidgetFavourites.getUserFavouriteColors=function(){return document.getElements("div.color-favourites-content a.single-color").map(function(e){if(e.style.backgroundImage.test(/gradient/))return e.style.backgroundImage;var o=e.style.backgroundColor;return"transparent"==o?null:o})},ColorPickerWidgetFavourites.updateUserColors=function(e,o){var t=document.querySelector("div.color-favourites-content div.colors-list"),r=document.querySelector("div.color-favourites-content .no-favourites");_.isEmpty(e)?(t.classList.add("hidden"),t.classList.remove("visible"),r.classList.add("visible"),r.classList.remove("hidden")):(t.classList.add("visible"),t.classList.remove("hidden"),r.classList.add("hidden"),r.classList.remove("visible")),ColorPickerWidgetFavourites.storeUserColors(e),o&&(new Dejax).newRequest({url:"/ajax/dmsAdminUsers/SetUserColors/",mode:"cancel",data:{colors:e}})},ColorPickerWidgetFavourites.storeUserColors=function(e){this.mColors=e},ColorPickerWidgetFavourites.getUserColors=function(){return this.mColors};
var ColorPickerWidgetFooter=new MooTools.Class({Extends:ColorPickerWidgetCore,options:{parentElement:"color-picker"},mCurrentPage:null,render:function(){var e=this.getTemplate("template-color-picker-footer");return _.template(e)({pages:this.getPages()})},getPages:function(){var e=[];e.push({class:"dot icon-general-heart",name:"Favorite colors"}),uxpft.enabled(FEATURE_DESIGN_LIBRARIES)&&e.push({class:"dot icon-general-libraries",name:"Library colors"}),e.push({class:"dot icon-font-dropper active",name:"Color picker"},{class:"dot icon-font-swatches",name:"Solid colors"},{class:"dot icon-font-schemes",name:"Color schemes"});for(var t=0;t<e.length;t++)e[t].page=t;return e},addEvents:function(){this.mEl.querySelector("nav.navigation").addEvent("click",function(e){e&&e.stop&&e.stop(),e.target.classList.contains("dot")&&(lscache.bucket(dpManager.dpProject.mIdProject,function(){lscache.set("color_picker_page",e.target.get("data-page"),1440)}.bind(this)),this.showPage(e.target.get("data-page")))}.bind(this))},showPage:function(e){var t=this.mEl.querySelectorAll("footer nav.navigation ul li");MooTools.Array.prototype.forEach.call(t,function(t,s){s!=e?t.classList.remove("active"):t.classList.add("active")});var s,r=this.mEl.querySelector(".color-data"),a=0,i=0,o=this.mEl.querySelector(".gradient-view-switcher"),l=this.mEl.querySelector(".gradient-view"),n=this.mEl.querySelector("#gradient-view");uxpft.enabled(FEATURE_DESIGN_LIBRARIES)?0==e?(a="-400",i="-200",n&&n.checked&&l.classList.remove("visible")):1==e?(a="-200",i="-200",n&&n.checked&&l.classList.remove("visible")):2==e?(a="0",i="0",n&&n.checked&&l.classList.add("visible")):3==e?(a="200",i="-200",n&&n.checked&&l.classList.remove("visible")):4==e&&(a="400",i="-200",n&&n.checked&&l.classList.remove("visible")):0==e?(a="-200",i="200",n&&n.checked&&l.classList.remove("visible")):1==e?(a="0",i="0",n&&n.checked&&l.classList.add("visible")):2==e?(a="200",i="-200",n&&n.checked&&l.classList.remove("visible")):3==e&&(a="400",i="-200",n&&n.checked&&l.classList.remove("visible"));var c="translate3d("+a+"px, 0, 0)";r.style.webkitTransform=c,r.style.MozTransform=c,r.style.msTransform=c,r.style.OTransform=c,r.style.transform=c;var d="translate3d("+i+"px, 0, 0)";o&&(o.style.webkitTransform=d,o.style.MozTransform=d,o.style.msTransform=d,o.style.OTransform=d,o.style.transform=d),s="translate3d(-"+200*e+"px, 0, 0)";var m=this.mEl.querySelector("section.slides-content-overflow");m.style.webkitTransform=s,m.style.MozTransform=s,m.style.msTransform=s,m.style.OTransform=s,m.style.transform=s,this.isGradientEditorVisible()&&2==e?(this.mEl.querySelector(".middle-content-container").classList.add(this.options.with_gradient_class),this.mEl.parentNode.classList.add(this.options.with_gradient_class)):this.isGradientEditorVisible()&&2!=e&&(this.mEl.querySelector(".middle-content-container").classList.remove(this.options.with_gradient_class),this.mEl.parentNode.classList.remove(this.options.with_gradient_class)),this.mCurrentPage=e},afterRender:function(){this.mCurrentPage=lscache.bucket(dpManager.dpProject.mIdProject,function(){return lscache.get("color_picker_page")}),null===this.mCurrentPage&&(this.mCurrentPage=2),this.showPage(this.mCurrentPage)},getCurrentPage:function(){return this.mCurrentPage}});
var ColorPickerWidgetGradient=new MooTools.Class({Extends:ColorPickerWidgetCore,options:{parentElement:"color-picker-content"},mIndicatorGridHeight:10,render:function(){var e=this.getTemplate("template-color-picker-gradient");return _.template(e)()},addEvents:function(){this.mGradientAngleEl=new ColorPickerControlInputMinMax(this.mEl.getElementById("gradient-angle"),-180,180,{suffix:""}),this.mRadialGradientOptionEl=this.mEl.getElementById("radial-gradient-option"),this.mLinearGradientOptionEl=this.mEl.getElementById("linear-gradient-option"),this.mGradientAngleEl&&this.mGradientAngleEl.mEl&&(this.mGradientAngleEl.addEvent("onChange",this.refreshGradientBar.bind(this,!0)),this.mGradientAngleEl.mEl.addEvent("focus",function(e){this.mGradientAngleEl.mEl.value=this.mGradientAngleEl.mEl.value.replace("","")}.bind(this)),this.mGradientAngleEl.mEl.addEvent("blur",function(e){this.mGradientAngleEl.mEl.value=this.mGradientAngleEl.mEl.value+""}.bind(this)));var e=this.mEl.querySelector("div.gradient-bar");e.addEvent("mousedown",function(t){if(t.target.classList.contains("color-indicator"))return!1;var i=this.mEl.querySelector("input.action-color-opacity");i.value=100,i.fireEvent("manualSet",{code:""}),this.createIndicator(t.page.x-e.getLeft(),this.mEl.querySelector(".color-preview").style.backgroundColor)}.bind(this)),e.addEvent("mousemove",function(t){var i=this.mEl.querySelector("div.color-indicator.ghost-indicator"),r=this.mEl.querySelector("div.color-indicator.dragging");t.target.classList.contains("color-indicator")?i&&i.parentNode.removeChild(i):i?i.style.left=t.page.x-e.getLeft()+"px":r||this.createIndicator(t.page.x-e.getLeft(),this.mEl.querySelector(".color-preview").style.backgroundColor,!1,!0)}.bind(this)),e.addEvent("mouseout",function(e){var t=this.mEl.querySelector("div.color-indicator.ghost-indicator");t&&t.parentNode.removeChild(t)}.bind(this)),this.mRadialGradientOptionEl&&(this.mRadialGradientOptionEl.addEvent("change",this.gradientTypeChange.bind(this)),this.mLinearGradientOptionEl.addEvent("change",this.gradientTypeChange.bind(this)))},gradientTypeChange:function(e){this.mLinearGradientOptionEl.checked?(this.mGradientAngleEl.mEl.removeAttribute("disabled"),this.mEl.querySelector("div.gradient-view span.angle").classList.remove("disabled")):(this.mGradientAngleEl.mEl.setAttribute("disabled","disabled"),this.mEl.querySelector("div.gradient-view span.angle").classList.add("disabled")),this.refreshGradientBar()},afterRender:function(){if(this.options.gradient_value&&this.options.gradient_value.test(/gradient/))this.drawGradient(this.options.gradient_value);else{var e=this.mEl.querySelector("div.gradient-bar"),t=this.mEl.querySelectorAll(".shades a");"transparent"===this.options.value?this.createIndicator(0,"#ffffff",!1):this.createIndicator(0,this.options.value,!1),this.createIndicator(e.getSize().x,t[t.length-1].style.backgroundColor,!1),this.mLinearGradientOptionEl&&(this.mLinearGradientOptionEl.checked=!0),this.hideGradientView()}},drawGradient:function(e){this.showGradientView();var t=this.mEl.querySelectorAll(".color-indicator");MooTools.Array.prototype.forEach.call(t,function(e){e.parentNode.removeChild(e)});var i=this.mEl.querySelector("input.action-color-opacity");i.value=100,i.fireEvent("manualSet",{code:""});var r,a,n,o,l=this.mEl.querySelector("div.gradient-bar"),s=e.match(/rgba?\((\d+, \d+, \d+(, \d+\.?(\d+)?)?)\) (\d+)%/gi)||[],d=e.match(/#(?:[0-9a-f]{3}){1,2} (\d+)%/gi)||[],c=s.concat(d.map(function(e){var t=e.split(" ");return t[0].hexToRgb()+" "+(t[1]||"0%")})),h=[];for(n=0,o=c.length;n<o;n++)h.push(c[n]);h.sort();var g=null;for(n=0,o=h.length;n<o;n++){a=h[n].match(/.+\)/)[0],r=h[n].match(/\) (\d+)/)[1],g=a,this.createIndicator(Math.round(r/100*l.getSize().x),a,!1);var m=this.mEl.querySelector("input.action-color-hex");m.value=this.parseColor(g).hex,m.fireEvent("manualSet",{code:""})}var u=e.match(/gradient\((\d+)deg/i);e.match(/radial/i)&&this.mRadialGradientOptionEl?this.mRadialGradientOptionEl.checked=!0:u&&u[1]&&this.mGradientAngleEl&&this.mLinearGradientOptionEl?(this.mGradientAngleEl.mEl.value=180-parseFloat(u[1])+"",this.mLinearGradientOptionEl.checked=!0):this.mGradientAngleEl&&this.mLinearGradientOptionEl&&(this.mGradientAngleEl.mEl.value="0",this.mLinearGradientOptionEl.checked=!0),this.gradientTypeChange(),this.refreshGradientBar(!1)},refreshGradientBar:function(e){if(!this.isGradientEditorVisible())return!1;void 0===e&&(e=!0);var t=this.getLinearStyle(!1);this.mEl.querySelector("div.gradient-bar").style.backgroundImage=t,t=this.getCurrentStyle(),this.mEl.querySelector("div.color-picker .color-preview").style.backgroundImage=t,e&&this.isGradientEditorVisible()&&this.fireEvent("change",[this.options.property_gradient,{gradient:t}])},getIndicatorsSorted:function(){for(var e=this.mEl.querySelectorAll(".color-indicator span"),t=[],i=0,r=e.length;i<r;i++)e[i].parentNode.classList.contains("hidden")||t.push(e[i]);return t.sort(function(e,t){return e.getLeft()<t.getLeft()?-1:(e.getLeft(),t.getLeft(),1)}),t},getCurrentStyle:function(){return this.mRadialGradientOptionEl&&this.mRadialGradientOptionEl.checked?this.getRadialStyle():this.getLinearStyle()},getLinearStyle:function(e){if(this.mGradientAngleEl&&this.mGradientAngleEl.mEl){void 0===e&&(e=!0);var t="linear-gradient(";return t+=e?180-parseFloat(this.mGradientAngleEl.mEl.value.replace("","")):"90",t=t+"deg,"+this.parseGradientIndicators()+")"}},getRadialStyle:function(){return"radial-gradient(ellipse at center,"+this.parseGradientIndicators()+")"},parseGradientIndicators:function(){var e=this.getIndicatorsSorted(),t=this.mEl.querySelector("div.gradient-bar"),i="",r=null;return MooTools.Array.prototype.forEach.call(e,function(e,a){e.parentNode.classList.contains("active")&&(r=e.parentNode,e.parentNode.classList.remove("active")),0!==a&&(i+=", ");var n=e.style.backgroundColor||"rgba(0, 0, 0, 0)";n.test(/rgba/)||(n=n.replace("rgb","rgba").replace(")",", 1)")),i=i+n+" "+Math.floor((e.getLeft()+e.getSize().x/2-t.getLeft()+1)/t.getSize().x*100)+"%"}),r&&r.classList.add("active"),i},showGradientView:function(){2===this.getWidget("footer").getCurrentPage()&&(this.mEl.querySelector(".middle-content-container").classList.add(this.options.with_gradient_class),this.mEl.parentNode.classList.add(this.options.with_gradient_class)),this.mEl.getElementById("gradient-view").checked=!0,this.mEl.querySelector("div.color-picker .color-preview").style.removeProperty("background-color"),this.refreshGradientBar(!1),this.mEl.querySelector("input.action-color-hex").fireEvent("manualSet",{code:""})},hideGradientView:function(){var e=this.mEl.querySelector("div.gradient-view");e.classList.add("hidden"),e.classList.remove("visible"),2===this.getWidget("footer").getCurrentPage()&&this.mEl.querySelector(".middle-content-container").classList.remove(this.options.with_gradient_class),this.mEl.getElementById("gradient-view")&&(this.mEl.getElementById("gradient-view").checked=!1),this.mEl.parentNode.classList.remove(this.options.with_gradient_class),this.mEl.querySelector("div.color-picker .color-preview").style.removeProperty("background-image"),this.mEl.querySelector("input.action-color-hex").fireEvent("manualSet",{code:""})},createIndicator:function(e,t,i,r){void 0===i&&(i=!0),void 0===r&&(r=!1);var a=this.mEl.querySelector("div.gradient-bar"),n=document.createElement("div");n.classList.add("color-indicator"),n.classList.add("icon-font-map-pin"),n.style.left=e+"px",a.appendChild(n);var o=document.createElement("span");if(o.classList.add("color"),o.style.backgroundColor=t,n.appendChild(o),r)return n.style.opacity="0.5",void n.classList.add("ghost-indicator");n.classList.add("active"),n.addEvent("mousedown",function(e){this.setActiveIndicator(e.target),this.refreshColorEditor(e.target.querySelector("span").style.backgroundColor)}.bind(this)),this.setActiveIndicator(n),this.refreshGradientBar(i);var l=this.mEl.querySelector("input.action-color-opacity"),s=this.parseColor(t);s.opacity?(l.value=Math.round(100*s.opacity),l.fireEvent("manualSet",{code:""})):(l.value=100,l.fireEvent("manualSet",{code:""}));var d={x:[0,a.getSize().x]};new Drag(n,{limit:d,modifiers:{y:!1},onBeforeStart:this.indicatorDrag.bind(this),onStart:this.indicatorDrag.bind(this),onDrag:this.indicatorDrag.bind(this),onComplete:this.indicatorDragComplete.bind(this),snap:0,stopPropagation:!0,preventDefault:!0})},setActiveIndicator:function(e){var t=this.mEl.querySelectorAll(".color-indicator");MooTools.Array.prototype.forEach.call(t,function(e,t){e.classList.remove("active")}),e.classList.add("active")},indicatorDrag:function(e,t){if(void 0!==t&&ColorPicker.preventDestroy(!0),this.setActiveIndicator(e),e.classList.add("dragging"),this.mEl.querySelectorAll(".color-indicator").length>2&&t&&t.page&&t.page.y){var i=this.mEl.querySelector("div.gradient-bar"),r=!1;t.page.y-e.getSize().y/2>i.getTop()+i.getSize().y+this.mIndicatorGridHeight/2?(e.classList.contains("hidden")||(e.classList.add("hidden"),r=!0),e.classList.remove("active")):t.page.y-e.getSize().y/2<i.getTop()+i.getSize().y+this.mIndicatorGridHeight/2&&(e.classList.contains("hidden")&&(e.classList.remove("hidden"),r=!0),e.classList.add("active")),r&&this.refreshGradientBar(!1)}this.refreshGradientBar()},indicatorDragComplete:function(e,t){e.classList.remove("dragging");var i=this.mEl.querySelectorAll(".color-indicator");setTimeout(function(){ColorPicker.preventDestroy(!1)}.bind(this),10),i.length<3||e.classList.contains("hidden")&&this.removeIndicator(e)},removeIndicator:function(e){e.dispose();var t=this.mEl.querySelectorAll(".color-indicator"),i=t[t.length-1];this.setActiveIndicator(i),this.refreshColorEditor(i.querySelector("span").style.backgroundColor),this.refreshGradientBar()},refreshColorEditor:function(e){var t=this.mEl.querySelector("input.action-color-hex"),i=this.parseColor(e);if(t.value!=i){var r=this.mEl.querySelector("input.action-color-opacity");i.opacity?(r.value=Math.round(100*i.opacity),r.fireEvent("manualSet",{code:""})):100!=r.value&&(r.value=100,r.fireEvent("manualSet",{code:""})),t.value=i.hex,t.fireEvent("manualSet",{code:""})}}});
!function(e){"use strict";var t=new MooTools.Class({Extends:ColorPickerWidgetCore,options:{parentElement:"color-picker"},render:function(){var e=this.getTemplate("template-color-picker-header");return _.template(e)({withGradientEditor:this.options.with_gradient_editor})},isInFavourites:function(e,t){var i=function(t){var i=t.test(/gradient/)?t:this.rgbToHex(t);return t===e||i===e}.bind(this);return _.flatten(t).some(i)},createColorPickerInput:function(){var e=document.createElement("input");return e.setAttribute("type","color"),e.setAttribute("id","system-color-picker-input"),e.classList.add("action-system-color-picker"),document.body.appendChild(e),e},onInput:_.debounce(function(e){this.manualColorChange(e.target.value)},100),onSystemColorPickerClick:function(){var e=this.mEl.querySelector("input.action-color-hex");this.systemColorPickerInput.click(),this.systemColorPickerInput.value=e.value,dpManager.Analytics.kissEvent("App - Color Picker - System color picker clicked")},removeEvents:function(){var e=this.mEl.querySelector(".system-color-picker");this.systemColorPickerInput&&this.systemColorPickerInput.removeEventListener("input",this.onInputRef),e&&e.removeEventListener("click",this.onSystemColorPickerClickRef)},addEvents:function(){var e=this.mEl.querySelector(".gradient-view-switcher");e&&e.addEvent("change",function(){this.isGradientEditorVisible()?(-1!==this.getWidget("footer").getCurrentPage()&&this.getWidget("footer").showPage(uxpft.enabled(FEATURE_DESIGN_LIBRARIES)?2:1),this.getWidget("middle-picker-gradient").showGradientView()):this.getWidget("middle-picker-gradient").hideGradientView()}.bind(this)),this.systemColorPickerInput=document.querySelector(".action-system-color-picker")||this.createColorPickerInput(),this.isSystemColorPickerAvailable()&&(this.onInputRef=this.onInput.bind(this),this.onSystemColorPickerClickRef=this.onSystemColorPickerClick.bind(this),this.systemColorPickerInput.addEventListener("input",this.onInputRef),this.mEl.querySelector(".system-color-picker").addEventListener("click",this.onSystemColorPickerClickRef));var t=this.mEl.querySelector("div.color-picker .color-preview");t.addEvent("click",function(){1!==this.getWidget("footer").getCurrentPage()&&this.getWidget("footer").showPage(uxpft.enabled(FEATURE_DESIGN_LIBRARIES)?2:1)}.bind(this)),this.mEl.querySelector(".add-to-favourites").addEvent("click",function(e){e&&e.stop&&e.stop();var i=this.mEl.querySelector("input.action-color-hex"),r=i.value,o=null;if(this.isGradientEditorVisible()&&t.style.backgroundImage.test(/gradient/))o=t.style.backgroundImage;else if(this.isHex(r))o=r;else{if(!this.isShortHex(r))return;o=this.expandHex(r)}this.mEl.querySelector("li.icon-general-heart").style.color=t.value,setTimeout(function(){this.mEl.querySelector("li.icon-general-heart").classList.add("fav-added")}.bind(this),40),setTimeout(function(){this.mEl.querySelector("li.icon-general-heart").erase("style").classList.remove("fav-added")}.bind(this),190);var s=ColorPickerWidgetFavourites.getUserColors();if(!this.isInFavourites(o,s)){var n=document.createElement("li"),l=document.createElement("a");l.classList.add("single-color"),this.isGradientEditorVisible()&&t.style.backgroundImage.test(/gradient/)?l.style.backgroundImage=o:l.style.backgroundColor=o,n.appendChild(l);var c=document.createElement("span");c.classList.add("delete-color"),c.classList.add("icon-general-close"),l.appendChild(c);var a=this.mEl.querySelector("div.color-favourites-content div.colors-list ul"),d=this.mEl.querySelector("div.color-favourites-content .no-favourites");if(a.appendChild(n),_.isEmpty(s)){var u=this.mEl.querySelector("div.color-favourites-content div.colors-list");u.classList.add("visible"),u.classList.remove("hidden"),d.classList.add("hidden"),d.classList.remove("visible")}var h=ColorPickerWidgetFavourites.getUserFavouriteColors();this.fireEvent("onSetFavouriteColors",{colors:h}),ColorPickerWidgetFavourites.updateUserColors(h,!1);try{dpManager.Analytics.analyticsEvent("app","add favourite","colorpicker")}catch(e){}}}.bind(this))}});e.ColorPickerWidgetHeader=t}(window);
var ColorPickerWidgetMiddleContentContainer=new MooTools.Class({Extends:ColorPickerWidgetCore,options:{parentElement:"color-picker"},render:function(){var e=this.getTemplate("template-color-picker-middle-content");return _.template(e)()}});
var ColorPickerWidgetMooRainbow=new MooTools.Class({Extends:ColorPickerWidgetCore,options:{parentElement:"slides-content-overflow"},mooRainbow:null,afterRender:function(){var o=(this.mEl.querySelector("div.moo-rainbow"),null);if(this.isGradientEditorVisible()){var e=this.mEl.querySelector("div.color-indicator.active span");o=e?this.parseColor(e.style.backgroundColor):"rgb(0, 0, 0)"}else o=this.parseColor(this.options.value),this.mEl.querySelector("input.action-color-hex").value=o.hex||null;this.mooRainbow=new MooRainbowWrapper(this.mEl,{color:o,onChange:this.onColorChange.bind(this)}),this.mooRainbow.render(),this.updateView(o),this.isGradientEditorVisible()&&this.mEl.querySelector("input.action-color-hex").value&&this.mEl.querySelector("input.action-color-hex").fireEvent("manualSet",{code:""})},render:function(){return""},destroy:function(){this.mooRainbow.destroy(),this.mooRainbow=null,this.removeEvents()}});
var ColorPickerWidgetPickerContainer=new MooTools.Class({Extends:ColorPickerWidgetCore,options:{parentElement:"slides-content-overflow"},render:function(){var e=this.getTemplate("template-color-picker-rainbow-container");return _.template(e)()}});
var ColorPickerWidgetPickerRainbow=new MooTools.Class({Extends:ColorPickerWidgetCore,options:{parentElement:"color-picker-content"},render:function(){var e=this.getTemplate("template-color-picker-rainbow");return _.template(e)()},addEvents:function(){this.mEl.querySelector(".shades").addEvent("click",function(e){if(e&&e.stop&&e.stop(),this.isGradientEditorVisible()&&e.target.classList.contains("single-color")){var o=this.mEl.querySelector("input.action-color-hex"),r=this.parseColor(e.target.style.backgroundColor).hex;o.value!=r&&(o.value=r,o.fireEvent("manualSet",{code:""}))}else if(e.target.classList.contains("single-color")){this.manualColorChange(e.target.style.backgroundColor);try{dpManager.Analytics.analyticsEvent("app","shades","colorpicker")}catch(e){}}}.bind(this))},generateShades:function(e){for(var o=this.mEl.querySelectorAll("div.color-picker-view .shade-color"),r=0,t=o.length;r<t;r++)if(o[r].style.backgroundColor&&e.hex&&e.hex==this.rgbToHex(o[r].style.backgroundColor))return;var l,a=new Color(e.hex,"rgb"),s=a.hsb[2];l=s<40?a.hsb[2]+40:s>80?a.hsb[2]:a.hsb[2]+20,MooTools.Array.prototype.forEach.call(o,function(e,o){var r=new Color([a.hsb[0],a.hsb[1],l],"hsb");e.style.backgroundColor=r.hex,l-=10}.bind(this))}});
var ColorPickerWidgetPredefined=new MooTools.Class({Extends:ColorPickerWidgetCore,options:{parentElement:"slides-content-overflow"},mColorsLastUsed:null,mSolidGradients:["linear-gradient(90deg, rgb(255, 94, 58) 0%, rgb(255, 43, 103) 100%)","linear-gradient(90deg, rgb(255, 205, 3) 0%, rgb(255, 219, 75) 100%)","linear-gradient(90deg, rgb(13, 212, 26) 0%, rgb(134, 252, 111) 100%)","linear-gradient(90deg, rgb(29, 100, 240) 0%, rgb(26, 213, 253) 100%)","linear-gradient(90deg, rgb(89, 86, 215) 0%, rgb(197, 68, 251) 100%)","linear-gradient(90deg, rgb(44, 44, 44) 0%, rgb(74, 74, 74) 100%)","linear-gradient(90deg, rgb(138, 141, 145) 0%, rgb(218, 220, 221) 100%)","linear-gradient(90deg, rgb(224, 224, 224) 0%, rgba(255, 255, 255, 0) 100%)"],mSolidColors:[["000000","9197e5","6c74dd","333ecf","2a34b1","21298a","171c61"],["ffffff","303030","ae97df","9374d4","6a3fc4","5934a7","452882","311d5c"],["e8e8e8","474747","e09797","d57373","c53e3e","a83333","832828","5c1c1c"],["d1d1d1","5e5e5e","f4d49e","f0bf72","e89c30","cb8426","a1671e","714915"],["bababa","757575","f0f086","ebeb5e","e3e31f","c2c219","979713","6b6b0e"],["a3a3a3","8c8c8c","99e394","6edc6c","40c353","37a447","2a8039","1e5b22"]],render:function(){var e=this.getTemplate("template-color-picker-predefined"),o=_.template(e),r=[];return r=this.options.with_gradient_editor?this.mSolidColors[0].concat(this.mSolidColors[2],this.mSolidColors[3],this.mSolidColors[4],this.mSolidColors[5]):this.mSolidColors[0].concat(this.mSolidColors[1],this.mSolidColors[2],this.mSolidColors[3],this.mSolidColors[4],this.mSolidColors[5]),o({solidColors:r,solidGradients:this.mSolidGradients,withGradientEditor:this.options.with_gradient_editor,lastUsed:ColorPickerWidgetPredefined.getUserColorsLastUsed()})},addEvents:function(){this.mEl.querySelector(".predefined-content").addEvent("click",function(e){e&&e.stop&&e.stop(),e.target.classList.contains("single-color")&&(_.isEmpty(e.target.style.backgroundImage)||e.target.classList.contains("action-transparent")?_.isEmpty(e.target.style.backgroundColor)?this.manualColorRemove("transparent"):this.manualColorChange(e.target.style.backgroundColor):this.manualGradientChange(e.target.style.backgroundImage))}.bind(this));var e=this.mEl.querySelector("div.color-swatches-content div.colors-list");e.addEvent("scroll",function(o){var r=e.getScroll(),t=this.mEl.querySelector("div.color-swatches-content h5");r&&r.y?t.classList.add("on-scroll"):t.classList.remove("on-scroll")}.bind(this))}});ColorPickerWidgetPredefined.updateUserColorsLastUsed=function(e,o){ColorPickerWidgetPredefined.storeUserColorsLastUsed(e),o&&(new Dejax).newRequest({url:"/ajax/dmsAdminUsers/SetUserColorsLastUsed/",mode:"cancel",data:{colors:e}})},ColorPickerWidgetPredefined.storeUserColorsLastUsed=function(e){this.mColorsLastUsed=e},ColorPickerWidgetPredefined.getUserColorsLastUsed=function(){return this.mColorsLastUsed};
var ColorPickerWidgetSwatches=new MooTools.Class({Extends:ColorPickerWidgetCore,options:{parentElement:"slides-content-overflow"},mSwatches:[["105B63","FFFAD5","FFD34E","DB9E36","BD4932"],["F00807","5F6273","A4ABBF","CCC9D1","E2E1E9"],["DC3522","D9CB9E","374140","2A2C2B","1E1E20"],["FCFFF5","D1DBBD","91AA9D","3E606F","193441"],["2F2933","01A2A6","29D9C2","BDF271","FFFFA6"],["2B3A42","3F5765","BDD4DE","EFEFEF","FF530D"],["E1E6FA","C4D7ED","ABC8E2","375D81","183152"],["468966","FFF0A5","FFB03B","B64926","8E2800"],["2C3E50","E74C3C","ECF0F1","3498DB","2980B9"],["00585F","009393","FFFCC4","F0EDBB","FF3800"],["63A69F","F2E1AC","F2836B","F2594B","CD2C24"],["002635","013440","AB1A25","D97925","EFE7BE"],["F2385A","F5A503","E9F1DF","4AD9D9","36B1BF"],["304269","91BED4","D9E8F5","FFFFFF","F26101"],["D5FBFF","9FBCBF","647678","2F3738","59D8E6"],["1A1F2B","30395C","4A6491","85A5CC","D0E4F2"],["272F32","9DBDC6","FFFFFF","FF3D2E","DAEAEF"],["004056","2C858D","74CEB7","C9FFD5","FFFFCB"],["FFFFFA","A1A194","5B605F","464646","FF6600"]],render:function(){var F=this.getTemplate("template-color-picker-swatches");return _.template(F)({swatches:this.mSwatches})},addEvents:function(){this.mEl.querySelector(".color-swatches-content").addEvent("click",function(F){F&&F.stop&&F.stop(),F.target.classList.contains("single-color")&&this.manualColorChange(F.target.style.backgroundColor)}.bind(this))}});
var ColorPickerMooRainbow=new MooTools.Class({name:"ColorPickerMooRainbow",options:{id:"mooRainbow",prefix:"moor-",startColor:[255,0,0],opacity:null,onComplete:MooTools.$empty,onChange:MooTools.$empty},isLocked:!0,Implements:[MooTools.Events,MooTools.Options],initialize:function(t,i,e){if(this.element=$(t),this.element){this.parentEl=i,this.setOptions(e);var s=!1;"array"!=MooTools.$type(this.options.startColor)&&(this.options.startColor=new Color("#FFFFFF","rgb"),s=!0),this.sliderPos=0,this.sliderOpacityPos=0,this.pickerPos={x:0,y:0},this.sets={rgb:[],hsb:[],hex:[],rgba:null},this.setLayout(),this.setOverlayEvents(),this.setSliderEvents(this.layout.slider,this.layout.trigger,this.sliderDrag),this.setSliderEvents(this.layout.sliderOpacity,this.layout.triggerOpacity,this.sliderDragOpacity),this.layout.triggerOpacity.setStyle("left",this.layout.sliderOpacity.getSize().x),this.options.opacity?(this.layout.triggerOpacity.setStyle("left",Math.round(this.options.opacity*this.layout.sliderOpacity.getSize().x)+this.snippet("triggerHalfWidth","int")),this.setOpacityInputValue(Math.round(100*this.options.opacity))):s&&this.layout.triggerOpacity.setStyle("left",0),this.sliderOpacityPos=this.snippet("triggerOpacityPosition")-this.snippet("triggerHalfWidth","int"),this.manualSet(this.options.startColor),this.pickerPos.x=this.snippet("cursorPosition").l+this.snippet("cursorSize","int").w,this.pickerPos.y=this.snippet("cursorPosition").t+this.snippet("cursorSize","int").h,this.sliderPos=this.snippet("triggerPosition")-this.snippet("triggerHalfWidth","int"),this.isLocked=!1}},setLayout:function(){this.container=this.parentEl.querySelector("section.middle-content-container div.color-picker-content"),this.layout=this.container.querySelector("div.color-spectrum"),this.layout.slider=this.container.querySelector("div.range-input-wrapper"),this.layout.sliderOpacity=this.container.querySelector("div.color-opacity");var t=document.createElement("a");t.classList.add(this.options.prefix+"cursor"),t.style.overflow="hidden",t.style.position="absolute",t.style.zIndex=2,this.layout.appendChild(t),this.layout.cursor=this.container.querySelector("."+this.options.prefix+"cursor"),this.layout.trigger=this.container.querySelector("div.range-input-wrapper span a"),this.layout.triggerOpacity=this.container.querySelector("div.color-opacity span a"),this.opacityInput=new ColorPickerControlInputMinMax(this.container.querySelector("input.action-color-opacity"),0,100,{suffix:"%"}),this.hexInput=this.container.querySelector("div.color-data .action-color-hex"),this.rgbInput=this.container.querySelector("input.action-color-rgb"),this.inputSwitcher=this.container.querySelector("div.color-data .action-input-switcher")},manualSet:function(t,i,e){(!i||"hsb"!=i&&"hex"!=i)&&(i="rgb");var s,o;"rgb"==i?(s=t,o=t.rgbToHsb(),t.rgbToHex()):"hsb"==i?(o=t,s=t.hsbToRgb(),s.rgbToHex()):(t,s=t.hexToRgb(!0),o=s.rgbToHsb()),this.setMooRainbow(s),this.autoSet(o),e&&this.onChange(),this.onOpacityChange(this.getOpacityInputValue()),this.setOpacityInputValue(this.getOpacityInputValue())},onChange:function(){if(this.isLocked)return!1;this.getOpacityInputValue()&&100!=this.getOpacityInputValue()?this.sets.rgba="rgba("+this.sets.rgb[0]+","+this.sets.rgb[1]+","+this.sets.rgb[2]+","+this.getOpacityInputValue()/100+")":this.sets.rgba=null,this.fireEvent("onChange",[this.sets,this])},autoSet:function(t){var i,e=this.snippet("cursorSize","int").h,s=this.snippet("cursorSize","int").w,o=this.layout.getSize().y,r=this.layout.getSize().x,n=this.layout.slider.getSize().x,a=Math.round(r*t[1]/100-s),h=Math.round(-o*t[2]/100+o-e),l=Math.round(n*t[0]/360);l=360==l?0:l;var u=n-l+Math.round(this.layout.trigger.getSize().x/2)-4;this.layout.cursor.setStyles({top:h,left:a}),this.layout.trigger.setStyle("left",u),i=[this.sets.hsb[0],100,100].hsbToRgb(),this.layout.setStyle("background-image","linear-gradient(rgba(0, 0, 0, 0) 0%, rgb(0, 0, 0) 100%), linear-gradient(to right, rgb(255, 255, 255) 0%, rgb("+i[0]+", "+i[1]+", "+i[2]+") 100%)"),this.sliderPos=this.snippet("triggerPosition")-this.snippet("triggerHalfWidth","int"),this.sliderOpacityPos=this.snippet("triggerOpacityPosition")-this.snippet("triggerHalfWidth","int")},snippet:function(t,i){var e;switch(i=i||"none",t){case"triggerPosition":var s=this.layout.trigger.style.left.toInt();e=s;break;case"triggerOpacityPosition":var s=this.layout.triggerOpacity.style.left.toInt();e=s;break;case"triggerHalfWidth":var o=this.layout.trigger.getSize().x;o="int"==i?(o/2).toInt():o,e=o;break;case"cursorPosition":var r=this.layout.cursor.style.left.toInt(),s=this.layout.cursor.style.top.toInt();e={l:r,t:s};break;case"cursorSize":var n=this.layout.cursor.getSize().y,o=this.layout.cursor.getSize().x;n="int"==i?(n/2).toInt():n,o="int"==i?(o/2).toInt():o,e={w:o,h:n}}return e},setMooRainbow:function(t,i){(!i||"hsb"!=i&&"hex"!=i)&&(i="rgb");var e,s,o;"rgb"==i?(e=t,s=t.rgbToHsb(),o=t.rgbToHex()):"hsb"==i?(s=t,e=t.hsbToRgb(),o=e.rgbToHex()):(o=t,e=t.hexToRgb(),s=e.rgbToHsb()),this.sets={rgb:e,hsb:s,hex:o},this.rgbInput.value=e[0]+", "+e[1]+", "+e[2],this.hexInput.value=o},parseColors:function(t,i,e){var s=Math.round(100*t/this.layout.getSize().x),o=100-Math.round(100*i/this.layout.getSize().y),r=360-Math.round(360*e/this.layout.slider.getSize().x);return r-=this.snippet("triggerHalfWidth","int"),r=r>=360?0:r<0?0:r,s=s>100?100:s<0?0:s,o=o>100?100:o<0?0:o,[r,s,o]},setOverlayEvents:function(){var t,i=this.snippet("cursorSize","int").h,e=this.snippet("cursorSize","int").w;this.inputSwitcher.addEvent("change",function(t){"RGB"==this.inputSwitcher.value?(this.hexInput.classList.add("hidden"),this.rgbInput.classList.remove("hidden")):(this.hexInput.classList.remove("hidden"),this.rgbInput.classList.add("hidden"))}.bind(this)),[this.rgbInput,this.hexInput].each(function(t){t.addEvent("keyup",this.eventKeyup.bindWithEvent(this,t)),t.addEvent("focus",this.eventFocus.bindWithEvent(this,t))},this),this.opacityInput.addEvent("onChange",this.eventKeyup.bindWithEvent(this,this.opacityInput.mEl)),t={x:[0-e,this.layout.getSize().x-e],y:[0-i,this.layout.getSize().y-i]},this.layout.drag=new Drag(this.layout.cursor,{limit:t,onBeforeStart:this.overlayDrag.bind(this),onStart:this.overlayDrag.bind(this),onDrag:this.overlayDrag.bind(this),onComplete:this.dragComplete.bind(this),snap:0,stopPropagation:!0,preventDefault:!0}),this.layout.addEvent("mousedown",function(t){this.layout.cursor.setStyles({top:t.page.y-this.layout.getTop()-i-2,left:t.page.x-this.layout.getLeft()-e}),this.layout.drag.start(t),this.layout.drag.stop(t)}.bind(this)),this.opacityInput.mEl.addEvent("focus",function(t){this.opacityInput.mEl.value=this.getOpacityInputValue()}.bind(this)),this.opacityInput.mEl.addEvent("blur",function(t){this.opacityInput.mEl.value=this.getOpacityInputValue()+"%"}.bind(this))},overlayDrag:function(t,i){void 0!==i&&ColorPicker.preventDestroy(!0);var e=!0;_.isUndefined(i)&&(e=!1),e&&this.layout.classList.add("dragging");var s=this.snippet("cursorSize","int").h,o=this.snippet("cursorSize","int").w;this.pickerPos.x=this.snippet("cursorPosition").l+o,this.pickerPos.y=this.snippet("cursorPosition").t+s,this.setMooRainbow(this.parseColors(this.pickerPos.x,this.pickerPos.y,this.sliderPos),"hsb"),this.onChange(),e&&this.layout.classList.remove("dragging")},dragComplete:function(t,i){setTimeout(function(){ColorPicker.preventDestroy(!1)}.bind(this),10)},setSliderEvents:function(t,i,e){var s=[0,t.getSize().x],o=new Drag(i,{limit:{x:s},modifiers:{y:!1},onBeforeStart:e.bind(this),onStart:e.bind(this),onDrag:e.bind(this),onComplete:this.dragComplete.bind(this),stopPropagation:!0,preventDefault:!0,snap:0});t.addEvent("mousedown",function(e){e=new MooTools.Event(e),i.setStyle("left",e.page.x-t.getLeft()-Math.round(i.getSize().x/2)),o.start(e),o.stop(e)}.bind(this))},sliderDrag:function(t,i){void 0!==i&&ColorPicker.preventDestroy(!0);var e=void 0!==i;e&&this.layout.slider.children[0].classList.add("dragging");var s;this.sliderPos=this.snippet("triggerPosition")-this.snippet("triggerHalfWidth","int"),this.setMooRainbow(this.parseColors(this.pickerPos.x,this.pickerPos.y,this.sliderPos),"hsb"),s=[this.sets.hsb[0],100,100].hsbToRgb(),this.layout.setStyle("background-image","linear-gradient(rgba(0, 0, 0, 0) 0%, rgb(0, 0, 0) 100%), linear-gradient(to right, rgb(255, 255, 255) 0%, rgb("+s[0]+", "+s[1]+", "+s[2]+") 100%)"),this.onChange(),e&&this.layout.slider.children[0].classList.remove("dragging")},sliderDragOpacity:function(t,i){void 0!==i&&ColorPicker.preventDestroy(!0);var e=void 0!==i;e&&this.layout.sliderOpacity.children[0].classList.add("dragging"),this.onOpacityChange(),this.setOpacityInputValue(this.getOpacityInputValue()),e&&this.layout.sliderOpacity.children[0].classList.remove("dragging")},onOpacityChange:function(t){t&&this.layout.triggerOpacity.setStyle("left",Math.round(t/100*this.layout.sliderOpacity.getSize().x)),this.sliderOpacityPos=this.snippet("triggerOpacityPosition")-this.snippet("triggerHalfWidth","int");var i=this.snippet("triggerOpacityPosition");this.opacityInput.mEl.value=t||parseInt(100*(i/this.layout.sliderOpacity.getSize().x).toFixed(2)),this.onChange()},eventFocus:function(t,i){setTimeout(function(){i.select()}.bind(this),50)},eventKeyup:function(t,i){var e,s=(t.code,t.key,i.value.charAt(0));if(MooTools.$chk(i.value)){if(i.classList.contains("action-color-hex")){if("#"!=s&&6!=i.value.length)return;if("#"==s&&7!=i.value.length)return}if(i.classList.contains("action-color-rgb"))rawColors=i.value.match(/(\d+), ?(\d+), ?(\d+)/),rawColors&&rawColors[1]>=0&&rawColors[1]<=255&&rawColors[2]>=0&&rawColors[2]<=255&&rawColors[3]>=0&&rawColors[3]<=255&&(this.manualSet([rawColors[1],rawColors[2],rawColors[3]]),this.onChange());else if(i.classList.contains("action-color-opacity")){if(i.value<0||i.value>100)return;this.onOpacityChange(i.value)}else{if(e=i.value.hexToRgb(!0),isNaN(e[0])||isNaN(e[1])||isNaN(e[2]))return;MooTools.$chk(e)&&(this.manualSet(e),this.onChange())}}},getOpacityInputValue:function(){return this.opacityInput.mEl.value.replace("%","")},setOpacityInputValue:function(t){this.opacityInput.mEl.value=t+"%"},destroy:function(){this.inputSwitcher.removeEvents(),this.opacityInput.mEl.removeEvents(),this.opacityInput.removeEvents(),this.layout.sliderOpacity.removeEvents(),this.layout.slider.removeEvents(),this.rgbInput.removeEvents(),this.hexInput.removeEvents(),this.layout.removeEvents(),this.removeEvents()}});
var MooRainbowWrapper=new MooTools.Class({Implements:[MooTools.Options,MooTools.Events],options:{color:""},mLayer:null,mMooWrapper:null,mMooRainbow:null,initialize:function(o,t){this.mLayer=o,this.setOptions(t)},render:function(){var o="transparent"!=this.options.color.hex&&this.options.color.hex?new Color(this.options.color.hex):null,t=this.options.color.opacity?this.options.color.opacity:null;this.colorInput=this.mLayer.querySelector("input.action-color-hex"),this.mMooRainbow=new ColorPickerMooRainbow(this.colorInput,this.mLayer,{startColor:o,opacity:t,onChange:function(o){this.fireEvent("change",[o])}.bind(this)}),this.colorInput.addEvent("keyup",this.manualColorSet.bind(this)),this.colorInput.addEvent("manualSet",this.manualColorSet.bind(this)),this.opacityInput=this.mLayer.querySelector("input.action-color-opacity"),this.opacityInput.addEvent("manualSet",this.manualOpacitySet.bind(this))},manualColorSet:function(o){var t,n=function(){try{dpManager.Analytics.analyticsEvent("app","hex color","colorpicker")}catch(o){}};MooTools.$clear(t),6==this.colorInput.get("value").replace("#","").length&&(o.type&&"keyup"==o.type&&(t=n.delay(500)),this.mMooRainbow.eventKeyup(o,this.colorInput))},manualOpacitySet:function(o){this.mMooRainbow.eventKeyup(o,this.opacityInput)},destroy:function(){this.mMooRainbow.destroy(),this.mMooRainbow=null,this.opacityInput.removeEvents(),this.colorInput.removeEvents(),this.removeEvents()}});
!function(t){"use strict";var e=new MooTools.Class({name:"ColorPicker",Implements:[MooTools.Options,MooTools.Events],options:{value:"",text:"Color",property:"color",property_gradient:"background-image",with_gradient_class:"with-gradient-panel",with_gradient_editor:!1,process_set_property:!0,onChange:function(){}},initialize:function(t,e){this.mActiveEl=t,this.setOptions(e)},getPropertyValue:function(t){if(this.options[t])return this.options[t];var e=this.getActiveEl();return e&&e.getProperty(t)?e.getProperty(t):null},getActiveEl:function(){return this.mActiveEl},buildDefaultWidgets:function(){var t=null;this.options.with_gradient_editor&&this.options.gradient_value?t=this.options.gradient_value:this.options.property_gradient&&(t=this.getPropertyValue(this.options.property_gradient));var e={property:this.options.property,property_gradient:this.options.property_gradient,value:this.options.value||this.getPropertyValue(this.options.property),gradient_value:t,with_gradient_editor:this.options.with_gradient_editor,with_gradient_class:this.options.with_gradient_class,onChange:this.onColorChange.bind(this)},i=[];return i.push({name:"header",widget:ColorPickerWidgetHeader,options:e},{name:"middle-content-container",widget:ColorPickerWidgetMiddleContentContainer,options:e},{name:"middle-favourites",widget:ColorPickerWidgetFavourites,options:e}),uxpft.enabled(FEATURE_DESIGN_LIBRARIES)&&i.push({name:"middle-design-library",widget:ColorPickerDesignLibrary,options:e}),i.push({name:"middle-picker-container",widget:ColorPickerWidgetPickerContainer,options:e}),this.options.with_gradient_editor&&i.push({name:"middle-picker-gradient",widget:ColorPickerWidgetGradient,options:e}),i.push({name:"middle-picker-rainbow",widget:ColorPickerWidgetPickerRainbow,options:e},{name:"middle-predefined",widget:ColorPickerWidgetPredefined,options:e},{name:"middle-swatches",widget:ColorPickerWidgetSwatches,options:e},{name:"footer",widget:ColorPickerWidgetFooter,options:this.options},{name:"rainbow-init",widget:ColorPickerWidgetMooRainbow,options:e}),i},setPropertyOnElem:function(t,e){if(e){for(var i=t.length;i<8;i++)t[i]=void 0;return t[8]=!0,e.setProperty.apply(e,t)}return!1},onColorChange:function(t,e){var i=this.getActiveEl();i&&(this.options.process_set_property&&this.options.with_gradient_editor&&e.gradient?(this.setPropertyOnElem([this.options.property_gradient,e.gradient,!0,!0],i),this.setPropertyOnElem([this.options.property,"transparent",!0,!0,1],i)):this.options.process_set_property&&(e=e.rgba||e.hex||e,this.setPropertyOnElem([t,e,!0,!0],i),(i&&i.isVirtualElement()||this.options.with_gradient_editor)&&"string"==typeof this.getPropertyValue(this.options.property_gradient)&&!this.getPropertyValue(this.options.property_gradient).match(/http/i)&&this.setPropertyOnElem([this.options.property_gradient,"",!0,!0,1],i))),this.fireEvent("change",[t,e])},close:function(){var t=document.querySelector("div.color-picker input.action-color-hex");if(t&&(t=t.value,"#"===t.charAt(0)&&7===t.length)){var e=ColorPickerWidgetPredefined.getUserColorsLastUsed();for(var i in e)if(e[i]===t)return void this.destroy();_.isArray(e)&&e.length>7?e.splice(-1):_.isArray(e)||(e=[]),e.unshift(t),this.fireEvent("onSetLastUsedColors",{colors:e}),ColorPickerWidgetPredefined.updateUserColorsLastUsed(e)}if(this.options.with_gradient_editor&&this.mColorPickerWidgetsManager){var r=this.mColorPickerWidgetsManager.getWidget("middle-picker-gradient").getCurrentStyle();if(this.mColorPickerWidgetsManager.getWidget("middle-picker-gradient").isGradientEditorVisible()&&r.test(/gradient/)&&r!==this.options.gradient_value)try{dpManager.Analytics.analyticsEvent("app","gradient color","colorpicker")}catch(t){}}this.destroy()},destroy:function(){this.mColorPickerWidgetsManager&&(_.each(this.mColorPickerWidgetsManager.getWidgets(),function(t){t.removeEvents(),t.destroy&&t.destroy()}),this.mColorPickerWidgetsManager.destroy(),this.mColorPickerWidgetsManager=null),this.templatesContainer&&(this.templatesContainer.destroy(),this.templatesContainer.removeEvents(),this.templatesContainer=null)},renderTo:function(t){return this.mColorPickerWidgetsManager=new ColorPickerWidgetsManager(this,this.buildDefaultWidgets()),this.templatesContainer=document.createElement("div"),_.each(this.mColorPickerWidgetsManager.getWidgets(),function(t){var e=this.templatesContainer.querySelector("."+t.options.parentElement);e?e.innerHTML=e.innerHTML+t.render():this.templatesContainer.innerHTML=this.templatesContainer.innerHTML+t.render(),t.mEl=this.templatesContainer,t.addEvent("onSetFavouriteColors",function(t){this.fireEvent("onSetFavouriteColors",t)}.bind(this))}.bind(this)),this.mColorPickerWidgetsManager.mIsRendered=!0,t.appendChild(this.templatesContainer),this.addEvents(),t},addEvents:function(){_.each(this.mColorPickerWidgetsManager.getWidgets(),function(t){t.addEvents(),t.afterRender()}.bind(this))},generateGradientFromDeprecatedProperty:function(){var t=new Color(this.getPropertyValue(this.options.property),"rgb"),e=new Color(this.colorLuminance(this.getPropertyValue(this.options.property),.2),"rgb");return"linear-gradient(0deg, rgba("+t[0]+", "+t[1]+", "+t[2]+", 1) 0%, rgba("+e[0]+", "+e[1]+", "+e[2]+", 1) 100%)"},colorLuminance:function(t,e){t=MooTools.String(t).replace(/[^0-9a-f]/gi,""),t.length<6&&(t=t[0]+t[0]+t[1]+t[1]+t[2]+t[2]),e=e||0;var i,r,o="#";for(r=0;r<3;r++)i=parseInt(t.substr(2*r,2),16),i=Math.round(Math.min(Math.max(0,i+i*e),255)).toString(16),o+=("00"+i).substr(i.length);return o}});e.preventDestroy=function(t){this.mPreventDestroy=t},e.isPreventDestroy=function(){return this.mPreventDestroy},t.ColorPicker=e}(window);
!function(t){"use strict";function i(){return dpManager.dpWorkBench.getWorkBenchEl()}function e(t){t.classList.add("color-picker-new-ui")}t.ColorPickerWindow=new MooTools.Class({name:"ColorPickerWindow",Implements:[MooTools.Options,MooTools.Events],mOffset:{elementMargin:10,layerWidth:0,triggerWidth:0,layerTop:-18,boundsMargin:5},mToolsBoxPosition:null,mEl:null,mActiveEl:null,mEventRefs:{},mDejax:null,mActiveClassName:"visible",options:{value:"",gradient_value:"",property:"",property_gradient:"",with_gradient_editor:"",positioning_element:"",additional_classes:[],fixed:!1,openCallback:null,closeCallback:null},initialize:function(t,i,e){this.mActiveEl=t,this.setOptions(i),this.mDejax=new Dejax,this.emitter=new EventEmitter,e&&_.extend(this.mOffset,e),this.addToggleOnTransformationEvents()},getActiveEl:function(){return this.mActiveEl},addToggleOnTransformationEvents:function(){this.mEventRefs={resize:this.toggle.bind(this,!1),resizeStop:this.toggle.bind(this,!0),move:this.toggle.bind(this,!1),moveStop:this.toggle.bind(this,!0),rotationStart:this.toggle.bind(this,!1),rotationStop:this.toggle.bind(this,!0)},this.mActiveEl&&this.mActiveEl.addEvents({resize:this.mEventRefs.resize,resizeStop:this.mEventRefs.resizeStop,move:this.mEventRefs.move,moveStop:this.mEventRefs.moveStop,rotationStart:this.mEventRefs.rotationStart,rotationStop:this.mEventRefs.rotationStop})},removeToggleOnTransformationEvents:function(){this.mActiveEl&&this.mActiveEl.removeEvents({resize:this.mEventRefs.resize,resizeStop:this.mEventRefs.resizeStop,move:this.mEventRefs.move,moveStop:this.mEventRefs.moveStop})},onColorPickerChange:function(t,i){this.fireEvent("change",[t,i])},render:function(){var t=document.querySelector("div.stand-alone.color-picker"),i=document.querySelector("div#free-canvas div#canvas");t&&t.destroy(),this.mEl=document.createElement("div"),this.mEl.classList.add("tools-box-layer"),this.mEl.classList.add("stand-alone"),this.mEl.classList.add("color-picker"),this.options.fixed&&this.mEl.classList.add("color-picker-fixed"),e(this.mEl),this.options.class_name&&this.mEl.classList.add(this.options.class_name),this.options.additional_classes.length>0&&this.options.additional_classes.forEach(function(t){this.mEl.classList.add(t)}.bind(this)),this.options.fixed?document.getElementById("layout").appendChild(this.mEl):i?i.appendChild(this.mEl):dpManager.dpWorkBench.getWorkBenchElMain().appendChild(this.mEl),_.isFunction(this.options.openCallback)&&this.options.openCallback(),this.options.onChange=this.onColorPickerChange.bind(this),this.colorPicker=new ColorPicker(this.getActiveEl(),this.options),this.colorPicker.renderTo(this.mEl),this.colorPicker.addEvent("onSetLastUsedColors",this.onSetLastUsedColors.bind(this)),this.colorPicker.addEvent("onSetFavouriteColors",this.onSetFavouriteColors.bind(this)),this.mEventRefs.destroy=this.clickOnWindow.bind(this),window.addEventListener("click",this.mEventRefs.destroy)},onSetFavouriteColors:function(t){this.emitter.emit("onSetFavouriteColors",t.colors)},onSetLastUsedColors:function(t){this.emitter.emit("onSetLastUsedColors",t.colors)},addListener:function(t,i){this.emitter.on(t,i)},removeListener:function(t,i){this.emitter.off(t,i)},setPosition:function(){var t,e,s=i(),o={offset:this.mOffset};this.options.positioning_element?e=this.options.positioning_element:this.mActiveEl&&(e=this.mActiveEl.mEl),this.mActiveEl&&this.mActiveEl.mToolbar&&this.mActiveEl.mToolbar.mEl.classList.contains("tool-layer-on-left")&&(o=_.extend(o,{prioritySide:"left"})),t=new ToolsBoxPosition(this.mEl,e,s,o),t.setPosition(),t=null},toggle:function(t){t||!this.isActive()?this.quickShow():this.quickHide()},show:function(){this.setPosition(),this.mEl.classList.add(this.mActiveClassName),this.mEventRefs.keyDown=this.keyDown.bind(this),window.addEventListener("keydown",this.mEventRefs.keyDown)},hide:function(){this.fireEvent("close"),this.mEl.destroy()},quickHide:function(){this.mEl.hide()},quickShow:function(){this.mEl.show(),this.setPosition()},clickOnWindow:function(t){var i,e,s=!1,o=!1,n=!1,l=!1,r=!1;if(!ColorPicker.isPreventDestroy()){if(this.mActiveEl&&(s=!this.mActiveEl.isVirtualElement()&&t.target.getParent("div.dpContainer")===this.mActiveEl.mEl),o=!!document.querySelector("div.color-picker")&&(t.target.classList.contains("picker")||t.target.classList.contains("color-preview")||"fontcolor"===t.target.id||"backcolor"===t.target.id||t.target.parentNode.classList.contains("color")||t.target.classList.contains("color")),n=t.target.classList.contains("close-stand-alone"),l=t.target.classList.contains("action-system-color-picker"),r=!1,t.target.classList.contains("color-picker"))r=!0;else{i=this.getParents(t.target);for(e in i)if(i[e].classList&&i[e].classList.contains("color-picker")){r=!0;break}}!n&&(s||r||o||l)||this.destroy()}},getParents:function(t){for(var i,e=[],s=t.parentNode;null!==s;)i=s,e.push(i),s=i.parentNode;return e},destroy:function(t){t=t||{},t.noAnimation?this.mEl.destroy():this.mEl.onTransitionEnd(function(){this.mEl.destroy()}.bind(this)),this.colorPicker&&this.colorPicker.close&&this.colorPicker.close(),this.mEl.removeEvents(),this.removeToggleOnTransformationEvents(),window.removeEventListener("click",this.mEventRefs.destroy),this.mEventRefs.destroy=null,window.removeEventListener("keydown",this.mEventRefs.keyDown),this.mEventRefs.keyDown=null,this.hide(),this.fireEvent("close"),_.isFunction(this.options.closeCallback)&&this.options.closeCallback(),this.removeEvents()},isActive:function(){return this.mEl&&this.mEl.hasClass(this.mActiveClassName)},keyDown:function(t){t.keyCode===Enums.KEYS.TAB&&t.preventDefault(),t.keyCode===Enums.KEYS.ESC&&this.destroy()}})}(window);
var ColorPickerWidgetsManager=new MooTools.Class({name:"ColorPickerWidgetsManager",Implements:[MooTools.Options,MooTools.Events],mColorPickerWindow:null,mWidgets:{},mIsRendered:!1,initialize:function(i,e){this.mColorPickerWindow=i,this.add(e)},add:function(i){MooTools.Array.isArray(i)?i.map(this.registerWidgets.bind(this),this):this.registerWidgets(i)},registerWidgets:function(i){var e=i.options||{};e.name=i.name,this.mWidgets[i.name]=new i.widget(this,e)},getWidget:function(i){return void 0!==this.mWidgets[i]?this.mWidgets[i]:null},getWidgets:function(){return this.mWidgets},getColorPickerWindow:function(){return this.mColorPickerWindow},isRendered:function(){return this.mIsRendered},destroy:function(){this.mWidgets={},this.mColorPickerWindow=null}});
var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(){"use strict";var t=function t(e){this.elements=[],this.columns={},this.options=t.mergeCopyObjects({el:null,items:{use_this:!1,width:200,minHeight:50,marginTop:0,marginLeft:0,marginRight:0,marginBottom:0}},e),-1===["absolute","relative"].indexOf(getComputedStyle(this.options.el).position)&&(this.options.el.style.position="relative")};t.prototype.activate=function(){this.resizeRef=this.resize.bind(this),window.addEventListener("resize",this.resizeRef),this.resize()},t.prototype.deactivate=function(){window.removeEventListener("resize",this.resizeRef)},t.prototype.resize=function(t){var e=this.getRightEdge();(e>this.getRealContainerWidth()||e+this.getItemWidth()<this.getRealContainerWidth())&&(this.setStdColumns(),this.elements.forEach(function(t){this.setItemPosition(t.container,t.options),this.updateColumns(t.container)}.bind(this)))},t.prototype.append=function(e,i){i=t.mergeCopyObjects(this.options.items,i);var o=this.createItem(e,i);return this.appendToDOM(o),this.elements.push({container:o,options:i}),o},t.prototype.createItem=function(t,e){var i;if(e.use_this)if("string"==typeof t){var o=document.createElement("div");o.innerHTML=t,i=o.children[0]}else i=t;else i=document.createElement("div"),"string"==typeof t?i.innerHTML=t:i.appendChild(t);return i=this.setItemStyles(i,e),i=this.setItemPosition(i,e)},t.prototype.setItemStyles=function(t,e){return t.style.position="absolute",t.style.width=parseInt(e.width,10)+"px",e.minHeight>0&&(t.style.minHeight=parseInt(e.minHeight,10)+"px"),e.height>0&&(t.style.height=parseInt(e.height,10)+"px"),t.style.marginLeft=e.marginLeft?e.marginLeft+"px":"",t.style.marginTop=e.marginTop?e.marginTop+"px":"",t.style.marginRight=e.marginRight?e.marginRight+"px":"",t.style.marginBottom=e.marginBottom?e.marginBottom+"px":"",t},t.prototype.setItemPosition=function(t,e){var i=this.countPosition(this.getItemWidth(e));return t.style.top=i.top+"px",t.style.left=i.left+"px",t},t.prototype.countPosition=function(t){var e,i,o={top:1/0,left:0},n=this.getRightEdge();if(n+t<this.getRealContainerWidth())return o.top=0,o.left=n,o;for(var s in this.columns)this.columns.hasOwnProperty(s)&&this.columns[s].bottom<o.top&&(i=this.columns[this.getNextColumn(s)],this.columns[s].width>=t||i&&i.bottom<=this.columns[s].bottom?(o.top=this.columns[s].bottom,o.left=parseInt(this.columns[s].left,10)):this.columns[s].width<t&&e&&e.bottom<=this.columns[s].bottom&&(o.top=this.columns[s].bottom,o.left=e.left),e=this.columns[s]);return o},t.prototype.appendToDOM=function(t){this.options.el.appendChild(t),this.updateColumns(t)},t.prototype.setStdColumns=function(){this.columns={};for(var t=this.getRealContainerWidth(),e=this.getItemWidth(),i=0;i+e<t;)this.columns[i]={left:i,width:e,bottom:0},i+=e},t.prototype.updateColumns=function(t){var e=parseInt(t.style.top,10),i=parseInt(t.style.left,10),o=this.getItemWidth({width:parseInt(t.style.width,10),marginLeft:this.getItemMargin(t,"Left"),marginRight:this.getItemMargin(t,"Right")});void 0===this.columns[i]&&(this.columns[i]={left:i,width:o});for(var n in this.columns){var s=this.columns[n];this.columns.hasOwnProperty(n)&&(s.left===i||s.left>i&&i+o>s.left)&&(s.bottom=e+t.offsetHeight+this.getItemMargin(t,"Top")+this.getItemMargin(t,"Bottom"))}},t.prototype.getNextColumn=function(t){var e,i=!1;for(var o in this.columns)if(this.columns.hasOwnProperty(o)&&o===t)i=!0;else if(this.columns.hasOwnProperty(o)&&i){e=o;break}return e},t.prototype.getItemWidth=function(e){var i=t.mergeCopyObjects(this.options.items,e),o=i.width;return i.marginLeft>0&&(o+=i.marginLeft),i.marginRight>0&&(o+=i.marginRight),o},t.prototype.getItemMargin=function(t,e){return t.style["margin"+e]?parseInt(t.style["margin"+e],10):0},t.prototype.getRightEdge=function(){var t=0;for(var e in this.columns)if(this.columns.hasOwnProperty(e)){var i=this.columns[e];i.left+i.width>t&&(t=i.left+i.width)}return t},t.prototype.getRealContainerWidth=function(){var t=this.options.el,e=parseInt(t.offsetWidth,10);return t.scrollHeight>t.offsetHeight&&(e-=18),e},t.prototype.clear=function(t){this.elements=[],this.setStdColumns(),(void 0===t||t)&&(this.options.el.innerHTML="")},t.mergeCopyObjects=function(e,i){var o={};for(var n in e)e.hasOwnProperty(n)&&(o[n]=e[n]);if("object"===(void 0===i?"undefined":_typeof(i)))for(var s in i)i.hasOwnProperty(s)&&("el"!==s&&"object"===_typeof(i[s])?o[s]=t.mergeCopyObjects(o[s],i[s]):o[s]=i[s]);return o},window.UXPGrid=t}();
!function(e){"use strict";var t=function(){this.listeners={},this.unprocessedShotCollection=[]};t.prototype.emitSocketUpdate=function(){"undefined"!=typeof socket&&dpManager.isCollaboration()&&socket.emit("teamLibrariesUpdated")},t.prototype.isDesignLibrariesActive=function(){return uxpft.enabled(FEATURE_DESIGN_LIBRARIES)&&uxpft.enabled(FEATURE_DESIGN_LIBRARIES_UI_ELEMENTS)&&uxpft.enabled(FEATURE_SYMBOLS)},t.prototype.addElementToLibraries=function(e,t){var n=function(n){n.forEach(function(e){dpManager.User.elements.push(e),this.getShot(e.id_element)}.bind(this)),dpManager.Analytics.kissEvent("app-libraries-addelement",{"app-libraries-addelement-number":e.libraries.length,"app-libraries-addelement-source":t}),this.emitSocketUpdate(),this.broadcast("refreshElements",n)}.bind(this);(new Dejax).newRequest({url:"/ajax/UserElements/AddElementToLibraries/",mode:"cancel",data:e,onComplete:n})},t.prototype.librariesExternallyUpdated=function(){(new Dejax).newRequest({url:"/ajax/UserElements/GetUserAll/",mode:"cancel",onComplete:function(e){dpManager.User.libraries=e[0],dpManager.User.elements=e[1],dpManager.User.visible_libraries=e[2],this.broadcast("externallyUpdated",dpManager.User.elements)}.bind(this)})},t.prototype.getPromoCountDown=function(){var e,t=document.createElement("div"),n=utils.RenderTemplate("template-libraries-promo-countdown",{daysRemaining:dpManager.User.promotion_expires.custom_libraries});return t.insertAdjacentHTML("beforeend",n),e=t.children[0],this.addUpgradeEvent(e.querySelector(".action-upgrade")),e},t.prototype.addUpgradeEvent=function(e){e.addEventListener("click",function(e){e.preventDefault(),dpManager.showSpecUpgrade("plusa"),dpManager.UserElements.sendKissUpgradeEvent()})},t.prototype.sendKissUpgradeEvent=function(){dpManager.Analytics.kissEvent("app-libraries-upgrade-called")},t.prototype.prepareElement=function(){var e=dpManager.dpWorkBench.getActivePage().getActiveElements(),t=[];return e.forEach(function(e){var n=e.toHash();DPElementGeneric.isAggregation(n.type)&&(n.stored_elements.forEach(function(e){t.push(e)}),delete n.stored_elements,delete n.deltas),t.push(n)}),t},t.prototype.uniqueSearch=function(){return _.uniqBy(dpManager.User.elements,function(e){return e.id_element})},t.prototype.deleteElementFromList=function(e,t){return MooTools.Array.prototype.filter.call(e,function(e){return e.id_element!==t})},t.prototype.renameElementInList=function(e,t,n){return e.forEach(function(r){if(r.id_element===t)return r.name=n,r.label=n,e}),e},t.prototype.deleteLibraryFromLists=function(e){var t=this.findLibraryIndex(dpManager.User.libraries,"id_library",e);dpManager.User.libraries.splice(t,1),dpManager.User.visible_libraries.splice(dpManager.User.visible_libraries.indexOf("c"+e)),dpManager.User.elements=dpManager.User.elements.filter(function(t){return t.id_library!==e})},t.prototype.findLibraryIndex=function(e,t,n){for(var r=0;r<e.length;r++)if(e[r][t]===n)return r;return-1},t.prototype.isLibraryEditable=function(e){var t=_.find(dpManager.User.libraries,function(t){return t.id_tree===e});return!(!t||!t.is_editable)&&1===parseInt(t.is_editable)},t.prototype.deleteElement=function(e,t){(new Dejax).newRequest({url:"/ajax/UserElements/DeleteElement/",mode:"cancel",data:e,onComplete:function(e){dpManager.User.elements=this.deleteElementFromList(dpManager.User.elements,e.id_element),this.emitSocketUpdate(),this.broadcast("elementRemoved",e,t)}.bind(this)})},t.prototype.setSawCustomLibraries=function(){(new Dejax).newRequest({url:"/ajax/UserElements/SetSawCustomLibraries/",mode:"cancel",onComplete:function(){}})},t.prototype.addLibrary=function(e,t,n){(new Dejax).newRequest({url:"/ajax/UserElements/AddLibrary/",mode:"cancel",data:{name:e,edit_scope:t,access_scope:n},onComplete:function(e){!1!==e&&(dpManager.User.libraries.push(e),dpManager.User.visible_libraries.push("c"+e.id_library),dpManager.Analytics.kissEvent("app-libraries-addlibrary"),dpManager.Analytics.kissEvent("app-libraries-permission",{"access-scope":e.access_scope,"edit-scope":e.edit_scope}),this.emitSocketUpdate(),this.broadcast("libraryAdded",e))}.bind(this)})},t.prototype.deleteLibrary=function(e){(new Dejax).newRequest({url:"/ajax/UserElements/DeleteLibrary/",mode:"cancel",data:e,onComplete:function(e){!1!==e&&(this.deleteLibraryFromLists(e),this.emitSocketUpdate(),this.broadcast("libraryRemoved",e))}.bind(this)})},t.prototype.renameElement=function(e,t){(new Dejax).newRequest({url:"/ajax/UserElements/UpdateElementName/",mode:"cancel",data:{id_element:e,name:t},onComplete:function(e){dpManager.User.elements=this.renameElementInList(dpManager.User.elements,e.id_element,e.name),this.emitSocketUpdate(),this.broadcast("elementRenamed",e.id_element,e.name)}.bind(this)})},t.prototype.updateLibrary=function(e,t,n,r){(new Dejax).newRequest({url:"/ajax/UserElements/UpdateLibrary/",mode:"cancel",data:{id_library:e,name:t,edit_scope:n,access_scope:r},onComplete:function(e){!1!==e&&(dpManager.User.libraries.forEach(function(t,n){if(t.id_library===e.id_library)return void(dpManager.User.libraries[n]=e)}.bind(this)),dpManager.Analytics.kissEvent("app-libraries-permission",{"access-scope":e.access_scope,"edit-scope":e.edit_scope}),this.emitSocketUpdate(),this.broadcast("libraryUpdated",e))}.bind(this)})},t.prototype.setVisibleLibraries=function(e){dpManager.User.visible_libraries=e,this.broadcast("visibility-changed")},t.prototype.undoDelete=function(e,t){(new Dejax).newRequest({url:"/ajax/UserElements/UndoDelete/",mode:"cancel",data:{item:e,id:t},onComplete:function(t){if("library"===e)dpManager.User.libraries.push(t),dpManager.User.visible_libraries.push("c"+t.id_library),this.emitSocketUpdate(),this.broadcast("libraryAdded",t);else if("element"===e){for(var n=0,r=t.length;n<r;n++)dpManager.User.elements.push(t[n]),this.getShot(t[n].id_element);this.emitSocketUpdate(),this.broadcast("elementAdded",t)}}.bind(this)})},t.prototype.getShot=function(e){var t;this.unprocessedShotCollection.push({attempts:10,elementData:{id_page:e}});var n=function(){console.warn("Error receiving shot.")},r=function(e){e&&!1!==e.shot&&(this.updateElementShot(e.id_page,e.shot),this.unprocessedShotCollection.shift()),this.unprocessedShotCollection.length||clearInterval(t)}.bind(this);1===this.unprocessedShotCollection.length&&(t=setInterval(function(){(new Dejax).newRequest({url:"/ajax/UserElements/GetShot/",mode:"cancel",data:this.unprocessedShotCollection[0].elementData,onComplete:r,onError:n}),--this.unprocessedShotCollection[0].attempts,0===this.unprocessedShotCollection[0].attempts&&this.unprocessedShotCollection.shift(),this.unprocessedShotCollection.length||clearInterval(t)}.bind(this),4e3))},t.prototype.getAllShots=function(e,t){var n=function(e,t){t||(t=[]),t.forEach(function(t){_.filter(e,function(e){e.id_element===t.id_page&&(t.shot?e.icon=t.shot:this.getShot(t.id_page))}.bind(this))}.bind(this))}.bind(this),r=function(e){n(dpManager.User.elements,e),this.broadcast("refreshElements"),"function"==typeof t&&t()}.bind(this),i=[];e.forEach(function(e){var t={};t.id_page=e.id_element,i.push(t)}),(new Dejax).newRequest({url:"/ajax/UserElements/GetBulkShot/",mode:"cancel",data:i,onComplete:r})},t.prototype.updateElementShot=function(e,t){!function(t,n){t.forEach(function(t){parseInt(t.id_element,10)===parseInt(e,10)&&(t.icon=n)})}(dpManager.User.elements,t),this.broadcast("refreshElements")},t.prototype.newElementModal=function(e,t){if(dpManager.User.libraries.length>1){var n=new AddElementModal(e,t);document.body.appendChild(n.render().el),setTimeout(n.show.bind(n,1))}else if(1===dpManager.User.libraries.length){var r={element:t||this.prepareElement(),name:"Custom element#"+(dpManager.User.elements.length+1),libraries:[dpManager.User.libraries[0].id_library]};this.addElementToLibraries(r,e)}},t.prototype.isLibraryVisible=function(e){return _.some(dpManager.User.visible_libraries,function(t){return t.toString()===e.toString()})},t.prototype.on=function(e,t,n){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push({fn:t,context:n||this})},t.prototype.broadcast=function(e){if(this.listeners[e])for(var t=MooTools.Array.prototype.slice.call(arguments,1),n=0;n<this.listeners[e].length;n++)this.listeners[e][n].fn.apply(this.listeners[e][n].context,t)},e.UserElements=t}(window);
//# sourceMappingURL=maps/core.js.map
